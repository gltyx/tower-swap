!function(){var k={};!function(){Math.sign||(Math.sign=function(a){return(a>0)-(a<0)||+a}),k._log=console.log.bind(console),window.location.host,k._storage=localStorage,k._storage||(k._storage={}),k._rngm=2147483648,k._rnga=1103515245,k._rngc=12345,k._rngstate=0,k.canvassaves=0,k.glis=1,k.touchx=0,k.touchy=0,k.mousedownmouse=0,k.mouses={},k.resized=!1,k.now=0,k._fpstime=0,k._fpsloops=0,k._fpstimewanted=1e3/60,k._nowold=new Date().getTime(),k._elapsed=0,k.fps=0,k.loops=0,k.running=0,k._inputs={},k._keyboardhid=0,k._keyboardshowed=0,k._keyshit=[],k.keydown=[],k.keyhit=[],k.keyreleased=[],k.mousedowntime=0,k.mousehitany=0,k.mousedownany=0,k.mousereleasedany=0,k.mouseclickedany=0,k.clickendedtime=0,k.mousewheelspeed=0,k.debugon=1,k._fontsize=22,k.font="arial",k.scalex=1,k.scaley=1,window.gtboffsetx=0,window.gtboffsety=0,window.gtboffsettransformedx=0,window.gtboffsettransformedy=0,k.color={r:255,g:255,b:255,a:255},k.transparency=0,k.imagesmoothing=!1,k._transforms=[],k.images=[],k.sounds=[],k.devicename="device",k._draw=0,k._drawcanvas=0,k._drawrgb=4294967040,k._degreestoradians=Math.PI/180,k._hacksound=0,k._hacksoundplayed=0,k._inevent=0,k.audiocontext=null;var a=window.AudioContext||window.webkitAudioContext||!1;try{k.audiocontext=new a}catch(b){k._log(b)}k.debugset=function(a){"footershow"==a?footer.style.display="flex":"footerhide"==a?footer.style.display="none":"whenapploaded"==a?(window.crazysdk=window.CrazyGames.CrazySDK.getInstance(),crazysdk.init(),crazysdk.addEventListener("adFinished",function(){gn(),gj()}),crazysdk.addEventListener("adError",gk)):"adLoadTry"==a?crazysdk.requestAd("rewarded"):"achievementdid"==a&&crazysdk.happytime()},k.debugonset=function(a){this.debugon=a,window.gdebugdiv&&(a?gdebugdiv.style.display="block":gdebugdiv.style.display="none"),window.gcmddivide&&(gcmddivide=a?gcmddividesafe:gcmddividefast)},k.runtimeerror=function(a,b){this._storage.userid,this._throw(a,b)},k._throw=function(b,c){var a={};throw(b>0||0===b)&&(a.line=b+1),a.stack=a.message=c,a},k.debugquit=function(a){this._throw(a,"debugquit")},k.mousexget=function(b){var a=this._mousegetbycmdindex(b);return a?a.x:0},k.mouseyget=function(b){var a=this._mousegetbycmdindex(b);return a?a.y:0},k.mousedownget=function(b){var a=this._mousegetbycmdindex(b);return a?a.down:0},k.mousemovedget=function(b){if(b<0)for(var c in this.mouses){var a=this.mouses[c];if(a.down&&a.movedsincedown)return 1}else{var a=this._mousegetbycmdindex(b);return a?a.down&&a.movedsincedown:0}},k._mousegetbycmdindex=function(b){for(var c in this.mouses){var a=this.mouses[c];if(a.cmdindex==b)return a}},k._mouseadd=function(b){var a=this.mouses[b];if(a)return a;if((a={}).index=b,a.x=0,a.y=0,a.oldx=0,a.oldy=0,a.speedx=0,a.speedy=0,a.down=0,a.downx=0,a.downy=0,a.movedsincedown=0,"real"==b)a.cmdindex=0;else for(a.cmdindex=1;this._mousegetbycmdindex(a.cmdindex);)a.cmdindex++;return this.mouses[b]=a,a},k.mousereal=k._mouseadd("real"),k.ggl={canvassizex:0,canvassizey:0,verti:0,alpha:255,imagedraw:function(y,z,A,B,f,g,r,s,t,h,i,l,m,q){var a=this.verti;if(a>=this.vertmax2)return 0;var b=this.verts;if(void 0!==t){var u=h*h,v=i*i,n=Math.PI+t,o=h-r,w=o*o,p=i-s,x=p*p,c=Math.atan2(i,h)+n,d=Math.sqrt(u+v);b[a]=f+Math.cos(c)*d*l,b[a+1]=g+Math.sin(c)*d*m;var c=Math.atan2(i,o)+n,d=Math.sqrt(w+v);b[a+2]=f+Math.cos(c)*d*l,b[a+3]=g+Math.sin(c)*d*m;var c=Math.atan2(p,h)+n,d=Math.sqrt(u+x);b[a+4]=f+Math.cos(c)*d*l,b[a+5]=g+Math.sin(c)*d*m;var c=Math.atan2(p,o)+n,d=Math.sqrt(w+x);b[a+6]=f+Math.cos(c)*d*l,b[a+7]=g+Math.sin(c)*d*m}else f-=h,g-=i,b[a]=b[a+4]=f,b[a+1]=b[a+3]=g,b[a+2]=b[a+6]=f+r,b[a+5]=b[a+7]=g+s;var j=this.vertrgbas,k=a/2;q+=this.alpha,j[k]!=q&&(j[k]=j[k+1]=j[k+2]=j[k+3]=q);var e=this.uvs;e[a]=e[a+4]=y,e[a+1]=e[a+3]=z,e[a+2]=e[a+6]=A,e[a+5]=e[a+7]=B,this.verti+=8},draw:function(){if(!this.canvassizex)return 0;if(this.ready){var a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,this.uvbuf),a.bufferData(a.ARRAY_BUFFER,this.uvs,a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertbuf),a.bufferData(a.ARRAY_BUFFER,this.verts.subarray(0,this.verti),a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertrgbabuf),a.bufferData(a.ARRAY_BUFFER,this.vertrgbas,a.STATIC_DRAW),a.drawElements(a.TRIANGLES,Math.round(.75*this.verti),a.UNSIGNED_SHORT,0)}this.verti=0},resize:function(){this.canvassizex=this.canvas.width,this.canvassizey=this.canvas.height,this.gl.viewport(0,0,this.canvassizex,this.canvassizey);var a=this.gl.getUniformLocation(this.shaderprogram,"canvassizex");this.gl.uniform1f(a,this.canvassizex/2);var a=this.gl.getUniformLocation(this.shaderprogram,"canvassizey");this.gl.uniform1f(a,this.canvassizey/2)},setup:function(i){this.canvas=i;var a=i.getContext("experimental-webgl",{preserveDrawingBuffer:!0});if(this.gl=a,!a)return k.glis=0,0;a.clearColor(0,0,0,1);var f=a.createShader(a.VERTEX_SHADER);a.shaderSource(f,"				attribute vec4 attrgba;				attribute vec2 attvert;				attribute vec2 atttex;								varying highp vec2 fragtex;				varying vec4 fragabgr;								uniform lowp float canvassizex;				uniform lowp float canvassizey;								void main(void) {					gl_Position = vec4(attvert.x/canvassizex - 1.0, 1.0 - attvert.y/canvassizey, 0.0, 1.0);					fragtex = atttex;					fragabgr = attrgba.abgr;				}			"),a.compileShader(f),a.getShaderParameter(f,a.COMPILE_STATUS)||alert(a.getShaderInfoLog(f));var g=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(g,"				varying highp vec2 fragtex;				varying highp vec4 fragabgr;				uniform sampler2D usampler;								void main(void) {					gl_FragColor = texture2D(usampler, fragtex) * fragabgr;				}			"),a.compileShader(g),a.getShaderParameter(g,a.COMPILE_STATUS)||alert(a.getShaderInfoLog(g));var b=a.createProgram();a.attachShader(b,f),a.attachShader(b,g),a.linkProgram(b),a.useProgram(b),this.shaderprogram=b;var j=a.getAttribLocation(b,"atttex");this.uvbuf=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.uvbuf),a.vertexAttribPointer(j,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(j);var h=a.getAttribLocation(b,"attvert");this.vertbuf=a.createBuffer();var l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertbuf),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,l),a.vertexAttribPointer(h,2,a.SHORT,!1,0,0),a.enableVertexAttribArray(h);var h=a.getAttribLocation(b,"attrgba");this.vertrgbabuf=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertrgbabuf),a.vertexAttribPointer(h,4,a.UNSIGNED_BYTE,!0,0,0),a.enableVertexAttribArray(h),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.enable(a.BLEND),a.disable(a.DEPTH_TEST),this.imagemax=6e3,this.vertmax=4*this.imagemax,this.vertmax2=2*this.vertmax,this.trianglemax=this.vertmax/2*3,this.indexmax=6*this.imagemax;var c=new Uint16Array(this.indexmax);this.indices=c;for(var d=0,e=0;d<this.indexmax;)c[d]=e,c[d+1]=e+1,c[d+2]=e+2,c[d+3]=e+1,c[d+4]=e+2,c[d+5]=e+3,d+=6,e+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,c,a.STATIC_DRAW),this.uvs=new Float32Array(this.vertmax2),this.verts=new Int16Array(this.vertmax2),this.vertrgbas=new Uint32Array(this.vertmax)},texloadfromjsimage:function(c){k._log("texloadfromjsimage()"),this.jsimage=c,this.texsizex=c.width,this.texsizey=c.height;for(var b,d=-1;b=k.images[++d];)b.texx2=b.texx+b.sizex/this.texsizex,b.texy2=b.texy+b.sizey/this.texsizey,b.loaded=1;var a=this.gl;a.bindTexture(a.TEXTURE_2D,a.createTexture()),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.generateMipmap(a.TEXTURE_2D),a.activeTexture(a.TEXTURE0),this.ready||(this.resize(),this.ready=1)},texload:function(b,c,d){k._log("texload() "+b),this.ready=0;var a=new Image;a.onload=(function(){k._log("tex loaded "+a.src),this.texloadfromjsimage(a)}).bind(this),a.onerror=function(){alert("Texture failed to load: "+b)},this.texsizex=c,this.texsizey=d,a.src=b},texcanvasconvert:function(){this.texcanvas||(this.texcanvas=k.canvasmake(this.texsizex,this.texsizey),this.texcanvasdraw=this.texcanvas.getContext("2d"),this.texcanvasdraw.drawImage(this.jsimage,0,0))},clear:function(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT)},texunload:function(){k._log("texunload()"),this.jsimage=0,this.texcanvas=0,this.ready=0}},k._hacksoundplay=function(){this._inevent=1,!this._hacksoundplayed&&this._hacksound&&(this.audiocontext.resume&&this.audiocontext.resume(),this.soundplay(this._hacksound),this._hacksound.loaded&&(this._hacksoundplayed=1,galldiv.removeAttribute("onclick"),galldiv.onclick=function(){})),this._inevent=0},k._onscroll=function(a){var b;b=a.detail?-120*a.detail:a.wheelDelta,this.mousewheelspeed=b},k.setup=function(){this.mobile=0;var a=navigator.userAgent;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a)?(this.mobile=1,(a=a.toLowerCase()).indexOf("android")>=0?this.devicename="Android":a.indexOf("iphone")>=0?this.devicename="iPhone":a.indexOf("ipad")>=0?this.devicename="iPad":a.indexOf("ipod")>=0&&(this.devicename="iPod")):(this.devicename="Windows computer","Mac"==navigator.platform.substr(0,3)&&(this.devicename="Mac computer"));var b=document.createElement("div");b.innerHTML="			<input type='password' id=gbginput spellcheck='false' autocomplete='off' style='position:absolute;top:40px;left:0;width:1px;height:1px;font-size:1px;border:none' />			<canvas width='0' height='0' id='gglcanvas' style='position:absolute;top:0;left:0'></canvas>			<canvas width='0' height='0' id='gcanvas' style='position:relative;top:0;left:0'></canvas>			<canvas width='0' height='0' id='gtex' style='display:none;position:absolute;top:0;left:0'></canvas>			<div id=gfginputs></div>		",window.galldiv=document.getElementById("galldiv"),galldiv.appendChild(b),window.gcanvas=document.getElementById("gcanvas"),this._drawcanvas=gcanvas,this._draw=this._drawcanvas.getContext("2d"),this.imagesmoothingset(!1),this.mobile?(this._hacksound=this._soundloadonline("./nothing.wav"),galldiv.onclick=this._hacksoundplay.bind(k)):this._hacksoundplayed=1,window.addEventListener("mousemove",k._onmousemove.bind(k)),window.addEventListener("mousedown",k._onmousedown.bind(k)),window.addEventListener("mouseup",k._onmouseup.bind(k)),window.addEventListener("keydown",k._onkeydown.bind(k)),window.addEventListener("keyup",k._onkeyup.bind(k)),window.addEventListener("resize",k._onresize.bind(k)),window.addEventListener("blur",k.inputclear.bind(k)),document.addEventListener("DOMMouseScroll",k._onscroll.bind(k)),window.addEventListener("mousewheel",k._onscroll.bind(k)),document.addEventListener("touchstart",(function(a){this._log("touchstart",a.changedTouches),this._inevent=1;for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c],b=this._mouseadd(d.identifier);b.x=d.clientX,b.y=d.clientY,this.mousereal.x=b.x,this.mousereal.y=b.y,b.down=1,this._clickstarted(a,b)}return this._inevent=0,!this._blocktaps(a)||(a.preventDefault(),!1)}).bind(k),{passive:!1}),document.addEventListener("touchend",(function(a){this._log("touchend",a.changedTouches),this._inevent=1;for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c],b=this._mouseadd(d.identifier);b.x=d.clientX,b.y=d.clientY,this.mousereal.x=b.x,this.mousereal.y=b.y,this._clickended(a,b)}return this._inevent=0,!this._blocktaps(a)||(a.preventDefault(),!1)}).bind(k),{passive:!1}),document.addEventListener("touchcancel",(function(a){this._log("touchcancel",a.changedTouches),this._inevent=1;for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c],b=this._mouseadd(d.identifier);b.x=d.clientX,b.y=d.clientY,this.mousereal.x=b.x,this.mousereal.y=b.y,this._clickended(a,b)}return this._inevent=0,a.preventDefault(),!1}).bind(k),{passive:!1}),document.addEventListener("touchmove",(function(b){this._log("touchmove",b.targetTouches),this._inevent=1;for(var c=0,d=0;d<b.targetTouches.length;d++){var e=b.targetTouches[d],a=this._mouseadd(e.identifier);a.x=e.clientX,a.y=e.clientY,a.down,this.mousereal.x=a.x,this.mousereal.y=a.y,this._mousemoved(a),this._clickmoved(a),this.clickmovedcallback&& !1==this.clickmovedcallback(b,a)&&(c=1)}if(this._inevent=0,this.running&&(c=1),c)return b.preventDefault(),!1}).bind(k),{passive:!1}),document.addEventListener("visibilitychange",(function(){if(this.running)for(var a,b=-1;a=this.sounds[++b];)document.hidden?(a.loopstoppedminimize=0,a.looping&&(a.loopstoppedminimize=1),this.soundstop(a)):a.loopstoppedminimize&&(a.loopstoppedminimize=0,this.soundloop(a))}).bind(k),!1),this.running=1,this.rngsetup(new Date().getTime()),this._draw.textAlign="left",this._draw.textBaseline="top",this._transformsapply(),this.glis&&this.ggl.setup(gglcanvas),this._onresize()},k.fpsset=function(a){a>0||(a=1),this._fpstimewanted=1e3/a},k.updatesget=function(){this.now=new Date().getTime(),this._elapsed+=this.now-this._nowold;var a=0;return this._elapsed>=this._fpstimewanted&&(a=Math.floor(this._elapsed/this._fpstimewanted),this._elapsed-=this._fpstimewanted*a,a>99&&(a=1,this._elapsed=0)),this._nowold=this.now,a},k.draw=function(){for(var b in this._fpsloops++,this.now>this._fpstime&&(this._fpstime=this.now+1e3,this.fps=this._fpsloops,this._fpsloops=0),this._inputs){var a=this._inputs[b];a.drew||(gfginputs.removeChild(a.div),delete this._inputs[b]),a.drew=0}k.glis&&k.ggl.draw()},k.update=function(){for(var b in this.loops++,this.resized=!1,this.mouses){var a=this.mouses[b];a.speedx=a.x-a.oldx,a.speedy=a.y-a.oldy,a.oldx=a.x,a.oldy=a.y}this._keyboardhid=0,this._keyshit=[],this.keyhit=[],this.keyreleased=[],this.mousehitany=0,this.mousereleasedany=0,this.mouseclickedany=0,this.mousewheelspeed=0},k._blocktaps=function(a){if(this.running){if(console.log(a.target.tagName),"A"==a.target.tagName)return a.target.click(),0;if("INPUT"==a.target.tagName)return 0;if(this._hacksoundplayed&&!this._keyboardhid)return 1}this._keyboardshowed=0},k.canvasreset=function(){this._transforms=[],this._transformsreapply(),this._draw.textAlign="left",this._draw.textBaseline="top"},k._onresize=function(a){this.screensizex=Math.max(document.documentElement.clientWidth,window.innerWidth||0),this.screensizey=Math.max(document.documentElement.clientHeight,window.innerHeight||0),this.screensizex&&(gcanvas.setAttribute("width",this.screensizex),gcanvas.setAttribute("height",this.screensizey),gcanvas.style.width=this.screensizex+"px",gcanvas.style.height=this.screensizey+"px",this.glis&&(gglcanvas.setAttribute("width",this.screensizex),gglcanvas.setAttribute("height",this.screensizey),gglcanvas.style.width=this.screensizex+"px",gglcanvas.style.height=this.screensizey+"px"),this._transformsunapply(),this._draw.textAlign="left",this._draw.textBaseline="top",this._transformsapply(),this.running&&window.scrollTo(0,0),this.glis&&this.ggl.resize(),this.resized=!0,k.resize1callback&&(k.resize1callback(),k.resize1callback=0))},k._onmousedown=function(a){return this.mobile?0:(this._inevent=1,this._keyscheck(a),this.mousereal.x=a.clientX,this.mousereal.y=a.clientY,this.mousereal.down=1,this._clickstarted(a,this.mousereal),this._inevent=0,!this._blocktaps(a)||void a.preventDefault())},k._onmousemove=function(b){var a=this.mousereal;if(a.x=b.clientX,a.y=b.clientY,this._mousemoved(a),this.mouseoverdiv=b.target,a.down&&(this._clickmoved(a),this.clickmovedcallback&& !1==this.clickmovedcallback(b,a)))return b.preventDefault(),!1},k._mousemoved=function(a){a!=this.mousereal&&(this.mouseoverdiv=document.elementFromPoint(a.x,a.y),this._log("mouseoverdiv="+(this.mouseoverdiv&&this.mouseoverdiv.id))),this.mousemovedcallback&&this.mousemovedcallback(a)},k._keyscheck=function(a){this.keydown[16]&&!a.shiftKey&&(this._log("shift was not actually down"),this.keydown[16]=0,this.keyreleased[16]=1),this.keydown[17]&&!a.ctrlKey&&(this._log("control was not actually down"),this.keydown[17]=0,this.keyreleased[17]=1)},k._onmouseup=function(a){if(this.mobile)return 0;this._inevent=1,this._keyscheck(a),this._clickended(a,this.mousereal),this._inevent=0},k._onkeyup=function(a){this.keydown[a.keyCode]=0,this.keyreleased[a.keyCode]=1},k._onkeydown=function(a){this.keydown[a.keyCode]||(this.keydown[a.keyCode]=1,this.keyhit[a.keyCode]=1);var b=a.keyCode;if(this._keyshit.push(b),this._log("keydown",b,String.fromCharCode(b),this._keyshit),9==b)return a.preventDefault(),!1},k._clickmoved=function(a){if(a.down){var b=a.x,c=a.y;this.touchx=b,this.touchy=c;var d=6;(Math.abs(a.downx-b)>d||Math.abs(a.downy-c)>d)&&(a.movedsincedown=1)}},k._clickstarted=function(b,a){this.mousehitany=1,this.mousedownany=1,this.touchx=a.x,this.touchy=a.y,a.downx=a.x,a.downy=a.y,this.mousedownmouse=a,this.mousedowntime=this.now,a.movedsincedown=0,this.mouseoverdiv=b.target},k._clickended=function(b,a){for(var c in this._log("clickended()",a),a.down=0,this.mousereleasedany=1,this.mousedownany=0,this.mouses)if(this.mouses[c].down){this.mousedownany=1;break}if(!a.movedsincedown){if(this.mouseclickedany=1,this.now-this.clickendedtime<500&&this.clickeddoublecallback&&!this.clickeddoublecallback(b,a))return b.preventDefault(),!1;this.clickendedtime=this.now,this.clickedcallback&&this.clickedcallback(b,a)}a!=this.mousereal&&delete this.mouses[a.index]},k.soundplay=function(c,e,f){if(!c)throw"Play Sound: Sound is Null";var a=c.audio;if(!a)return 0;if(!c.loaded&&a.play){if(a.readyState>=4&&(c.loaded=1),this._inevent)c.loaded=1;else if(a.readyState<4)return 0}if(a.play){a.pause(),a.currentTime=0,a.volume=c.volume;var g=a.play();g&&g.catch&&g.catch(function(a){console.log("soundplay",a)})}else if(this.audiocontext){"suspended"==this.audiocontext.state&&(this._log("resume audiocontext"),this.audiocontext.resume());var b=this.audiocontext.createBufferSource();if(b&&(b.buffer=a,b.start||(b.start=b.noteOn),b.start)){var d=this.audiocontext.createGain();b.connect(d),d.connect(this.audiocontext.destination),d.gain.value=c.volume,f||e?f?b.start(0,e||0,f):b.start(0,e||0):b.start(),c.gainnode=d,c.playedtime=this.now}}},k.soundstop=function(a){if(!a.loaded)return 0;var b=a.audio;if(!b)return 0;a.looping=0,a.loopstopped=1,a.timeout&&(clearTimeout(a.timeout),a.timeout=0),b.play?(b.pause(),b.currentTime=0):(a.gainnode&&(a.gainnode.gain.value=0),a.playedtime=0)},k._soundloadonline=function(b){var a={};return a.volume=1,a.loaded=0,a.playedtime=0,a.audio=document.createElement("audio"),a.audio.addEventListener("canplaythrough",function(){a.loaded=1},!1),a.audio.src=b,a},k.soundadd=function(a){var b={};if(b.volume=1,b.version=1,b.loaded=0,b.playedtime=0,a&&a.substr){"/"==a[0]&&(a=this.rootpath?this.rootpath+a:a.substr(1));var c=function(a){b.loaded=1,b.audio=a};b.url=a,this._soundloadajax(a,c)}else b.audio=a,b.loaded=1;return this.sounds.push(b),b},k._soundloadajax=function(b,d){var c=this.audiocontext;if(!c)return 0;var a=new XMLHttpRequest;return a.open("GET",b,!0),a.responseType="arraybuffer",a.onload=function(){c.decodeAudioData(a.response,function(a){d&&d(a)},function(a){})},a.onerror=function(){},a.send(),a},k._listnodemake=function(b){var a={};return a.val=b,a.next=null,a.prev=null,a},k._listnodeget=function(b,c){for(var a=b.first;;){if(!a)return;if(a.val==c)return a;a=a.next}},k._listnoderemove=function(b,a){return a.prev?a.prev.next=a.next:b.first=a.next,a.next?a.next.prev=a.prev:b.last=a.prev,b.total--,a.prev=null,a},k._listnodeinsertafter=function(c,a,b,d){if(c.total++,d){if(!b&&!(b=c.first)){c.first=a,c.last=a;return}b.prev?b.prev.next=a:c.first=a,a.prev=b.prev,a.next=b,b.prev=a}else{if(!b&&!(b=c.last)){c.first=a,c.last=a;return}b.next?b.next.prev=a:c.last=a,a.prev=b,a.next=b.next,b.next=a}},k.imagedraw=function(a,b,c){return a?a.canvas?void(void 0!==a.angle?this._imagedrawrotated(a,b,c):this._draw.drawImage(a.canvas,b-a.offsetx,c-a.offsety)):(this._throw(void 0,"Draw Image: Image canvas is not set."),0):(this._throw(void 0,"Draw Image: Image value is not set."),0)},k.imagedrawgl=function(a,d,e,b,c){if(!a)return this._throw(void 0,"Draw Image: Image value is not set."),0;if(!a.glis){void 0!==b?this.imagedrawatsize(a,d,e,b,c):this.imagedraw(a,d,e);return}if(!this.ggl.ready)return this._throw(void 0,"Draw Image: Image has not finished loading."),0;var f=a.offsetx,g=a.offsety;void 0===b?(b=a.sizex,c=a.sizey):(f*=b/a.sizex,g*=c/a.sizey);var h=~~(window.gtboffsettransformedx+d*this.scalex),i=~~(window.gtboffsettransformedy+e*this.scaley);void 0===a.angle&&(f*=this.scalex,g*=this.scaley,b*=this.scalex,c*=this.scaley,b=Math.ceil(b),c=Math.ceil(c)),this.ggl.imagedraw(a.texx,a.texy,a.texx2,a.texy2,h,i,b,c,a.angle,f,g,this.scalex,this.scaley,a.rgb)},k.imagedrawglpart=function(a,f,i,g,h,d,e){if(!a)return this._throw(void 0,"Draw Image: Image value is not set."),0;if(g<0||h<0||d<0||e<0)return this._throw(void 0,"Draw Image Part: Part numbers must positive."),0;var b=a.sizex,c=a.sizey;if(a.glis||(b=a.canvas.width,c=a.canvas.height),d<0||d>b)return this._throw(void 0,"Draw Image Part: Part Width must be a positive number between 0 and the image width ("+b+") Was "+d),0;if(e<0||e>c)return this._throw(void 0,"Draw Image Part: Part Height must be a positive number between 0 and the image height ("+c+") Was "+e),0;if(!a.glis){this._draw.save(),this.canvassaves++,this._draw.beginPath(),this._draw.rect(f,f,d,e),this._draw.clip(),this._draw.drawImage(a.canvas,f-a.offsetx-g,i-a.offsety-h),this._draw.restore(),this.canvassaves--;return}if(!this.ggl.ready)return this._throw(void 0,"Draw Image: Image has not finished loading."),0;var j=a.offsetx,k=a.offsety,n=~~(window.gtboffsettransformedx+f*this.scalex),o=~~(window.gtboffsettransformedy+i*this.scaley),b=d,c=e;void 0===a.angle&&(j*=this.scalex,k*=this.scaley,b*=this.scalex,c*=this.scaley,b=Math.ceil(b),c=Math.ceil(c));var l=a.texx+(a.texx2-a.texx)*g/a.sizex,m=a.texy+(a.texy2-a.texy)*h/a.sizey,p=l+(a.texx2-a.texx)*d/a.sizex,q=m+(a.texy2-a.texy)*e/a.sizey;this.ggl.imagedraw(l,m,p,q,n,o,b,c,a.angle,j,k,this.scalex,this.scaley,a.rgb)},k._imagedrawrotated=function(a,b,c){this._draw.save(),this.canvassaves++,this._draw.translate(b,c),this._draw.rotate(a.angle),this._draw.drawImage(a.canvas,-a.offsetx,-a.offsety),this._draw.restore(),this.canvassaves--},k._imagedrawrotatedatsize=function(a,f,g,d,e){this._draw.save(),this.canvassaves++,this._draw.translate(f,g),this._draw.rotate(a.angle);var b=1,c=1;d<0&&(b=-1),e<0&&(c=-1),this._draw.scale(b,c),this._draw.drawImage(a.canvas,-a.offsetx*d/a.canvas.width*b,-a.offsety*e/a.canvas.height*c,Math.abs(d),Math.abs(e)),this._draw.scale(b,c),this._draw.restore(),this.canvassaves--},k.imagedrawatsize=function(a,d,e,b,c){if(!a)return this._throw(void 0,"Draw Image: Image value is not set."),0;if(!a.canvas)return this._throw(void 0,"Draw Image: Image canvas is not set."),0;if(b<0||c<0){if(void 0!==a.angle)this._imagedrawrotatedatsize(a,d,e,b,c);else{var f=1,g=1;b<0&&(f=-1),c<0&&(g=-1),this._draw.scale(f,g),this._draw.drawImage(a.canvas,d*f-a.offsetx,e*g-a.offsety,Math.abs(b),Math.abs(c)),this._draw.scale(f,g)}}else void 0!==a.angle?this._imagedrawrotatedatsize(a,d,e,b,c):this._draw.drawImage(a.canvas,d-a.offsetx,e-a.offsety,b,c)},k.imageaddgl=function(b,c,d,e){var a={};return a.glis=1,a.texx=b/this.ggl.texsizex,a.texy=c/this.ggl.texsizey,a.sizex=d,a.sizey=e,a.rgb=4294967040,a.offsetx=0,a.offsety=0,a.loaded=this.ggl.ready,this.images.push(a),a},k.imageadd=function(b){"/"==b[0]&&(b=this.rootpath?this.rootpath+b:b.substr(1));var a={};a.canvas=new Image,a.offsetx=0,a.offsety=0,a.canvas.onload=function(){a.loaded=1},a.canvas.src=b,this.images.push(a)},k.rngsetup=function(a){(!a||a<0)&&(a=0),this._rngstate=a||Math.floor(Math.random()*(this._rngm-1))},k._rngnextint=function(){return this._rngstate=(this._rnga*this._rngstate+this._rngc)%this._rngm,this._rngstate},k.arraymake=function(g,h,d,e,f){d<1&&this._throw(g,"Array length can't be less than 1. It was "+d);var c=[];if(void 0===e)for(var a=1;a<=d;a++)c[a]=h;else if(void 0===f){e<1&&this._throw(g,"Array height can't be less than 1. It was "+e);for(var a=1;a<=d;a++){c[a]=[];for(var b=1;b<=e;b++)c[a][b]=h}}else{f<1&&this._throw(g,"Array depth can't be less than 1. It was "+f);for(var a=1;a<=d;a++){c[a]=[];for(var b=1;b<=e;b++){c[a][b]=[];for(var i=1;i<=f;i++)c[a][b][i]=h}}}return c},k.fontsizeset=function(a){this._fontsize=a,this._draw.font=this._fontsize+"px "+this.font},k.fontset=function(a){this.font=a,this._draw.font=this._fontsize+"px "+this.font},k._offsettransform=function(){if(this.glis)for(var b=window.gtboffsetx,c=window.gtboffsety,a=0;a<this._transforms.length;a++){var d=this._transforms[a];if("scale"==d)b*=this.scalex,c*=this.scaley;else if("offset"==d){window.gtboffsettransformedx=b,window.gtboffsettransformedy=c;return}}},k._transformadd=function(a){var b=this._transforms.indexOf(a);b>=0&&this._transforms.splice(b,1),this._transforms.push(a)},k._transformsunapply=function(){this._draw.restore(),this.canvassaves--},k._transformsreapply=function(){this._transformsunapply(),this._transformsapply()},k._transformsapply=function(){this._draw.save(),this.canvassaves++;for(var a=0;a<this._transforms.length;a++){var b=this._transforms[a];"scale"==b?this._draw.scale(this.scalex,this.scaley):"offset"==b&&this._draw.translate(window.gtboffsetx,window.gtboffsety)}this.fontset(this.font),this.colorset(this.color),this.imagesmoothingset(this.imagesmoothing),this.transparencyset(this.transparency)},k._imagecanvasconvert=function(a){var b=this.canvasmake(a.canvas.width,a.canvas.height);b.getContext("2d").drawImage(a.canvas,0,0),a.canvas=b},k.colortostring=function(a){return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"},k.colorset=function(a){this.color=a,this._draw.fillStyle=this._draw.strokeStyle=this.colortostring(a),this.glis&&(this._drawrgb=16777216*a.r+(a.g<<16)+(a.b<<8))},k.transparencyset=function(a){if(a<0)throw"Transparency cannot be negative: "+a;if(a>1)throw"Transparency must be between 0 and 1. Was "+a;this._draw.globalAlpha=1-a,this.glis&&(this.ggl.alpha=Math.floor((1-a)*255)),this.transparency=a},k.imagemake=function(b,c){var a={};return a.url="",a.version=1,a.loaded=1,a.canvas=this.canvasmake(b,c),a.offsetx=0,a.offsety=0,a},k.canvasmake=function(c,d){var b=document.createElement("canvas");b.width=c,b.height=d;var a=b.getContext("2d");return a.imageSmoothingEnabled=!1,a.fillStyle="#FFF",a.strokeStyle="#FFF",a.textAlign="left",a.textBaseline="top",b},k.imageloaded=function(a){return a.glis?this.ggl.ready:!!a.loaded},k.imageloadonline=function(b){if("http"!=b.substr(0,4))return this._throw(0,'Image URL should start with "http" Instead found "'+b+'"'),0;var a={};return a.url=b,a.version=1,a.loaded=0,a.canvas=this._imageloadonline(b,a),a.offsetx=0,a.offsety=0,a},k._imageloadonline=function(b,d){var a=new Image,c=this.canvasmake(1,1);return a.onload=function(){c&&(c.width=a.width,c.height=a.height,c.getContext("2d").drawImage(a,0,0),d.loaded=1)},a.src=b,c},k.imagesmoothingset=function(a){this.imagesmoothing=this._draw.mozImageSmoothingEnabled=this._draw.webkitImageSmoothingEnabled=this._draw.msImageSmoothingEnabled=this._draw.imageSmoothingEnabled=a},k.inputclear=function(){this.keydown=[],this._keyshit=[],this.mouses={},this.mousereal=this._mouseadd("real"),this.touchx=0,this.touchy=0,this.mousedownmouse=0},k.notifications=[]}();var l=null,m=null,n=null,o=null,p=null,q=null,r=0,s=!1,t=0,u=0,v=0,w="",x="",y="",z=!1,A=null,B=null,C={total:0,first:null,last:null},D={total:0,first:null,last:null},E={total:0,first:null,last:null},F={total:0,first:null,last:null},G={total:0,first:null,last:null},H={total:0,first:null,last:null},I={total:0,first:null,last:null},J={total:0,first:null,last:null},K={total:0,first:null,last:null},L={total:0,first:null,last:null},M=0,N=!1,O=0,P=null,Q=0,R=0,S=0,T="",U=!1,V=0,W=0,X=0,Y=0,Z=0,$=0,_=0,aa=0,ab=0,ac=!1,ad=null,ae=0,af=!1,ag=!1,ah=!1,ai=0,aj=0,ak=0,al=0,am=null,an=0,ao=0,ap=0,aq=0,ar=0,as=0,at=0,au=0,av=0,aw=null,ax=0,ay=0,az=0,aA=null,aB=0,aC=null,aD=!1,aE=!1,aF=null,aG=0,aH=null,aI=0,aJ=null,aK=null,aL=null,aM=!1,aN=0,aO=0,aP=0,aQ=null,aR=0,aS=null,aT=null,aU=null,aV=null,aW=null,aX=null,aY=!1,aZ=!1,a$=null,a_=0,a0=null,a1=null,a2=0,a3=null,a4=0,a5=0,a6=0,a7=0,a8=!1,a9=0,ba=0,bb=null,bc=0,bd=0,be=0,bf=0,bg="",bh=!1,bi=!1,bj=!1,bk=!1,bl=!1,bm=!1,bn="",bo=!1,bp=!1,bq=null,br=null,bs=null,bt=null,bu={total:0,first:null,last:null},bv={total:0,first:null,last:null},bw={total:0,first:null,last:null},bx={total:0,first:null,last:null},by=0,bz=null,bA="",bB=!1,bC=!1,bD=!1,bE=0,bF=0,bG=0,bH=0,bI=0,bJ=0,bK=0,bL=0,bM=0,bN=0,bO=0,bP=0,bQ=0,bR=0,bS=0,bT=0,bU=0,bV=0,bW=0,bX=0,bY=0,bZ=0,b$=0,b_=0,b0=0,b1=0,b2=!1,b3=0,b4=0,b5=0,b6=0,b7=0,b8=0,b9=0,ca=0,cb=0,cc=0,cd=0,ce=0,cf=0,cg=0,ch=0,ci=0,cj=0,ck=0,cl=0,cm=0,cn=0,co=0,cp=0,cq=0,cr=0,cs=0,ct=0,cu=0,cv=0,cw=0,cx=0,cy=0,cz=0,cA=0,cB=0,cC=0,cD=0,cE=0,cF=0,cG=0,cH=0,cI=0,cJ=0,cK=0,cL=0,cM=0,cN=0,cO=0,cP=0,cQ=0,cR=0,cS=0,cT=0,cU=0,cV=0,cW=0,cX=null,cY=null,cZ=!1,c$=0,c_=0,c0=0,c1=null,c2=0,c3=!1,c4=!1,c5={total:0,first:null,last:null},c6=null,c7=null,c8=0,c9=null,da=null,db=!1,dc=!1,dd=!1,de=!1,df=0,dg=0,dh=0,di=null,dj=null,dk=0,dl=null,dm=0,dn=null,dp="",dq=0,dr=0,ds=0,dt=0,du=0,dv=0,dw=0,dx=null,dy=null,dz=null,dA=0,dB=null,dC=null,dD=null,dE=null,dF=null,dG=null,dH=null,dI=null,dJ=null,dK=null,dL=0,dM=null,dN=null,dO=0,dP=null,dQ=0,dR=0,dS=0,dT=0,dU=0,dV=0,dW=0,dX=0,dY=0,dZ=0,d$=0,d_=0,d0=0,d1=0,d2=null,d3=null,d4=null,d5=null,d6=0,d7=!1,d8="",d9=!1,ea=0,eb=null,ec=0,ed=0,ee=0,ef="crazygames",eg=!1,eh=!1,ei="",ej=0,ek=0,el=!1,em=0,en={total:0,first:null,last:null},eo=0,ep=0,eq=0,er=0,es=null,et=0,eu=null,ev=0,ew=0,ex=0,ey=0,ez=null,eA=0,eB=0,eC="",eD=0,eE=!1,eF=0,eG=0,eH=0,eI="",eJ=0,eK=null,eL=null,eM=null,eN=null,eO=!1,eP=null,eQ="",eR=null,eS=0,eT=null,eU=0,eV="",eW=0,eX=0,eY=null,eZ=!1,e$=!1,e_="",e0=0,e1="",e2=0,e3=!1,e4=0,e5=0,e6=0,e7=0,e8=0,e9=0,fa=0,fb=0,fc=0,fd=null,fe=null,ff=null,fg=null,fh=0,fi=!1,fj=!1,fk=0,fl=null,fm=null,fn=null,fo=null,fp=null,fq=null,fr=null,fs=null,ft=null,fu=null,fv=null,fw=null,fx=null,fy=null,fz=null,fA=0,fB=null,fC=null,fD=!1,fE=0,fF=0,fG=0,fH=0,fI=0,fJ=0,fK=0,fL=0,fM=0,fN=0,fO=0,fP=null,fQ=null,fR=null,fS=null,fT=null,fU=0,fV=0,fW=0,fX=null,fY=0,fZ="",f$=0,f_=!1,f0=null,f1=null,f2=null,f3=null,f4=null,f5=null,f6=null,f7=!1,f8=null,f9=null,ga=null,gb=null,gc=null,gd=null,ge=null,gf="",gg=0,gh=function(){requestAnimationFrame(gh);for(var b=k.updatesget(),a=0;a<b;a++)hM(),k.update();hJ(),k.draw()};function gi(a){if(dE==dy||dE==dF||dE==dz){if(dA>=5)return}else if(dA>=3)return;dA+=1,c_=0,g0(bI),k.debugset("achievementdid")}function gj(){var a="";if(k.debugset("ad closed!"),!z){gl();return}z=!1,k.cls({r:0,g:0,b:0,a:255}),ia(0,"playold1"),ia(0,"playold2"),bD&&ap<=0?(gF(),g0(cT),at=k.loops,ix(k.sounds[13]),I={total:0,first:null,last:null},G={total:0,first:null,last:null}):null!=aF&&0==aG&&(cv==b1||bG==b1)?(gS(),g0(b1),cH=3):null!=ad?(ad.Bought=!0,cv==bQ||bG==bQ?g0(bR):(hi(),g0(cc),iz(),ix(k.sounds[22]))):cv==cy||bG==cy?hg():(a="adwatched.php?",bC&&(a+="&level="+dE.Index),B=gp(a,!1),g0(cm)),w=""}function gk(){"crazygames"==ef?(hr("aderror","crazygames adError"),go()):gl()}function gl(){k.debugset("ad failed!"),hr("adfailed","ad failed"),w="failed",ap<=0?g0(cu):bG==bK&&g0(cv),s=!0}function gm(){if("loaded"==w){g0(bK);return}z=!1,w="loading",v=k.loops,k.soundstop(d4),k.soundstop(d2),k.soundstop(d3),k.soundstop(d5),k.debugset("adLoadTry"),("itch"==ef||"web"==ef)&&go()}function gn(){k.debugset("ad watched!"),z=!0,bD&&ap<=0&&h5()}function go(){A=gp("adget.php?",!1)}function gp(a,b){return"https"!=k.stringpart(a,1,5)&&(a=e1+("/"+a)),a+="&version="+M,b||(a+="&userid="+hn("userid"),a+="&token="+hn("token")),k.ajaxmake(a+("&platform="+ef))}function gq(){var a=0,b=null,c=0;for(a=1;a<=k.arraylengthget(es);a++)(b=es[a]).Time_Unlock_Started>0&&0>=b._Time_Remaining_Get()&&(c+=1);k.debugset("badgeset;"+c)}function gr(a,b,c){return a<=b||a>=c?0:k.clamp(Math.sin((a-b)/(c-b)*180*k._degreestoradians),0,1)}function gs(a,b,c,f){var d=0,e=0;null==a&&(alert("no avatar"),a=gt(0)),b+=-1,c+=-9,f&&(d=window.gtboffsetx,e=window.gtboffsety,k.scaleset(2*bE,2*bE),k.offsetset(d/2,e/2),b/=2,c/=2),k.imagedrawglpart(k.images[391],b,c,22*a.Grid_X,31*a.Grid_Y+0,22,28),f&&(k.scaleset(bE,bE),k.offsetset(d,e))}function gt(c){for(var b=null,a=bu.first;a;){if((b=a.val).Id==c)return b;a=a.next}return k.listfirstget(9,bu)}function gu(){var a="";a="avatarset.php?",a+="&avatar="+fT.Id,a+="&cost="+fT.Cost,P=gp(a,!1)}function gv(e){var c=0,b=null,f=null,d=0,g=0;for(g=1,c=1;g<=dR;g++)for(d=1;d<=dQ;d++){if(null!=(b=dP[d][g]))for(var h=K.first;h;){if((f=h.val).id==k.stringpart(e,c,1)){b.Kind=f,b.Tier_Index=1*k.stringpart(e,c+1,1)||0,b.Kind==fm&&b._Cannonslot_attach(),b.Kind==fw&&(b.dynamite_total=b.Tier_Index,b.Tier_Index=0),b.Kind==ft&&(b.Tier_Index=0,b.Water_depth=1*k.stringpart(e,c+1,1)||0,0==b.Water_depth&&(b.Water_depth=9999));break}h=h.next}c+=2}if(aw=k.arraymake(31,null,dQ),c<e.length)for(d=1;d<=dQ;d++){if("e"!=k.stringpart(e,c,1)){b=new a,aw[d]=b,b.Grid_x=d,b.Grid_y=0;for(var i=K.first;i;){if((f=i.val).id==k.stringpart(e,c,1)){b.Kind=f,b.Tier_Index=1*k.stringpart(e,c+1,1)||0;break}i=i.next}}c+=2}}function gw(){var a=0;ib(gy(),"board"),ia(hm("userid"),"boarduserid"),ia(d1,"swaps"),ia(a6,"day"),ia(ap,"castlehealth"),ia(he(),"levelprogress"),ia(dE.Index,"level"),ia(jM(eO,0),"repaired"),a=new Date().getTime(),dw>0&&(a=dw),dw=0,k.rngsetup(a),ia(a,"seed"),ia(a9,"dealsdone"),ia(ar,"healthmax"),ia(gx(),"test2"),k.debugset("board save locally seed="+a)}function gx(){var c=0,a=null,b=0,d=0;for(d=1;d<=dR;d++)for(b=1;b<=dQ;b++)null!=(a=dP[b][d])&&(c+=a.Tier_Index*a.Grid_y,c+=(a.Kind.id.charCodeAt(0)||0)*a.Grid_x);for(b=1;b<=dQ;b++)null!=(a=aw[b])&&(c+=a.Tier_Index,c+=(a.Kind.id.charCodeAt(0)||0)*a.Grid_x);return c+=7*ap,c+=3*d1}function gy(){var b="",a=null,c=0,d=0;for(d=1;d<=dR;d++)for(c=1;c<=dQ;c++)null!=(a=dP[c][d])?(b+=a.Kind.id,a.Kind==ft&&a.Water_depth<=9?b+=""+a.Water_depth:a.Kind==fw?b+=""+a.dynamite_total:b+=""+a.Tier_Index):b+="e0";for(c=1;c<=dQ;c++)null!=(a=aw[c])?(b+=a.Kind.id,b+=""+a.Tier_Index):b+="e0";return b}function gz(a,b,d,c){T=a,a6=k.mod(b,1e3),ie(),h7(),ap=0,ar=5+eJ,bC=!0,bD=!1,U=c,g0(bP)}function gA(e){var b=null,a=null,f="",d=null,c=0;for(k.debugset("buildings for sale from text "+e),C={total:0,first:null,last:null},d=k.split(e," "),c=1;c<=k.arraylengthget(d);c++)if(f=d[c],a=k.split(f,"@"),k.arraylengthget(a)>=4){if((b=new jO).Kind=iW(a[1]),null==b.Kind){alert("Error!");break}b.Level=1*a[2]||0,b.Cost=1*a[3]||0,b.Bought="1"==a[4],k.debugset("For sale "+b.Kind.id+a[4])}}function gB(h,b,a,i,m,j,f,n,l){var d=0,e=!1,g=null,c=0;i?(c=1.5*k.imagesizexget(k.images[97]),d=1.5*k.imagesizeyget(k.images[97])):(c=k.imagesizexget(k.images[97]),d=k.imagesizeyget(k.images[97])),j&&(c=k.imagesizexget(k.images[71]),d=k.imagesizeyget(k.images[71])),l&&(c=k.imagesizexget(k.images[431]),d=k.imagesizeyget(k.images[431])),m&&(b-=c/2),n&&g_(b+3,a+3,c,d,9,6),e=jc(b,a,c,d),l?k.mousedownany&&e&&!k.mousemovedget(-1)?(k.imagedrawgl(k.images[431],b,a),a+=1):k.imagedrawgl(k.images[430],b,a):j?k.mousedownany&&e&&!k.mousemovedget(-1)?(k.imagedrawgl(k.images[72],b,a),a+=1):k.imagedrawgl(k.images[71],b,a):k.mousedownany&&e&&!k.mousemovedget(-1)?(f?k.imagedrawgl(k.images[414],b,a,c,d):k.imagedrawgl(k.images[98],b,a,c,d),a+=1+jM(i,0)):f?k.imagedrawgl(k.images[413],b,a,c,d):k.imagedrawgl(k.images[97],b,a,c,d),ae=0,af=!1,("loading"!=w||"CANCEL"==h)&&(af=aZ&&e&&fG==bG&&!f,k.mousedownany&&e&&fG==bG&&!k.mousemovedget(-1)&&(ae=1+jM(i,0))),f&&k.transparencyset(.4),g=k.split(h,"/"),k.arraylengthget(g)>1?(iH(g[1],b+c/2,a+(d-30)/2,14,!0),iH(g[2],b+c/2,a+(d- -2)/2,14,!0)):iH(h,b+c/2,a+(d-14)/2,14,!0),k.transparencyset(0),ag&&(ag=!1,Y=b+window.gtboffsetx,Z=a+window.gtboffsety,X=c,W=d),ah&&(ah=!1,aa=b,ab=a,_=c,$=d),hC(b,a,c,d)&&(f||k.mousedownany&&k.mousemovedget(-1)||k.cursorset(119,"pointer"))}function gC(g,a,b,l,h,m,i,j){var e=null,c=0,f=!1,d=0;d=k.imagesizexget(k.images[289]),c=k.imagesizeyget(k.images[289]),i>0&&(d=i),j>0&&(c=j),l&&(a-=d/2),f=jc(a,b,d,c),k.colorset(k.colormake(88,88,88,255)),k.rectdraw(a,b,d,c),k.colorset(k.colormake(0,0,0,255)),k.mousedownany&&f&&!k.mousemovedget(-1)?(k.rectdraw(a,b,d,c-0),k.colorset(k.colormake(195,168,75,255)),e=k.images[292],b+=1):(k.rectdraw(a,b,d,c-1),k.colorset(k.colormake(222,191,85,255)),e=k.images[291]),k.rectdraw(a+1,b+1,d-2,c-3),k.imagedrawgl(e,a,b),g2(e,a+(d-k.imagesizexget(e)),b),k.imagedrawgl(e,a+d,b+(c-1),0-k.imagesizexget(e),0-k.imagesizeyget(e)),k.imagedrawgl(e,a,b+(c-1),k.imagesizexget(e),0-k.imagesizeyget(e)),af=aZ&&f&&fG==bG,ae=0,k.mousedownany&&f&&fG==bG&&!k.mousemovedget(-1)&&(ae=1),m?iJ(g,a+d/2,b+(c-22)/2,14,!0,!1):iJ(g,a+11,b+(c-10)/2,14,!1,!1),h&&(k.transparencyset(.8),k.colorset(k.colormake(0,0,0,255)),k.rectdraw(a,b,d,c)),k.transparencyset(0),ag&&(ag=!1,Y=a+window.gtboffsetx,Z=b+window.gtboffsety,X=d,W=c),ah&&(ah=!1,aa=a,ab=b,_=d,$=c),hC(a,b,d,c)&&(h?k.cursorset(70,"not-allowed"):k.mousedownany&&k.mousemovedget(-1)||k.cursorset(73,"pointer"))}function gD(b){var a=0;return a=(fA-11)*(b-1)+26,b>3&&(a+=42,b<6&&(a-=4)),dQ<6&&(a-=24),a}function gE(){var a=0;a=S-k.imagesizeyget(k.images[308])+ -12,k.imagedrawgl(k.images[314],R+V/2+0-k.imagesizexget(k.images[308])/2+76,a+20+174)}function gF(){eO=!0,at=k.loops,ix(k.sounds[13]),au=-1,ap=dE.Health_max_start,dE==dx?(ap=1,am[au=2]=0):(ap+=az,am=k.arraymake(11,0,dQ))}function gG(b,c,e,d){var a=0;d?(k.imagergbset(k.images[416],k.colormake(150,150,150,255)),k.imagergbset(k.images[410],k.colormake(150,150,150,255))):(k.imagergbset(k.images[416],k.colormake(255,255,255,255)),k.imagergbset(k.images[410],k.colormake(255,255,255,255))),k.imagedrawgl(k.images[416],b,c),e&&k.imagedrawgl(k.images[410],b+3,c+1),a=3,aD=!d&&aZ&&jc(b-a,c-a,22+2*a,22+2*a)&&fG==bG}function gH(){return bG==cq||bG==cW||bG==bU}function gI(){var f=0,b=0,i=0,c="",g=0,a="",d=0,h=0,e=0;for(d=1,c="GGGCCC888444000GCCG88G00C00800CGC8G80G00C0080CCG88G00G00B008GGCGG8GG0CC0880GFCGE8GC0C80840GCFG8EG0CC08804FCGE8GC0G80C408",aQ=k.arraymake(1,{r:0,g:0,b:0,a:255},c.length/3+0);d<=c.length;d++)b="0"==(a=k.stringpart(c,d,1))?0:"G"==a?255:"F"==a?240:"E"==a?240:"C"==a?224:"8"==a?128:"B"==a?208:64,0==e?h=b:1==e?g=b:(f=b,aQ[i+=1]=k.colormake(h,g,f,255)),(e+=1)>2&&(e=0)}function gJ(a,b,e,c,d,i,j,g,f){var h=!1;a=Math.floor(a),aM=!1,i&&(h=jc(a,b,22,26),k.mousedownany&&h&&!k.mousemovedget(-1)?b+=1:k.imagedrawgl(k.images[407],a,b+1),aZ&&h&&fG==bG&&(aM=!0),hC(a,b,22,26)&&k.cursorset(13,"pointer")),k.imagedrawgl(k.images[407],a,b),!j&&(c<=0&&(c=1),d<=0&&(d=2),e<=0&&(e=1)),f==l&&c>0&&(k.imagergbset(k.images[451],gM(c,!1)),k.imagedrawgl(k.images[451],a+2,b+2),k.imagergbset(k.images[408],gM(c,!1)),k.imagedrawgl(k.images[408],a+2,b+2)),f==m&&(d>0&&(k.imagergbset(k.images[451],gM(d,!1)),k.imagedrawgl(k.images[451],a+2,b+2)),c>0&&(k.imagergbset(k.images[408],gM(c,!1)),k.imagedrawgl(k.images[408],a+2,b+2))),f==o&&(c>0&&(k.imagergbset(k.images[444],gM(c,!1)),k.imagedrawgl(k.images[444],a+2,b+2)),d>0&&(k.imagergbset(k.images[445],gM(d,!1)),k.imagedrawgl(k.images[445],a+2,b+2))),f==n&&(c>0&&(k.imagergbset(k.images[446],gM(c,!1)),k.imagedrawgl(k.images[446],a+2,b+2)),d>0&&(k.imagergbset(k.images[452],gM(d,!1)),k.imagedrawgl(k.images[452],a+2,b+2))),f==p&&(c>0&&(k.imagergbset(k.images[446],gM(c,!1)),k.imagedrawgl(k.images[446],a+2,b+2)),g>0&&(k.imagergbset(k.images[452],gM(g,!1)),k.imagedrawgl(k.images[452],a+2,b+2)),d>0&&(k.imagergbset(k.images[447],gM(d,!1)),k.imagedrawgl(k.images[447],a+2,b+2))),f==q&&(c>0&&(k.imagergbset(k.images[448],gM(c,!1)),k.imagedrawgl(k.images[448],a+2,b+2)),d>0&&(k.imagergbset(k.images[450],gM(d,!1)),k.imagedrawgl(k.images[450],a+2,b+2)),g>0&&(k.imagergbset(k.images[449],gM(g,!1)),k.imagedrawgl(k.images[449],a+2,b+2))),e>0&&(e>=200?(e-200)*17<k.imagesizexget(k.images[406])-8&&k.imagedrawglpart(k.images[406],a+3,b+3,(e-200)*17,0,16,16):iH(String.fromCharCode(e),a+11,b+4,14,!0))}function gK(c,d,e,f,h,g,a,b){c=Math.floor(c),e<=0&&(e=1),f<=0&&(f=2),g==l&&(k.colorset(gM(e,!1)),k.rectdraw(c,d,a,b),k.rectdraw(c+a/2,d+b/2,a/2,b/2)),g==m&&(k.colorset(gM(f,!0)),k.rectdraw(c,d,a/2,b/2),k.rectdraw(c+a/2,d+b/2,a/2,b/2),k.colorset(gM(e,!1)),k.rectdraw(c+a/2,d,a/2,b/2),k.rectdraw(c,d+b/2,a/2,b/2)),g==o&&(k.colorset(gM(e,!1)),k.rectdraw(c,d,a,b/2),k.colorset(gM(f,!0)),k.rectdraw(c,d+b/2,a,b/2)),g==n&&(k.colorset(gM(e,!1)),k.rectdraw(c,d,a/2,b),k.colorset(gM(f,!0)),k.rectdraw(c+a/2,d,a/2,b)),g==p&&(k.colorset(gM(e,!1)),k.rectdraw(c,d,a/3,b),k.colorset(gM(f,!0)),k.rectdraw(c+a/3,d,a/3,b),k.colorset(gM(h,!0)),k.rectdraw(c+a/3*2,d,a/3,b)),g==q&&(k.colorset(gM(e,!1)),k.rectdraw(c,d,a,b/3),k.colorset(gM(f,!0)),k.rectdraw(c,d+b/3,a,b/3),k.colorset(gM(h,!0)),k.rectdraw(c,d+b/3*2,a,b/3))}function gL(){return""!=fZ&&(!!db||f$>0&&f$<=3)}function gM(a,b){return(2>k.arraylengthget(aQ)&&gI(),a>k.arraylengthget(aQ)&&(a=1),a<1)?b?k.colormake(200,200,200,255):k.colormake(255,255,255,255):aQ[a]}function gN(a,b){eB=0,b?(eC=gd.clan_name,ew=gd.clan_color_1,ex=gd.clan_color_2,ey=gd.Clan_color_3,ez=gd.Color_style,eA=gd.clan_emblem):a&&(eC=fZ,ew=fV,ex=fW,ey=fU,ez=fX,eA=fY),g0(b$)}function gO(){var a="";a="clanavatarset.php?",a+="&color1="+aN,a+="&color2="+aO,a+="&color3="+aP,a+="&colorstyle="+aL.Id,a+="&emblem="+fY,aS=gp(a,!1)}function gP(b){var a="";a="clanjoin.php?",a+="&clanid="+b,aU=gp(a,!1)}function gQ(d,e,f,i){var a=null,b=0,g=0,c=0;for(0==e&&(e=eW/2-R),0==f&&(f=eU-fA-S),c=d,d>=50&&(c=50+k.mod(d,10),g=(d-c)/10),b=1;b<=c+g;b++)(a=new h).x=e,a.y=f,a.Start_x=a.x,a.Start_y=a.y,a.From_gold_dragon=i,a.Start_x_add+=k.randomint(-10,10),a.Start_y_add+=k.randomint(-10,10),a.Time_created-=b,b>c&&(a.Value=10)}function gR(){return dE==dn&&0==k.mod(a6,10)}function gS(){var e=0,a=null,d=0,c=0,b=0;for(b=1,bb=aF;b<=dR;b++)for(c=1;c<=dQ;c++)null!=(a=dP[c][b])&&a.Kind.Upgraded_version!=a.Kind&&null!=a.Kind.Upgraded_version&&a._Kind_can_go_here(aH)&&(d=k.randomint(88,100),d/=b+3,d/=i1(c,b,aH),(d*=i1(c,b,a.Kind))>e&&(e=d,bb=a))}function gT(){var a=0;dX<158&&(dX+=3+.1*dX),dY=158,bG==ce&&(dX=dY),hw(5*fA,dX=k.clamp(dX,0,dY),.3,77+hV(),!1),dX>(a=25)&&iJ("Game Over",dW/2,a,14,!0,!1),dX>(a+=36)&&iJ("Day Reached: "+a6,dW/2,a,14,!0,!1),dX>(a+=30)&&iJ("Goals Achieved: "+dA,dW/2,a,14,!0,!1),dX>(a+=30)&&iJ("Score: "+(a6+1e3*dA),dW/2,a,14,!0,!1),dY>dX&&(hz(),hx(!1)),k.offsetset(0,0)}function gU(){var b=null,a=null;if(2==cH&&D.total<=0&&iz(),3==cH&&e6/11>=1){c_=0,bD?hS():g0(cq);return}ik(.4),b=k.images[117],cH>0&&(k.debugset(""+cH),b=k.images[118],null!=B?(iH("Opening"+ho(!1),eW/2,222,14,!0),k.cursorset(27,"wait")):iH("You got "+(""+c_+" gold!"),eW/2,244,14,!0)),k.imagedrawgl(b,(eW-k.imagesizexget(b))/2,166),k.offsetset(R,S),k.offsetset(0,0),aZ&&0==cH&&(iz(),ix(k.sounds[14])),1==cH&&null!=B&&""!=k.ajaxresponseget(47,B)&&(a=k.split(k.ajaxresponseget(48,B),","),k.arraylengthget(a)>1&&"good"==a[1]?(c$=(1*a[2]||0)-u,c_=1*a[3]||0,gQ(c_,eW/2-R,177-S,!1),t=1*a[4]||0):k.debugset("Error"),iz(),B=null),g8("Thank you! Take my money!","",k.images[74],0),k.offsetset(0,0)}function gV(b,c){var a=0;a=H.total,(a=k.clamp(a,0,99))<10?k.imagedrawgl(k.images[305],b,c):k.imagedrawgl(k.images[307],b,c),iH(""+a,b+3,c+1,14,!1)}function gW(){iI("<Cancel",5,c0+5,14,!1),fi&&(bD=!1,g0(cq),hr("state","signup cancel"))}window.onload=function(){k.rootpath="",k.setup(),k.debugonset(0),k.ggl.texload((k.rootpath?k.rootpath+"/":"")+"image/__texture.png?v=1657506343000",1024,1024),k.arraylengthget=function(a){if(!a)throw"Array Length: Array is null.";return a.length-1},k.stringpart=function(a,b,c){return a.substr(b-1,c)},k.cursorset=function(b,a){galldiv.style.cursor=a},k.offsetset=function(a,b){window.gtboffsetx=a,window.gtboffsety=b,k._transformadd("offset"),k._transformsreapply(),k._offsettransform()},k.imagergbset=function(b,a){b.rgb=16777216*a.r+(a.g<<16)+(a.b<<8)},k.colormake=function(a,b,c){if(a<0||a>255)throw"RGB Color: Color must be from 0 to 255. Red was "+a;if(b<0||b>255)throw"RGB Color: Color must be from 0 to 255. Green was "+b;if(c<0||c>255)throw"RGB Color: Color must be from 0 to 255. Blue was "+c;return{r:~~a,g:~~b,b:~~c,a:255}},k.cls=function(a){if(this.glis){this.ggl.verti&&(this.ggl.verti=0),this.ggl.gl.clearColor(a.r/255,a.g/255,a.b/255,1),this.ggl.clear(),this.drew2d&&(this._transformsunapply(),this._draw.clearRect(0,0,gcanvas.width,gcanvas.height),this._transformsapply(),this.drew2d=0);return}this._transformsunapply(),this._draw.fillStyle=this.colortostring(a),this._draw.fillRect(0,0,this.screensizex,this.screensizey),this._transformsapply()},k.browseropen=function(b){window.open(b);var a=window.webkit;a&&a.messageHandlers.ads&&a.messageHandlers.ads.postMessage(b)},k.textdraw=function(a,b,c){this._draw.fillText(a,b,c),this.drew2d=1},k.textdrawcentered=function(a,b,c){this._draw.textAlign="center",this._draw.textBaseline="middle",this._draw.fillText(a,b,c),this._draw.textAlign="left",this._draw.textBaseline="top",this.drew2d=1},k.clamp=function(c,a,b){if(a>b)throw"Clamp: First boundary ("+a+") was greater than the second ("+b+")";return c<a?a:c>b?b:c},k.ajaxresponseget=function(b,a){return a?a.tbresponse||"":(this._throw(b,"HTTP Request variable has not been set."),"")},k.split=function(b,c){var a=b.split(c);return a.unshift(0),a},k.ajaxmake=function(b){this._log("ajaxmake()",b);var a=new XMLHttpRequest;return a.onloadstart=function(){a.timeout=function(b){a.tberrorcode=1,this._log(b)}},a.onreadystatechange=function(){4==a.readyState&&(200==a.status?a.tbresponse=a.responseText:a.tberrorcode=a.status||2)},a.open("GET",b,!0),a.send(),a},k.clamp=function(c,a,b){if(a>b)throw"Clamp: First boundary ("+a+") was greater than the second ("+b+")";return c<a?a:c>b?b:c},k.scaleset=function(a,b){this.scalex=a,this.scaley=b,this._transformadd("scale"),this._transformsreapply(),this._offsettransform()},k.listfirstget=function(c,a){if(!a){this._throw(c,"First Item: List is null.");return}var b=a.first;return b?b.val:null},k.mod=function(a,b){return a>0?a%b:b>0?a-b*Math.floor(a/b):0==b?a:a%b},k.imagesizexget=function(a){return a?a.glis?a.sizex:a.loaded?a.canvas?a.canvas.width:(this._throw(void 0,"Image Width: Image canvas is not set."),0):0:(this._throw(void 0,"Image Width: Image value is not set."),0)},k.imagesizeyget=function(a){return a?this.glis?a.sizey:a.loaded?a.canvas?a.canvas.height:(this._throw(void 0,"Image Height: Image canvas is not set."),0):0:(this._throw(void 0,"Image Height: Image value is not set."),0)},k.rectdraw=function(c,d,a,b){this.glis&&this._drawcanvas==gcanvas?(c=~~(window.gtboffsettransformedx+c*this.scalex),d=~~(window.gtboffsettransformedy+d*this.scaley),a*=this.scalex,b*=this.scaley,a=Math.ceil(a),b=Math.ceil(b),this.ggl.imagedraw(0,0,1e-5,1e-5,c,d,a,b,void 0,0,0,0,0,this._drawrgb)):(this._draw.fillRect(c,d,a,b),this.drew2d=1)},k.imagerotationset=function(a,b){a.angle=b*this._degreestoradians},k.listindexget=function(d,b,e){if(!b){this._throw(d,"Get Item From List: List is null.");return}for(var a=b.first,c=1;;){if(!a)return 0;if(a.val==e)return c;a=a.next,c++}},k.listpush=function(b,a,c){if(!a){this._throw(b,"Push: List is null.");return}var d=this._listnodemake(c);this._listnodeinsertafter(a,d,a.last)},k.listitemget=function(d,b,a){if(!b){this._throw(d,"Get Item From List: List is null.");return}if(a<1)return this._throw(d,"Get Item From List: Index cannot be less than 1. It was "+a),null;if(a>b.total)return null;for(var c=b.first;a>1;a--)c=c.next;return c.val},k.randomint=function(a,b){if(a=Math.floor(a),b=Math.floor(b),b<=a)return a;var c=b+1-a;return a+Math.floor(this._rngnextint()/this._rngm*c)},k.keyboardopen=function(){return document.activeElement&&"INPUT"==document.activeElement.tagName},k.textboxfocus=function(c,a){var b=this._inputs[a];if(!b){this._throw(c,"Select TextBox: No TextBox with ID: "+a);return}b.div.firstChild.focus()},k.textboxdraw=function(g,d,e,h,c,b){var i,a=this._inputs[g];if(!a){var j=document.createElement("div");gfginputs.appendChild(j),(a=this._inputs[g]={}).div=j,i=1}if(d*=this.scalex,e*=this.scaley,d+=window.gtboffsettransformedx,e+=window.gtboffsettransformedy,h*=this.scalex,b="position:absolute;left:"+d+"px;top:"+e+"px;width:"+h+"px;font-size:"+this._fontsize*this.scaley+"px;"+b,i){var f=c?"password":"text";a.div.innerHTML="<input type='"+f+"' spellcheck='false' autocomplete='off' style='"+b+"' />"}else if(a.css!=b&& -1==b.indexOf("'")&&(a.css=b,a.div.firstChild.style.cssText=b),a.passwordis!=c){var f=c?"password":"text";a.passwordis=c,a.div.firstChild.setAttribute("type",f)}a.drew=1},k.textboxtextget=function(c,a){var b=this._inputs[a];if(!b){this._throw(c,"Get TextBox Text: No TextBox with ID: "+a);return}return b.div.firstChild.value},k.keyboardhide=function(){var a=document.activeElement;a&&"INPUT"==a.tagName&&a.blur(),gbginput.disabled=!0,gbginput.style.display="none",gcanvas.focus(),this._keyboardhid=1,this._keyboardshowed=0,document.body.style.overflowY="hidden",gbginput.value=""},k.textboxtextset=function(c,a,d){var b=this._inputs[a];if(!b){this._throw(c,"Set TextBox Text: No TextBox with ID: "+a);return}b.div.firstChild.value=d},k.arrayheightget=function(a){if(!a)throw"Array Height: Array is null.";return a.length?a[1].length-1:0},k.circledraw=function(b,c,a){if(a<0)return 0;this._draw.beginPath(),this._draw.arc(b,c,a,0,2*Math.PI),this._draw.fill(),this.drew2d=1},k.textwidth=function(a){return this._draw.measureText(a).width},k.moveto=function(a,b,c){var d=b-a;return Math.abs(d)<=c?b:a+c*Math.sign(d)},k.soundplaying=function(b){var a=b.audio;return a?a.play?!a.paused:b.playedtime?this.now-b.playedtime<1e3*a.duration:0:0},k.imageoffsetset=function(a,b,c){a.offsetx=b,a.offsety=c},k.triangledraw=function(a,b,c,d,e,f){this._draw.beginPath(),this._draw.moveTo(a,b),this._draw.lineTo(c,d),this._draw.lineTo(e,f),this._draw.fill(),this.drew2d=1},k.localstorageget=function(a){return this._storage["tb_0_"+a]||""},k.listremove=function(b,a,d){if(!a){this._throw(b,"Remove From List: List is null.");return}var c=this._listnodeget(a,d);if(!c){this._throw(b,"List Remove: item was not in the list.");return}this._listnoderemove(a,c)},k.rectshit=function(a,b,e,f,c,d,g,h){return a>=c+g||b>=d+h||c>=a+e||d>=b+f?0:1},k.soundloop=function(a){if(!a||!a.audio)return 0;this.soundstop(a),a.looping=1,a.loopstopped=0,this.soundplay(a),a.timeout=setTimeout((function(){a.loopstopped||this.soundloop(a)}).bind(k),1e3*a.audio.duration)},k.soundvolumeset=function(a,b){if(!a)return 0;if(b<0)throw"Volume cannot be negative: "+b;if(b>1)throw"Volume must be between 0 and 1. Was "+b;a.volume=b,a.audio&&a.audio.play?a.audio.volume=b:a.gainnode&&(a.gainnode.gain.value=b)},k.localstorageset=function(a,b){this._storage["tb_0_"+a]=b},k.random=function(){return this._rngnextint()/(this._rngm-1)},k.listinsertafter=function(b,a,d,e){if(!a){this._throw(b,"Insert After: List is null.");return}var f=this._listnodemake(d),c=this._listnodeget(a,e);if(!c){this._throw(b,"Insert After: Item is not in the list.");return}this._listnodeinsertafter(a,f,c)},k.listlastget=function(c,a){if(!a){this._throw(c,"Last Item: List is null.");return}var b=a.last;return b?b.val:null},k.imageresize=function(a,b,c,e){var f=this.canvasmake(b,c),d=f.getContext("2d");a.glis?(a.x=Math.round(a.texx*this.ggl.texsizex),a.y=Math.round(a.texy*this.ggl.texsizey),e?d.drawImage(this.ggl.jsimage,a.x,a.y,a.sizex,a.sizey,0,0,b,c):d.drawImage(this.ggl.jsimage,a.x,a.y,a.sizex,a.sizey,0,0,a.sizex,a.sizey),a.sizex=b,a.sizey=c,a.glis=0):e?d.drawImage(a.canvas,0,0,b,c):d.drawImage(a.canvas,0,0),a.canvas=f},k.colorredget=function(a){return a.r},k.imagepixelget=function(a,c,d){if(!a)return this._throw(void 0,"Get Image Pixel: Image value is not set."),0;if(!a.loaded)return this._throw(void 0,"Get Image Pixel: Image has not finished loading yet."),0;if(c<0)throw"Get Image Pixel: X cannot be negative: "+c;if(d<0)throw"Get Image Pixel: Y cannot be negative: "+d;if(a.glis){this.ggl.texcanvasconvert(),a.x=Math.round(a.texx*this.ggl.texsizex),a.y=Math.round(a.texy*this.ggl.texsizey);var b=this.ggl.texcanvasdraw.getImageData(a.x+c,a.y+d,1,1).data}else{a.canvas.getContext||this._imagecanvasconvert(a);var b=a.canvas.getContext("2d").getImageData(c,d,1,1).data}if(!b||b.length<4)throw"Get Image Pixel: Cannot read pixel at "+c+", "+d;return{r:b[0],g:b[1],b:b[2],a:b[3]}},k.colortransparencyget=function(a){return 1-a.a/255},k.drawtoscreen=function(a){this.drawtocanvas(a,gcanvas)},k.angleto=function(b,c,d,e){var a=Math.atan2(e-c,d-b)/this._degreestoradians;return a<0&&(a+=360),a},k.imageaddgl(589,793,23,23),k.imageaddgl(707,880,8,8),k.imageaddgl(908,490,12,48),k.imageaddgl(89,342,44,76),k.imageaddgl(834,431,50,52),k.imageaddgl(814,590,34,45),k.imageaddgl(335,842,17,17),k.imageaddgl(821,639,38,38),k.imageaddgl(860,639,38,38),k.imageaddgl(899,639,38,38),k.imageaddgl(955,842,16,16),k.imageaddgl(876,342,37,59),k.imageaddgl(443,793,16,24),k.imageaddgl(624,639,150,39),k.imageaddgl(366,342,64,64),k.imageaddgl(221,431,44,56),k.imageaddgl(525,863,12,15),k.imageaddgl(538,863,10,15),k.imageaddgl(549,863,10,15),k.imageaddgl(560,863,10,15),k.imageaddgl(571,863,10,15),k.imageaddgl(582,863,10,15),k.imageaddgl(593,863,10,15),k.imageaddgl(604,863,11,15),k.imageaddgl(616,863,10,15),k.imageaddgl(627,863,10,15),k.imageaddgl(638,863,10,15),k.imageaddgl(649,863,10,15),k.imageaddgl(660,863,13,15),k.imageaddgl(674,863,12,15),k.imageaddgl(687,863,10,15),k.imageaddgl(698,863,10,15),k.imageaddgl(972,842,10,16),k.imageaddgl(709,863,11,15),k.imageaddgl(721,863,10,15),k.imageaddgl(732,863,10,15),k.imageaddgl(743,863,12,15),k.imageaddgl(756,863,12,15),k.imageaddgl(769,863,13,15),k.imageaddgl(783,863,10,15),k.imageaddgl(794,863,12,15),k.imageaddgl(807,863,10,15),k.imageaddgl(818,863,10,15),k.imageaddgl(829,863,10,15),k.imageaddgl(840,863,10,15),k.imageaddgl(851,863,10,15),k.imageaddgl(862,863,10,15),k.imageaddgl(873,863,10,15),k.imageaddgl(884,863,10,15),k.imageaddgl(895,863,10,15),k.imageaddgl(906,863,10,15),k.imageaddgl(917,863,10,15),k.imageaddgl(928,863,10,15),k.imageaddgl(939,863,10,15),k.imageaddgl(950,863,10,15),k.imageaddgl(358,880,10,14),k.imageaddgl(613,793,23,23),k.imageaddgl(983,842,16,16),k.imageaddgl(921,490,16,48),k.imageaddgl(938,490,12,48),k.imageaddgl(702,204,88,89),k.imageaddgl(791,204,88,89),k.imageaddgl(880,204,88,89),k.imageaddgl(625,759,30,30),k.imageaddgl(579,880,10,10),k.imageaddgl(431,342,64,64),k.imageaddgl(650,880,9,9),k.imageaddgl(1e3,842,16,16),k.imageaddgl(0,863,16,16),k.imageaddgl(134,342,44,75),k.imageaddgl(839,793,9,22),k.imageaddgl(405,639,41,41),k.imageaddgl(447,639,41,41),k.imageaddgl(460,793,24,24),k.imageaddgl(496,342,64,64),k.imageaddgl(526,880,16,12),k.imageaddgl(951,490,49,48),k.imageaddgl(17,863,16,16),k.imageaddgl(34,863,16,16),k.imageaddgl(51,863,16,16),k.imageaddgl(68,863,16,16),k.imageaddgl(85,863,16,16),k.imageaddgl(102,863,16,16),k.imageaddgl(119,863,16,16),k.imageaddgl(136,863,16,16),k.imageaddgl(961,863,9,15),k.imageaddgl(153,863,16,16),k.imageaddgl(170,863,16,16),k.imageaddgl(187,863,16,16),k.imageaddgl(204,863,16,16),k.imageaddgl(221,863,16,16),k.imageaddgl(238,863,16,16),k.imageaddgl(255,863,16,16),k.imageaddgl(272,863,16,16),k.imageaddgl(289,863,16,16),k.imageaddgl(306,863,16,16),k.imageaddgl(323,863,16,16),k.imageaddgl(234,685,100,36),k.imageaddgl(335,685,100,36),k.imageaddgl(176,842,19,19),k.imageaddgl(971,863,16,15),k.imageaddgl(340,863,21,16),k.imageaddgl(196,842,19,19),k.imageaddgl(654,819,15,21),k.imageaddgl(670,819,14,21),k.imageaddgl(685,819,15,21),k.imageaddgl(914,342,50,59),k.imageaddgl(0,541,48,48),k.imageaddgl(369,880,10,14),k.imageaddgl(485,793,31,24),k.imageaddgl(637,793,23,23),k.imageaddgl(661,793,23,23),k.imageaddgl(590,880,10,10),k.imageaddgl(601,880,10,10),k.imageaddgl(362,863,17,16),k.imageaddgl(660,880,9,9),k.imageaddgl(983,723,30,33),k.imageaddgl(849,590,48,45),k.imageaddgl(898,590,48,45),k.imageaddgl(786,759,10,26),k.imageaddgl(942,759,10,25),k.imageaddgl(797,759,9,26),k.imageaddgl(807,759,10,26),k.imageaddgl(953,759,9,25),k.imageaddgl(818,759,11,26),k.imageaddgl(573,759,10,31),k.imageaddgl(963,759,11,25),k.imageaddgl(975,759,5,25),k.imageaddgl(584,759,7,31),k.imageaddgl(981,759,11,25),k.imageaddgl(993,759,5,25),k.imageaddgl(999,759,17,25),k.imageaddgl(0,793,11,25),k.imageaddgl(12,793,9,25),k.imageaddgl(592,759,10,31),k.imageaddgl(603,759,10,31),k.imageaddgl(22,793,10,25),k.imageaddgl(33,793,10,25),k.imageaddgl(44,793,8,25),k.imageaddgl(53,793,11,25),k.imageaddgl(65,793,10,25),k.imageaddgl(76,793,16,25),k.imageaddgl(93,793,13,25),k.imageaddgl(614,759,10,31),k.imageaddgl(107,793,11,25),k.imageaddgl(119,793,9,25),k.imageaddgl(129,793,9,25),k.imageaddgl(139,793,9,25),k.imageaddgl(149,793,9,25),k.imageaddgl(159,793,9,25),k.imageaddgl(169,793,9,25),k.imageaddgl(179,793,9,25),k.imageaddgl(189,793,9,25),k.imageaddgl(199,793,9,25),k.imageaddgl(209,793,9,25),k.imageaddgl(219,793,5,25),k.imageaddgl(778,759,7,27),k.imageaddgl(225,793,5,25),k.imageaddgl(849,793,20,22),k.imageaddgl(870,793,16,22),k.imageaddgl(887,793,16,22),k.imageaddgl(904,793,16,22),k.imageaddgl(701,819,16,21),k.imageaddgl(921,793,16,22),k.imageaddgl(938,793,16,22),k.imageaddgl(830,759,16,26),k.imageaddgl(955,793,19,22),k.imageaddgl(847,759,14,26),k.imageaddgl(862,759,16,26),k.imageaddgl(975,793,15,22),k.imageaddgl(685,793,21,23),k.imageaddgl(991,793,22,22),k.imageaddgl(0,819,20,22),k.imageaddgl(21,819,15,22),k.imageaddgl(37,819,23,22),k.imageaddgl(879,759,16,26),k.imageaddgl(61,819,17,22),k.imageaddgl(79,819,14,22),k.imageaddgl(94,819,19,22),k.imageaddgl(114,819,16,22),k.imageaddgl(707,793,26,23),k.imageaddgl(131,819,22,22),k.imageaddgl(755,759,16,28),k.imageaddgl(154,819,13,22),k.imageaddgl(231,793,16,25),k.imageaddgl(517,793,16,24),k.imageaddgl(380,863,16,16),k.imageaddgl(397,863,16,16),k.imageaddgl(193,759,32,32),k.imageaddgl(414,863,16,16),k.imageaddgl(534,793,4,24),k.imageaddgl(226,342,44,74),k.imageaddgl(489,639,134,41),k.imageaddgl(821,819,44,20),k.imageaddgl(539,793,24,24),k.imageaddgl(988,863,10,15),k.imageaddgl(380,880,10,14),k.imageaddgl(718,819,8,21),k.imageaddgl(391,880,4,14),k.imageaddgl(431,863,16,16),k.imageaddgl(612,880,6,10),k.imageaddgl(226,759,32,32),k.imageaddgl(436,685,8,36),k.imageaddgl(543,880,11,12),k.imageaddgl(670,880,16,9),k.imageaddgl(448,863,9,16),k.imageaddgl(216,842,16,19),k.imageaddgl(49,541,45,48),k.imageaddgl(5,896,3,3),k.imageaddgl(320,342,45,72),k.imageaddgl(95,541,45,48),k.imageaddgl(947,590,44,45),k.imageaddgl(0,490,45,50),k.imageaddgl(248,793,11,25),k.imageaddgl(396,880,63,14),k.imageaddgl(168,819,55,22),k.imageaddgl(999,863,22,15),k.imageaddgl(266,431,25,56),k.imageaddgl(95,431,25,57),k.imageaddgl(778,342,48,60),k.imageaddgl(292,431,25,56),k.imageaddgl(318,431,24,56),k.imageaddgl(676,342,50,62),k.imageaddgl(727,342,50,62),k.imageaddgl(626,342,49,63),k.imageaddgl(141,541,48,48),k.imageaddgl(460,880,13,14),k.imageaddgl(270,842,16,18),k.imageaddgl(568,880,10,11),k.imageaddgl(190,541,48,48),k.imageaddgl(239,541,48,48),k.imageaddgl(0,342,88,88),k.imageaddgl(288,541,48,48),k.imageaddgl(221,204,480,110),k.imageaddgl(347,0,480,144),k.imageaddgl(0,759,92,33),k.imageaddgl(343,431,25,56),k.imageaddgl(121,431,25,57),k.imageaddgl(827,342,48,60),k.imageaddgl(369,431,25,56),k.imageaddgl(395,431,24,56),k.imageaddgl(716,880,8,8),k.imageaddgl(725,880,8,8),k.imageaddgl(734,880,8,8),k.imageaddgl(743,880,16,8),k.imageaddgl(287,842,2,18),k.imageaddgl(760,880,16,8),k.imageaddgl(777,880,16,8),k.imageaddgl(727,819,25,21),k.imageaddgl(753,819,25,21),k.imageaddgl(734,793,25,23),k.imageaddgl(760,793,25,23),k.imageaddgl(259,759,80,32),k.imageaddgl(153,590,47,47),k.imageaddgl(337,541,48,48),k.imageaddgl(420,431,62,55),k.imageaddgl(201,590,44,47),k.imageaddgl(386,541,48,48),k.imageaddgl(435,541,48,48),k.imageaddgl(630,431,48,54),k.imageaddgl(483,431,48,55),k.imageaddgl(532,431,48,55),k.imageaddgl(484,541,48,48),k.imageaddgl(533,541,48,48),k.imageaddgl(582,541,48,48),k.imageaddgl(0,880,36,15),k.imageaddgl(37,880,36,15),k.imageaddgl(74,880,35,15),k.imageaddgl(110,880,35,15),k.imageaddgl(854,880,37,6),k.imageaddgl(892,880,37,6),k.imageaddgl(930,880,37,6),k.imageaddgl(968,880,37,6),k.imageaddgl(631,541,12,48),k.imageaddgl(866,819,10,20),k.imageaddgl(877,819,10,20),k.imageaddgl(888,819,10,20),k.imageaddgl(899,819,10,20),k.imageaddgl(340,759,32,32),k.imageaddgl(561,342,64,64),k.imageaddgl(779,819,21,21),k.imageaddgl(373,759,18,32),k.imageaddgl(205,896,2,2),k.imageaddgl(392,759,25,32),k.imageaddgl(353,842,41,17),k.imageaddgl(395,842,35,17),k.imageaddgl(431,842,27,17),k.imageaddgl(459,842,36,17),k.imageaddgl(418,759,42,32),k.imageaddgl(656,759,98,30),k.imageaddgl(45,639,16,44),k.imageaddgl(811,880,12,7),k.imageaddgl(824,880,12,7),k.imageaddgl(910,819,14,20),k.imageaddgl(925,819,30,20),k.imageaddgl(956,819,14,20),k.imageaddgl(971,819,14,20),k.imageaddgl(986,819,14,20),k.imageaddgl(782,685,37,35),k.imageaddgl(687,880,9,9),k.imageaddgl(1006,880,4,4),k.imageaddgl(1011,880,4,4),k.imageaddgl(9,896,3,3),k.imageaddgl(496,842,10,17),k.imageaddgl(1016,880,7,4),k.imageaddgl(507,842,16,17),k.imageaddgl(772,759,5,28),k.imageaddgl(524,842,26,17),k.imageaddgl(2,0,344,203),k.imageaddgl(445,685,23,36),k.imageaddgl(619,880,5,10),k.imageaddgl(644,541,48,48),k.imageaddgl(111,639,48,43),k.imageaddgl(160,639,48,43),k.imageaddgl(260,793,182,25),k.imageaddgl(469,685,23,36),k.imageaddgl(493,685,23,36),k.imageaddgl(517,685,23,36),k.imageaddgl(555,880,12,12),k.imageaddgl(458,863,13,16),k.imageaddgl(209,639,48,43),k.imageaddgl(258,639,48,43),k.imageaddgl(179,342,46,75),k.imageaddgl(0,842,30,20),k.imageaddgl(31,842,30,20),k.imageaddgl(246,590,46,47),k.imageaddgl(293,590,46,47),k.imageaddgl(340,590,46,47),k.imageaddgl(387,590,46,47),k.imageaddgl(434,590,46,47),k.imageaddgl(481,590,46,47),k.imageaddgl(693,541,48,48),k.imageaddgl(742,541,48,48),k.imageaddgl(551,842,17,17),k.imageaddgl(62,842,30,20),k.imageaddgl(581,431,48,55),k.imageaddgl(791,541,48,48),k.imageaddgl(0,431,48,58),k.imageaddgl(965,342,48,59),k.imageaddgl(786,793,20,23),k.imageaddgl(501,880,13,13),k.imageaddgl(233,842,19,19),k.imageaddgl(625,880,13,10),k.imageaddgl(93,842,22,20),k.imageaddgl(253,842,16,19),k.imageaddgl(515,880,10,13),k.imageaddgl(290,842,23,18),k.imageaddgl(62,639,48,44),k.imageaddgl(116,842,14,20),k.imageaddgl(472,863,18,16),k.imageaddgl(131,842,18,20),k.imageaddgl(474,880,16,14),k.imageaddgl(146,880,13,15),k.imageaddgl(491,863,16,16),k.imageaddgl(569,842,18,17),k.imageaddgl(801,819,19,21),k.imageaddgl(491,880,9,14),k.imageaddgl(271,342,48,74),k.imageaddgl(840,541,48,48),k.imageaddgl(679,431,54,54),k.imageaddgl(734,431,49,53),k.imageaddgl(784,431,49,53),k.imageaddgl(639,880,10,10),k.imageaddgl(49,431,45,58),k.imageaddgl(807,793,21,23),k.imageaddgl(150,842,25,20),k.imageaddgl(0,723,962,35),k.imageaddgl(93,759,30,33),k.imageaddgl(829,793,9,23),k.imageaddgl(461,759,32,32),k.imageaddgl(494,759,32,32),k.imageaddgl(224,819,149,22),k.imageaddgl(124,759,18,33),k.imageaddgl(963,723,19,34),k.imageaddgl(143,759,18,33),k.imageaddgl(775,639,45,39),k.imageaddgl(527,759,45,32),k.imageaddgl(889,541,45,48),k.imageaddgl(935,541,45,48),k.imageaddgl(0,639,44,45),k.imageaddgl(46,490,45,50),k.imageaddgl(541,685,38,36),k.imageaddgl(938,639,38,37),k.imageaddgl(977,639,38,37),k.imageaddgl(508,863,16,16),k.imageaddgl(0,685,38,37),k.imageaddgl(39,685,38,37),k.imageaddgl(78,685,38,37),k.imageaddgl(117,685,38,37),k.imageaddgl(156,685,38,37),k.imageaddgl(195,685,38,37),k.imageaddgl(0,204,220,137),k.imageaddgl(794,880,16,8),k.imageaddgl(837,880,16,7),k.imageaddgl(528,590,46,47),k.imageaddgl(575,590,46,47),k.imageaddgl(307,639,48,43),k.imageaddgl(356,639,48,43),k.imageaddgl(160,880,197,15),k.imageaddgl(13,896,191,3),k.imageaddgl(697,880,9,9),k.imageaddgl(0,896,4,4),k.imageaddgl(162,759,30,33),k.imageaddgl(374,819,22,22),k.imageaddgl(397,819,22,22),k.imageaddgl(420,819,20,22),k.imageaddgl(588,842,330,17),k.imageaddgl(896,759,22,26),k.imageaddgl(441,819,18,22),k.imageaddgl(919,759,22,26),k.imageaddgl(314,842,20,18),k.imageaddgl(919,842,17,17),k.imageaddgl(937,842,17,17),k.imageaddgl(580,685,100,36),k.imageaddgl(681,685,100,36),k.imageaddgl(564,793,24,24),k.imageaddgl(460,819,22,22),k.imageaddgl(622,590,46,47),k.imageaddgl(669,590,46,47),k.imageaddgl(92,490,50,50),k.imageaddgl(716,590,48,47),k.imageaddgl(143,490,50,50),k.imageaddgl(194,490,50,50),k.imageaddgl(245,490,50,50),k.imageaddgl(296,490,50,50),k.imageaddgl(347,490,50,50),k.imageaddgl(398,490,50,50),k.imageaddgl(449,490,50,50),k.imageaddgl(147,431,27,57),k.imageaddgl(175,431,45,57),k.imageaddgl(885,431,52,52),k.imageaddgl(938,431,52,52),k.imageaddgl(500,490,50,50),k.imageaddgl(551,490,50,50),k.imageaddgl(602,490,50,50),k.imageaddgl(653,490,50,50),k.imageaddgl(765,590,48,47),k.imageaddgl(704,490,50,50),k.imageaddgl(755,490,50,50),k.imageaddgl(806,490,50,50),k.imageaddgl(857,490,50,50),k.imageaddgl(0,590,50,48),k.imageaddgl(51,590,50,48),k.imageaddgl(102,590,50,48),k.imageaddgl(483,819,18,22),k.imageaddgl(502,819,18,22),k.imageaddgl(521,819,18,22),k.imageaddgl(540,819,18,22),k.imageaddgl(559,819,18,22),k.imageaddgl(578,819,18,22),k.imageaddgl(597,819,18,22),k.imageaddgl(616,819,18,22),k.imageaddgl(635,819,18,22),k.soundadd("/sound/Cannon_Shoot.wav"),k.soundadd("/sound/swoosh.wav"),k.soundadd("/sound/Dragon_die.wav"),k.soundadd("/sound/Dragon_roar.wav"),k.soundadd("/sound/crossbow_release.wav"),k.soundadd("/sound/Birds.wav"),k.soundadd("/sound/Whoosh.wav"),k.soundadd("/sound/Drum.wav"),k.soundadd("/sound/Game_Over.mp3"),k.soundadd("/sound/upgrade.wav"),k.soundadd("/sound/Got_coin.wav"),k.soundadd("/sound/fire_burning.wav"),k.soundadd("/sound/dragon.wav"),k.soundadd("/sound/metaltap.wav"),k.soundadd("/sound/325279__adamn__briefcase.wav"),k.soundadd("/sound/music_overworldjb_cut.mp3"),k.soundadd("/sound/castleDefense.mp3"),k.soundadd("/sound/6upgrade.wav"),k.soundadd("/sound/2whoosh.wav"),k.soundadd("/sound/7upgrade.wav"),k.soundadd("/sound/LockedDoorHandleJiggle.wav"),k.soundadd("/sound/Win_sound.wav"),k.soundadd("/sound/MENU_A_Select.wav"),k.soundadd("/sound/hammering2.wav"),k.soundadd("/sound/raindance.mp3"),k.soundadd("/sound/itemget5.wav"),k.soundadd("/sound/offedge.mp3"),k.soundadd("/sound/briefcaseclose.wav"),k.soundadd("/sound/invuse.mp3"),k.soundadd("/sound/2zapsplat_cartoon_squelch_wet_drop_003_47586.wav"),k.soundadd("/sound/clickclose.wav"),k.soundadd("/sound/clikcwood.wav"),k.soundadd("/sound/GUI_Sound_Effects_007.wav"),k.soundadd("/sound/3GUI_Sound_Effects_007.wav"),k.resize1callback=function(){hK(),k.clickedcallback=hL,gh()},k.resized&&(k.resize1callback(),k.resize1callback=0)};function gX(b,c,e){var a=null,d=0;d=Math.floor(13*h4(3*b+c)),a=k.images[226],0==d&&(a=k.images[227],b<111&&(b-=3)),1==d&&(a=k.images[319]),2==d&&(a=k.images[344]),3==d&&(a=k.images[343]),4==d&&(a=k.images[343],b<111&&(b-=9)),5==d&&(a=k.images[348]),6==d&&(a=k.images[349]),7==d&&(a=k.images[350],b<111&&(b-=6)),8==d&&(a=k.images[351]),9==d&&(a=k.images[352]),10==d&&(a=k.images[353]),11==d&&(a=k.images[354],e?c-=2:c-=5),12==d&&(a=k.images[355]),e?(c+=22*h4((3*b+c)*4),b+=6*h4((3*b+c)*4)):(b+=22*h4((3*b+c)*4),c+=8*h4((3*b+c)*4)),0>h4(6*b+3*c)?g2(a,b,c):k.imagedrawgl(a,b,c),e?c+=9*h4(4*b+7*c)+15:b+=12*h4(4*b+7*c)+18,d=h4(13*b+c),a=k.images[228],d<.15?(a=k.images[339],c-=8,b-=5):d>.225&&(a=k.images[356],d>.3&&(a=k.images[345],d>.45&&(a=k.images[340],d>.6&&(a=k.images[342],d>.8&&(a=k.images[341],c-=6))))),.5>h4(3*b+3*c)?g2(a,b,c):k.imagedrawgl(a,b,c)}function gY(g){var c=0,d=0,e=null,i=0,h=0,f=0,a=0,b=0;for(f=25,k.colorset(k.colormake(11,112,169,255)),k.offsetset(R,S),b=-3;b<=dR;b++)for(a=1;a<=dQ;a++)iV(a,b)&&(c=(a-1)*fA,d=(b-1)*fA,iV(a-1,b)||(iV(a-1,b-1)||(g<2?(k.colorset(k.colormake(11,112,169,255)),k.rectdraw(c-63-f+fA,d,f,fA),g2(k.images[230],c-63-f,d),gX(c+2-41,d,!0)):(e=k.images[239],dE.Is_water_level&&(e=k.images[220]),k.imagedrawgl(e,c+2-k.imagesizexget(k.images[220]),d-0))),iV(a,b+1)||(g<2?g2(k.images[231],c-31-f,d+fA+0):(e=k.images[236],dE.Is_water_level&&(e=k.images[217]),k.imagedrawgl(e,c+1-k.imagesizexget(k.images[217]),d+fA-3)))),iV(a+1,b)||(iV(a+1,b-1)||(g<2?(k.rectdraw(c+fA+16-0+0,d,f,fA),k.imagedrawgl(k.images[230],c+fA+16+f,d),gX(c+fA+22,d,!0)):(e=k.images[240],dE.Is_water_level&&(e=k.images[221]),k.imagedrawgl(e,c+fA-2,d))),iV(a,b+1)||(g<2?k.imagedrawgl(k.images[231],c+fA-31+0,d+fA+0):(e=k.images[237],dE.Is_water_level&&(e=k.images[218]),k.imagedrawgl(e,c-1+fA,d+fA-3)))),!iV(a,b+1)&&(iV(a+1,b+1)&&iV(a-1,b+1)?k.imagedrawgl(k.images[224],c,d+fA-3):iV(a-1,b+1)?k.imagedrawgl(k.images[222],c-2,d+fA-4):iV(a+1,b+1)?k.imagedrawgl(k.images[223],c+0,d+fA-4):g<2?k.imagedrawgl(k.images[229],c,d+fA+18+f):(e=k.images[238],dE.Is_water_level&&(e=k.images[219],0==k.mod(a,3)&&(e=k.images[337]),1==k.mod(a,3)&&(e=k.images[338])),k.imagedrawgl(e,c,d+fA-3)),g>=2&&dE.Is_water_level&&(h=d+fA+55,iV(a+1,b)||gX(c+72,h-55,!0),iV(a-1,b)||gX(c-40,h-55,!0),i=c,iV(a+1,b+1)&&(i-=40,h-=6),iV(a-1,b+1)&&(i+=44,h-=6),gX(i,h,!1))));if(g<2)for(b=-3;b<=dR;b++)for(a=1;a<=dQ;a++)iV(a,b)&&(c=(a-1)*fA,d=(b-1)*fA,!iV(a-1,b)&&iV(a-1,b-1)&&k.rectdraw(c-60,d+33,15,fA),!iV(a+1,b)&&iV(a+1,b-1)&&k.rectdraw(c+94,d+33,15,fA));k.offsetset(0,0)}function gZ(d,a,b,e,f){var c=0;return e+(c=(c=((d=a<b?k.clamp(d,a,b):k.clamp(d,b,a))-a)/(b-a))<.5?2*Math.pow(c,2):1-2*Math.pow(1-c,2))*(f-e)}function g$(){for(var a=0,b=0;;){if(b++ >999999)throw{line:1,message:"Infinite While Loop"};if(a=k.randomint(1,dQ),dE==dn&&(a=k.randomint(2,dQ-1)),null==dE.Road||dE.Road[a][k.arrayheightget(dE.Road)])break}return a}function g_(b,c,d,e,a,f){f>0&&(b+=f,c+=f,d-=2*f,e-=2*f),k.imagerotationset(k.images[12],90),k.imagedrawgl(k.images[12],b,c,e,a),k.imagedrawgl(k.images[12],b+d,c,e,0-a),k.imagerotationset(k.images[12],0),k.imagedrawgl(k.images[12],b,c+e,d,a),k.imagedrawgl(k.images[12],b,c,d,0-a),k.imagerotationset(k.images[415],0),k.imagedrawgl(k.images[415],b,c+e,0-a,a),k.imagedrawgl(k.images[415],b+d,c+e,a,a),k.imagedrawgl(k.images[415],b,c,0-a,0-a),k.imagedrawgl(k.images[415],b+d,c,a,0-a)}function g0(a){var b;k.debugset("Game State Set from "+(""+bG+" to "+(""+a))),a==cB||d9&&a==cq?k.debugset("footershow"):k.debugset("footerhide"),a==bK&&(z=!1,k.debugset("adShow")),a==b4&&(bo=bp),k.keyboardhide(),dk=0,dY=0,d$=0,dX=0,bG==bK&&k.cls({r:0,g:0,b:0,a:255}),bG==bQ&&(dm=0),bG==cq&&(ea=0),bG==cu&&(eM=null),a==ck&&(el=!1,bC=!0,bD=!0,iy(),ia(hm("plays")+1,"plays"),dT=0,hl()),a==ch&&(bD=!0),a==cw&&(ib("","board"),bD=!1,(d9||f_)&&ic(),hk(!1)),(a==cp||a==co)&&(bC=!0,e0=k.loops),a==ci&&dE==dy&&je(),a==cW&&bG==cl&&(gg=k.loops),a==b$&&(b="",b="claninfoget.php?",b+="&clanname="+eC,aT=gp(b,!1)),bG==cz&&(eB=0),af=!1,e3=!1,b2=!1,cv=bG,bG=a,fk=0,e4=0,e6=0,cH=0,e5=k.loops,e7=k.loops,cv==cq&&(c_=0,s=!1),a!=cq||(""==fZ||bD||cv!=cf&&cv!=ce&&cv!=cs&&ij(),bD||d4==d5||(k.soundstop(d4),d4=d5)),(a==cG||a==cp||a==cF||a==cD||a==co||a==bZ)&&(e_=""),a==cD&&(e_="",eV=""),a==bZ&&(e0=k.loops),a==bY&&(aX=gp("clansget.php?",!1)),(a==bO||a==b6)&&(fR=null),a==co&&hr("state","login password"),a==cp&&hr("state","login screenname"),a==cD&&hr("state","signup screenname"),a==cC&&hr("state","signup age"),a==cF&&hr("state","signup password"),a==bS&&hr("state","buy gold"),a==b_&&hr("state","credits"),a==bH&&hr("state","account"),a==bZ&&hr("state","clan make"),a==cc&&hr("state","inventory")}function g1(){for(var d=0,b=0,c=0,a=null,e=0;;){if(e++ >999999)throw{line:1,message:"Infinite While Loop"};if(b=k.randomint(1,dQ),c=k.randomint(1,dR),a=iT(b,c),null!=a&&a.Kind._Resource_is()&&a.Kind!=cY){cX=a;return}if((d+=1)>3333){g0(bO);return}}}function g2(a,b,c){k.imagedrawgl(a,b+k.imagesizexget(a),c,0-k.imagesizexget(a),k.imagesizeyget(a))}function g3(a,b){return a>0&&b>0&&a<=dQ&&b<=dR}function g4(e){var b=null,a=null,d=null,c=0;if(c5={total:0,first:null,last:null},!(e.length<5))for(c=1,d=k.split(e," ");c<=k.arraylengthget(d);c++)b=k.split(d[c],"@"),a=new jU,k.listpush(8,c5,a),a.Tile_Kind=iW(b[1]),a.Tier=1*b[2]||0,a.Total=1*b[3]||0}function g5(){var a="";a="inventorymatch.php?",a+="&tilekind="+c7.Tile_Kind.id,a+="&tier="+c7.Tier,c9=gp(a,!1)}function g6(){var a="";a="inventoryuse.php?",a+="&level="+dE.Index,a+="&tilekind="+c6.Tile_Kind.id,a+="&buildinglevel="+c6.Tier,da=gp(a,!1)}function g7(){return"ios"==ef||"android"==ef}function g8(c,d,m,p){var n=0,e=0,g=0,f=0,a=0,b=0,o=0,h="",i="",j=0,l=null;k.offsetset(R,S),dg=-5,dh=eU-64-S,k.imagedrawgl(m,dg+jM(m==k.images[428],9),dh),b=g9(),o=k.loops-e5,p>0&&(b=p,o=p),""==d&&(l=k.split(c,"/"),k.arraylengthget(l)>2&&(dh-=20),c=l[1],k.arraylengthget(l)>1&&(d=l[2],k.arraylengthget(l)>2&&(h=l[3]))),dk=0,b>c.length&&(dk=1,b>c.length+d.length&&(dk=2,b>c.length+d.length+h.length&&(dk=3))),e=255,f=dg+54,a=dh+3,(e=iN(c,14))<iN(d,14)&&(e=iN(d,14)),h.length>0?(e<iN(h,14)&&(e=iN(h,14)),g=68):(g=48,d.length<=0&&(g=29,a+=20)),e+=14,o<11&&(f+=8*Math.cos(220*(n=o/11)*k._degreestoradians),f+=8*Math.cos(40*k._degreestoradians),e-=16*Math.cos(220*n*k._degreestoradians),e-=16*Math.cos(40*k._degreestoradians),a+=4*Math.cos(220*n*k._degreestoradians),a+=4*Math.cos(40*k._degreestoradians),g-=4*Math.cos(220*n*k._degreestoradians),g-=4*Math.cos(40*k._degreestoradians)),k.imagedrawgl(k.images[302],f+4,a+4,e-8,g-8),k.imagedrawgl(k.images[300],f,a+8,k.imagesizexget(k.images[300]),g-16),k.imagedrawgl(k.images[300],f+e,a+8,0-k.imagesizexget(k.images[300]),g-16),k.imagedrawgl(k.images[301],f+8,a,e-16,k.imagesizeyget(k.images[301])),k.imagedrawgl(k.images[401],f+8,a+g,e-16,0-k.imagesizeyget(k.images[301])),k.imagerotationset(k.images[299],90),k.imagedrawgl(k.images[299],f+e-0,a+0),k.imagerotationset(k.images[400],180),k.imagedrawgl(k.images[400],f+e-0,a+g-0),k.imagerotationset(k.images[400],270),k.imagedrawgl(k.images[400],f+0,a+g-0),k.imagerotationset(k.images[299],0),k.imagedrawgl(k.images[299],f+0,a+0),k.imagedrawgl(k.images[303],f-8,a+g-18),j=dg+60,i=k.stringpart(c,1,b-1),fj=!0,iH(i,j,a+7,14,!1),iH(k.stringpart(c,b,1),j+iN(i,14),a+7-jM(b<=c.length||d.length>0,0),14,!1),b>c.length&&d.length>0&&(i="",b-c.length-1>0&&(fj=!0,iH(i=k.stringpart(d,1,b-c.length-1),j,a+27,14,!1)),iH(k.stringpart(d,b-c.length,1),j+iN(i,14),a+27-1,14,!1)),h.length>0&&dk>=2&&(fj=!0,iH(i=k.stringpart(h,1,b-(c.length+d.length)-1),j,a+47,14,!1),iH(k.stringpart(h,b-(c.length+d.length),1),j+iN(i,14),a+47-1,14,!1)),b==df+1&&b<c.length+(h.length+d.length)&&1>k.mod(b,2)&&(m==k.images[363]||m==k.images[429]||m==k.images[428]?ix(k.sounds[32]):ix(k.sounds[33])),df=b}function g9(){var a=0;return a=Math.floor((k.loops-e5)/2)-4,(bG==bZ||bG==cp||bG==co)&&(a=Math.floor((k.loops-e0)/3)-4),a<1&&(a=1),a}function ha(){dA=0,a6>10&&(dA=1),a6>20&&(dA=2),a6>30&&(dA=3)}function hb(){if(du>0){hf();return}if(cZ&&(cZ=!1,d9)){g0(cD);return}if(dE!=dn&&dE!=dn&&dE!=dF&&bG!=ci&&1!=hm("leveltutorialdid"+dE.Index)&&(ia(1,"leveltutorialdid"+dE.Index),d9)){g0(ci);return}if(bG!=bQ&&bG!=bR){if(bG!=cj&&!(d9&&dE==dy)){g0(cj),e5=k.loops;return}if(dE==dx||dE==dC||dE==dz||dE==dD||dE==dn||dE==dl){g0(cO);return}}hf()}function hc(a){var b;k.soundstop(d4),d4=d2,dc=!1,bB&&du<=0?(bD=!1,g0(cq)):g0(ch),bB=!1,h7(),bG!=cp&&(bC=!0,e5=k.loops,a4=1,d9||!a||eh||(hm("playold1")>0&&ia(hm("playold1"),"playold2"),ia(new Date().getTime(),"playold1")))}function hd(a){dE=a,(d9||f_)&&dE._Scores_from_text(hn("scoreslevel"+dE.Index)),c_=0,d$=0}function he(){return dE==dz?dT:dE==dy||dE==dF?d_:dE==dn?d_:dA}function hf(){var b,a=0;(a=hm("plays"+dE.Index)+1,ia(a,"plays"+dE.Index),a7=60,e5=k.loops,!(C.total>0)||ac)?eh?(bN=cQ,g0(b3)):(g0(cQ),iZ(),dw>0&&bG!=cQ&&d1<=0||(dw=0)):(ac=!0,g0(bQ)),du=0,dq=0,ds=0}function hg(){if(!d9&&hm("playold2")>0&&Math.abs(hm("playold2")-new Date().getTime())<dL){g0(cy);return}s=!1,bB=!1,h8(),g0(ck),k.soundstop(d4),d4=d2,dc=!1}function hh(){var a=null;null!=dG&&""!=k.ajaxresponseget(0,dG)&&((a=k.split(k.ajaxresponseget(1,dG),","),k.arraylengthget(a)>=3&&"good"==a[1])?(ad.Bought=!0,c$=1*a[2]||0,ix(k.sounds[10]),bG!=bR&&g4(a[3])):bG==bR&&g0(bQ),dG=null)}function hi(){var c=null,d=0,a="";a="levelbuildingbuy.php?",bG==bQ&&(a+="&level="+dE.Index);for(var b=C.first;b&&(c=b.val,d+=1,c!=ad);)b=b.next;a+="&buildingindex="+d,dG=gp(a,!1)}function hj(){var a="";a="levelday.php?",a+="&day="+a6,a+="&health="+ap,a+="&level="+dE.Index,a+="&progress="+he(),a+="&board="+gy(),a+="&seed="+hn("seed"),a+="&dealsdone="+a9,dH=gp(a,!1),ia(1,"leveldaysent")}function hk(b){var a="";if(eh||a8&&a6>50){ij();return}a="leveldone.php?",a+="&day="+a6,a+="&enemycol="+an,a+="&seed="+hn("seed"),a+="&score="+(a6+1e3*dA),a+="&board="+gy(),a+="&level="+dE.Index,a+="&health="+ap,a+="&achievements="+dA,b&&(a+="&retry=1"),dI=gp(a,!1)}function hl(){var a="";ia(0,"leveldaysent"),a="levelstart.php?",a+="&level="+dE.Index,a+="&board="+gy(),a+="&health="+ap,dK=gp(a,!1)}function hm(a){return 1*k.localstorageget("m_"+a)||0}function hn(a){return k.localstorageget("m_"+a)}function ho(c){var a=0,b=0;return(b=7,c&&(b=20),(a=k.mod(Math.floor(k.loops/b),5))<=0)?"   ":a<=1?".  ":a<=2?".. ":a<=3?" ..":"  ."}function hp(a,b){iJ(ho(!1),a,b,14,!1,!1)}function hq(a,b){k.transparencyset(Math.abs(.8*Math.sin(4*k.loops*k._degreestoradians))),k.imagedrawgl(k.images[333],a-9,b),k.transparencyset(0)}function hr(b,c){var a="";a="https://towerswap.app/log.php?",a+="&kind="+b,a+="&message="+c,dN=gp(a,!1)}function hs(a){var c=0,b=0;d9=!1,ia(0,"userisoffline"),ib(a[2],"token"),ib(a[3],"userid"),ib(a[4],"screenname"),ib(a[4],"screennamelast"),c$=1*a[5]||0,k.split(a[6]," "),du=1*a[7]||0,dq=1*a[8]||0,ds=1*a[9]||0,eO=!1,(1*a[10]||0)>0&&(eO=!0),b=1*a[11]||0,dp=a[12],hn("board").length>0&&(dq!=hm("day")&&dq!=hm("day")-1&&(ei="wrong day",eh=!0,k.debugset("Playing disconnected now because level continue day="+dq+("but localstorage="+hm("day")))),du!=hm("level")&&(ei="wrong level",eh=!0,k.debugset("Playing disconnected now because level continue index="+du+("but localstorage="+hm("level"))))),dp="",du=0,dq=0,ds=0,dw=0,eO=!1,b=0,hn("board").length>0&&(hm("boarduserid")!=hm("userid")?ib("","board"):(dp=hn("board"),du=hm("level"),dq=hm("day"),ds=hm("castlehealth"),eO=hm("repaired")>0,b=hm("levelprogress"),dv=hm("swaps"),dw=hm("seed"),dr=hm("dealsdone"),dt=hm("healthmax"))),dA=b,du==dz.Index&&(dA=0,(dT=b)>=dz.Goal_Number_1&&(dA=1,dT>=dz.Goal_Number_2&&(dA=2,dT>=dz.Goal_Number_3&&(dA=3,dT>=dz.Goal_number_4&&(dA=4,dT>=dz.Goal_number_5&&(dA=5)))))),(du==dy.Index||du==dF.Index)&&(dA=0,d_=b,dq>dy.Goal_Number_1&&(dA=1,dq>dy.Goal_Number_2&&(dA=2,dq>dy.Goal_Number_3&&(dA=3,dq>dy.Goal_number_4&&(dA=4,dq>dy.Goal_number_5&&(dA=5)))))),du==dn.Index&&(d_=b),fZ=a[13],f_="1"==a[14],(1*a[15]||0)>M&&(g7()?d8="Game update available!":(d8="Game update available!/Updating...",window.location.reload(),a[20]="")),""!=a[16]&&gA(a[16]),ac=!0,h2(a[17]),g4(a[18]),hH(a[19]),hE(a[20]),db=(1*a[21]||0)>0,aB=0,(c=1*a[22]||0)>0&&(c<=k.arraylengthget(dJ)?(aC=dJ[c],aB=1e3*(1*a[23]||0)):N=!0),az=1*a[24]||0,fT=gt(1*a[25]||0),M<(1*a[26]||0)&&(N=!0),fV=1*a[27]||0,fW=1*a[28]||0,fY=1*a[29]||0,f$=1*a[30]||0,t=1*a[31]||0,bm="1"==a[32],ht(a,33),fU=1*a[44]||0,fX=m,(1*a[45]||0)>0&&(fX=k.listitemget(161,bv,1*a[45]||0)),k.debugset("Login redirect level continue index="+du),ig(),du>0?(hd(dJ[du]),hc(!1),du==dn.Index&&ha()):(bD=!1,hd(dy),bD=!1,bC=!0,0==fT.Id?g0(bM):fV<=0&&gL()?g0(bX):g0(cq)),k.cls({r:0,g:0,b:0,a:255})}function ht(a,d){var c=0,b=0;gd._Clear(),(c=1*a[(b=d)+0]||0)>0&&(c<=k.arraylengthget(dJ)?(gd.level=dJ[c],gd.end_time=1e3*(1*a[b+1]||0),gd.clan_name=a[b+2],gd.clan_color_1=1*a[b+3]||0,gd.clan_color_2=1*a[b+4]||0,gd.clan_emblem=1*a[b+5]||0,gd.Clan_color_3=1*a[b+6]||0,gd.Color_style=m,(1*a[b+7]||0)>0&&(gd.Color_style=k.listitemget(15,bv,1*a[b+7]||0))):N=!0),gd.chest_got="1"==a[b+6],gd.You_won=1*a[b+7]||0,gd.User_is_in="1"==a[b+8]}function hu(){var a=0,b=0;k.debugset("matches was "+dU),dU>=(a=3)&&(iB(V/2,-33,b=dU-a+1,dU),iD(V/2-44,V+88,b,0)),dU=0}function hv(a,b){return a<=0&&(a=dW),b<=0&&(b=dV),"loading"!=w&&(aZ&&!jc(0,0,a,b)&&fG==bG||c4)}function hw(c,a,f,b,g){var h,d=0,e=0;dW=c,dY<=(dV=a)&&(dY=dV),d$=k.clamp(d$,0,k.clamp(dY-dV,0,99999)),k.offsetset(0,0),k.colorset({r:0,g:0,b:0,a:255}),e=f,ik(e),d=Math.floor((eW-c)/2)-0,0==b&&(dY<=dV?(b=hV()+Math.floor((eU-a-hT()-hV())/2),gH()&&(b-=33),bG==cc&&(b-=55)):b=70+hV()),k.offsetset(d,b),dY>a&&(d$-=eX/2,k.mousedownany?jd(0,0,dW,dV)&&(d$-=fF):(fD&&jd(0,0,dW,dV)&&(dZ=fO-fL),0!=dZ&&(d$+=dZ,.1>Math.abs(dZ*=.9)&&(dZ=0))),d$>dY-a&&(dZ=0),d$=k.clamp(d$,0,dY-a)),k.colorset(k.colormake(232,210,166,255)),k.rectdraw(0,-2,c,a+4),hy(),dY<=a&&(hz(),hx(g)),dY>dV&&hC(0,0,dW,dV)&&(k.mousedownany?k.cursorset(63,"grabbing"):k.cursorset(65,"grab"))}function hx(j){var c=0,a=null,g=0,b=null,e=null,d=0,h=0,i=0,f=0;dY>dV?(k.rectdraw(0,-55,dW,55),k.rectdraw(0,dV,dW,55),g_(0,-55,dW,dV+110,24,0)):g_(0,-15,dW,dV+30,24,0),j&&(h=dW-k.imagesizexget(k.images[298])+2,i=-11-k.imagesizeyget(k.images[298]),k.imagergbset(k.images[298],k.colormake(255,255,255,255)),k.mousedownany&&jc(h,i,k.imagesizexget(k.images[298]),k.imagesizeyget(k.images[298]))&&!k.mousemovedget(-1)&&k.imagergbset(k.images[298],k.colormake(200,200,200,255)),k.imagedrawgl(k.images[298],h,i),hC(h,i,k.imagesizexget(k.images[298]),k.imagesizeyget(k.images[298]))&&k.cursorset(25,"pointer")),a=k.images[287],b=k.images[286],c=k.mod(Math.floor((d$+dX+9999-dY)/10),4),e=k.images[297],1==c&&(e=k.images[296]),2==c&&(e=k.images[295]),3==c&&(e=k.images[293]),dY>d$+dV&&(a=k.images[334],1==c&&(a=k.images[324]),2==c&&(a=k.images[323]),3==c&&(a=k.images[294]),b=e,g=4),d=k.imagesizexget(b)-15,d=0;for(var l=0;d<dW-(15-15*jM(k.images[285]==a,0));){if(l++ >999999)throw{line:64,message:"Infinite While Loop"};k.imagedrawgl(a,d,dV-(1+g)),d+=k.imagesizexget(a)}k.imagedrawgl(b,-1,dV-(1+g)),g2(b,dW-k.imagesizexget(b)+0,dV-(1+g)),k.imagedrawgl(k.images[283],0-k.imagesizexget(k.images[283]),dV-10),g2(k.images[283],dW,dV-10),a=k.images[285],b=k.images[284],f=1,d$>0&&(a=k.images[334],1==c&&(a=k.images[324]),2==c&&(a=k.images[323]),3==c&&(a=k.images[294]),b=e,f+=4),d=k.imagesizexget(b)-15,d=0;for(var m=0;d<dW-(15- -15*jM(k.images[285]==a,0));){if(m++ >999999)throw{line:99,message:"Infinite While Loop"};k.imagedrawgl(a,d,f-k.imagesizeyget(a)),d+=k.imagesizexget(a)}k.imagedrawgl(b,-1,f-k.imagesizeyget(b)),g2(b,dW-k.imagesizexget(b)+0,f-k.imagesizeyget(b)),k.imagedrawgl(k.images[283],0-k.imagesizexget(k.images[283]),11-k.imagesizeyget(k.images[283])),g2(k.images[283],dW,11-k.imagesizeyget(k.images[283]))}function hy(){var a=0;d$>0?a-=k.mod(d$,k.imagesizeyget(k.images[281])):a+=k.imagesizeyget(k.images[288]);for(var b=0;a<dV-16*jM(dY<=dV,0);){if(b++ >999999)throw{line:6,message:"Infinite While Loop"};k.imagedrawgl(k.images[281],0,a),g2(k.images[281],dW-k.imagesizexget(k.images[281]),a),a+=k.imagesizeyget(k.images[281])}d$<k.imagesizeyget(k.images[288])&&(k.imagedrawgl(k.images[288],0,0-d$),g2(k.images[288],dW-k.imagesizexget(k.images[288]),0-d$)),d$>=dY-dV-k.imagesizeyget(k.images[288])&&(k.imagedrawgl(k.images[288],0,dY-d$,k.imagesizexget(k.images[288]),0-k.imagesizeyget(k.images[288])),k.imagedrawgl(k.images[288],dW,dY-d$,0-k.imagesizexget(k.images[288]),0-k.imagesizeyget(k.images[288])))}function hz(){k.transparencyset(.8),k.colorset(k.colormake(0,0,0,255)),k.rectdraw(0,0,dW,6),k.transparencyset(.9),k.rectdraw(0,6,dW,1),k.transparencyset(0)}function hA(){var b=null;if(ix(k.sounds[30]),bG==ct)for(var a=H.first;a;)(b=a.val).done_time>0&&k.listremove(4,H,b),a=a.next;bC?bD?hS():g0(cq):bG=cW,k.offsetset(0,0)}function hB(a,b){return a<b?a:b}function hC(a,b,c,d){return!g7()&&!!k.rectshit(k.mousereal.x,k.mousereal.y,1,1,(window.gtboffsetx+a)*bE,(window.gtboffsety+b)*bE,c*bE,d*bE)}function hD(){d1=5}function hE(a){k.debugset("news from server = "+a),""!=a&&(a!=hn("newsseen")&&(""!=hn("newsseen")&&(k.debugset("NEWS IS NEW"),d8=a),ib(a,"newsseen")),k.debugset(d8))}function hF(){var b=null;if(H.total>0)for(var a=H.first;a;){if("rankearn"==(b=a.val).kind||"freebonus"==b.kind)return!0;a=a.next}return!1}function hG(b){var a="";a="notificationcollect.php?",b<=0?a+="&id=rankearnall":a+="&id="+b,eb=gp(a,!1)}function hH(e){var a=null,c=0,b=null,d=null;if(H={total:0,first:null,last:null},""!=e)for(c=1,d=k.split(e," ");c<=k.arraylengthget(d);c++){if(a=k.split(d[c],"@"),7>k.arraylengthget(a)){alert("Notification not enough fields:"+d[c]);return}(b=new jV).id=1*a[1]||0,b.kind=a[2],b.From_user_name=a[3],b.level_index=1*a[5]||0,b.amount=1*a[6]||0,b.reason=1*a[7]||0,b.score=1*a[9]||0,b.From_user_avatar=gt(1*a[10]||0),b.reason=k.clamp(b.reason,1,k.arraylengthget(eL))}}function hI(a){return(a=Math.floor(a))>9?""+a:"0"+a}function hJ(){var cd,$,aK,a0,_,c,cn,q,h,a1,cU,cV,df,di,dj,cz,aj,aa,a3,z,ab,ac,dp,a,cA,bf,i,cE,ak,d,dq,dr,ds,bh,cG,ah,cI,j,e,dt,du,cL,ai,f,dv,dw,p,dJ,al,g,dN,dO,dU,as,ax,bk=null,ay=0,b=null;if(g7()||k.cursorset(1,"auto"),bG==bK){dZ=0,(k.soundstop(d2),k.soundstop(d3),k.cls({r:57,g:57,b:57,a:255}),k.colorset({r:251,g:251,b:251,a:255}),g7())?(k.fontsizeset(24),k.textdrawcentered("Loading",eW/2,eU/2),k.fontsizeset(16),k.textdrawcentered("Cancel",eW/2,eU/1.5),aZ&&jc(eW/2-50,eU/1.5,100,22)&&(hr("loadingcancel","ad"),gl())):(k.fontsizeset(24),iH(x,eW/2,eU/2-150,14,!0),gB("App Store",eW/2,eU/2-50,!0,!0,!1,!1,!1,!1),af&&k.browseropen("https://apps.apple.com/app/id1463356368"),gB("Play Store",eW/2,eU/2+36,!0,!0,!1,!1,!1,!1),iH(y,eW/2,eU/2+140,14,!0),af&&k.browseropen("https://play.google.com/store/apps/details?id=com.curtastic.towerswap"),dZ=25-Math.floor((k.loops-e5)/60),((localStorage&&1*localStorage.userid||0)>0||a8)&&(dZ-=20),k.fontsizeset(32),k.textdraw(""+dZ,eW-80,3),dZ<1?(gn(),gj()):(k.textdraw("X",eW-30,3),aY&&jc(eW-30,0,30,30)&&gl()));return}if(bG==cl){!function(){var a=0,b=!1,c=0;for((b=k.loops>300)?k.cls({r:0,g:0,b:0,a:255}):(k.colorset(k.colormake(0,0,0,255)),k.circledraw(eW/2,eU/2,eU+eW,0,2*Math.PI)),a=1;a<=k.images.length;a++)k.imageloaded(k.images[a-1])&&(c+=1);if(cv==cl?k.transparencyset(k.clamp((k.loops-gg)/11,0,1)):k.transparencyset(1-by),""!=hn("screenname")&&hm("userid")>0&&""!=hn("token")&&(k.colorset({r:193,g:121,b:0,a:255}),k.textdrawcentered("Welcome back, "+hn("screenname"),eW/2,eU/2-122)),k.colorset({r:193,g:121,b:0,a:255}),k.textdraw("Loading"+ho(!1),eW/2-k.textwidth("Loading")/2,eU/2),k.cursorset(30,"wait"),bG==cl&&(by<1&&(by+=1e-4+by/4)>=1&&(by=1,io(e2),im(d6)),ik(by),by>=1&&c>=k.images.length)){if(null==fC?(""!=hn("screennamelast")?(bD=!1,bB=!1,g0(cp)):(hd(dy),bC=!0,bD=!1,g0(cq)),k.cls({r:0,g:0,b:0,a:255})):i8(),null==fC){k.transparencyset(0),k.cls({r:0,g:0,b:0,a:255}),k.offsetset(0,0);return}b&&(k.colorset({r:193,g:121,b:0,a:255}),iH("Check internet connection",eW/2,eU/2+35,14,!0),gB("Play Offline",eW/2,eU/2+70,!0,!0,!1,!1,!1,!1),af&&(fC=null,hW()))}}();return}if(bC){!function(){var c=0,d=0,b=null;for(function(){var h=null,d=0,e=0,j=0,i=0,f=!1,g=0,c=null,a=0,b=0;for(h=k.images[232],dE.Is_water_level&&(h=k.images[225]),k.offsetset(R,S),i=Math.ceil((eW/fA-dQ)/2),j=Math.ceil(eU/fA-dR),g=0;g<=1;g++)for(b=-4;b<=dR+j;b++)for(a=1-i;a<=dQ+i;a++)if(k.mod(a+b,2)==g){if(d=(a-1)*fA,e=(b-1)*fA,f=!g3(a,b),dE.Is_water_level){if(f){if(0==b&&b<1&&a>0&&a<=dQ){k.imagedrawgl(k.images[4],d,e);continue}}else if((c=dP[a][b]).Kind==ft){k.imagedrawgl(h,d,e);continue}}0==g||f?f?k.imagedrawgl(h,d,e):k.imagedrawgl(k.images[4],d-1,e-2):k.imagedrawgl(k.images[76],d-1,e),!f&&iU(a,b)&&(c=dP[a][b],k.imagedrawgl(k.images[375],c._Pixel_Target_X_Get()+c.Kind.X_offset+c.Shift_X+6*jM(a>1,0),c._Pixel_Target_Y_Get()+c.Kind.Y_Offset+c.Shift_Y+6))}(function(){var d=0,e=0,c=null,a=0,b=0;if(null!=dE.Road)for(dE==dF&&(k.offsetset(0,0),gE(),k.offsetset(R,S)),b=1;b<=k.arrayheightget(dE.Road);b++)for(a=1;a<=k.arraylengthget(dE.Road);a++)dE.Road[a][b]&&(d=(a-1)*fA-1,e=(b-1)*fA,c=k.images[442],(a>=k.arraylengthget(dE.Road)||!dE.Road[a+1][b])&&(c=k.images[443]),k.imagedrawgl(c,d,e),b<=1&&k.imagedrawgl(c,d,e-fA))})(),dE.Is_water_level&&gY(1),k.offsetset(R,S),k.offsetset(0,0),gY(2),function(){var j,d=null,e=0,f=0,g=0,h=0,i=null,b=0,a=0,c=0;for(ao>0&&(av=2*Math.sin(ao/10*620*k._degreestoradians),(ao+=1)>10&&(ao=0)),bG==cu&&(av=2*Math.sin(k.loops/10*620*k._degreestoradians)),c=S-k.imagesizeyget(k.images[308])+ -12,k.imagedrawgl(k.images[308],R+V/2+av-k.imagesizexget(k.images[308])/2,c+20),fY>0?(h=fY,e=fV,f=fW,g=fU,d=fX,bG==(j=bP)&&U&&(h=gd.clan_emblem,e=gd.clan_color_1,f=gd.clan_color_2,g=gd.Clan_color_3,d=gd.Color_style),gJ(R+(V-22)/2+av,c+144,h,e,f,!1,!1,g,d),k.imagedrawgl(k.images[409],R+(V-22)/2+av,c+144)):(i=k.images[405],k.imagedrawgl(i,R+V/2+av-k.imagesizexget(i)/2,c+146+0)),a=1;a<=k.arraylengthget(am);a++)for(b=0;b<=am[a]-1;b++)k.imagerotationset(k.images[278],77*h4(10*a+b)),k.imagedrawgl(k.images[278],R+(gD(a)+10*h4(8*a+b))+av,c+k.imagesizeyget(k.images[308])-(15+22*h4(9*a+b)+7*Math.sin(44*b*k._degreestoradians)))}(),dE!=dF&&gE()}(),k.offsetset(R,S),c=1;c<=dQ;c++)null!=(b=aw[c])&&b._Draw5(!1);for(d=1;d<=dR;d++)for(var a=L.first;a;){if((b=a.val).Grid_y!=d||b.Kind==ft){a=a.next;continue}b._Draw5(!1),a=a.next}k.offsetset(0,0),function(){var b=0,a=0,c=0,d=0;if(k.loops-at<50)for(d=S-k.imagesizeyget(k.images[308])+ -12,k.imagerotationset(k.images[99],0),7>k.mod(k.loops,14)&&k.imagerotationset(k.images[99],45),c=au,b=au,au<0&&(c=1,b=k.arraylengthget(am)),a=c;a<=b;a++)k.imagedrawgl(k.images[99],R+gD(a),d+k.imagesizeyget(k.images[308])-(7+11*Math.sin(30*a*k._degreestoradians)))}()}(),k.offsetset(R,S);for(var dZ,B,aI,br,bw=I.first;bw;)null!=(b=bw.val).Tower&&b.Tower.Kind==fo&&26>Math.abs(b.Pixel_Y-24-(b.Tower.Pixel_y-jM(b.Tower.Flipped,20)))&&b._Draw3(),bw=bw.next;!function(){for(var b=null,a=L.first;a;)(b=a.val).Kind==fo&&b._Ballista_Top_Draw(),a=a.next}(),null!=ff&&(ff._Draw5(!1),ff.Kind==fo&&ff._Ballista_Top_Draw()),k.offsetset(0,0),B=0,aI=0,(bG==cT||bG==ca||bG==cQ&&k.loops<e5+a5&&a6>1)&&(aI=k.loops-e5,B=.56,bG!=cQ?bG==ca?aI<a5?a4=1-aI/a5*(1-B):(a4=B,2==a6&&dE==dy&&e$&&1!=hm("tutorialdidfirstnight")?(ia(1,"tutorialdidfirstnight"),g0(cN)):jK()):a4=B:a4=aI/a5*(1-B)+B,k.transparencyset(a4),k.colorset(k.colormake(22,11,33,255)),k.rectdraw(0,0,eW,eU),k.transparencyset(0)),k.offsetset(R,S);for(var bx=G.first;bx;)0==(bk=bx.val).Got_Zapped&&bk._Draw2(),bx=bx.next;for(var bF=G.first;bF;)(bk=bF.val).Got_Zapped>0&&bk._Draw2(),bF=bF.next;for(var bJ=I.first;bJ;)null==(b=bJ.val).Tower||b.Tower.Kind==fo&&26>Math.abs(b.Pixel_Y-24-(b.Tower.Pixel_y-jM(b.Tower.Flipped,20)))||b._Draw3(),bJ=bJ.next;k.offsetset(0,0),function(){var e=0,a=0,c=0,d=0,b=0;if(eU>(c=S+8*fA)){for((bG==ca||bG==cT&&k.loops-e5<111)&&(d=.3,bG==cT&&(d-=(k.loops-e5)/111*d),a$[1]+=d,a$[2]+=2*d,a$[3]+=3*d,a$[4]+=2.8*d),e=1;e<=3;e++)a$[e]>=k.imagesizexget(k.images[234])&&(a$[e]-=k.imagesizexget(k.images[234]));a=255*a4,k.imagergbset(k.images[235],k.colormake(a,a,a,255)),k.imagergbset(k.images[234],k.colormake(a,a,a,255)),k.imagergbset(k.images[233],k.colormake(a,a,a,255)),k.imagergbset(k.images[241],k.colormake(a,a,a,255)),k.imagergbset(k.images[242],k.colormake(a,a,a,255)),k.imagergbset(k.images[243],k.colormake(a,a,a,255)),b=a$[1]-k.imagesizexget(k.images[234]),c+=9,b=Math.floor(a$[2]-k.imagesizexget(k.images[234])),k.transparencyset(.2);for(var f=0;b<eW;){if(f++ >999999)throw{line:39,message:"Infinite While Loop"};k.imagedrawgl(k.images[234],b,c),b+=k.imagesizexget(k.images[234])}k.imagedrawgl(k.images[242],0,c+k.imagesizeyget(k.images[234]),eW,23),k.transparencyset(0),b=a$[3]-k.imagesizexget(k.images[234]),c+=22;for(var g=0;b<eW;){if(g++ >999999)throw{line:48,message:"Infinite While Loop"};k.imagedrawgl(k.images[233],b,c),b+=k.imagesizexget(k.images[233])}k.imagedrawgl(k.images[241],0,c+k.imagesizeyget(k.images[233]),eW,eU-c)}}(),bG==ch&&(k.loops-e5<30?ik((k.loops-e5)/60):hb()),bG==cm&&gU(),function(){var n,c,v,d,e,f,M,N,b,o,g,p,i,x,q,B,y,s,z,E,F,h,H,t,j,l,m,a=0,u=0;k.imagedrawgl(k.images[12],0,0,eW,32+1.5*hV()),k.offsetset(R,S),0==J.total&&k.loops-fa>3&&(d0=d1),((dE==dy||dE==dF)&&a6==dE._Goal_Number_Next_Get()||gR())&&!dc&&(k.transparencyset(Math.abs(.5*Math.sin(11*k.loops*k._degreestoradians))),k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],(d_-.5)*fA,fA*dR+22+Math.sin(20*k.loops*k._degreestoradians)*gZ(d1,0,4,3,0)),k.transparencyset(0));for(var A=J.first;A;)(0,A.val)._Update5(),A=A.next;if(k.offsetset(0,0),bG==bR&&function(){var c,b=null,d=0,e="",a=null;if(null!=ad)b=ad.Kind,d=ad.Level;else{if(null==c6){bD=!1,g0(cq),hr("crash","building buy put null"),alert("Error buying.");return}b=c6.Tile_Kind,d=c6.Tier}if(k.offsetset(R,S),e="Put it wherever you want.",null!=dG&&(hh(),eh&&(dG=null)),null!=da&&(c=null,null!=da&&""!=k.ajaxresponseget(0,da)&&(c=k.split(k.ajaxresponseget(1,da),","),k.arraylengthget(c)>=2&&"good"==c[1]?g4(c[2]):g0(bQ),da=null),bG!=bR)){h9();return}if(1==cH)null!=dG||null!=da?(k.offsetset(0,0),ik(.4),iH("   Connecting"+ho(!1),eW/2,eU/2-22,14,!0),k.cursorset(4,"wait"),gB("Back",eW/2,eU/2+9,!1,!0,!1,!1,!1,!1),af&&(dG=null,da=null,g0(bQ),h9())):(ad=null,g0(cQ),iZ(),bG==cQ&&hu(),ad=null);else{if(a=iS(fJ,fL),fD&&null!=a&&a._Kind_can_go_here(b)){k.debugset("Putting building here"),ix(k.sounds[28]),a.Kind=b,a.Tier_Index=d,a.Kind==fw&&(a.dynamite_total=1),a._Cannonslot_attach(),cH=1;return}k.mousedownany?(null!=a&&a._Kind_can_go_here(b)&&(k.transparencyset(.5),k.colorset({r:0,g:0,b:14,a:255}),k.rectdraw(a.Pixel_x,a.Pixel_y,fA,fA),k.transparencyset(0)),b._Draw6(d,fJ-R-fA/2,fL-S-fA/2,0)):(k.transparencyset(Math.abs(Math.sin(13*k.loops*k._degreestoradians))),b._Draw6(d,(V-fA)/2,(V-fA)/2,0),k.transparencyset(0))}1==cH&&(null!=dG||null!=da)||g8(e,"",k.images[14],0),k.offsetset(0,0)}(),bG==cO&&function(){var a=0,b=0;if(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),dE==dn?(k.rectdraw(0,0,R+fQ._Pixel_Target_X_Get(),eU),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+2*fA),0,eW,eU),k.rectdraw(R+fQ._Pixel_Target_X_Get(),S+(fQ._Pixel_Target_Y_Get()+fA),2*fA,eU),k.rectdraw(R+fQ._Pixel_Target_X_Get(),0,2*fA,S+(fQ._Pixel_Target_Y_Get()+0))):dE==dy||dE==dl||dE==dz?k.rectdraw(0,0,eW,eU):(k.rectdraw(0,0,R+fQ._Pixel_Target_X_Get(),eU),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+fA),0,eW,eU),(dE==dx||dE==dx||dE==dx||dE==dn)&&k.rectdraw(R+fQ._Pixel_Target_X_Get(),S+(fQ._Pixel_Target_Y_Get()+fA),fA,eU),dE==dC&&k.rectdraw(R+fQ._Pixel_Target_X_Get(),0,fA,S+(fQ._Pixel_Target_Y_Get()+0))),k.transparencyset(0),k.offsetset(R,S),dE==dx&&g8("Drag it up to repair.","",k.images[14],0),dE==dD&&g8("Drag it into the castle.","",k.images[14],0),dE==dC&&g8("Drag it down into the water","",k.images[14],0),dE==dn&&g8("Move cannons to the edge","",k.images[14],0),dE==dz){for(k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),k.imagedrawgl(fQ.Kind.Image,fQ.Pixel_x+fQ.Kind.X_offset,fQ.Pixel_y-fQ.Kind.Y_Offset),b=1;b<=4;b++)2!=b&&k.imagedrawgl(fQ.Kind.Image,3*fA+fQ.Kind.X_offset,fA*b-fQ.Kind.Y_Offset);k.transparencyset(0),g8("Match-4 these for +1&","",k.images[14],0)}if(dE==dl){for(k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),k.imagedrawgl(fQ.Kind.Image,fQ.Pixel_x+fQ.Kind.X_offset,fQ.Pixel_y-fQ.Kind.Y_Offset),b=0;b<=4;b++)2!=b&&k.imagedrawgl(fQ.Kind.Image,3*fA+fQ.Kind.X_offset,fA*b-fQ.Kind.Y_Offset);k.transparencyset(0),g8("Big matches give you more/bonus swaps& on this/level only.","",k.images[14],0)}if(dE==dy){k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),null==ff?k.imagedrawgl(fv.Image,2*fA+0,3*fA):k.imagedrawgl(fv.Image,ff.Pixel_x,ff.Pixel_y),k.imagedrawgl(fv.Image,3*fA,4*fA),k.imagedrawgl(fv.Image,3*fA,2*fA),k.transparencyset(0);for(var c=G.first;c;)(0,c.val)._Draw2(),c=c.next;aZ&&(e5=-999),g8("A dragon is coming!/Match these 3 stones/to make a tower!","",k.images[65],0)}dE==dx&&(a=90),dE==dD&&(a=90),dE==dC&&(a=270),dE==dy&&(a=180),dE==dz&&(a=180),dE==dl&&(a=180),dE==dn&&(a=180),k.imagerotationset(k.images[75],a),k.mousedownany||k.imagedrawgl(k.images[75],fQ._Pixel_Target_X_Get()+fA/2+Math.cos(a*k._degreestoradians)*(2*Math.sin(15*k.loops*k._degreestoradians)),fQ._Pixel_Target_Y_Get()+fA/2+Math.sin(a*k._degreestoradians)*Math.sin(15*k.loops*k._degreestoradians))}(),bG==cj&&function(){var a=0,b=0;if(dE==dn?(k.transparencyset(.5),k.colorset(k.colormake(0,0,0,255)),k.rectdraw(0,0,eW,S),k.rectdraw(0,S+dR*fA,eW,eU),k.rectdraw(0,S,R,dR*fA),k.rectdraw(R+fA,S,(dQ-2)*fA,dR*fA),k.rectdraw(R+dQ*fA,S,eW,dR*fA),k.transparencyset(0)):dE==dF?(k.transparencyset(.5),k.colorset(k.colormake(0,0,0,255)),k.rectdraw(0,0,R+2*fA,eU),k.rectdraw(R+4*fA,0,eW,eU),k.transparencyset(0)):ik(.5),g8(dE._Goal_Text_Next_Get(),"",k.images[14],0),aZ&&(dk>=3?hb():e5=0),dE==dB){for(k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),a=0;a<=1;a++)b=a*(5*fA),k.imagedrawgl(fo.Level_Images[dA+1],b,2*fA);k.transparencyset(0)}dE==dy&&(d9?(k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),k.imagedrawgl(fv.Image,1*fA+0,4*fA),k.imagedrawgl(fv.Image,2*fA,5*fA),k.imagedrawgl(fv.Image,2*fA,3*fA),k.transparencyset(0),k.imagerotationset(k.images[75],180),k.imagedrawgl(k.images[75],2.1*fA+2*Math.sin(7*k.loops*k._degreestoradians),4.6*fA)):(k.transparencyset(Math.abs(Math.sin(5*k.loops*k._degreestoradians))),k.imagedrawgl(k.images[61],2*fA,3*fA),k.transparencyset(0))),k.offsetset(0,0)}(),bG==ci&&(dE==dy&&function(){var a=null;if(ik(.5),k.offsetset(R,S),(a=k.listfirstget(4,G)).Pixel_y>6.4*fA)a._Update2(),a._Update2(),a._Draw2(),dg=-5,dh=eU-64-S,k.imagedrawgl(k.images[65],dg,dh);else{hb(),g0(cO);return}k.offsetset(0,0)}(),dE==dB&&(ik(.5),k.offsetset(R,S),g9(),g8("The castle is on an island.","There's less room to build.",k.images[14],0),aZ&&(dk>=2?(g0(cj),e5=k.loops):e5=0),k.offsetset(0,0)),dE==dC&&(b=0,o=0,g="",p="",ik(.5),k.offsetset(R,S),o=dh-58,b=g9(),g="This castle is on a tiny isle",p="But there is shallow water",iH(k.stringpart(g,1,b),-8,o,14,!1),b>g.length&&iH(k.stringpart(p,1,b-g.length),-8,o+18,14,!1),b>g.length+p.length&&iH(k.stringpart("at the bottom.",1,b-(g.length+p.length)),-8,o+36,14,!1),dg=-5,dh=eU-64-S,k.imagedrawgl(k.images[14],dg,dh),aZ&&(b>80?(bG=cj,e5=k.loops):e5=0),k.offsetset(0,0)),dE==dD&&(ik(.5),g8("We are on a short island./There's less room to put/defenses for the castle.","",k.images[14],0),aZ&&(dk>=3?hb():e5=0),k.offsetset(0,0)),dE==dx&&(ik(.5),g8("This castle is damaged!","It only has 1 heart left!",k.images[14],0),aZ&&(dk>1?hb():e5=0),k.offsetset(0,0)),null==dE&&(i=0,x=0,q="",B="",ik(.5),k.offsetset(R,S),x=dh-58,i=g9(),q="Every 7 days a fire dragon",B="arrives. Watch out!",iH(k.stringpart(q,1,i),-8,x,14,!1),i>q.length&&iH(k.stringpart(B,1,i-q.length),-8,x+18,14,!1),dg=-5,dh=eU-64-S,k.imagedrawgl(k.images[14],dg,dh),aZ&&(i>44?hb():e5=0),k.offsetset(0,0)),dE==dz&&(ik(.5),g8("Match-4 is four of the","same thing in a row.",k.images[14],0),aZ&&(dk>=2?hb():e5=0),k.offsetset(0,0))),bG==cN&&(ik(.4),g8("You used all your swaps&/Night is falling!/Dragons come in the night!","",k.images[14],0),k.offsetset(0,0),aZ&&(dk>=2?jK():e5=0)),bG==cg&&(ik(.5),dE==dy&&g8("Good Work!","Now build more defenses!",k.images[14],0),dE==dD&&g8("Good! Next arm both sides","with bronze arrow towers!",k.images[14],0),aZ&&(dk>=2?dE==dy?jJ():g0(b6):e5=0),k.offsetset(0,0)),bG==cM&&(fQ.Kind==fo&&function c(){var a=0,b=0;if(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,R+fQ._Pixel_Target_X_Get(),eU),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+fA),0,eW,eU),k.transparencyset(0),k.offsetset(R,S),b=k.mod(k.loops,fA),fQ.Grid_y>0)for(a=1;a<=fQ.Grid_y-0;a++)k.imagerotationset(fQ.Kind.Projectile_Image,180),k.imagedrawgl(fQ.Kind.Projectile_Image,fQ._Pixel_Target_X_Get()+.5*fA,(a-.5)*fA-b);for(a=fQ.Grid_y+0;a<=dR+1;a++)k.imagerotationset(fQ.Kind.Projectile_Image,0),k.imagedrawgl(fQ.Kind.Projectile_Image,fQ._Pixel_Target_X_Get()+.5*fA,(a-.5)*fA+b);g8("Ballista!","Shoots up and down only.",k.images[14],0)}(),fQ.Kind==fm&&function e(){var a=0,b=0,d=0,c=0;for(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,eW,S+fQ._Pixel_Target_Y_Get()),k.rectdraw(0,S+(fQ._Pixel_Target_Y_Get()+fA),eW,eU),k.transparencyset(0),b=k.mod(2*k.loops,fA),k.offsetset(R,S),d=fQ._Pixel_Target_X_Get()+.5*fA,c=fQ._Pixel_Target_Y_Get()+.5*fA,a=fQ.Grid_x-1;a<=dQ;a++)k.imagerotationset(fQ.Kind.Projectile_Image,3*k.loops),k.imagedrawgl(fQ.Kind.Projectile_Image,b+fA*(a+.5),c);for(a=0;a<=fQ.Grid_x;a++)k.imagerotationset(fQ.Kind.Projectile_Image,3*k.loops),k.imagedrawgl(fQ.Kind.Projectile_Image,d-b-fA*a,c);g8("Cannons shoot left/and right.","",k.images[14],0)}(),fQ.Kind==fx&&function e(){var a=0,b=0,c=0,d=0;for(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,eW,S+(fQ._Pixel_Target_Y_Get()-fA)),k.rectdraw(0,S+(fQ._Pixel_Target_Y_Get()-fA),R+(fQ._Pixel_Target_X_Get()-fA),3*fA),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+2*fA),S+(fQ._Pixel_Target_Y_Get()-fA),eW,3*fA),k.rectdraw(0,S+(fQ._Pixel_Target_Y_Get()+2*fA),eW,eU),k.transparencyset(0),k.offsetset(R,S),b=k.mod(k.loops,fA),c=fQ._Pixel_Target_X_Get()+fA/2,d=fQ._Pixel_Target_Y_Get()+fA/2,a=0;a<=7;a++)k.imagerotationset(fQ.Kind.Projectile_Image,(a-90)*45),k.imagedrawgl(fQ.Kind.Projectile_Image,c+Math.cos(45*a*k._degreestoradians)*b,d+Math.sin(45*a*k._degreestoradians)*b);g8("You "+(iP(0==Q,"got","made")+" a tower!"),"It shoots anything nearby.",k.images[14],0)}(),fQ.Kind==fp&&(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,eW,S+fQ._Pixel_Target_Y_Get()),k.rectdraw(0,S+fQ._Pixel_Target_Y_Get(),R+fQ._Pixel_Target_X_Get(),fA),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+fA),S+fQ._Pixel_Target_Y_Get(),eW,fA),k.rectdraw(0,S+(fQ._Pixel_Target_Y_Get()+fA),eW,eU),k.transparencyset(0),k.offsetset(R,S),k.transparencyset(Math.abs(Math.sin(20*k.loops*k._degreestoradians))),k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],fQ._Pixel_Target_X_Get()+fA/2,fQ._Pixel_Target_Y_Get()+fA),k.transparencyset(0),g8(0==Q?"You got a chest!":"You made a chest!","Tap it to open it",k.images[14],0)),null==fQ.Kind&&(n=0,k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,eW,S+fQ.Grid_y*fA),k.rectdraw(0,S+fQ.Grid_y*fA,R+fQ.Grid_x*fA,fA),k.rectdraw(R+(fQ.Grid_x+1)*fA,S+fQ.Grid_y*fA,eW,fA),k.rectdraw(0,S+(fQ.Grid_y+1)*fA,eW,eU),k.transparencyset(0),k.offsetset(R,S),k.transparencyset(Math.abs(Math.sin(20*k.loops*k._degreestoradians))),k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],(fQ.Grid_x+.5)*fA,fQ.Grid_y*fA+1*fA),k.transparencyset(0),n=dh-40,0==Q?iH("You got a shovel!",-8,n,14,!1):iH("You made a shovel!",-8,n,14,!1),iH("Tap it to get an extra swap",-8,n+18,14,!1)),fQ.Kind==fz&&(k.transparencyset(.5),k.colorset({r:0,g:0,b:0,a:255}),k.rectdraw(0,0,eW,S+fQ._Pixel_Target_Y_Get()),k.rectdraw(0,S+fQ._Pixel_Target_Y_Get(),R+fQ._Pixel_Target_X_Get(),fA),k.rectdraw(R+(fQ._Pixel_Target_X_Get()+fA),S+fQ._Pixel_Target_Y_Get(),eW,fA),k.rectdraw(0,S+(fQ._Pixel_Target_Y_Get()+fA),eW,eU),k.transparencyset(0),g8("Ice walls slow down/the dragons.","",k.images[14],0)),aZ&&(null!=fQ.Kind&&fQ.Kind!=fp||jc(fQ.Pixel_x,fQ.Pixel_y,fA,fA))&&(fQ.Kind==fm&&(fQ.Flip_loops=1),g0(cQ),fQ.Kind==fp&&fQ._Chest_Open(),ia(1,"tilekindtutorialdid"+fQ.Kind.id),fQ.Kind.First_Matched_tile=null,fQ=null,ji()),k.offsetset(0,0)),bG==cr&&(y=0,s="",ik(.5),k.offsetset(R,S),k.transparencyset(Math.abs(Math.sin(20*k.loops*k._degreestoradians))),k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],(d_-.5)*fA,fA*(dR+1)+9),k.transparencyset(0),y=g9(),a6>10&&(y=99),s="coming from the south!",d_<3&&(s="coming from the southwest!"),d_>4&&(s="coming from the southeast!"),g8("The mother of dragons is",s,k.images[14],0),aZ&&(y>50?jJ():e5=0),k.offsetset(0,0)),bG==cb&&(z=0,ik(.5),k.offsetset(R,S),k.transparencyset(Math.abs(Math.sin(20*k.loops*k._degreestoradians))),k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],(d_-.5)*fA,fA*(dR+1)+9),k.transparencyset(0),z=g9(),a6>10&&(z=99),g8("A golden dragon is coming","tonight. It's harmless!",k.images[14],0),aZ&&(z>50?jJ():e5=0),k.offsetset(0,0)),bG==b1&&function(){var d="",b=0,a=0,c=0,e=0,f=0;if(cH>0&&ik(.4),cH<3)b=R+(aF.Pixel_x+aF.Kind.X_offset),a=S+(aF.Pixel_y-aF.Kind.Y_Offset),c=e4,cH>0&&(c=9999),c=k.clamp(c,0,k.imagesizeyget(k.images[363])),k.imagedrawglpart(k.images[363],b-3*Math.sin(5*e4*k._degreestoradians)+3,a+(25-c)+1*Math.sin(8*e4*k._degreestoradians),0,0,k.imagesizexget(k.images[363]),c),cH<=0&&e6>66&&(iz(),e5=k.loops),bd=b+22,be=a+30;else if(4==cH){if(e=R+bb.Pixel_x,f=S+bb.Pixel_y,e6>88){bb._Kind_Set2(aH),bb.Tier_Index=bc,bb.Appear_loops=33,bb.Removed=!1,aF=null,g0(bO),ix(k.sounds[22]);return}b=gZ(e6,0,77,bd,e),a=gZ(e6,0,77,be,f),aH._Draw6(bc,b,a,0),k.imagedrawgl(k.images[363],b-22,a-30)}else e=R+(V/2+Math.cos(2*k.loops*k._degreestoradians)*(V/2)),f=S+(V/2+Math.sin(2*k.loops*k._degreestoradians)*(V/2)),bd+=(e-bd)/55,be+=(f-be)/55,k.imagedrawgl(k.images[363],bd-22,be-30);if(!(cH<=0)){if(2==cH){if(d="Watch an ad",aG>0&&(d="Give me "+(""+aG+" heart"),aG>1&&(d+="s")),g8(d+" for a",iQ(bc)+iP(bc>1," ","")+aH.Name+"?",k.images[363],0),a=eU-S-154,aG>0?(k.imagedrawgl(k.images[6],V/2-77-69,a-8),iH("-"+aG,V/2-77-54,a-14,14,!1)):k.imagedrawgl(k.images[365],V/2-77-60,a-8),k.imagerotationset(k.images[75],180),k.imagedrawgl(k.images[75],V/2-77-15,a),aH._Draw6(bc,V/2-77+6,a-22,0),k.imagedrawgl(k.images[364],V/2+77-11,a-10),gB("Deal",V/2-77,a+33,!0,!0,!1,!1,!0,!1),af){ia(a9+=1,"dealsdone"),k.offsetset(0,0),aG>0?(ap-=aG,iz(),e5=k.loops,gS()):(hr("devilad","clicked to watch"),gm());return}if(gB("No Deal",V/2+77,a+33,!0,!0,!1,!1,!0,!1),af){ba+=1,k.offsetset(0,0),g0(bO),aF=null;return}}1==cH&&(g8("I have a deal for you!","",k.images[363],0),aZ&&(iz(),e5=k.loops)),3==cH&&(g8("I never said where I would","put it though! Hahaha!",k.images[363],0),aZ&&dk>=2&&iz()),k.offsetset(0,0)}}(),bG==b9&&function(){var b=0,c=0,a=0,e=null;if(cH>0&&ik(.4),k.offsetset(R,S),!(cH<=2)||(b=aF.Pixel_x+aF.Kind.X_offset,c=aF.Pixel_y-aF.Kind.Y_Offset,a=e4,cH>0&&(a=9999),a=k.clamp(a,0,k.imagesizeyget(k.images[428])),cH<=0?k.imagedrawglpart(k.images[428],b-4*Math.sin(9*e4*k._degreestoradians)+8,c+(25-a),0,0,k.imagesizexget(k.images[428]),a):(bd=b-4*Math.sin(5*e4*k._degreestoradians)+0,be=c+(25-a)+1*Math.sin(8*e4*k._degreestoradians),k.imagedrawgl(k.images[429],bd,be)),cH<=0&&e6>66&&(iz(),e5=k.loops),!(cH<=0))){if(cH>=3&&(k.transparencyset(.5),k.imagedrawgl(k.images[109],cX.Pixel_x+22-6*Math.sin(16*k.loops*k._degreestoradians),cX.Pixel_y+22+5*Math.cos(16*k.loops*k._degreestoradians)),k.imagedrawgl(k.images[109],cX.Pixel_x+22-5*Math.sin((16*k.loops+180)*k._degreestoradians),cX.Pixel_y+22+6*Math.cos((16*k.loops+170)*k._degreestoradians)),k.transparencyset(0),(a=e6)>60&&(a=60,k.soundplaying(k.sounds[6])||ix(k.sounds[6])),b=gZ(a,0,77,bd,cX.Pixel_x),c=gZ(a,0,77,be,cX.Pixel_y),e6>a&&(b+=Math.cos(15*e6*k._degreestoradians)*gZ(e6,55,77,2,14),c+=Math.sin(15*e6*k._degreestoradians)*gZ(e6,55,77,2,14)),k.imagedrawgl(k.images[429],b,c),e6>85)){if(iz(),cX._Kind_Set2(cY),ix(k.sounds[28]),bd=b,be=c,cH>=6){g0(bO),k.offsetset(0,0);return}g1()}if(2==cH&&(g8("What do you wish for","more of?",k.images[428],0),dk>=1)){b=2,c=eU-122-S-hT();for(var d=K.first;d;){if((e=d.val)._Resource_is()){if(gB("",b,c,!1,!1,!1,!1,!0,!0),e._Draw6(0,b+2,c+2+ae,0),af){cY=e,iz(),g1();break}b+=58}d=d.next}}1==cH&&(g8("You found great genie!","",k.images[428],0),aZ&&(iz(),e5=k.loops)),k.offsetset(0,0)}}(),bG==cK&&(E=0,F=0,h=0,cH>0&&ik(.4),E=R+(aF.Pixel_x+aF.Kind.X_offset),F=S+(aF.Pixel_y-aF.Kind.Y_Offset),h=e4,cH>0&&(h=9999),h=k.clamp(h,0,k.imagesizeyget(aF.Turning_into_kind.Image)),k.imagedrawglpart(aF.Turning_into_kind.Image,E+9,F+(25-h)+1*Math.sin(8*e4*k._degreestoradians),0,0,k.imagesizexget(aF.Turning_into_kind.Image),h),cH<=0&&e6>66&&(iz(),e5=k.loops),1==cH&&(aF.Turning_into_kind==fl?g8("You found an anvil! Drag","in a resource to upgrade!",k.images[14],0):g8("You found TNT! Tap it to","blast the resources away!",k.images[14],0),aZ&&(aF=null,g0(bO),iz(),e5=k.loops)),k.offsetset(0,0)),bG==bI&&function(){var a="",f=0,b=null;ik(.4),k.offsetset(R,S);for(var c=L.first;c;)(b=c.val).Achievement_causing&&b._Draw5(!1),c=c.next;if(f=dh-88,cH<=0?(a="You did it!!!",k.imageoffsetset(k.images[100],7,7),k.imagerotationset(k.images[100],10*Math.sin(7*k.loops*k._degreestoradians)),k.imagedrawgl(k.images[100],130,f+8),k.imageoffsetset(k.images[100],0,0),a+=" Score +"+dE.Goal_gold,dA<=4&&(d9?a+="/Not logged in for rewards.":a+="/You'll get a prize chest!"),g8(a,"",k.images[14],0),dA<=4&&(d9||hX(111,dh-88+44,hB(dA,4),1,!1,!1))):(c_=0,a=dE.Goal_Text_Did_2,eW<333&&""!=dE.Goal_text_did_SE_2&&(a=dE.Goal_text_did_SE_2),dA>1&&(a=dE.Goal_Text_Did_3,(dE==dy||dE==dF)&&(4==dA&&(a=dE.Goal_text_did_4),5==dA&&(a=dE.Goal_text_did_5))),a=iM(a,"=",""+dE._Goal_Number_Next_Get()),g8(a,"",k.images[14],0)),aZ){if(cH<=0&&dA<3+3*jM(dE==dy,0)){e5=k.loops,cH+=1;for(var d=L.first;d;)(b=d.val).Achievement_causing=!1,d=d.next;dE==dx&&(dE.Health_max_start+=12,ar=dE.Health_max_start)}else if(g9()<a.length)e5=0;else{for(var e=L.first;e;)(b=e.val).Achievement_causing=!1,e=e.next;dE==dx&&(bG=b6),(dE==dy||dE==dF)&&jJ(),dE==dB&&(bG=b6),dE==dD&&(bG=b6),(dE==dC||dE==dz)&&(bG=b6),r=-1,e5=k.loops}}}(),k.offsetset(0,0),bG==cT&&e$&&2==a6&&(fD&&(eZ=!0),eZ&&iH("You must wait for day time"+ho(!1),eW/2,eU-55,14,!0)),bD||bG==bP)(function(){var c=0,a=0,d=null,b=0,e=0,f=0,g=0;if(!((bG==ci||bG==cj)&&dE==dx&&k.mod(k.loops,12)>6)){if(ap<=36)for(e=85,a=Math.ceil(k.clamp(ar,0,36)/2),ar<=10&&(a=5),b=1;b<=k.clamp(ar,0,36);b++)d=k.images[6],b>ap&&(d=k.images[114]),c=k.loops-aq,b==ap&&c<30&&k.mod(c,6)>c/30*6&&(d=k.images[114]),k.imagedrawgl(d,eW/2-e/2+f/(a-1)*(e-17),c0+g),(f+=1)>=a&&0==g&&(f=0,g+=15,ar>10&&(a=Math.floor(k.clamp(ar,0,36)/2)));else k.imagedrawgl(k.images[6],eW/2-25,c0+4),iL(""+ap,eW/2-25+20,c0);a8&&aZ&&jc(eW/2-44,c0-9,88,33)&&(jc(eW/2-44,c0-9,22,33)?ap>1&&(ap-=1):(ap+=1)>ar&&(ar=ap))}})(),k.offsetset(R,0),a=fA*(dQ/2)+52,a6>9&&c$>999999&&(a-=8),k.imagedrawgl(k.images[280],a,c0+1),a8&&aZ&&jc(a-1,c0-11,35,35)&&(a6+=1,0==d_&&(d_=1)),iL(""+a6,a+21,c0),u=c0,k.loops-fa<3&&(u-=1,k.loops-fa==1&&(u-=1)),a=fA*(dQ/2)-87,d0>9&&(a-=13),d0>99&&(a-=11),k.imagedrawgl(k.images[346],a-3,u+3),a8&&aZ&&jc(a-1,c0-11,35,35)&&(d1+=1),bG==cN&&8>k.mod(k.loops,16)||iL(""+d0,a+21,u),k.offsetset(0,0);(function(){var b="",a=0;if(dE==dz){if(bG==bP)return;a=17+c0,k.loops-dS<30&&(a+=Math.sin((k.loops-dS)*44*k._degreestoradians)),bG==bI&&(a+=Math.sin((k.loops-dS)*33*k._degreestoradians)),ap>5&&(a+=15),k.imagedrawgl(k.images[252],(eW-k.imagesizexget(k.images[252]))/2,a),b=""+dT,dE._Goal_Number_Next_Get()>0&&(b+="/"+dE._Goal_Number_Next_Get()),iJ(b,eW/2,a+8,14,!0,!1)}})(),iC(),bG==(H=cT)&&(c=0,v=0,d=null,e=0,f=0,G.total<1||(e=Math.floor((eW-k.imagesizexget(k.images[398]))/2),f=eU-33,(d=k.listfirstget(5,G)).kind==bs&&(c=d.Health/d.Health_max,k.loops-d.Spawn_time<88&&(c=(k.loops-d.Spawn_time)/88),c=k.clamp(c,0,1),k.imagedrawgl(k.images[399],e+3,f+3,1*k.imagesizexget(k.images[399]),9),v=k.loops-d.Took_Damage_Time,v<=9&&(k.colorset({r:255,g:10,b:48,a:255}),k.transparencyset(gr(v,0,9)),k.rectdraw(e+3,f+3,1*k.imagesizexget(k.images[399]),9),k.transparencyset(0)),k.colorset(k.colormake(0,0,0,255)),k.rectdraw(e+3+c*k.imagesizexget(k.images[399]),f+3,k.imagesizexget(k.images[399])*(1-c),9),k.imagedrawgl(k.images[398],e,f),k.imagedrawglpart(k.images[406],e-8,f-1,289,0,16,16)))),bG==bQ&&function(){var g,e=0,c=null,f=0,a=0,b=0;if(C.total<=0&&c5.total<=0){k.debugset("Nothing for sale, leaving building buy"),g0(cQ),iZ();return}if(ik(.2),k.offsetset(R,S),e=2,g9(),b=44,iH("Your Inventory:",V/2,(a=-20)-44,14,!0),eh)iH("Offline",V/2,a-22,14,!0);else{c5.total<=0&&iH("None",V/2,a-22,14,!0);for(var d=c5.first;d;){if(c=d.val,(f+=1)<=6*dm||f>(dm+1)*6){d=d.next;continue}if((0,c.Tile_Kind)._Draw6(c.Tier,b-fA/2,a-17,0),c.Total>1?(gB("USE 1",b,a+27,!1,!0,!1,!1,!0,!1),iH("x"+c.Total,b+18,a,14,!1)):gB("USE",b,a+27,!1,!0,!1,!1,!0,!1),af){c6=c,ad=null,g6(),gw(),k.offsetset(0,0),g0(bR);return}(b+=k.imagesizexget(k.images[97])+e)>V&&(b=44,a+=2*fA),d=d.next}a=4*fA-21,c5.total>(dm+1)*6&&(gB(">",V-k.imagesizexget(k.images[71]),a-23,!1,!1,!0,!1,!0,!1),af&&(dm+=1)),dm>0&&(gB("<",0,a-23,!1,!1,!0,!1,!0,!1),af&&(dm-=1))}it(eU-88-hT()-hV()-S),g8("Use a boost!","",k.images[14],0),bG==(g=bQ)&&(gB("Skip >",195,dh+17,!1,!1,!1,!1,!0,!1),af||c4)&&(af&&iy(),c4=!1,g0(cQ),iZ(),bG==cQ&&hu()),k.offsetset(0,0)}(),t="",j=0,l=0,m=0,bG==cQ&&a7>0&&(a7-=1,j=k.imagesizexget(k.images[192]),l=m=28,a7>m&&(l=m-(a7-m)*8),a7<10&&(l=m-(10-a7)*8),hV()>0&&(l*=1.5),k.offsetset((eW-j)/2,l),k.imagedrawgl(k.images[192],0,0),t="Day "+a6,k.imagedrawgl(k.images[102],(j-iO(t))/2-22,11),k.imagedrawgl(k.images[102],(j+iO(t))/2+6,11),iJ(t,j/2,14,14,!0,!1),k.offsetset(0,0)),bG==cw&&(G={total:0,first:null,last:null},I={total:0,first:null,last:null},D={total:0,first:null,last:null},g0(cf),dX=0),bG==cu&&function(){var c=0,d=0,b=null,f=0,e=0,a=0;if(cH>0){if(hw(c=255,230,.4,0,!1),k.colorset({r:245,g:245,b:0,a:255}),iJ("Repair the castle!",c/2,20,14,!0,!1),iJ("One time only.",c/2,47,14,!0,!1),f=k.imagesizexget(k.images[97]),k.imagesizeyget(k.images[98]),e=c/2-f/2,a=173,gB("Give up",e,a,!1,!1,!1,!1,!1,!1),af){iy(),g0(cw);return}gB("Watch ad",e,a=123,!1,!1,!1,"loading"==w,!1,!1),"loading"!=w&&ae>0&&aY&&gm(),"loading"==w&&(iH(ho(!1),c/2,a+16,14,!0),k.cursorset(30,"wait")),(d=100,a=73,null==eM)?(gB("Pay ~"+d,e,a,!1,!1,!1,c$<d,!1,!1),af&&c$>=d&&(c$-=d,h6())):(gB(ho(!1),e,a,!1,!1,!1,!0,!1,!1),k.cursorset(46,"wait"),""!=k.ajaxresponseget(47,eM)&&((b=k.split(k.ajaxresponseget(48,eM),","),k.arraylengthget(b)>1&&"good"==b[1])?(c$=1*b[2]||0,gF(),g0(cT),I={total:0,first:null,last:null},G={total:0,first:null,last:null}):(k.debugset("Error"),k.arraylengthget(b)>=3&&(c$=1*b[3]||0)),eM=null))}else ik(.4);g8("Oh no!/The castle might collapse!","",k.images[279],0),k.offsetset(0,0),cH<1&&aZ&&(iz(),e7=0)}(),hQ()&&hP()}(),bG==cT&&0==G.total&&0==I.total&&(null!=dH?function(){if(eh||d9){dH=null;return}ik(.4),k.offsetset(0,0),iH("Not connected.",eW/2,eU/2-22,14,!0),iH("No rewards will be given.",eW/2,eU/2+0,14,!0),k.loops-a2>600?(gB("Retry",eW/2,eU/2+22,!1,!0,!1,!1,!1,!1),af&&(hj(),a2=k.loops)):(iH(ho(!1),eW/2,eU/2+22,14,!0),k.cursorset(21,"wait")),gB("Continue",eW/2,eU/2+66,!1,!0,!1,!1,!1,!1),af&&(dH=null,eh=!0,k.debugset("Playing disconnected now becuase user clicked continue on levelday loading"))}():(dE==dn&&gR()&&(br="",br="golddragongoldget.php?",br+="&goldgot="+D.total,c1=gp(br,!1),c1=null),(a6+=1)>hm("bestday"+dE.Index)&&ia(a6,"bestday"+dE.Index),dE==dn&&ha(),jJ()))}else bG==cm&&gU();(bG==ck&&(ay=(k.loops-e5)/10,ay=k.clamp(ay,0,1),ik(1-ay),ay>=1&&(function(){var a=null;if(!d9&&null!=dK&&""!=k.ajaxresponseget(1,dK)){if(a=k.split(k.ajaxresponseget(2,dK),","),k.arraylengthget(a)>=3&&"good"==a[1])eh=!1,dE==dy&&0==hm("leveltutorialdid1")||gA(a[3]);else{if(k.debugset("ERROR levelstart bad response"),k.arraylengthget(a)>=3&&"wrong token"==a[2]){jg(),g0(cp),bD=!1,dK=null;return}if(!d9){g0(cq),bD=!1,dK=null;return}}dK=null}null==dK&&bG!=cW&&(k.offsetset(0,0),ik(0),dA=0,hc(!0),eO=!1)}(),null!=dK&&function(){if(hm("userisoffline")>0||eh&&d9){dK=null;return}if(k.offsetset(0,0),k.loops-e5<444/(1+jM(d9,0))){iH(ho(!1),eW/2,eU/2+22,14,!0),k.cursorset(7,"wait");return}if(d9){dK=null;return}hq(eW/2,eU/2-40),iH("Not connected.",eW/2,eU/2-22,14,!0),iH("No rewards will be given.",eW/2,eU/2+0,14,!0),k.loops-a2>444?(gB("Retry",eW/2,eU/2+22,!1,!0,!1,!1,!1,!1),af&&(hl(),a2=k.loops)):(iH(ho(!1),eW/2,eU/2+22,14,!0),k.cursorset(30,"wait")),gB("Continue",eW/2,eU/2+66,!1,!0,!1,!1,!1,!1),af&&(dK=null,eh=!0,k.debugset("Playing disconnected now becuase user clicked continue on levelstart loading"))}())),bG==bP&&(ac=null,0==cH?ik(0):ik(gZ(e6,0,22,0,1)),k.offsetset(0,0),null!=eR&&(e6>55&&(iH(ho(!1),eW/2,eU/2,14,!0),k.cursorset(10,"wait")),id(),null==eR&&iz()),gB("<",10,11+hV(),!1,!1,!0,!1,!0,!1),(af||c4)&&(iy(),eR=null,hd(dy),g0(cq),c4&&(c4=!1)),an>0&&(ac=bt,(dE==dy||dE==dF)&&a6>50&&(ac=bq),dE==dn&&(ac=bq),k.imagedrawgl(ac.Images[k.mod(Math.floor(k.loops/11),k.arraylengthget(ac.Images))+1],R+an*fA-(fA+k.imagesizexget(k.images[8]))/2,S-40)),hw(300,65,1,(S+fA*dR+eU)/2-33,!1),O=eG,iJ("^"+(T+"'s"),150,15,14,!0,!1),O=0,iJ("final defense",150,41,14,!0,!1)),bG==cq?function(){var h,e,f,c="",d=0,b=0,g=0,a=0;if(bD){hR();return}if(""!=d8){g0(cs);return}if(""!=fZ&&fV<=0&&gL()){g0(bX);return}if(aB>0&&new Date().getTime()>aB&&(aB=0),g=32,b=324,""!=fZ||d9||f_||dE!=dy?(d=eU-eq-166-hV()-hT(),dY=70,null!=dE.Scores&&(dY+=k.arraylengthget(dE.Scores)*g),dY+=4*g,d9&&(dY+=70),dE!=dy?null!=gd.level&&0==gd.end_time&&(dY+=50):""==fZ||(dY+=50,d9||(dY+=50)),d=k.clamp(d,0,dY)):(d=200,dY=0),hw(b,d,.4,0,!1),a=18-d$,k.transparencyset(0),a> -16&&(k.imagerotationset(k.images[100],0),d9||f_?(iJ("Scores to Beat",b/2,a,14,!0,!1),k.imagedrawgl(k.images[100],b/2-7-85,a-2),k.imagedrawgl(k.images[100],b/2-7+85,a-2)):dE!=dy&&null!=gd.level||(iJ("High Scores",b/2,a,14,!0,!1),k.imagedrawgl(k.images[100],b/2-7-76,a-2),k.imagedrawgl(k.images[100],b/2-7+76,a-2))),""!=fZ&&!d9&&dE==dy&&((a+=27)> -16&&iJ("of",b/2,a,14,!0,!1),(a+=24)> -16&&(iK(fZ,b/2,a,14,!0),gJ(b/2-iO(fZ)/2-26,a-8,fY,fV,fW,!1,!1,fU,fX),gJ(b/2+iO(fZ)/2+2,a-8,fY,fV,fW,!1,!1,fU,fX),fi&&(iy(),gN(!0,!1)))),null!=eT&&(hp(b/2-6,a+11),ii()),dE!=dy&&(null!=gd.level?(a> -16&&(iJ("WAR!",b/2,a,14,!0,!1),gJ(b/2-64,a-8,fY,fV,fW,!0,!1,fU,fX),aM&&(iy(),gN(!0,!1)),gJ(b/2+42,a-8,gd.clan_emblem,gd.clan_color_1,gd.clan_color_2,!0,!1,gd.Clan_color_3,gd.Color_style),aM&&(iy(),gN(!1,!0))),a+=30,null==eT&&(a> -16&&(gd.end_time>0?new Date().getTime()<=gd.end_time?iJ("Time left: "+i7(gd.end_time-new Date().getTime(),!0,!0,"",!1,!1),b/2,a,14,!0,!1):new Date().getTime()<=gd.end_time+2e3?hp(dW/2,a):new Date().getTime()<=eS+5e3?hp(dW/2,a):ij():gd.end_time<0?iJ("War starts soon!",b/2,a,14,!0,!1):gd.You_won>=0&&iJ(iP(1==gd.You_won,fZ,gd.clan_name)+" wins!",b/2,a,14,!0,!1)),0==gd.end_time&&1==gd.You_won&&((a+=20)> -40&&gd._PrizeChest_get_draw(a),a+=30)),(a+=30)> -16&&(iK(fZ,52,a,14,!1),gJ(26,a-8,fY,fV,fW,!0,!1,fU,fX),(fi||aM)&&(iy(),gN(!0,!1)),iJ("*",b-24-iO("*"+gd._Score_total_get(!0))-5,a,14,!1,!1),iJ("*"+gd._Score_total_get(!0),b-24-iO("*"+gd._Score_total_get(!0)),a,14,!1,!1)),(a+=30)> -16&&(iK(gd.clan_name,52,a,14,!1),gJ(26,a-8,gd.clan_emblem,gd.clan_color_1,gd.clan_color_2,!0,!1,gd.Clan_color_3,gd.Color_style),(fi||aM)&&(iy(),gN(!1,!0)),iJ("*",b-24-iO("*"+gd._Score_total_get(!1))-5,a,14,!1,!1),iJ("*"+gd._Score_total_get(!1),b-24-iO("*"+gd._Score_total_get(!1)),a,14,!1,!1))):null==aC?k.debugset("challenge level null"):((a+=30)> -16&&iJ("in "+(aC.Name+" Castle Battle"),b/2,a,14,!0,!1),(a+=30)> -16&&(aB>0?iJ("Time left: "+i7(aB-new Date().getTime(),!0,!0,"",!1,!1),b/2,a,14,!0,!1):aB<0?iJ("Battle starts soon!",b/2,a,14,!0,!1):iJ("New battle this weekend!",b/2,a,14,!0,!1)))),function(u){var j=0,i="",c=null,n=0,q=0,h=0,d=0,o=0,b=0,g="",e=0,f=0,l=0,m="",t="",r=0,s=0,a=0,p=0;if(j=8,eP=null,a=u,d=32,dE==dy&&(h=k.arraylengthget(eL)),""!=fZ||d9||dE!=dy||f_){if(null!=dE.Scores)for(b=1;b<=k.arraylengthget(dE.Scores);b++)(c=dE.Scores[b]).Is_my_new_one&&(q=b),c.name,hn("screenname");for(q>3&&k.loops-e5<3&&(d$=k.clamp((q-3)*d+99,0,9999)),e=28,s=9,null!=dE.Scores&&(s=k.arraylengthget(dE.Scores)),b=1;b<=s;b++){if((null!=dE.Scores&&(c=dE.Scores[b]),dE==dy||null==gd.level)?1>k.mod(b,2)&&a> -19&&a<dV+5&&(k.colorset(k.colormake(55,22,0,255)),k.transparencyset(.9),k.rectdraw(k.imagesizexget(k.images[281]),a-(10+3*jM(b<=h,0)),dW-2*k.imagesizexget(k.images[281]),d+jM(b<=h,0)*(d+7)),k.transparencyset(0)):a> -55&&a<dV+5&&(k.transparencyset(.9),p=a-(10+3*jM(b<=h,0)),o=d+jM(b<=h,0)*(d+7)+1,r=j,null!=dE.Scores&&c.Is_other_war_clan?k.colorset(gM(gd.clan_color_1,!1)):gd.clan_color_1==fV?k.colorset(gM(fW,!0)):k.colorset(gM(fV,!1)),k.rectdraw(k.imagesizexget(k.images[281]),p,dW-2*k.imagesizexget(k.images[281]),o),k.transparencyset(.4),null!=c&&c.Is_other_war_clan?gK(k.imagesizexget(k.images[281]),p,gd.clan_color_1,gd.clan_color_2,gd.Clan_color_3,gd.Color_style,r,o):gK(k.imagesizexget(k.images[281]),p,fV,fW,fU,fX,r,o),k.transparencyset(0)),null==dE.Scores)k.transparencyset(.5),g="",f=b,l=0,eu=gt(0);else{g="^"+c.name;for(var v=0;iO(g)>183;){if(v++ >999999)throw{line:115,message:"Infinite While Loop"};g=k.stringpart(g,1,g.length-1)}t=k.stringpart(g,2,99),a> -19&&a<dV&&c.Is_my_new_one&&(k.colorset({r:232,g:217,b:0,a:255}),k.loops-e5<50&&k.transparencyset(Math.abs(.8*Math.sin((k.loops-e5)*15*k._degreestoradians))),b<=h&&""!=fZ&&dE!=gd.level?k.rectdraw(k.imagesizexget(k.images[281])+j,a-10,dW-2*k.imagesizexget(k.images[281])-2*j,2*d+0):k.rectdraw(k.imagesizexget(k.images[281])+j,a-10,dW-2*k.imagesizexget(k.images[281])-1*j,d),k.transparencyset(0)),f=c.Rank,l=c.score,eu=c.Avatar}if(b<=h&&dE==dy){if(a> -16&&a<dV){i="Castle",""!=fZ&&(i=fZ);for(var w=0;iO(i)>163;){if(w++ >999999)throw{line:143,message:"Infinite While Loop"};i=k.stringpart(i,1,i.length-1)}dE!=dy&&(i=dE.Name+iP(null!=gd.level," War"," Castle")),iJ(eL[b]+" of "+i,e+iO(""+f+". "),a,14,!1,!1)}a> -30&&a<dV&&(1==b&&k.imagedrawgl(k.images[373],e-1,a-13+d/2),2==b&&k.imagedrawgl(k.images[374],e-1,a-13+d/2),3==b&&k.imagedrawgl(k.images[372],e-1,a-13+d/2)),(a+=d)> -16&&a<dV&&(O=b,""==fZ&&dE==dy?iJ(g,e+iO(""+f+". ")-2,a+2,14,!1,!1):(iK(g,e+iO(""+f+". ")-2,a+2,14,!1),fi&&(iy(),eI=c.name,eP=eu,eG=f,ev=f)),O=0)}else O=0,a> -16&&a<dV+5&&(iJ(""+f+". ",e,a,14,!1,!1),""!=fZ||dE!=dy?(iK(g,e+iO(""+f+". "),a+2,14,!1),fi&&(iy(),eI=c.name,eP=eu,eG=f,ev=f,g0(bH))):iJ(g,e+iO(""+f+". "),a+2,14,!1,!1));if(a> -16&&a<dV){if(m="*"+l,(""!=fZ||dE!=dy)&&l>0){if(iK(m,dW-(e+iO(m)),a,14,!1),fi){iy(),hz(),hx(!1),eG=b,eJ=0,gz(c.name,l,!1,c.Is_other_war_clan),k.offsetset(0,0);return}}else iJ(m,dW-(e+iO(m)),a,14,!1,!1)}dE==dy&&b<=h&&c_>1&&t!=hn("screenname")&&""!=fZ&&el&&(1==b&&(n=.2*c_),2==b&&(n=.1*c_),3==b&&(n=.05*c_),iH("~+"+Math.ceil(n),e+iO(""+f+". "+g),a,14,!1)),dE==dy&&(b<=h&&(a+=7),b==h&&(a-=3)),k.transparencyset(0),a+=d}}else iJ("None",dW/2,a,14,!0,!1),iJ("Join a clan to compete!",dW/2,a+=55,14,!0,!1);dE==dy&&(""==fZ?d9?((a+=10)> -16&&a<dV&&iJ("Log in to get rewards!",dW/2,a,14,!0,!1),(a+=26)> -16&&a<dV&&(gB(" Log In",dW/2,a,!1,!0,!1,!1,!1,!1),k.imagedrawgl(k.images[203],dW/2-37,a+12+ae),af&&(iy(),g0(bS)))):(a+=33,f_||de||(gB("Join Clan",dW/2,a,!1,!0,!1,!1,!1,!1),af&&(iy(),g0(bY)))):(a+=17)> -16&&a<dV&&(gJ(dW/2-11-66,a+3,fY,fV,fW,!1,!1,fU,fX),gJ(dW/2-11+66,a+3,fY,fV,fW,!1,!1,fU,fX),gB("View Clan",dW/2,a,!1,!0,!1,!1,!1,!1),af&&(iy(),gN(!0,!1)))),a+=10}(a+=40),bG!=(h=bP)){if(!(bC&&!bD)&&(aZ&&!jc(0,0,b,d)&&fG==bG&&fL<eU-eq||c4)&&(c4=!1,bD?hS():bG=cW),hz(),hx(!1),!de&&(null!=gd.level&&""!=fZ?(dE!=dy?(gB("< Back",dW/2-80,dV+25,!0,!0,!1,null!=ge,!0,!1),af&&(iy(),hd(dy),ij())):(null!=gd.level?(c="War!/",gd.end_time<0?c+="Starting soon":gd.end_time>0?c+=i7(gd.end_time-new Date().getTime(),!0,!1,"",!1,!1):gd.You_won>=0&&(c+=iP(1==gd.You_won,"Your clan won!","Your clan lost"))):(c="- over",aB<0&&(c="- soon"),aB>0&&(c=i7(aB-new Date().getTime(),!1,!1,"",!1,!1)),c=aC.Name+" Castle/Battle "+c),N&&(c="App update/required"),gB(c,dW/2-80,dV+25,!0,!0,!1,null!=ge,!0,!1),af&&(iy(),N?hN():(null!=gd.level?hd(gd.level):hd(aC),ij()))),c="Play",dE!=dy&&(c="Battle",gd.User_is_in||null==gd.level?0==gd.end_time&&null!=gd.level&&(c+="/Is Over"):(0==gd.end_time&&(c+=" Over"),c+="/You're not in")),gB(c,dW/2+80,dV+25,!0,!0,!1,dE!=dy&&(gd.end_time<=0||!gd.User_is_in)&&null!=gd.level||null!=ge,!0,!1)):gB("Play",dW/2,dV+25,!0,!0,!1,!1,!0,!1),af)){eh=!1,iy(),hg();return}ea>0?(g8("You are now the "+(eL[ea]+"/of the castle! You get/gold when others score!"),"",k.images[74],0),dk>=3&&aZ&&(k.debugset("set rank just got to 0"),ea=0)):dd?(g8("I put you in this clan:",fZ,k.images[74],0),dk>=2&&aZ&&(dd=!1)):de&&(g8("Your first chest is free!","",k.images[74],0),dk>=1&&aZ&&(de=!1)),is()&&(e=0,f=0,k.offsetset(0,0),gB("",e=7,f=2+c0,!1,!1,!0,!1,!0,!1),k.imagedrawgl(k.images[73],e+8,f+8+ae),H.total>0&&gV(e+22,f-1+ae),(c4||af)&&(c4=!1,g0(cB),iy())),k.offsetset(0,0),null!=eP&&(eu=eP,eP=null,g0(bH),jt())}}():bG==cB?function(){var c=0,a=0,b=0;if(hw(c=220,365,.4,0,!0),iJ("Settings",c/2,17,14,!0,!1),b+=44,k.imagesizexget(k.images[97]),a=c/2-(k.imagesizexget(k.images[71])+3),g7()&&(a-=(k.imagesizexget(k.images[71])+7)/2+4),e2>0?(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&io(0),k.imagedrawgl(k.images[248],a+7,b+8+ae)):(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&(io(1),iy()),k.imagedrawgl(k.images[249],a+7,b+8+ae)),a+=k.imagesizexget(k.images[71])+7,d6>0?(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&(im(0),iy()),k.imagedrawgl(k.images[250],a+7,b+7+ae)):(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&(im(1),iy()),k.imagedrawgl(k.images[251],a+7,b+7+ae)),g7()&&(a+=k.imagesizexget(k.images[71])+7,0>=hm("vibrateoff")?(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&(ia(1,"vibrateoff"),iy()),k.imagedrawgl(k.images[369],a+7,b+7+ae)):(gB("",a,b,!1,!1,!0,!1,!1,!1),af&&(ia(0,"vibrateoff"),iy(),jH(100)),k.imagedrawgl(k.images[370],a+7,b+7+ae))),a=c/2,b=92,d9){if(gB(" Sign Up",a,b,!1,!0,!1,!1,!1,!1),k.imagedrawgl(k.images[203],a-41,b+12+ae),af){iy(),iw(),k.offsetset(0,0);return}}else eu=fT,gB("^ Account",a,b,!1,!0,!1,!1,!1,!1),af&&(iy(),eI=hn("screenname"),ew=fV,ex=fW,eA=fY,jt(),g0(bH));if(b+=43,d9){if(gB(" Log In",a,b,!1,!0,!1,!1,!1,!1),k.imagedrawgl(k.images[203],a-37,b+12+ae),af){g0(cp),iy(),k.offsetset(0,0);return}}else gB("Upgrade  ",a,b,!1,!0,!1,!1,!1,!1),k.imagedrawgl(k.images[6],a+25,b+10+ae),af&&(iy(),g0(bT));b+=43,d9?(gB("Feedback",a,b,!1,!0,!1,!1,!1,!1),af&&(iy(),hm("userid")>0?g0(b7):g0(bS))):(gB("Inventory",a,b,!1,!0,!1,!1,!1,!1),af&&(iy(),g0(cc))),gB("Messages",a,b+=43,!1,!0,!1,d9,!1,!1),H.total>0&&gV(a+35,b-2+ae),d9?af&&(iy(),g0(bS)):af&&(iy(),g0(ct)),gB("Get gold",a,b+=43,!1,!0,!1,d9,!1,!1),af&&(g0(bS),iy()),gB("About",a,b+=43,!1,!0,!1,!1,!1,!1),af&&(g0(bL),iy()),hv(0,0)&&(c4=!1,hA()),k.offsetset(0,0)}():bG==bU?h$():bG==bY?function(){var b,c=null,g=!1,e=0,d=0,a=0;if(dY=40*E.total+77,hw(d=320,e=k.clamp(eU-111,0,dY),.4,0,!0),(a=19-d$)> -17&&a<e&&(iJ("Join a clan!",d/2,a,14,!0,!1),ag=!0,gB("+",d/2+66,a-12,!1,!1,!0,!1,!1,!1)),null!=aU)iJ("Joining"+ho(!1),dW/2,55,14,!0,!1),k.cursorset(12,"wait"),b=null,null!=aU&&""!=k.ajaxresponseget(0,aU)&&(b=k.split(k.ajaxresponseget(1,aU),","),k.arraylengthget(b)>=5&&"good"==b[1]&&(eC=fZ=b[2],fV=1*b[3]||0,fW=1*b[4]||0,fY=1*b[5]||0,f$=1*b[6]||0,fU=1*b[7]||0,fX=m,(1*b[8]||0)>0&&(fX=k.listitemget(12,bv,1*b[8]||0))),aU=null),null==aU&&g0(cq);else{null!=aX&&(hp(d/2-7,36),k.cursorset(20,"wait"),a+=5,function(){var b=null,a=null,c=null,d=0;if(null!=aX&&""!=k.ajaxresponseget(0,aX)){if(c=k.split(k.ajaxresponseget(1,aX),","),k.arraylengthget(c)>=2&&"good"==c[1])for(d=2,E={total:0,first:null,last:null};d<=k.arraylengthget(c);d++)k.debugset(c[d]),a=k.split(c[d],"@"),k.arraylengthget(a)>=8?((b=new jQ).ID=1*a[1]||0,b.Name=a[2],b.Total_Users=1*a[3]||0,b.Color_1=1*a[4]||0,b.Color_2=1*a[5]||0,b.Emblem=1*a[6]||0,b.Color_3=1*a[7]||0,b.Color_style=m,(1*a[8]||0)>0&&(b.Color_style=k.listitemget(18,bv,1*a[8]||0))):hr("clienterror","clansget not enough fields");aX=null}}()),a+=42;for(var f=E.first;f;)c=f.val,a> -21&&a<e+7&&(gC("   "+c.Name,27,a-11,!1,c.Total_Users>=99,!1,d-54,36),gJ(33,a-6+ae,c.Emblem,c.Color_1,c.Color_2,!1,!1,c.Color_3,c.Color_style),iJ(""+c.Total_Users,d-50,a+ae,14,!1,!1),k.imagedrawgl(k.images[203],d-64,a+1+ae),af&&!(c.Total_Users>=99)&&gP(c.ID)),a+=40,f=f.next;hv(d,e)&&(g=!0)}hz(),hx(!0),k.offsetset(0,0),g&&hA()}():bG==b$?function(){var o,g,e=null,h="",m=null,b=null,i={total:0,first:null,last:null},f=0,d=0,c=0,a=0;if(d=320,f=6*fA,dY=0,null==aT&&(dY=170,dY+=27*F.total,F.total>1&&(dY+=35),f=eU-hT()-hV()-99,f=k.clamp(f,0,dY)),hw(d,f,.4,0,!0),a=25,(a-=d$)> -12&&a<f&&(iJ(eC,d/2,a,14,!0,!1),gJ((d-iO(eC))/2-26,a-8,eA,ew,ex,gL(),!1,ey,ez),aM&&(iy(),g0(bX)),null==aT&&(iJ(""+F.total,(d+iO(eC))/2+26,a-0,14,!1,!1),k.imagedrawgl(k.images[203],(d+iO(eC))/2+8,a-0))),a+=35,null==aT){if(a> -20&&a<f&&(iJ("Sort by: ",77,a+=8,14,!1,!1),h="Active",1==aR&&(h="~Gold"),2==aR&&(h="Upgrades"),3==aR&&(h="*Score"),gB(h,166,a-10,!1,!1,!1,!1,!1,!1),af&&(iy(),(aR+=1)>3&&(aR=0)),a+=6),a+=32,i=F,1!=aR){i={total:0,first:null,last:null};for(var n=0;;){if(n++ >999999)throw{line:60,message:"Infinite While Loop"};e=null;for(var j=F.first;j;)b=j.val,0==k.listindexget(62,i,b)&&(0==aR&&(null==e||b.active_minutes_ago<e.active_minutes_ago)&&(e=b),2==aR&&(null==e||b.castle_upgrades>e.castle_upgrades)&&(e=b),3==aR&&(null==e||b.score_best>e.score_best)&&(e=b)),j=j.next;if(null==e)break;k.listpush(83,i,e)}}for(var l=i.first;l;){if(b=l.val,a> -14&&a<f+6){if(eu=b.Avatar,O=b.rank,iK("^"+b.screenname,27,a,14,!1),b.leader_is_1>0&&k.imagedrawgl(k.images[206],9,a-3),fi&&(eI=b.screenname,m=b.Avatar,k.debugset(eu.Name),jt(),g0(bH)),1==aR)c=d-25-iO("~"+b.gold),iJ("~"+b.gold,c,a,14,!1,!1);else if(0==aR)c=d-25-iO(i7(6e4*b.active_minutes_ago,!1,!0,"online",!1,!1)),iJ(i7(6e4*b.active_minutes_ago,!1,!0,"online",!1,!1),c,a,14,!1,!1);else if(3==aR)c=d-25-iO("*"+b.score_best),iJ("*"+b.score_best,c,a,14,!1,!1);else for(c=1;c<=b.castle_upgrades;c++)k.imagedrawgl(k.images[6],d-24-17*c,a)}a+=27,l=l.next}}else hp(d/2-7,a+=32),k.cursorset(129,"wait"),a+=50;if(c=d/2,a+=5,null==aV&&null==aT?fZ!=eC?a> -12&&a<f+ -2&&iJ("You are not in this clan.",c,a+5,14,!0,!1):a> -12&&a<f+ -2&&(gB("Quit Clan",c+60,a,!1,!0,!1,!1,!1,!1),af&&(iy(),aV=gp("clanleave.php?",!1)),fZ==eC&&(gB("Edit logo",c-60,a,!1,!0,!1,!gL(),!1,!1),af&&gL()&&(iy(),g0(bX)))):(a> -12&&a<f+ -2&&null!=aV&&(iJ(ho(!1),dW/2,a,14,!0,!1),k.cursorset(164,"wait")),g=null,null!=aV&&""!=k.ajaxresponseget(0,aV)&&(g=k.split(k.ajaxresponseget(1,aV),","),k.arraylengthget(g)>=2&&"good"==g[1]?(fZ="",db=!1,f$=0,ig(),gd._Clear(),eI=hn("screenname"),jt(),g0(cq)):k.arraylengthget(g)>=2&&"no clan"==g[2]&&(fZ="",gd._Clear()),hd(dy),aV=null),null!=aT&&function(){var b=null,c=null,a=null,d=0,e=null;if(null!=aT&&""!=k.ajaxresponseget(0,aT)){if(c=k.split(k.ajaxresponseget(1,aT),","),k.arraylengthget(c)>=2&&"good"==c[1])for(d=1,F={total:0,first:null,last:null},e=k.split(c[2]," ");d<=k.arraylengthget(e);d++)a=k.split(e[d],"@"),k.arraylengthget(a)>=6&&((b=new jS).screenname=a[1],b.leader_is_1=1*a[2]||0,b.gold=1*a[3]||0,b.active_minutes_ago=1*a[4]||0,b.Avatar=gt(1*a[5]||0),b.castle_upgrades=1*a[6]||0,b.score_best=1*a[7]||0,b.rank=1*a[8]||0);aT=null}}()),hv(d,f)){hA();return}hz(),hx(!0),k.offsetset(0,0),eu=m}():bG==bZ?function(){var b,j,f,c=0,g=0,a="",i=0,d=0,h=0,e=0;if(hw(d=280,i=192,.4,100+hV(),!0),e=25,iJ("Choose a clan name",h=d/2,e,14,!0,!1),null!=aW){if(iJ("Creating",h,e+=29,14,!0,!1),hp(d/2-7,77),k.cursorset(12,"wait"),e=102,e_="",b=null,null!=aW&&""!=k.ajaxresponseget(0,aW)&&(b=k.split(k.ajaxresponseget(1,aW),","),k.arraylengthget(b)>=2&&"good"==b[1]&&(eC=fZ=b[2],db=!0,g0(cq)),k.arraylengthget(b)>=2&&"bad"==b[1]&&("name taken"==b[2]&&(e_="Name taken!"),"bad name"==b[2]&&(e_="That name is not allowed!")),aW=null),""!=fZ){k.offsetset(0,0),eB=0,g0(b$);return}}else{for(e+=30,Y=d/2-100,Z=e,X=200,W=33,fk+=1,k.fontsizeset(24),k.textboxdraw(1,Y+5,Z+0,X-10,!1,"padding:"+3*bE+"px;font-family:serif;font-weight:bold;text-align:center;"),a=k.textboxtextget(38,1),g=1;g<=a.length;g++)(c=k.stringpart(a,g,1).charCodeAt(0)||0)>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||32==c||(k.keyboardhide(),a="",e_="Letters and numbers only!",e0=k.loops,k.textboxtextset(49,1,""));(iO(a)>d-88||a.length>20)&&(k.keyboardhide(),a="",e_="Not so long!",e0=k.loops,k.textboxtextset(58,1,"")),k.keyboardopen()||""!=a||(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],d/2+0,Z+51+Math.sin(9*k.loops*k._degreestoradians))),gB("Create",h,e+64,!0,!0,!1,a.length<2,!1,!1),(af||c3)&&a.length>=2&&(k.keyboardhide(),f="",f="clanmake.php?",f+="&name="+a,aW=gp(f,!1))}hv(d,i)&&hA(),""==e_?g8("Name your clan.","",k.images[14],0):g8(e_,"",k.images[14],0),k.offsetset(0,0)}():bG==ct?function(){var e="",d=0,c=0,b=null,n=0,h=0,g="",f="",a=0;!function(){var e=!1,b=null,a=null;if(null!=eb&&""!=k.ajaxresponseget(0,eb)){if(a=k.split(k.ajaxresponseget(1,eb),","),k.arraylengthget(a)>=3&&"good"==a[1]){for(var c=H.first;c;)(b=c.val).collecting&&"freebonus"==b.kind&&(b.collecting=!1,b.done_time=k.loops,c$=(1*a[2]||0)-(1*a[3]||0),gQ(1*a[3]||0,0,b.Y,!1),ix(k.sounds[10])),c=c.next;for(var d=H.first;d&&(!(b=d.val).collecting||(b.collecting=!1,b.done_time=k.loops,"rankearn"==b.kind&&(e&&"rankearnall"==a[4]||(c$=(1*a[2]||0)-(1*a[3]||0),gQ(1*a[3]||0,0,b.Y,!1),ix(k.sounds[10]),e=!0)),"rankearnall"==a[4]));)d=d.next}eb=null}}();for(var i=H.first;i;)"rankearn"==(b=i.val).kind&&b.done_time<=0&&(h+=1,n+=b.amount),i=i.next;c=320,dY=77;for(var j=H.first;j;)b=j.val,dY+=120,"rankdown"==b.kind&&(dY+=28),j=j.next;if(h>1&&(dY+=111),d=dY,hw(c,d=k.clamp(d,111,eU-122),.4,0,!0),(a=20-d$)> -15&&a<d&&iJ("Notifications",c/2,a,14,!0,!1),a+=38,H.total<=0)iJ("None",c/2,a+=11,14,!0,!1);else if(h>1){if(null!=eb&&k.transparencyset(.5),a-0> -35&&a-0<d&&iJ("You have "+(""+h+" rewards"),c/2,a,14,!0,!1),(a+=25)-0> -35&&a-0<d&&iJ("because of your noble rank.",c/2,a,14,!0,!1),(a+=29)-0> -35&&a-0<d&&null==eb&&(gB("Collect!",(c-k.imagesizexget(k.images[97]))/2,a,!1,!1,!1,!1,!1,!1),iJ("~"+n,220,a+10,14,!1,!1),af)){hG(0);for(var l=H.first;l;)"rankearn"==(b=l.val).kind&&(b.collecting=!0),l=l.next}k.transparencyset(0),a+=70}for(var m=H.first;m;)(b=m.val).done_time>0&&k.transparencyset(.5),"rankearn"==b.kind?(a> -15&&a<d&&(e="",b.level_index>1&&(e="Battle "),iJ(e+(eL[k.clamp(b.reason,1,k.arraylengthget(eL))]+" Bonus!"),c/2,a,14,!0,!1)),(a+=28)> -15&&a<d&&(g="^"+b.From_user_name,f=" got *"+b.score,b.score<=0&&(f=" played."),eu=b.From_user_avatar,iK(g,c/2-iO(f)/2,a,14,!0),fi&&(iy(),eI=b.From_user_name,jt(),g0(bH)),iJ(f,c/2+iO(g)/2,a,14,!0,!1)),(a+=28)-0> -35&&a-0<d&&b.done_time<=0&&(gB("Get ~"+b.amount,c/2,a,!1,!0,!1,b.collecting,!1,!1),af&&null==eb&&(b.collecting=!0,b.Y=a,hG(b.id)))):"rankdown"==b.kind?(a> -15&&a<d&&(e="",b.level_index>1&&(e="Battle "),iJ(e+(eL[b.reason]+" status lost."),c/2,a,14,!0,!1)),(a+=28)> -15&&a<d&&iJ("You were beaten by",c/2,a,14,!0,!1),(a+=28)> -15&&a<d&&(g="^"+b.From_user_name,f=" with *"+b.amount,eu=b.From_user_avatar,iK(g,(c-iO(f))/2,a,14,!0),iJ(f,(c+iO(g))/2,a,14,!0,!1),fi&&(iy(),eI=b.From_user_name,jt(),g0(bH))),b.done_time<=0&&(a+=28)> -35&&a<d&&(gB("Okay",c/2,a,!1,!0,!1,b.collecting,!1,!1),af&&null==eb&&(b.collecting=!0,hG(b.id)))):"freebonus"==b.kind?(a> -35&&a<d&&iJ("Free Gift!",c/2,a,14,!0,!1),(a+=28)> -35&&a<d&&iJ("You get ~"+b.amount,c/2,a,14,!0,!1),(a+=28)> -35&&a<d&&(b.done_time<=0?gB("Collect",c/2,a,!1,!0,!1,b.collecting,!1,!1):iJ("]",c/2,a,14,!0,!1)),af&&null==eb&&(b.collecting=!0,b.Y=a,hG(b.id))):"kicked"==b.kind?(a> -15&&a<d&&iJ(e+"Kicked out of your clan.",c/2,a,14,!0,!1),(a+=28)> -15&&a<d&&iJ("You were kicked by",c/2,a,14,!0,!1),(a+=28)> -15&&a<d&&(eu=b.From_user_avatar,iK("^"+b.From_user_name,c/2,a,14,!0),fi&&(iy(),eI=b.From_user_name,jt(),g0(bH))),b.done_time<=0&&(a+=28)> -35&&a<d&&(gB("Okay",c/2,a,!1,!0,!1,b.collecting,!1,!1),af&&null==eb&&(b.collecting=!0,hG(b.id)))):(iJ("App Update Required",c/2,a,14,!0,!1),iJ("to view all messages.",c/2,a+=28,14,!0,!1),gB("Update",c/2,a+=28,!1,!0,!1,b.collecting,!1,!1),af&&hN(),a+=28),a+=64,k.transparencyset(0),m=m.next;a+=4,hz(),hx(!0),hv(0,0)&&hA(),k.offsetset(0,0)}():bG==bW?function(){var g,a=0,d=0,f="",i=0,h=0,e=0,j=!1,c=0,b=0;if(2>k.arraylengthget(aQ)&&gI(),dY=99+(k.arraylengthget(aQ)-0)*10.8,d=19,f="ABCDEFGHIJKLMNOPQRSTUVWXYZ",cH>=3&&(dY=99+(d+f.length-0)*10.8),e=eU-122,4==cH&&(e-=gZ(e6,0,44,0,e))<1&&(g=null,null!=aS&&""!=k.ajaxresponseget(0,aS)&&(g=k.split(k.ajaxresponseget(1,aS),","),k.arraylengthget(g)>=3&&"good"==g[1]||ix(k.sounds[29]),aS=null),null==aS&&(j=!0)),hw(280,e=k.clamp(e,0,dY),.4,0,!0),4==cH){if(e<1&&null!=aS&&e6>222&&(hq(dW/2,dW/2-37),gB("Cancel",dW/2,dW/2,!1,!0,!1,!1,!1,!1),af)){hr("loadingcancel","clanavatarset.php"),aS=null,hA();return}e6<=222&&(iH("Saving"+ho(!1),dW/2,eU-55-window.gtboffsety,14,!0),k.cursorset(40,"wait"))}for((b=22-d$)> -15&&b<dV&&(cH<=0?iJ("Set Clan Color 1",dW/2,b,14,!0,!1):1==cH?iJ("Set Clan Color 2",dW/2,b,14,!0,!1):2==cH?iJ("Set Clan Color 3",dW/2,b,14,!0,!1):iJ("Set Clan Emblem",dW/2,b,14,!0,!1)),b+=45,c=i=40,h=k.arraylengthget(aQ),3==cH&&(h=d,h+=f.length),a=1;a<=h;a++)b> -20&&b<dV&&(0==cH?gJ(c,b-0,0,a,a,!0,!0,a,aL):1==cH?gJ(c,b-0,0,aN,a,!0,!0,a,aL):2==cH?gJ(c,b-0,0,aN,aO,!0,!0,a,aL):a<=d?gJ(c,b-0,199+a,aN,aO,!0,!0,aP,aL):gJ(c,b-0,k.stringpart(f,a-d,1).charCodeAt(0)||0,aN,aO,!0,!0,aP,aL),aM&&(iy(),0==cH&&(aN=a),1==cH&&(aO=a),2==cH&&(aP=a),3==cH&&(fY=a<=d?a+199:k.stringpart(f,a-d,1).charCodeAt(0)||0,fV=aN,fW=aO,fU=aP,fX=aL,gO()),iz(),1==cH&&aL==l&&(iz(),iz()),2==cH&&(aL==m||aL==n||aL==o)&&iz(),d$=0)),(c+=44)>dW-i&&(c=i,b+=54);hz(),hx(fY>0),gB("<",0,-61,!1,!1,!0,!1,!1,!1),af&&(iy(),cH>0?(2==(cH-=1)&&(aL==m||aL==l||aL==n||aL==o)&&(cH-=1),1==cH&&aL==l&&(cH-=1),e7=k.loops):g0(bX)),!af&&fY>0&&hv(0,0)&&hA(),j&&hA(),k.offsetset(0,0)}():bG==bM?function(){var c,b=null,g="",i=!1,h=0,d=0,j=!1,e=0,a=0;dY=99+(bu.total-3)*62,fT.Cost>0&&(dY+=88),d=eU-122,1==cH&&(d-=gZ(e6,0,44,0,d))<1&&(c=null,null!=P&&""!=k.ajaxresponseget(0,P)&&(c=k.split(k.ajaxresponseget(1,P),","),k.arraylengthget(c)>=3&&"good"==c[1]?(null==(eu=gt(1*c[3]||0))&&(eu=gt(0)),c$!=(1*c[2]||0)&&(c$=1*c[2]||0,ix(k.sounds[10]))):ix(k.sounds[29]),P=null),null==P&&(j=!0)),hw(280,d=k.clamp(d,0,dY),.4,0,!0),1==cH&&(d<1&&null!=P&&e6>222&&(hq(dW/2,dW/2-37),gB("Cancel",dW/2,dW/2,!1,!0,!1,!1,!1,!1),af&&(hr("loadingcancel","avatarset.php"),P=null,hA())),e6<=222&&(iH("Saving"+ho(!1),dW/2,eU-55-window.gtboffsety,14,!0),k.cursorset(34,"wait"))),(a=20-d$)> -15&&a<dV&&iJ("Set Your Avatar",dW/2,a,14,!0,!1),fT.Cost>0&&((a+=45)> -15&&a<dV&&iJ("If you change your",dW/2,a,14,!0,!1),(a+=24)> -15&&a<dV&&iJ("avatar, you will lose",dW/2,a,14,!0,!1),(a+=24)> -15&&a<dV&&iJ("your old one.",dW/2,a,14,!0,!1)),a+=50,e=h=85;for(var f=bu.first;f;){if(0==(b=f.val).Id||b.Cost>99999){f=f.next;continue}b.Cost>0&&!i&&(i=!0,(a+=15)> -40&&a<dV+4&&iJ("Premium Avatars",dW/2,a,14,!0,!1),a+=44),a> -40&&a<dV+4&&gs(b,e-18,a-1,!0),b==fT?a+46+7> -40&&a+46+7<dV+4&&iJ("You",e,a+46+7,14,!0,!1):(g="Free",b.Cost>0&&(g="~"+b.Cost),a+46> -31&&a+46<dV&&gB(g,e,a+46,!1,!0,!1,cH>0||c$<b.Cost,!1,!1),af&&cH<=0&&(iy(),fT=b,gu(),iz())),(e+=110)>dW-h+6&&(e=h,a+=124),f=f.next}hz(),hx(fT.Id>0&&cH<=0),fT.Id>0&&cH<=0&&hv(0,0)&&hA(),j&&hA(),k.offsetset(0,0)}():bG==bH?function(){var b=!1,f="",e="",i=!1,g=0,h=0,c=0,d=0,a=0;if(c=320,h=318,dY=0,f_&&(h-=77),(i=db&&eI!=hn("screenname")&&eC==fZ)&&(g+=1),eI==hn("screenname")&&(f_?g+=1:g+=2),hw(c,h+=31*g,.4,0,!0),a=24,O=eG,iJ("^"+eI,c/2,a,14,!0,!1),O=0,!f_&&null==f4){if(a+=35,""==eC)iJ("Clan: None",c/2,a,14,!0,!1);else{e=eC;for(var j=0;iO(e)>165;){if(j++ >999999)throw{line:43,message:"Infinite While Loop"};e=k.stringpart(e,1,e.length-1)}eG>0&&eG<=k.arraylengthget(eL)?(f=eL[eG]+" of      "+e,iJ(eL[eG]+" of",c/2-iO(f)/2,a,14,!1,!1),iK(e,c/2-iO(f)/2+iO(eL[eG]+" of ")+28,a,14,!1),gJ(c/2-iO(f)/2+iO(eL[eG]+" of ")+1,a-8,eA,ew,ex,!1,!1,ey,ez)):eE?(iJ("Chief of",c/2-iO(f="Chief of      "+e)/2,a,14,!1,!1),iK(e,c/2-iO(f)/2+iO("Chief of ")+26,a,14,!1),gJ(c/2-iO(f)/2+iO("Chief of ")+3,a-9,eA,ew,ex,!1,!1,ey,ez)):(gJ(c/2-iO(eC)/2-18,a-10,eA,ew,ex,!1,!1,ey,ez),iK("   "+eC,c/2,a,14,!0)),fi&&g0(b$)}}if(a+=32,null==f4?(eI!=hn("screenname")&&(iJ("Gold: ",28,a,14,!1,!1),iJ("~"+eD,c-iO("~"+eD)-28,a,14,!1,!1),iJ("Active: ",28,a+=32,14,!1,!1),iJ(i7(1e3*et,!1,!0,"online now",!0,!1),c-iO(i7(1e3*et,!1,!0,"online now",!0,!1))-28,a,14,!1,!1),a+=32),iJ("Plays: ",28,a,14,!1,!1),iJ(""+eF,c-iO(""+eF)-28,a,14,!1,!1)):(a+=32,iJ(ho(!1),c/2,a,14,!1,!1),k.cursorset(82,"wait")),a+=32,null==f4&&(iJ("Castle upgrades: ",28,a,14,!1,!1),iJ(""+eJ,c-iO(""+eJ)-28,a,14,!1,!1)),a+=32,null==f4&&(iJ("Best score: ",28,a,14,!1,!1),gB("*"+eH,c-126,a-11,!1,!1,!1,bD||eH<=0,!1,!1),af&&(iy(),hd(dy),gz(eI,eH,!0,eC!=fZ))),a+=32,d=c/2,d-=60,!f_&&null==f4&&(""!=eC?(i&&(gB("Kick Out!",d+jM(b,120),a,!1,!0,!1,et<2592e3||null!=f5,!1,!1),b&&(a+=45),b=!b,af&&jv(eI),null!=f5&&(hp(d+jM(b,120)+55,a-15),k.cursorset(120,"wait"))),gB("  Clan",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),gJ(d+jM(b,120)-39,a+6+ae,eA,ew,ex,!1,!1,ey,ez),b&&(a+=45),b=!b,af&&(g0(b$),iy())):eI==hn("screenname")&&(gB("Join Clan",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af&&g0(bY))),null==f4){if(eI==hn("screenname")&&(!f_&&(gB("Email",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af&&(iy(),bm?g0(b5):g0(b4))),gB("^ Avatar",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af&&(iy(),g0(bM)),!f_&&(gB("Password",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af&&(iy(),g0(cx))),!f_&&(gB("Feedback",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af&&(iy(),g0(b7))),gB("Log Out",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),b&&(a+=45),b=!b,af)){iy(),hr("state","logout"),jg(),ig(),h8(),bC=!0,bD=!1,aB=0,aC=null,eT=null,k.offsetset(0,0),hd(dy),g0(cq);return}eI==hn("screenname")?(gB("  Delete",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),k.imagedrawgl(k.images[203],d+jM(b,120)-35,a+ae+12),b&&(a+=45),b=!b,af&&(g0(cP),iy())):(gB("  Report",d+jM(b,120),a,!1,!0,!1,!1,!1,!1),k.imagergbset(k.images[203],{r:255,g:0,b:0,a:255}),k.imagedrawgl(k.images[203],d+jM(b,120)-35,a+ae+12),k.imagergbset(k.images[203],k.colormake(255,255,255,255)),b&&(a+=45),b=!b,af&&(g0(cR),iy()))}null!=f4&&js(),null!=f5&&(ju(),null==f5&&hA()),hv(c,h)&&hA(),k.offsetset(0,0)}():bG==cc?function(){var e,f=0,a=null,g=0,i=0,j=0,m=null,p=0,q=0,n="",o=null,c=0,r=null,h=0,d=0,b=0;if(j=300,i=eU-277-hU(),i=k.clamp(i,160,444-hU()),dY=66+66*Math.ceil(c5.total/1),hw(j,i,.4,0,!0),b-=d$,(b+=22)> -11&&iJ("Your Inventory",j/2,b,14,!0,!1),hv(j,eU-window.gtboffsety-5-hT())){c7=null,c9=null,ad=null,dG=null,c4=!1,hA();return}cH>0&&e6>55&&null!=dG&&(hh(),null==dG&&(cH=0,e7=k.loops,ad=null)),g9(),d=50,b+=55,c5.total<=0&&iJ("None",j/2,b+22,14,!0,!1),c=c8;for(var l=c5.first;l;)r=(a=l.val).Tile_Kind,b-17> -44&&b-17<dV+9&&(c7==a&&3==a.Total||r._Draw6(a.Tier,d-fA/2+2,b-17,0),h=a.Total,c7==a?(e6>2&&(h-=1),e6>12&&(h-=1),e6>22&&(h-=1)):null!=c7&&null==c9&&a.Tier==c7.Tier+1&&a.Tile_Kind==c7.Tile_Kind.Upgraded_version&&(h-=1),a.Total>0&&iJ("x"+h,d+38,b-0,14,!0,!1),o=a.Tile_Kind.Upgraded_version,a.Tier<4&&null!=o?(f=100,1==a.Tier&&(f=300),2==a.Tier&&(f=1e3),3==a.Tier&&(f=3e3),n="Merge 3/~"+f,a.Total<3&&(n=0==a.Tier?"merge 3 to get/"+o._Name_Get(a.Tier+1,0):"merge 3 for a/"+(iQ(a.Tier+1)+" "+iP(a.Tile_Kind==fx,"Tower",a.Tile_Kind.Name))),gB(n,d+70,b-20,!0,!1,!1,a.Total<3||c$<f||null!=c7,!1,!1),af&&(iy(),ix(k.sounds[22]),c7=a,g5(),iz(),c8=b)):iJ("Max Level!",d+84,b-0,14,!1,!1)),null!=c7&&(a.Tier==c7.Tier&&a.Tile_Kind==c7.Tile_Kind&&(c=b),a.Tier==c7.Tier+1&&a.Tile_Kind==c7.Tile_Kind.Upgraded_version&&(q=b-11)),b+=66,l=l.next;if(d=50,b=i+60,null!=c7){for(e6>=88&&(p=e6-88),m=c7.Tile_Kind,e6>=111&&(k.transparencyset(gr(e6,111,133)),e6>=122&&(m=c7.Tile_Kind.Upgraded_version,122==e6&&(ix(k.sounds[28]),k.debugset("bong")))),c=c-17-gZ(e6-(2-g)*10,0,44,0,33),(c+=gZ(e6-155,0,50,0,q-c))>dV-44&&(d$+=c-(dV-44)),c<8&&(d$-=8-c),g=1;g<=3;g++)m._Draw6(c7.Tier+jM(e6>=122,1),d-fA/2+2+gZ(e6-(2-g)*10,0,44,0,(g-2)*30)*gZ(p,0,22,1,0),c,0);k.transparencyset(0),null!=c9?e6>=188&&(hp(d+26,b-40),k.cursorset(180,"wait")):e6>=205&&(c7=null,iz(),cH=0)}hz(),hx(!0),it(eU-133-hU()),k.offsetset(0,0),null!=c9&&e6>=155&&(e=null,null!=c9&&""!=k.ajaxresponseget(0,c9)&&(e=k.split(k.ajaxresponseget(1,c9),","),k.arraylengthget(e)>=2&&"good"==e[1]?(c$=1*e[2]||0,ix(k.sounds[10]),g4(e[3])):ix(k.sounds[29]),c9=null))}():bG==cJ?iY():bG==b3?(a=0,hw(320,330,.4,0,!0),iJ("Playing Disconnected",dW/2,a=28,14,!0,!1),a+=44,"wrong token"==ei?(iJ("You got logged out.",dW/2,a,14,!0,!1),iJ("Played on other device?",dW/2,a+=25,14,!0,!1)):(iJ("You or the server have",dW/2,a,14,!0,!1),iJ("lost connection.",dW/2,a+=25,14,!0,!1)),iJ("You can continue but",dW/2,a+=40,14,!0,!1),iJ("your score won't be saved",dW/2,a+=25,14,!0,!1),iJ("and you won't get a chest.",dW/2,a+=25,14,!0,!1),iJ("Quit your current game",dW/2,a+=40,14,!0,!1),iJ("and try playing again.",dW/2,a+=25,14,!0,!1),gB("Quit",dW/2-55,a+=25,!1,!0,!1,!1,!1,!1),af&&(iy(),g0(cw)),gB("Continue",dW/2+55,a,!1,!0,!1,!1,!1,!1),af&&hA(),hv(dW,dV)&&hA(),k.offsetset(0,0)):bG==bS?d9?function(){var f=0,d=0,b=0,e=0,c=0,a=0;if(d=320,a6>1&&bD&&(d+=26),hw(b=280,d,.4,0,!0),iJ("Account",b/2,15,14,!0,!1),e=k.imagesizexget(k.images[97]),f=k.imagesizeyget(k.images[97]),c=b/2-e/2,iJ("Create an account to...",b/2,(a=80)-20,14,!0,!1),a+=30,k.imagedrawgl(k.images[10],b/2+5,a-22),iJ("Collect    gold!",b/2,a-20,14,!0,!1),iJ("Save your progress!",b/2,(a+=30)-20,14,!0,!1),iJ("Compete with friends!",b/2,(a+=30)-20,14,!0,!1),jc(c,a=180,e,f),gB("Create",c,a,!1,!1,!1,!1,!1,!1),af){k.offsetset(0,0),iy(),bC&&h8(),ia(0,"leveltutorialdid1"),cZ=!0,hc(!1);return}iJ("Have an account?",b/2,(a=264)-25,14,!0,!1),jc(c,a,e,f),gB("Log In",c,a,!1,!1,!1,!1,!1,!1),af&&(iy(),g0(cp)),a6>1&&bD&&iJ("Note: Game will reset",b/2,a+48,14,!0,!1),hv(b,d)&&hA(),k.offsetset(0,0)}():(cA=!1,bf=0,i=0,cE=0,ak=0,d=0,bf=220,hw(i=192,bf=235,.4,0,!0),iJ("Get Gold",i/2,d=20,14,!0,!1),cE=k.imagesizexget(k.images[97]),k.imagesizeyget(k.images[97]),ak=i/2-cE/2,iJ("Earn    "+u,i/2,d+=40,14,!0,!1),k.imagedrawgl(k.images[10],i/2+5,d),d+=20,gB("Watch }",ak,d,!1,!1,!1,cA="loading"==w||new Date().getTime()<1e3*t,!1,!1),ae>0&&aY&&!cA&&gm(),new Date().getTime()<1e3*t&&iJ(i7(1e3*t-new Date().getTime(),!0,!1,"",!1,!0),i/2,d+39,14,!0,!1),"loading"==w&&(iH(ho(!1),i/2,d+16,14,!0),k.cursorset(28,"wait")),iJ("Spend Gold",i/2,d+=66,14,!0,!1),gB("Buy  ",ak,d+=20,!1,!1,!1,!1,!1,!1),k.imagedrawgl(k.images[6],ak+59,d+9+ae),af&&(iy(),g0(bT)),hv(i,bf)&&hA(),k.offsetset(0,0)):bG==bT?function(){var c,e=0,d=0,f=0,b=0,g=0,h=0,a=0;for(f=220,hw(b=300,f=333,.4,0,!0),iJ("Buy Castle Upgrades",b/2,a=20,14,!0,!1),g=k.imagesizexget(k.images[97]),k.imagesizeyget(k.images[97]),h=b/2-g/2,a+=33,e=-40,d=1;d<=5+az;d++)k.imagedrawgl(k.images[6],b/2+e,a),e+=16,5==d&&(a+=16,e=-40);az>=5?(iJ("You reached the",b/2,a+=65,14,!0,!1),iJ("maximum level!",b/2,a+=25,14,!0,!1),iJ("Good job!",b/2,a+=55,14,!0,!1)):(iJ("Start every level with",b/2,a+=44,14,!0,!1),iJ("an extra heart!",b/2,a+=25,14,!0,!1),iJ("Does not affect the",b/2,a+=40,14,!0,!1),iJ("Damaged Castle level.",b/2,a+=25,14,!0,!1),iJ("Buy 1   ",b/2,a+=45,14,!0,!1),k.imagedrawgl(k.images[6],b/2+22,a),1==cH&&k.imagedrawgl(k.images[6],b/2+22+gZ(e6,0,99,0,-38),a+gZ(e6,0,99,0,-199)),a+=26,gB("~"+(d=1e3*Math.pow(5,az)),h,a,!1,!1,!1,null!=aA||d>c$,!1,!1),af&&0==cH&&(aA=gp("castleupgrade.php?",!1),iz(),ix(k.sounds[22])),null!=aA&&(iH(ho(!1),b/2,a+16,14,!0),k.cursorset(59,"wait"),1==cH&&e6>98)&&(c=null,null!=aA&&""!=k.ajaxresponseget(0,aA)&&(c=k.split(k.ajaxresponseget(1,aA),","),k.arraylengthget(c)>=3&&"good"==c[1]&&(c$=1*c[2]||0,az=1*c[3]||0,ix(k.sounds[10])),aA=null),null==aA&&(cH=0))),hv(b,f)&&(aA=null,hA()),k.offsetset(0,0)}():bG==cy?function(){var f,c,b=0,e=0,d=0,a=0;if(k.offsetset(0,0),ik(.3),g8("I grow tired of setting up/the castle for you! watch/an ad to refill lives.","",k.images[65],0),k.offsetset(R,S),a=88,(d=dL-Math.abs(hm("playold2")-new Date().getTime()))<0){d=0,hg();return}for(b=1,e=2;b<=e;b++)k.imagedrawgl(k.images[114],V/2+(b-2)*k.imagesizexget(k.images[114]),a),1==b&&(k.transparencyset(.5*gr(k.mod(e4,66),0,15)),k.imagedrawglpart(k.images[412],V/2+(b-2)*k.imagesizexget(k.images[114]),a,0,0,Math.floor((dL-d)/dL*k.imagesizexget(k.images[6])),k.imagesizeyget(k.images[412])),k.transparencyset(0));if(iH("Next life in",V/2,111,14,!0),iH(i7(d,!0,!1,"",!1,!0),V/2,131,14,!0),a=.66*V,gB("< Cancel",V/2-80,a,!0,!0,!1,!1,!0,!1),af){hr("playtoomuchback","clicked to cancel"),g0(cq);return}gB("Watch Ad }/and play",V/2+80,a-30,!0,!0,!1,s,!0,!1),af&&(hr("playtoomuchad","clicked to watch"),gm()),gB(iP(null!=dM,ho(!1),"Pay ~100/and play"),V/2+80,a+30,!0,!0,!1,null!=dM,!0,!1),null!=dM&&k.cursorset(41,"wait"),af&&(dM=gp("livesrefill.php?",!1)),c=null,null!=dM&&""!=k.ajaxresponseget(0,dM)&&(c=k.split(k.ajaxresponseget(1,dM),","),k.arraylengthget(c)>=2&&"good"==c[1]&&(ix(k.sounds[10]),c$=1*c[2]||0,ia(0,"playold1"),ia(0,"playold2")),dM=null)}():bG==cP?jh():bG==cR?jk():bG==cS&&jj(),gH()&&h1(),bG==cf)?!function(){var a="",b="";if(k.offsetset(0,0),a="You survived @"+(""+a6+" day"),a6>1&&(a+="s"),a+="!",gT(),cH>=1&&2==cH){if(function(){var b=0,c=null,a=null;if(null!=dI){if(d9){c_=0,dI=null;return}if(""!=k.ajaxresponseget(6,dI)){if(ei="",a=k.split(k.ajaxresponseget(8,dI),","),k.arraylengthget(a)>=9&&"good"==a[1]){for(c_=1*a[2]||0,c$=(1*a[3]||0)-c_,gQ(c_,eW/2-R,V,!1),c=k.arraymake(13,!1,4),ek=0,el=!1,b=1;b<=4;b++)es[b].Day>0&&(c[b]=!0);for(h2(a[4]),b=1;b<=4;b++)if(es[b].Day>0&&!c[b]){ek=b,el=!0;break}ih(a[7]),(1*a[6]||0)>0&&((ea=1*a[6]||0)<0&&(ea=0),ea>0&&(null!=dE.Scores&&(ea>k.arraylengthget(dE.Scores)?(alert("Rank out of bounds"),ea=0):dE.Scores[ea].Is_my_new_one=!0),ea>k.arraylengthget(eL)&&(ea=0),dE!=dy&&(ea=0))),f$=1*a[9]||0}else k.arraylengthget(a)>=4&&"good"==a[1]?(c$=1*a[2]||0,h2(a[3]),ih(a[4])):(k.debugset("Playing disconnected now because leveldone.php"),eh=!0,c_=0,dA=0,ij());dI=null}}}(),null==dI){if(D.total<=0){dA>0?(aE=!1,g0(ce),ek>0&&ix(k.sounds[22])):eh&&e6<144?(iH("Was not connected to server.",eW/2,266,14,!0),iH("No rewards.",eW/2,288,14,!0)):(bD=!1,g0(cq));return}}else k.loops-a2<600&&iH("Loading Reward"+ho(!1),eW/2,277,14,!0),k.cursorset(38,"wait"),e6>150&&(k.loops-a2>600&&(k.cursorset(41,"auto"),gB("Retry",eW/2,266,!1,!0,!1,!1,!1,!1),af&&(a2=k.loops,hk(!0))),k.transparencyset(gZ(e6,150,200,1,0)),gB("Cancel",eW/2,310,!1,!0,!1,!1,!1,!1),k.transparencyset(0),af&&e6>=190&&(hr("loadingcancel","leveldone.php"),dI=null,bD=!1,g0(cq),ij()))}b="You get ~"+(""+a6+" gold!"),d9&&(b="No reward until you log in"),eh&&(b=""),g8(a,b,k.images[14],0),0==cH&&dk>=1&&iz(),k.offsetset(0,0),aZ&&(0==cH&&(e5=0),1==cH&&(iz(),a2=k.loops))}():bG==ce?!function(){var e=0,f=0,b=0,a=0,c="",d="",g=0;if(c="You achieved "+(""+dA+" goal"),dA>1&&(c+="s"),c+="!",g=g9(),gT(),k.offsetset(0,0),a=250,cH>=1&&(d9&&iH("You are not logged in!",eW/2,a+70,14,!0),h1(),(0!=ek||d9||eh)&&1==cH&&e6>eq&&(ek>0||aZ))){ek=0,bD=!1,g0(cq),k.offsetset(0,0);return}(b=(eW-k.imagesizexget(k.images[325]))/2,ek>0)?(iH("Day @"+(""+a6+" chest"),eW/2,a+50,14,!0),iH("Takes "+(""+hY(hB(dA,4))+" hours to unlock"),eW/2,a+72,14,!0),1==cH&&(e=h0(ek),e+=k.imagesizexget(k.images[117])/2,f=eU-eq-11,b+=(e-b)*(e6/eq),a+=(f-a)*(e6/eq),ek>2?b+=33*Math.sin(e6/eq*180*k._degreestoradians):b-=33*Math.sin(e6/eq*180*k._degreestoradians)),hX(b,a,hB(dA,4),1,!1,!1)):(2==cH&&(k.transparencyset(gZ(e6,0,33,0,1)),a+=gZ(e6,0,33,0,13)),hX(b,a,hB(dA,4),1,d9||eh,!1),k.transparencyset(0),d9||eh?eh?iH("Was offline. No prize chest.",eW/2,a+45,14,!0):iH("Not logged in. No prize chest.",eW/2,a+45,14,!0):cH<2&&(iH("Can't hold more chests.",eW/2,a+45,14,!0),gB("Discard",eW/2,a+64,!1,!0,!1,!1,!1,!1),af&&iz(),iH("Open one to make room!",eW/2,eU-eq-22,14,!0)),0==cH&&iz()),k.offsetset(R,S),d9||(d="Here's your prize chest",0!=ek||(d="But no room for prize chests!")),aE&&(c="Good job making room!",d="This chest could be good!"),cH<1&&g8(c,d,k.images[74],0),k.offsetset(0,0),aZ&&0==cH&&(g>c.length?iz():e5=0),2==cH&&e6>48&&(ek=0,bD=!1,g0(cq))}():bG==cC?(bh=0,bh=eW,ik(.4),cH<=0?dk>=1&&(gB("13 or older",bh/2,122,!0,!0,!1,!1,!1,!1),af&&(jm(!1),iz()),gB("I'm under 13",bh/2,244,!0,!0,!1,!1,!1,!1),af&&(jm(!0),hb())):(iH(ho(!1),eW/2,eU/2,14,!1),k.cursorset(21,"wait"),jl(),null==f0&&(""!=fZ?(dd=!0,de=!0,bD=!1,g0(bM)):(de=!0,bD=!1,g0(bM)))),g8("One last thing!","how old are you?",k.images[14],0),k.offsetset(0,0)):bG==cF?(cd=!1,$=0,aK="",a0="",_=0,c=0,cn=0,q="",h=null,((_=Math.floor((k.loops-e0)/3)-4)<1&&(_=1),aK="Hi "+eV+"!",a0="Set your password",c=300,cn=63+hV(),dk>=2)?(null!=f8?(dX-=2+.1*dX)<0&&(dX=0):dX+=2+.1*dX,dY=220,hw(c,dX=k.clamp(dX,0,dY),.4,cn,!1),X=c-40,W=55,Y=(c-X)/2,_>0&&_<11&&(Y+=4*Math.sin(66*_*k._degreestoradians)),Z=65,Z-=d$,dX>10&&iJ("My secret password",c/2,18,14,!0,!1),dX>38&&iJ("shall be...",c/2,46,14,!0,!1),$=(dX-Z-18)*bE,$=k.clamp($,0,99),fk+=1,k.fontsizeset(24),k.textboxdraw(2,Y+5,Z+13,X-10,!0,"padding:"+3*bE+"px;text-align:center;clip-path:polygon(0 0, 100% 0, 100% "+(""+$+("px, 0 "+(""+$+"px)")))),q=k.textboxtextget(57,2),!k.keyboardopen()&&""==q&&dX>Z+61-5&&(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],c/2+0,Z+61+Math.sin(9*k.loops*k._degreestoradians))),q.length>25&&(k.keyboardhide(),q="",e_="Not so long!",e0=k.loops,k.textboxtextset(70,2,"")),dX>150&&(gB("Done",c/2,Z+80,!0,!0,!1,cd=q.length<6||null!=f8,!1,!1),(af||c3)&&!cd&&(k.keyboardhide(),f8=gp("usermake2.php?screenname="+eV+("&password="+encodeURIComponent(q))+("&board="+gy()),!0),iz())),dX<=0&&null!=f8&&(iH("   Loading"+ho(!1),c/2-4,200,14,!0),k.cursorset(83,"wait"),e6>300&&(gB("Cancel",c/2,236,!1,!0,!1,!1,!0,!1),af&&(hr("loadingcancel","usermake2.php"),f8=null,bD=!1,g0(cq)))),hz(),hx(!1),Y+=window.gtboffsetx,Z+=window.gtboffsety,null!=f8&&""!=k.ajaxresponseget(101,f8)&&(h=k.split(k.ajaxresponseget(102,f8),","),k.arraylengthget(h)>=4&&("good"==h[1]?dX<=0&&(f8=null,ia(0,"userisoffline"),ib(h[2],"userid"),ib(h[3],"token"),ib(eV,"screenname"),ib(eV,"screennamelast"),c$=1*h[4]||0,ib(h[5],"newsseen"),d9=!1,g0(cC)):(e_="error","taken"==h[2]&&(g0(cD),e_="That name is taken",eV=""),"bad password"==h[2]&&(e_="Some symbols are not allowed."),cH=0,f8=null)))):ik(.4),""!=e_&&""==q&&(aK=e_,a0=""),g8(aK,a0,k.images[14],0),k.offsetset(0,0),gW()):bG==co?!function(){var d=0,c=0,g=!1,f="",a=0,h=0,b="",e="";for(a=320,h=105+hV(),1==cH?dX-=4:dX+=2+.1*dX,dY=255,hw(a,dX=k.clamp(dX,0,dY),.3,h,!1),X=a-40,W=60,Y=(a-X)/2+0,Z=60,d=1;d<=hn("screenname").length;d++){if(iO(e)>126){e+="...";break}e+=k.stringpart(hn("screenname"),d,1)}if(iJ("Welcome "+e,a/2,Z-42,14,!0,!1),dX>30&&iJ("Your password please...",a/2,Z-17,14,!0,!1),dX>Z+15&&(c=(dX-Z-18)*bE,c=k.clamp(c,0,99),fk+=1,k.fontsizeset(24),k.textboxdraw(2,Y+5,Z+13,X-10,!0,"padding:"+3*bE+"px;text-align:center;clip-path:polygon(0 0, 100% 0, 100% "+(""+c+("px, 0 "+(""+c+"px)")))),b=k.textboxtextget(44,2),!k.keyboardopen()&&""==b&&dX>Z+61-5&&(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],a/2+0,Z+61+Math.sin(9*k.loops*k._degreestoradians)))),b.length<1&&(e_=""),b.length>111&&(k.textboxtextset(62,2,""),e_="Not so long!",e5=0),null==f6)dX>140&&(gB("Done",a/2,135,!0,!0,!1,!(g=b.length>5&&b.length<30),!1,!1),(af||c3)&&g&&(jx(encodeURIComponent(b)),iz())),dX>200&&(iJ("Forgot password?",22,212,14,!1,!1),gB("Reset",a-119,198,!1,!1,!1,!1,!1,!1),af&&g0(b8));else{if(dX<=0&&(iH("   Loading"+ho(!1),a/2-4,180,14,!0),k.cursorset(87,"wait"),e6>300&&(gB("Cancel",a/2,202,!1,!0,!1,!1,!0,!1),af))){hr("loadingcancel","userlogin.php"),f6=null,bD=!1,g0(cq);return}jw()}Y+=window.gtboffsetx,Z+=window.gtboffsety,dY>dX&&(hz(),hx(!1)),f="Enter your password.",""!=e_&&(f=e_),g8(f,"",k.images[14],0),k.offsetset(0,0),gB("<",R,11+hV(),!1,!1,!0,!1,!0,!1),af&&(f6=null,hr("state","login password back"),g0(cp))}():bG==cp?!function(){var c=0,d="",a=0,b="";if(a=290,1==cH?dX-=4:dX+=2+.1*dX,dY=185,hw(a,dX=k.clamp(dX,0,dY),.3,120+hV(),!1),X=a-40,W=60,Y=(a-X)/2,Z=33,iJ("Log in as...",a/2,Z-12,14,!0,!1),c=(dX-Z-18)*bE,(c=k.clamp(c,0,99))>0&&(2==(fk+=1)&&k.textboxtextset(29,1,hn("screennamelast")),k.fontsizeset(24),k.textboxdraw(1,Y+5,Z+13,X-10,!1,"padding:"+3*bE+"px;font-family:serif;font-weight:bold;text-align:center;clip-path:polygon(0 0, 100% 0, 100% "+(""+c+("px, 0 "+(""+c+"px)")))),b=k.textboxtextget(37,1)),(iO(b)>a||b.length>20)&&(b="",e_="Not so long!",e0=k.loops,k.textboxtextset(43,1,"")),!k.keyboardopen()&&""==b&&dX>Z+61-5&&(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],a/2+0,Z+61+Math.sin(9*k.loops*k._degreestoradians))),null==gc)dX>115&&(gB("Continue",a/2,Z+77,!0,!0,!1,b.length<=2,!1,!1),(af||c3)&&b.length>2&&(jF(b),iz()));else if(dX<=0&&(e6>55&&(iH("   Loading"+ho(!1),a/2-4,180,14,!0),k.cursorset(71,"wait")),e6>333&&(hq(a/2,192),gB("Cancel",a/2,205,!1,!0,!1,!1,!1,!1),af))){hr("loadingcancel","userscreennamelogin.php"),gc=null,bD=!1,g0(cq);return}Y+=window.gtboffsetx,Z+=window.gtboffsety,dY>dX&&(hz(),hx(!1)),d="Enter your username.",""!=e_&&(d=e_),g8(d,"",k.images[14],0),k.offsetset(0,0),gB("<",R,11+hV(),!1,!1,!0,!1,!0,!1),af&&(hr("state","login cancel"),g0(cq)),null!=gc&&dX<=0&&jG()}():bG==cD?!function(){var c=0,f=0,d=0,g="",h="",e=0,b=0,i=0,a="";if(k.offsetset(0,0),(e=g9())<1&&(e=1),b=300,i=63+hV(),dk>=2){if(1==cH?dX-=4:dX+=2+.1*dX,dY=185,hw(b,dX=k.clamp(dX,0,dY),.3,i,!1),X=b-40,W=55,Y=(b-X)/2,e>0&&e<11&&(Y+=4*Math.sin(66*e*k._degreestoradians)),Z=44,Z-=d$,dX>15&&iJ("I shall be known as...",b/2,Z-19,14,!0,!1),d=(dX-Z-18)*bE,d=k.clamp(d,0,99),fk+=1,k.fontsizeset(24),k.textboxdraw(1,Y+5,Z+13,X-10,!1,"padding:"+3*bE+"px;font-family:serif;font-weight:bold;text-align:center;clip-path:polygon(0 0, 100% 0, 100% "+(""+d+("px, 0 "+(""+d+"px)")))),a=k.textboxtextget(50,1),""!=eV);else for(f=1;f<=a.length;f++)(c=k.stringpart(a,f,1).charCodeAt(0)||0)>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||(k.keyboardhide(),a="",e_="Letters and numbers only!",e0=k.loops,k.textboxtextset(66,1,""));!k.keyboardopen()&&""==a&&dX>Z+61-5&&(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],b/2+0,Z+61+Math.sin(9*k.loops*k._degreestoradians))),(iO(a)>X-20||a.length>20)&&(k.keyboardhide(),a="",e_="Not so long!",e0=k.loops,k.textboxtextset(83,1,"")),null==gb?dX>115&&(gB("Continue",b/2,Z+70,!0,!0,!1,a.length<=2,!1,!1),(af||c3)&&(k.keyboardhide(),a.length>2&&(cH+=1,e7=k.loops,jE(a),eV=a,b2=!0))):dX<=0&&""==k.ajaxresponseget(101,gb)&&(iH("   Loading"+ho(!1),b/2-4,200,14,!0),k.cursorset(103,"wait"),e6>333&&(hq(b/2,215),gB("Cancel",b/2,236,!1,!0,!1,!1,!0,!1),af&&(hr("loadingcancel","userscreennamecheck.php"),gb=null,bD=!1,g0(cq)))),Y+=window.gtboffsetx,Z+=window.gtboffsety,dY>dX&&(hz(),hx(!1))}else ik(.4);b2&&(g=""),g="Welcome to tower swap!",h="What is your name?",""!=e_&&""==a&&(g=e_,h=""),g8(g,h,k.images[14],0),k.offsetset(0,0),dX>9&&gW(),null!=gb&&jD()}():bG==b_?!function(){var a={total:0,first:null,last:null},d=0,e=0,g="",c=null,b=0;k.listpush(2,a,"Art"),k.listpush(3,a,"Lead artist: Kyle McArthur:kylemcarthur.com"),k.listpush(4,a,"Dragons: Kyle Sun"),k.listpush(5,a,"Logo: Kyle Sun"),k.listpush(6,a,"Menu scroll: Reff"),k.listpush(7,a,"Icons: PixelAccountant"),k.listpush(8,a,"Buttons: Daniel Eddeland"),k.listpush(9,a,"Bubbles: OwllCraft:owllcraft.itch.io"),k.listpush(10,a,"Font: Curtastic:curtastic.com"),k.listpush(11,a,""),k.listpush(12,a,"Audio"),k.listpush(13,a,"Menu music: Jaybee"),k.listpush(14,a,"Gameplay music: J. Fung:www.youtube.com/user/Auditor48"),k.listpush(15,a,"Sound effects: freesound.org:freesound.org"),k.listpush(16,a,""),k.listpush(17,a,"Code"),k.listpush(18,a,"Gameplay coder: Curtastic:curtastic.com"),k.listpush(19,a,"Server coder: Curtastic:curtastic.com"),k.listpush(20,a,"App engine: Touch Basic:touchbasicapp.com"),k.listpush(21,a,""),k.listpush(22,a,"Testing"),k.listpush(23,a,"Focus groups: Curtastic:curtastic.com"),k.listpush(24,a,"Cannon director: Andy"),k.listpush(25,a,"Exploit finder: Perry"),k.listpush(26,a,"Idea man: Will"),k.listpush(27,a,"Biggest addict: Priya"),k.listpush(28,a,""),k.listpush(29,a,"Marketing"),k.listpush(30,a,"Wiki: VirtualNomad:tower-swap.fandom.com/wiki/Tower_Swap_Wiki"),k.listpush(31,a,"Social Networks: Curtastic:curtastic.com"),e=330,d=eU-hT()-hV()-111,dY=28*a.total+77,hw(e,d,.4,0,!0),(b=18-d$)> -15&&b<d&&iJ("Credits",e/2,b,14,!0,!1),b+=30;for(var f=a.first;f;)g=f.val,b> -15&&b<d&&(c=k.split(g,":"),k.arraylengthget(c)>2?(iJ(c[1]+":",26,b,14,!1,!1),iK(c[2],32+iO(c[1]),b,14,!1),fi&&(hr("creditslink",c[3]),k.browseropen("https://"+c[3]))):iJ(g,26,b,14,!1,!1)),b+=28,f=f.next;b+=4,hz(),hx(!0),hv(e,d)&&hA(),k.offsetset(0,0)}():bG==bL?(cG=0,ah=0,cI=0,j=0,e=0,hw(ah=192,cG=320,.4,0,!0),iJ("Game Info",ah/2,22,14,!0,!1),cI=k.imagesizexget(k.images[97]),k.imagesizeyget(k.images[97]),j=ah/2-cI/2,e+=46,iJ("version "+M,ah/2,e,14,!0,!1),!f_&&(gB("feedback",j,e+=35,!1,!1,!1,!1,!1,!1),af&&(iy(),hm("userid")>0?g0(b7):g0(bS))),gB("Credits",j,e+=44,!1,!1,!1,!1,!1,!1),af&&(iy(),g0(b_)),gB("News",j,e+=44,!1,!1,!1,!1,!1,!1),k.imagergbset(k.images[362],{r:255,g:217,b:104,a:255}),k.imagedrawgl(k.images[362],j+83+0,e+13+ae),af&&(hr("aboutlink","blog"),k.browseropen("ht"+k.stringpart(fv.Name,2,1)+"ps://"+(k.stringpart(fx.Name,7,5)+"swap.app/blog"))),gB("Privacy",j,e+=44,!1,!1,!1,!1,!1,!1),k.imagedrawgl(k.images[362],j+83+0,e+13+ae),af&&(hr("aboutlink","privacy"),k.browseropen("https://towerswap.app/privacy")),gB("Terms",j,e+=44,!1,!1,!1,!1,!1,!1),k.imagedrawgl(k.images[362],j+83+0,e+13+ae),af&&(hr("aboutlink","terms"),k.browseropen("https://towerswap.app/terms")),hv(ah,cG)&&hA(),k.offsetset(0,0)):bG==cs?!function(){var a=0,c=!1,b=null;for(b=k.split(d8,"/"),c="Update"==k.stringpart(d8,1,6),hw(310,25*k.arraylengthget(b)+(44+66*jM(c,0)),.4,0,!0),a=1;a<=k.arraylengthget(b);a++)a<=1?iJ(b[a],dW/2,-5+25*a,14,!0,!1):iJ(b[a],30,1+25*a,14,!1,!1);c&&(gB("Update",dW/2,25*a+11,!0,!0,!1,!1,!1,!1),af&&("ios"==ef?k.browseropen("https://apps.apple.com/app/id1463356368"):"android"==ef?k.browseropen("https://play.google.com/store/apps/details?id=com.curtastic.towerswap"):k.browseropen("https://towerswap.app"))),hv(0,0)&&(d8="",hA())}():bG==bV?!function(){var i=0,g=0,e=0,c=null,j=0,h=0,b=0,a=0,l=0,m=0,d=null;if(c=es[eo],h=1,cH>=3&&(h=2),l=c.Y,a=eU-eq-166,b=l,m=.6-(k.loops-e5)/33*.4,c.X=k.moveto(c.X,eW/2-k.imagesizexget(k.images[325])/2,2),0==cH?(b-=(k.loops-e5)*1.5)<a&&(b=a,iz()):b=a,ik(k.clamp(m,.2,.6)),e6<22&&(b-=3*Math.sin(e6/22*180*k._degreestoradians)),2==cH&&(j=3*Math.sin(22*e6*k._degreestoradians)),cH==3+en.total&&k.transparencyset(gZ(e6,77,122,0,1)),hX(c.X+j,b,ep,h,!1,!1),k.transparencyset(0),cH>=3&&(iH("You got "+(""+c_+" gold!"),eW/2,a+50,14,!0),en.total>0&&cH>=4)){e=a+72;for(var f=en.first;f&&((d=f.val).Opened_Loops<=0&&(d.Opened_Loops=k.loops),iH("And "+(d.Tile_Kind._Name_Get(d.Tier,1)+"!"),eW/2,e,14,!0),g=k.loops-d.Opened_Loops,d.Tile_Kind._Draw6(d.Tier,gZ(g,0,111,c.X,R),gZ(g,0,111,b,e),0),e+=33,i+=1,!(i+3>=cH));)f=f.next}if(h_(),bG!=bV){c_=0;return}2==cH&&iH("Tap to open",eW/2,a+44,14,!0),1==cH&&(null==aJ?iz():e6>111?(iH("   Connecting"+ho(!1),eW/2,a+40,14,!0),k.cursorset(73,"wait"),gB("Cancel",eW/2,a+36+25,!1,!0,!1,!1,!1,!1),af&&(hr("loadingcancel","chestopen.php"),aJ=null,c_=0,g0(cv))):(iH(ho(!1),eW/2,a+36,14,!0),k.cursorset(83,"wait"))),aZ&&cH>=2&&(2==cH?(ix(k.sounds[14]),ix(k.sounds[22]),gQ(c_,c.X+22-R,b+13-S,!1),iz()):cH==3+en.total?e6>66&&(c_=0,g0(cv)):(ix(k.sounds[21]),iz()))}():bG==cx?hO():bG==b7?(cL=!1,ai="",f=0,hw(310,255,.4,111+hV(),!0),iJ("Tell us about TowerSwap!",dW/2,f+=25,14,!0,!1),iJ("Want something added?",dW/2,f+=28,14,!0,!1),iJ("We will fix glitches!",dW/2,f+=28,14,!0,!1),f+=33,cH<=0&&(k.fontsizeset(12),k.textboxdraw(4,(dW-260)/2,f,260,!1,"padding:"+2*bE+"px"),ai=k.textboxtextget(13,4),k.keyboardopen()||""!=ai||(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],dW/2,f+43+1.5*Math.sin(10*k.loops*k._degreestoradians)))),null!=bz&&(hp(dW/2-9,f+47),k.cursorset(21,"wait")),f+=61,cH<=0?(gB("Send",dW/2,f,!0,!0,!1,cL=ai.length<6||null!=bz,!1,!1),(af||c3)&&!cL&&(bz=gp("feedbacksend.php?feedback="+encodeURIComponent(ai=k.stringpart(ai,1,999))+("&platform="+ef),!1))):iJ("Sent!",dW/2,f,14,!0,!1),hv(0,0)&&(bz=null,hA()),null!=bz&&(a1=null,null!=bz&&""!=k.ajaxresponseget(0,bz)&&(a1=k.split(k.ajaxresponseget(1,bz),","),k.arraylengthget(a1)>=1&&"good"==a1[1]||ix(k.sounds[29]),bz=null),null==bz&&iz()),k.offsetset(0,0)):bG==b4?!function(){var c=!1,b="",d=0,e=0,f="",a=0;if(hw(310,280,.4,100+hV(),!0),a+=25,""==bg||cH>0){if(iJ("Confirm Your Email",dW/2,a,14,!0,!1),a+=28,bl||iJ("Get free ~1000!",dW/2,a,14,!0,!1),cH>0){if(null!=f2)hp(dW/2-9,a+44),k.cursorset(13,"wait");else if(a+=55,""!=bn?iJ(bn,dW/2,a,14,!0,!1):(iJ("Email Sent!",dW/2,a,14,!0,!1),iJ("Open it to confirm!",dW/2,a+=25,14,!0,!1)),gB("Okay",dW/2,a+=45,!1,!0,!1,!1,!1,!1),af){if(""!=bn)iz(),cH=0;else{hA(),k.offsetset(0,0);return}}}}else bm?(iJ("Email Address Confirmed!",dW/2,a,14,!0,!1),iJ("Change Your Email?",dW/2,a+=28,14,!0,!1)):(iJ("Email not confirmed",dW/2,a,14,!0,!1),iJ("Re-send or change",dW/2,a+=28,14,!0,!1));if(cH<=0){for(a+=37,k.fontsizeset(16),k.textboxdraw(3,(dW-250)/2,a,250,!1,"padding:"+3*bE+"px"),b=k.textboxtextget(52,3),e4<=0&&""!=bg&&k.textboxtextset(55,3,bg),k.keyboardopen()||""!=b||(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],dW/2,a+51+1.5*Math.sin(10*k.loops*k._degreestoradians))),a+=66,e=2;e<=b.length-1;e++)if(f=k.stringpart(b,e,1),0==d)"@"==f&&(d+=1);else if("."==f){d+=1;break}gG(34,a+5,bo,!1),aD&&(bo=!bo),iJ("  Agree to get emails",dW/2,a,14,!0,!1),iJ(" about Tower Swap",dW/2,a+=28,14,!0,!1),a+=28,null!=f2?(hp(dW/2-9,a+5),k.cursorset(86,"wait")):bm||""==bg||b!=bg?(c=b.length<5||d<2||null!=f2||b==bg&&bo==bp,gB(iP(""!=bg,"Save","Done"),dW/2,a,!0,!0,!1,c,!1,!1),(af||c3)&&!c&&(bn="",iz(),jp())):(gB("Re-send",dW/2,a,!0,!0,!1,c=b.length<5||d<2||null!=f2,!1,!1),(af||c3)&&!c&&(bn="",iz(),jp()))}hv(0,0)&&(bn="",hA()),null!=f2&&jo(),k.offsetset(0,0)}():bG==b5?(p=0,hw(310,210,.4,100+hV(),!0),iJ("Email me when...",dW/2,p+=25,14,!0,!1),p+=5,gG(30,(p+=32)-5,bi,null!=f3),iJ("I get kicked from clan.",60,p,14,!1,!1),aD&&(cH<1&&iz(),bi=!bi),gG(30,(p+=32)-5,bj,null!=f3),iJ("Free ~gold newsletter.",60,p,14,!1,!1),aD&&(cH<1&&iz(),bj=!bj),p+=40,null!=f3&&(hp(dW/2-4,p-18),k.cursorset(54,"wait")),gB("Save",dW/2,p,!0,!0,!1,1!=cH||null!=f3,!1,!1),af&&jr(),null!=f3&&(jq(),null==f3&&hA()),hv(0,0)&&(hA(),f3=null),k.offsetset(0,0)):bG==b8?(al=null,g=0,hw(300,222,.4,0,!0),iJ("Reset Your Password",dW/2,g+=30,14,!0,!1),iJ("An email will be sent",dW/2,g+=30,14,!0,!1),g+=30,iJ("to "+hn("screenname"),dW/2,g,14,!0,!1),g+=34,null==f9?cH<1?(gB("Send Email",dW/2,g,!0,!0,!1,!1,!1,!1),af&&jz()):(al=k.split(bA,"/"),g+=11,iJ(al[1],dW/2,g,14,!0,!1),k.arraylengthget(al)>1&&iJ(al[2],dW/2,g+25,14,!0,!1)):(hp(dW/2-10,g),k.cursorset(27,"wait"),jy()),hv(0,0)&&g0(cp)):bG==bX&&function(){var d=null,c=0,a=0;hw(300,190,.4,0,!0),c=40,iJ("Choose the color style",dW/2,a=26,14,!0,!1),iJ("for your clan shield.",dW/2,a+=30,14,!0,!1),a+=40;for(var b=bv.first;b;)gJ(c,a,0,1,2,!0,!0,6,d=b.val),aM&&(iy(),aL=d,g0(bW)),c+=40,b=b.next;hv(0,0)&&hA()}(),bC&&!bD&&bG!=bP&&((bG==bH||bG==cB)&&eU<500||(k.offsetset(0,0),k.imagedrawgl(k.images[13],(eW-k.imagesizexget(k.images[13]))/2,c0))),cz=0,aj=0,aa="",a3=0,z=0,bG!=cC&&bG!=cp&&bG!=co&&bG!=cF&&(bG!=bS||!d9)&&(k.offsetset(0,0),aj=k.loops-c2,(aj=1)<35&&(aj>25&&k.transparencyset((aj-25)/10),z=c0,d9?(aa="  log in",z+=5):(aa="~"+c$,eh&&(aa=" offline")),a3=eW-(iN(aa,14)+4),(cz=k.loops-a_)<=2&&(z-=1),fj=!0,iI(aa,a3,z,14,!1),d9&&k.imagedrawgl(k.images[203],a3+3,z+1+fh),1==cz&&(z-=1),!eh&&(bG==cq||bD)&&bG!=ct&&hF()&&(k.transparencyset(Math.abs(.5*Math.sin(4*k.loops*k._degreestoradians))),iH("Collect",eW-(iN("Collect",14)+4),z+18,14,!1)),k.transparencyset(0)),bG!=bV&&fG!=bS&&fi&&(hQ()||is()||bG==cD)&&bC&&(iy(),bN=bG,d9&&bC?bG==cD?g0(cp):g0(bS):eh?g0(b3):bG!=ct&&hF()?g0(ct):g0(bS))),k.offsetset(R,S);for(var b0=D.first;b0;)(0,b0.val)._Draw(),b0=b0.next;k.offsetset(0,0),"loading"==w&&(as=0,ax=0,as=(ax=k.loops-v)/12,as=k.clamp(as,0,1),ik(1-as),ax>25&&(iH(ho(!1),eW/2,eU/2,15,!0),k.cursorset(7,"wait")),ax>355&&(gB("CANCEL",eW/2,eU/2+55,!1,!0,!1,!1,!1,!1),af&&(k.debugset("Tapped cancel ad load"),A=null,gl())),ax>12&&(ab=null,null!=A&&""!=k.ajaxresponseget(0,A)&&(k.debugset("adget response="+k.ajaxresponseget(1,A)),ab=k.split(k.ajaxresponseget(2,A),","),k.arraylengthget(ab)>=2&&"good"==ab[1]?(x=ab[2],y=ab[3],w="loaded",k.debugset("ad loaded"),(bG==bS||bG==cc||bG==cu||bG==bQ||bG==b1||bG==cy)&&g0(bK)):w="failed",A=null))),aZ=!1,aY=!1,fD=!1,c4=!1,c3=!1,eX=0,fF=0}function hK(){var a,b=0;for(k.fpsset(60),a8=!1,""==ef&&(ef="web"),M=49,e1="https://towerswap.app",ia(0,"tutorialdidfirstnight"),k.debugonset(!1),k.rngsetup(new Date().getTime()),k.fontset("times new roman"),k.imagesmoothingset(!1),function(){var b=null,c=0;l=new jP,m=new jP,n=new jP,o=new jP,p=new jP,q=new jP;for(var a=bv.first;a;)b=a.val,c+=1,b.Id=c,a=a.next}(),gd=new f,aQ=k.arraymake(42,{r:0,g:0,b:0,a:255},1),dL=24e4,eQ="You",(eL=k.arraymake(45,"",3))[1]="Lord",eL[2]="Earl",eL[3]="Baron",r=-1,u=100,a5=30,as=36,c0=5+hV(),bE=1,a4=1,d9=!0,d5=k.sounds[15],d2=k.sounds[16],d3=k.sounds[24],d4=d5,0==hm("saved")&&(ia(1,"saved"),ia(1,"musicvolume"),ia(1,"soundvolume")),""==hn("scoreslevel1")&&ib("Curtastic@5065,LemonBot@5055,JoeBot@4045,BoulderBot@3035,HomerBot@2025,Tarbot@1015,ZigBot@1011,SirWelBot@8,GreyBot@5,"+(eQ+"@0"),"scoreslevel1"),io(hm("soundvolume")),im(hm("musicvolume")),ia(1,"levelunlocked"),b=0;b<=9;b++)ia(0,"levelbeaten"+b);for(1*k.localstorageget("l_userid")>0&&(ia(1*k.localstorageget("l_userid"),"userid"),k.localstorageset("l_userid",0),ib("","token"),ib("","screenname")),cQ=0,b6=1,bO=2,cT=3,cq=4,cw=5,cl=7,cA=8,cM=9,cB=10,cu=11,bK=12,cr=13,bJ=14,bI=15,cN=16,ci=17,bS=18,b_=19,cd=20,cW=21,ck=22,ch=23,b0=24,ca=25,cj=26,cU=27,cf=28,bT=29,cO=30,cV=31,cE=32,cn=33,cG=34,cp=35,cF=36,co=37,cm=38,bH=39,bY=40,bZ=41,b$=42,bQ=43,bR=44,cD=45,cC=46,bV=47,ce=49,bU=50,cg=51,cc=52,ct=53,cs=54,bL=55,b1=56,cK=57,cL=58,cb=59,bP=60,cz=61,bM=62,cJ=63,b3=64,cy=65,bW=66,b4=67,cx=68,b7=69,b5=70,b8=71,b9=72,cI=73,cP=74,cR=75,bX=76,cS=77,(bt=new jT).Images=k.arraymake(164,null,4),bt.Images[1]=k.images[7],bt.Images[2]=k.images[8],bt.Images[3]=k.images[9],bt.Images[4]=k.images[8],bt.Lightness=3,(br=new jT).Images=k.arraymake(173,null,4),br.Images[1]=k.images[381],br.Images[2]=k.images[382],br.Images[3]=k.images[383],br.Images[4]=k.images[382],br.Lightness=1,(bq=new jT).Images=k.arraymake(183,null,4),bq.Images[1]=k.images[385],bq.Images[2]=k.images[386],bq.Images[3]=k.images[387],bq.Images[4]=k.images[386],bq.images_hp_low=k.arraymake(190,null,4),bq.images_hp_low[1]=k.images[388],bq.images_hp_low[2]=k.images[389],bq.images_hp_low[3]=k.images[390],bq.images_hp_low[4]=k.images[388],bq.Lightness=2,(bs=new jT).Images=k.arraymake(200,null,4),bs.Images[1]=k.images[62],bs.Images[2]=k.images[61],bs.Images[3]=k.images[60],bs.Images[4]=k.images[61],bs.Lightness=0,(a0=k.arraymake(208,null,4))[1]=k.images[10],a0[2]=k.images[67],a0[3]=k.images[68],a0[4]=k.images[384],a=null,(a=new jN).Name="Default",a.Grid_X=0,a.Grid_Y=0,a.Head_Y=3,(a=new jN).Name="Curls",a.Id=1,a.Grid_X=1,a.Grid_Y=0,a.Head_Y=3,(a=new jN).Name="Timmy",a.Id=2,a.Grid_X=2,a.Grid_Y=0,a.Head_Y=2,(a=new jN).Name="Basic",a.Id=3,a.Grid_X=3,a.Grid_Y=0,a.Head_Y=1,(a=new jN).Name="Round",a.Id=4,a.Grid_X=4,a.Grid_Y=0,a.Head_Y=2,(a=new jN).Name="Square",a.Id=5,a.Grid_X=5,a.Grid_Y=0,a.Head_Y=2,(a=new jN).Name="Parens",a.Id=6,a.Grid_X=6,a.Grid_Y=0,a.Head_Y=-1,(a=new jN).Name="Curl",a.Id=7,a.Grid_X=7,a.Grid_Y=0,a.Head_Y=0,(a=new jN).Id=8,a.Name="Riverdance",a.Grid_X=8,a.Grid_Y=0,a.Head_Y=0,(a=new jN).Name="Shy",a.Id=9,a.Grid_X=0,a.Grid_Y=1,a.Head_Y=3,(a=new jN).Name="Bling",a.Id=10,a.Grid_X=1,a.Grid_Y=1,a.Head_Y=0,(a=new jN).Name="Gogo",a.Id=11,a.Grid_X=2,a.Grid_Y=1,a.Head_Y=-2,(a=new jN).Name="Hoodie",a.Id=12,a.Grid_X=3,a.Grid_Y=1,a.Head_X=2,a.Head_Y=-1,(a=new jN).Name="Flower",a.Id=13,a.Grid_X=4,a.Grid_Y=1,a.Head_Y=1,(a=new jN).Name="Buzz",a.Id=14,a.Grid_X=5,a.Grid_Y=1,a.Head_Y=0,(a=new jN).Name="Sad",a.Id=15,a.Grid_X=6,a.Grid_Y=1,a.Head_Y=1,(a=new jN).Name="Babydoll",a.Id=16,a.Grid_X=7,a.Grid_Y=1,a.Head_Y=1,(a=new jN).Name="Stash",a.Id=17,a.Grid_X=8,a.Grid_Y=1,a.Head_Y=-1,(a=new jN).Name="Emo",a.Id=18,a.Grid_X=9,a.Grid_Y=1,a.Head_Y=0,(a=new jN).Name="VN",a.Id=32,a.Grid_X=8,a.Grid_Y=3,a.Head_Y=-2,a.Cost=9999999,(a=new jN).Name="Brave",a.Id=33,a.Grid_X=4,a.Grid_Y=2,a.Head_X=2,a.Head_Y=-1,a.Cost=0,(a=new jN).Name="Glumplich",a.Id=31,a.Grid_X=9,a.Grid_Y=0,a.Head_Y=3,a.Cost=0,(a=new jN).Name="TeddyApe",a.Id=19,a.Grid_X=2,a.Grid_Y=2,a.Head_Y=1,a.Cost=8e3,(a=new jN).Name="Dog",a.Id=20,a.Grid_X=1,a.Grid_Y=2,a.Head_Y=1,a.Cost=8e3,(a=new jN).Name="Genie",a.Id=34,a.Grid_X=5,a.Grid_Y=2,a.Head_X=1,a.Head_Y=0,a.Cost=8e3,(a=new jN).Name="Trump",a.Id=21,a.Grid_X=3,a.Grid_Y=2,a.Head_Y=3,a.Cost=8e3,(a=new jN).Name="Missy",a.Id=22,a.Grid_X=0,a.Grid_Y=2,a.Head_Y=6,a.Cost=8e3,(a=new jN).Name="Knight",a.Id=23,a.Grid_X=0,a.Grid_Y=3,a.Head_Y=1,a.Cost=8e3,(a=new jN).Name="Santa",a.Id=24,a.Grid_X=1,a.Grid_Y=3,a.Head_Y=3,a.Cost=8e3,(a=new jN).Name="Alien",a.Id=25,a.Grid_X=2,a.Grid_Y=3,a.Head_Y=3,a.Cost=8e3,(a=new jN).Name="Snowboy",a.Id=26,a.Grid_X=3,a.Grid_Y=3,a.Head_Y=0,a.Cost=8e3,(a=new jN).Name="Vampire",a.Id=27,a.Grid_X=4,a.Grid_Y=3,a.Head_Y=0,a.Cost=8e3,(a=new jN).Name="Skull",a.Id=28,a.Grid_X=5,a.Grid_Y=3,a.Head_Y=-1,a.Cost=8e3,(a=new jN).Name="Priya",a.Id=29,a.Grid_X=6,a.Grid_Y=3,a.Head_Y=2,a.Cost=9999999,(a=new jN).Name="Curtis",a.Id=30,a.Grid_X=7,a.Grid_Y=3,a.Head_Y=-1,a.Cost=9999999,bF=.7,ir(),dj=di=k.arraymake(218,null,255),iq(),di=k.arraymake(221,null,255),ip(),b=1,es=k.arraymake(224,null,4);b<=4;b++)es[b]=new c;for(eq=63,dQ=6,dR=6,dP=k.arraymake(233,null,dQ,dR+1),function(){var b=0,a=null,c=0,d=0;for(dJ=k.arraymake(0,null,9),(a=new e).Name="Island",a.Is_water_level=!0,a.Health_max_start=5,a.Goal_gold=1e3,a.Goal_text_for_menu="Ballistas on the sides",a.Goal_Number_1=2,a.Goal_Number_2=3,a.Goal_Number_3=4,a.Goal_Text_1="I need bronze ballistas on/the sides to defend the/weaker parts.",a.Goal_Text_2="I need silver ballistas on/the sides to defend the/weaker parts.",a.Goal_Text_3="I need gold ballistas on/the sides to defend the/weaker parts.",a.Goal_Text_Did_2="Next I will need those/ballistas upgraded to silver.",a.Goal_Text_Did_3="Next I will need those/ballistas upgraded to gold.",dJ[2]=a,dB=a,(a=new e).Name="Forest",a.Is_water_level=!0,a.Health_max_start=5,a.Goal_gold=1e3,a.Goal_Number_1=10,a.Goal_Number_2=20,a.Goal_Number_3=30,a.Goal_number_4=40,a.Goal_number_5=50,a.Goal_text_for_menu="Defeat the mother dragon",a.Goal_Text_1="The mother of dragons is/coming in @= days!/You must prepare defenses!",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_text_4=a.Goal_Text_1,a.Goal_text_5=a.Goal_Text_1,a.Goal_Text_Did_2="A stronger mother dragon/is coming on day @=!",a.Goal_Text_Did_3=a.Goal_Text_Did_2,a.Goal_text_did_4="Final mother dragon/is coming on day @=!",a.Goal_text_did_5="All the green dragons/are defeated!/What's next?",dJ[1]=a,dy=a,(a=new e).Name="Four",a.Health_max_start=5,a.Goal_gold=1e3,a.Is_water_level=!0,a.Goal_text_for_menu="Make = match-4's",a.Goal_Text_1="At castle four we want to/see a match-4 = times.",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_text_4=a.Goal_Text_1,a.Goal_text_5=a.Goal_Text_1,a.Goal_Text_Did_2="Now we want to see a/match-4 = times.",a.Goal_Text_Did_3=a.Goal_Text_Did_2,a.Goal_Number_1=20,a.Goal_Number_2=50,a.Goal_Number_3=100,a.Goal_number_4=250,a.Goal_number_5=999,dJ[4]=a,dz=a,(a=new e).Name="Damaged",a.Is_water_level=!0,a.Health_max_start=6,a.Goal_gold=1e3,a.Goal_text_for_menu="Repair the castle fully",a.Goal_Text_1="Drag stone up to the castle/to repair it 1 heart until/full and I will reward you!",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_Text_Did_2="Now the castle can hold more/stone. Repair it more.",a.Goal_text_did_SE_2="The castle can hold more/stone. Repair it more.",a.Goal_Text_Did_3=a.Goal_Text_Did_2,dJ[3]=a,dx=a,(a=new e).Name="Isle",a.Is_water_level=!0,a.Health_max_start=5,a.Goal_gold=1e3,a.Goal_text_for_menu="Expand the ground",a.Goal_Number_1=1,a.Goal_Number_2=2,a.Goal_Number_3=3,a.Goal_Text_1="Drag dirt down into the/water to expand the ground/for more land to work with.",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_Text_Did_2="The dirt has settled. Now/there is more shallow water.",a.Goal_Text_Did_3=a.Goal_Text_Did_2,dJ[5]=a,dC=a,(a=new e).Name="Isle",a.Is_water_level=!0,a.Health_max_start=5,a.Goal_gold=1e3,a.Goal_text_for_menu="Arm the castle",a.Goal_Number_1=2,a.Goal_Number_2=3,a.Goal_Number_3=4,a.Goal_Text_1="Arm the castle towers/to get double range.",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_Text_Did_2="Next I will need those/towers upgraded to silver.",a.Goal_Text_Did_3="Next I will need those/towers upgraded to gold.",dJ[6]=a,dD=a,(a=new e).Name="Cannons",a.Health_max_start=5,a.Goal_gold=500,a.Goal_text_for_menu="Cannon slots",a.Goal_Text_1="Only cannons can go here",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Is_water_level=!0,dJ[7]=a,dn=a,(a=new e).Name="Bonus",a.Health_max_start=5,a.Goal_gold=500,a.Goal_text_for_menu="Match 4 all you can",a.Goal_Text_1="Bonus level!/Build all you can in 1 /@day for a high score*",a.Goal_Text_2="Here you get a bonus swap&/for each extra thing in a/match-4.",a.Goal_Text_3=a.Goal_Text_1,a.Is_water_level=!0,dJ[8]=a,dl=a,(a=new e).Name="Road",a.Health_max_start=5,a.Goal_gold=1e3,a.Goal_Number_1=10,a.Goal_Number_2=20,a.Goal_Number_3=30,a.Goal_number_4=40,a.Goal_number_5=50,a.Goal_Text_1="Dragons only fly over/the gold path!",a.Goal_Text_2=a.Goal_Text_1,a.Goal_Text_3=a.Goal_Text_1,a.Goal_text_4=a.Goal_Text_1,a.Goal_text_5=a.Goal_Text_1,a.Goal_Text_Did_2="A stronger mother dragon/is coming on day @=!",a.Goal_Text_Did_3=a.Goal_Text_Did_2,a.Goal_text_did_4="Final mother dragon/is coming on day @=!",a.Goal_text_did_5="All the green dragons/are defeated!/What's next?",a.Is_water_level=!0,dJ[9]=a,dF=a,c=3,a.Road=k.arraymake(216,!1,6,6);c<=4;c++)for(d=1;d<=6;d++)a.Road[c][d]=!0;for(b=1;b<=k.arraylengthget(dJ);b++)dJ[b].Index=b,(a=dJ[b]).Scores=null;hd(dy)}(),g0(ch),hd(dy),h7(),g0(cl),eK=k.arraymake(246,0,99),b=1;b<=k.arraylengthget(eK);b++)eK[b]=k.random();ai=30,gf=jL(),k.imageoffsetset(k.images[201],k.imagesizexget(k.images[201])/2,k.imagesizeyget(k.images[201])/2),k.imageoffsetset(k.images[188],k.imagesizexget(k.images[188])/2,k.imagesizeyget(k.images[188])/2),k.imageoffsetset(k.images[278],k.imagesizexget(k.images[278])/2,k.imagesizeyget(k.images[278])/2),k.imageoffsetset(k.images[109],k.imagesizexget(k.images[109])/2,k.imagesizeyget(k.images[109])/2),k.imageoffsetset(k.images[99],2,17),k.imageoffsetset(k.images[75],k.imagesizexget(k.images[75])/2,k.imagesizeyget(k.images[75])/2),bB=!0,0>=hm("userisoffline")&&(hm("userid")>0&&""!=hn("token")?fC=gp("tokencheck.php?",!1):jg()),ia(1,"tilekindtutorialdid"+fx.id),a$=k.arraymake(271,0,4),k.imageoffsetset(k.images[338],0,2),k.imageoffsetset(k.images[403],11,11),k.imageoffsetset(k.images[404],11,11),fT=gt(0),k.debugset("whenapploaded")}function hL(){k.debugset("ad loading state="+w),fG==bG&&((bG==cG||bG==cp||bG==co||bG==cF||bG==cD||bG==cD)&&(ja(),jc(Y,Z,X,W)&&(e3=!0)),bG==bZ&&(ja(),jc(Y,Z,X,W)&&(e3=!0)),bG==bY&&(ja(),jc(Y,Z,X,W)&&(g0(bZ),e3=!0)))}function hM(){if(k.mouseclickedany&&(aZ=!0),k.mousehitany&&(aY=!0),k.mousereleasedany&&(fD=!0),eX+=k.mousewheelspeed,e4=k.loops-e5,e6=k.loops-e7,k.keyhit[27]&&(c4=!0),k.keyreleased[13]&&(c3=!0),k.mousehitany&&jb(),k.mousedownany&&ja(),fF+=fE,bG!=bK&&((bG==cQ||bG==cO)&&(k.mousereleasedany&&(i9(),ff=null),k.mousedownany)&&(f=0,g=0,null!=ff&&((Math.abs(f=fJ-fH)>Math.abs(g=fL-fI)||1==fc)&&2!=fc?(e9=0,e8=f>0?1:-1):(e8=0,e9=g>0?1:-1),null!=fg&&fg._Pixel_Position_Reset(),null!=(fg=iT(ff.Grid_x+e8,ff.Grid_y+e9))&&iU(ff.Grid_x,ff.Grid_y)&&(iU(fg.Grid_x,fg.Grid_y)||fg.Kind==fm||(fg=null)),ff._Pixel_Position_Reset(),0!=e8?(bf=fJ-fH,bf=k.clamp(bf,0-fA,fA),ff.Pixel_x+=bf,null==fg||fg.Kind==fu||fg.Kind==fl||fg.Kind==fn||iU(fg.Grid_x,fg.Grid_y)&&ff.Kind!=fm||(fg.Pixel_x-=bf,fg.Kind!=ff.Kind||ff.Tier_Index!=fg.Tier_Index||(fg.Pixel_x+=.9*bf))):(bf=fL-fI,bf=k.clamp(bf,0-fA,fA),ff.Pixel_y+=bf,null==fg||fg.Kind==fu||fg.Kind==fl||fg.Kind==fn||iU(fg.Grid_x,fg.Grid_y)&&ff.Kind!=fm||(fg.Pixel_y-=bf,fg.Kind!=ff.Kind||ff.Tier_Index!=fg.Tier_Index||(fg.Pixel_y+=.9*bf))),Math.abs(bf)>fA/2?(eg||(ix(k.sounds[6]),eg=!0),fc<=0&&(fc=0!=e8?1:2,k.debugset(""+fc))):(fc>0&&(fc=0,k.debugset(""+fc)),eg=!1))),k.resized&&il(),bG!=cl)){if(bG!=bK&&"loading"!=w&&"loaded"!=w&&hm("musicvolume")>0&&(k.soundplaying(d4)||d4!=k.sounds[8]&&k.soundloop(d4),d4.volume<hm("musicvolume")&&k.soundvolumeset(d4,d4.volume+.05),bC&&(dc?d2.volume>.05&&k.soundvolumeset(d2,d2.volume-.05):d3.volume>.05&&k.soundvolumeset(d3,d3.volume-.05))),bC){if(k.resized&&i2(),!function(){var d=0,g=0,b=!1,a=null;for(d=1,b=!0;d<=dQ;d++)null!=(a=aw[d])&&a._Update6();for(var c=L.first;c;){if((a=c.val).Kind==ft){c=c.next;continue}bG==b6&&(a.Removed&&null!=a.Match_join_tile&&a.Match_join_tile!=a?(a.Pixel_x=k.moveto(a.Pixel_x,a.Match_join_tile.Pixel_x,.1*Math.abs(a.Pixel_x-a.Match_join_tile.Pixel_x)+.02*fA),g=.08,a.Pixel_y>a.Match_join_tile.Pixel_y&&(g/=2),a.Pixel_y=k.moveto(a.Pixel_y,a.Match_join_tile.Pixel_y,Math.abs(a.Pixel_y-a.Match_join_tile.Pixel_y)*g+.06*fA),Math.abs(a.Pixel_x-a.Match_join_tile.Pixel_x)>.03*fA||Math.abs(a.Pixel_y-a.Match_join_tile.Pixel_y)>.03*fA?b=!1:(a.Match_join_tile.Upgraded||a.Match_join_tile._Upgrade(),a._Delete2())):(a.Removed&&a.Dragged_off_edge_time>0&&(k.loops-a.Dragged_off_edge_time>30?a._Delete2():(a.Pixel_y+=1,b=!1)),a.Pixel_y<a._Pixel_Target_Y_Get()&&(a.Pixel_y=k.moveto(a.Pixel_y,a._Pixel_Target_Y_Get(),.05*fA),b=!1))),bG==bO&&a.Removed&&(a.Blink<1?(dU<999?a.Blink+=.05:a.Blink+=.025,b=!1):a.Blink=1),bG==b0&&k.loops-e5<60&&(b=!1),a._Update6(),c=c.next}if(b&&bG!=bJ&&bG!=cQ){if(bG==b6){if(dE==dz&&dA<5&&dT>=dE._Goal_Number_Next_Get()){gi(dE.Index);return}if(function(){var a=0,b=0,c=null;if(dE==dC&&dA<3){b=dR;for(var d=0;b>1;){if(d++ >999999)throw{line:5,message:"Infinite While Loop"};if((c=dP[1][b]).Kind!=ft)break;if(c.Water_depth<9)return;b-=1}for(a=1;a<=dQ;a++)if((c=dP[a][b]).Kind==ft)return;if((b+=1)<=dR)for(a=1;a<=dQ;a++)(c=dP[a][b]).Water_depth=1}}(),function(){var a=0,b=0,c=0;if(dE==dC&&dA<3){for(a=1,c=dR-3+dE._Goal_Number_Next_Get();a<=dQ;a++)for(b=c;b<=c;b++)if(dP[a][b].Kind==ft)return;gi(dE.Index)}}(),bG!=b6)return;for(var e=L.first;e;)(a=e.val).Match_join_tile==a&&a._Upgrade(),a.Removed&&a._Delete2(),a.Upgraded=!1,e=e.next;bG==b6&&(g0(cQ),iZ(),bG==cQ&&(gw(),ji()))}else bG==bO&&(i0(),bG!=bI&&(i3(),g0(b6)));if(bG==b0){for(var f=L.first;f;)(a=f.val).Destroyed&&(a.Removed=!0),f=f.next;i3()}fd=null,fe=null}}(),bG==cT)for(var f,g,h,b,a,c=G.first;c;)(0,c.val)._Update2(),c=c.next;if(bG==cT||bG==cQ||bG==cM)for(var d=I.first;d;)(0,d.val)._Update3(),d=d.next;bG==cL&&iA(),bG==cI&&i5(),b=null,null!=dK&&d9&&(0==hm("userid")?""!=k.ajaxresponseget(4,dK)&&(k.debugset("levelstart requestfinish offline response"+k.ajaxresponseget(5,dK)),b=k.split(k.ajaxresponseget(6,dK),","),k.arraylengthget(b)>=3&&"good"==b[1]?(ia(1,"userisoffline"),ia(1*b[2]||0,"userid"),ib(b[3],"token")):k.debugset("ERROR levelstart bad response"),dK=null):dK=null),hQ()&&(a=null,null!=dH&&""!=k.ajaxresponseget(0,dH)&&(a=k.split(k.ajaxresponseget(1,dH),","),k.arraylengthget(a)>=3&&"good"==a[1]||d9||eh||("challenge over"==a[2]?(bD=!1,g0(cq)):"wrong token"==a[2]?(jg(),g0(cp),bD=!1):(ei=a[2],eh=!0,k.debugset("Playing disconnected now because levelday said "+ei),bN=bG,g0(b3))),dH=null))}ej>0&&(ej-=1)<=0&&k.debugset("notiask");for(var e=D.first;e;)(0,e.val)._Update(),e=e.next;iF(),iG(),iE(),ed=c$,ec=a6,ee=ap}}function hN(){"ios"==ef?k.browseropen("https://apps.apple.com/app/id1463356368"):"android"==ef?k.browseropen("https://play.google.com/store/apps/details?id=com.curtastic.towerswap"):k.browseropen("https://towerswap.app")}function hO(){var a=0;hw(300,222,.4,111+hV(),!0),iJ("Change Your Password",dW/2,a+=25,14,!0,!1),a+=37,bm?(iJ("We will send you an",dW/2,a+=8,14,!0,!1),iJ("email where you can",dW/2,a+=27,14,!0,!1),iJ("set a new password.",dW/2,a+=27,14,!0,!1),a+=29,cH>0?(iJ("Sent!",dW/2,a+11,14,!0,!1),hv(0,0)&&hA()):(null!=f9&&(hp(dW/2-9,a-16),k.cursorset(36,"wait")),gB("Send",dW/2,a,!0,!0,!1,null!=f9,!1,!1),af?jB():hv(0,0)?(f9=null,hA()):null!=f9&&jA())):(iJ("You must first confirm",dW/2,a+=11,14,!0,!1),iJ("your email address.",dW/2,a+=27,14,!0,!1),gB("Okay",dW/2,a+=35,!0,!0,!1,!1,!1,!1),af?g0(b4):hv(0,0)&&hA())}function hP(){var a=0,b=0;k.offsetset(0,0),gB("",a=10,b=5+c0,!1,!1,!0,!1,!0,!1),k.imagedrawgl(k.images[194],a+3,b+ae+4),H.total>0&&gV(a+22,b+ae-1),(c4||af)&&(c4=!1,bN=bG,g0(cq),iy()),dE!=dy&&(gd.end_time>0?iH(i7(gd.end_time-new Date().getTime(),!1,!1,"",!1,!1),a+0,b+41,14,!1):iH(i7(0,!1,!1,"",!1,!1),a+0,b+41,14,!1))}function hQ(){return bG==bO||bG==b6||bG==cr||bG==cQ||bG==b1||bG==cT||bG==ca||bG==cN||bG==cN||bG==cb}function hR(){var d=!1,e=0,b=0,f=0,c=0,a=0;if(b=260,f=(e=250)-49,hw(b,e,.4,0,!0),iJ("Paused",b/2,(a=15)+15,14,!0,!1),iJ("Current score: *"+(a6+1e3*dA),b/2,a+54,14,!0,!1),a+=22,""==fZ&&!bD&&(a=f,d9?(iJ("Log in to get rewards!",b/2,a-26,14,!0,!1),gB("Log In",b/2-60,a,!1,!0,!1,!1,!1,!1),af&&(iy(),g0(bS))):!f_&&(gB("Join Clan",b/2-60,a,!1,!0,!1,!1,!1,!1),af&&(iy(),g0(bY)))),a+=10,c=b/2,a=103,k.imagedrawgl(k.images[73],c-(5+(k.imagesizexget(k.images[97])/2-k.imagesizexget(k.images[73]))),a+6),gB("Settings",c,a,!1,!0,!1,!1,!1,!1),H.total>0&&gV(c+35,a-2+ae),af&&(g0(cB),iy()),a=149,gB("Undo Swap",c=b/2,a,!1,!0,!1,!(d=null!=fR&&(bN==cQ||bN==ca)),!1,!1),d&&af){iy(),bN=cQ,hS(),k.offsetset(0,0),ff=fR,fg=fS,dc&&(bG=ca,jf()),g0(cI);return}if(a=193,gB("Quit",c=b/2,a,!1,!0,!1,!1,!1,!1),af){iy(),g0(cw);return}hv(0,0)&&fL<eU-eq&&(c4=!1,hS()),k.offsetset(0,0)}function hS(){ix(k.sounds[30]),g0(bN),bG==cQ&&(iZ(),a7=60,e5=k.loops)}function hT(){return"ios"==ef&&eW/eU<.47?10:0}function hU(){return hT()+hV()}function hV(){return"ios"==ef?eW/eU<.47?40:15:0}function hW(){k.cls({r:0,g:0,b:0,a:255}),iy(),d9=!0,jg(),ia(0,"leveltutorialdid1"),hd(dy),hc(!1)}function hX(d,e,b,c,f,g){var a=null;a=k.images[325],1==b&&(a=k.images[325],2==c&&(a=k.images[326])),2==b&&(a=k.images[394],2==c&&(a=k.images[395])),3==b&&(a=k.images[327],2==c&&(a=k.images[328])),4==b&&(a=k.images[329],2==c&&(a=k.images[330])),b>=5&&(a=k.images[418],2==c&&(a=k.images[417])),f&&k.imagergbset(a,{r:188,g:141,b:0,a:255}),k.imagedrawgl(a,d+2,e),f&&k.imagergbset(a,k.colormake(255,255,255,255)),g&&k.imagedrawgl(k.images[318],d+(k.imagesizexget(a)-k.imagesizexget(k.images[318]))/2+2,e+25)}function hY(a){return 1==a?3:2==a?8:3==a||5==a?12:24}function hZ(d,e){var a=0,b=0,c=0;a=k.mod(Math.floor(k.loops/60),8),b=d,c=e,0==a?k.imagedrawgl(k.images[244],b-14,c+18):1==a||7==a?k.imagedrawgl(k.images[246],b-14,c+18):2==a||6==a?k.imagedrawgl(k.images[247],b-14,c+18):3==a||5==a?k.imagedrawgl(k.images[246],b-14,c+(18+k.imagesizeyget(k.images[244])),k.imagesizexget(k.images[244]),0-k.imagesizeyget(k.images[244])):4==a&&k.imagedrawgl(k.images[244],b-14,c+(18+k.imagesizeyget(k.images[244])),k.imagesizexget(k.images[244]),0-k.imagesizeyget(k.images[244]))}function h$(){var d=null,e=null,f=0,c=0,a=0,g=0,h=0,i=0,b=0;if(d=es[em],c=240,aI>0&&(c=237),hw(a=255,c,.4,0,!0),b=24,5==d.Tier?iJ("War prize chest",a/2,b,14,!0,!1):iJ("Day "+(""+d.Day+" prize chest"),a/2,b,14,!0,!1),b+=15,hX((a-k.imagesizexget(k.images[320]))/2,b,d.Tier,1,!1,d._Time_Remaining_Get()>0||0==d.Time_Unlock_Started),aI==em&&hZ(a/2,b+10),b+=59,aI!=em&&iJ(""+d._Hours_Total_Get()+" hours to unlock",a/2,b,14,!0,!1),aI>0){if(b+=4,f=Math.floor((i=(e=es[aI])._Time_Remaining_Get())/60/60),g=Math.floor(k.mod(i/60,60)),h=Math.floor(k.mod(i,60)),aI==em){if(iJ("Unlocking[",a/2,b,14,!0,!1),b+=25,iJ(""+f+":"+(hI(g)+":"+(hI(h)+"")),a/2,b,14,!0,!1),iJ("Pay to finish unlock?",a/2,b+=40,14,!0,!1),b+=20,gB("~"+e._Unlock_cost_get(),a/2,b,!1,!0,!1,c$<e._Unlock_cost_get(),!1,!1),af){g0(cv),e._Open(!0),k.offsetset(0,0);return}}else iJ("Another chest is",a/2,c-92,14,!0,!1),iJ("being unlocked now.",a/2,c-70,14,!0,!1),iJ(""+f+":"+(hI(g)+":"+(hI(h)+"")),a/2,c-40,14,!0,!1)}else if(iJ("Start unlocking!",a/2,c-70,14,!0,!1),gB("Unlock",a/2,c-50,!1,!0,!1,!1,!1,!1),af){d._Unlock_Start(),g0(cv),k.offsetset(0,0);return}hv(a,c)&&(ix(k.sounds[30]),g0(cv)),k.offsetset(0,0)}function h_(){var a=0,b=null;if(null!=aJ&&""!=k.ajaxresponseget(0,aJ)){if(b=k.split(k.ajaxresponseget(1,aJ),","),aJ=null,k.arraylengthget(b)>=5&&"good"==b[1])for(h2(b[2]),g4(b[3]),ek=0,aE=!1,a=1;a<=k.arraylengthget(es)&&0!=es[a].Day;a++)a==k.arraylengthget(es)&&(ek=eo,aE=!0);else g0(cv)}}function h0(a){return R+(k.imagesizexget(k.images[255])+3)*(a-1)}function h1(){var j,e=0,h=0,n=0,a=null,g=0,l=0,m=0,b=0,f=0,o=0,i="",c=0,d=0;if(!d9&&(!(ea>0)||bG!=cq)&&(!de||bG!=cq)){for(b=4,f=3,h=eq,n=4*k.imagesizexget(k.images[255])+3*f,d=eU-h,d-=hT(),bG==cf&&1==cH&&(d+=k.clamp(h-e6,0,h)),c=(eW-n)/2,er>0&&(c+=2*Math.sin(33*er*k._degreestoradians),er-=1),e=k.imagesizexget(k.images[255])+f,c+=0,k.imagedrawgl(k.images[70],c-k.imagesizexget(k.images[70]),d+(k.imagesizeyget(k.images[255])-k.imagesizeyget(k.images[70]))/2),g2(k.images[70],c+(n-0),d+(k.imagesizeyget(k.images[255])-k.imagesizeyget(k.images[70]))/2),g=1;g<=4;g++)(g>1&&k.imagedrawgl(k.images[245],c-f,d+(k.imagesizeyget(k.images[255])-k.imagesizeyget(k.images[245]))/2,f,k.imagesizeyget(k.images[245])),a=es[g],k.imagedrawgl(k.images[255],c,d),a.Day>0&&g!=ek)?(0==aI&&0==a.Time_Unlock_Started&&null==aK&&(k.colorset({r:160,g:135,b:0,a:255}),k.transparencyset(Math.abs(.8*Math.sin(4*k.loops*k._degreestoradians))),k.rectdraw(c+b,d+b,e-f-2*b,e-f-7-2*b),k.transparencyset(0)),a.Time_Unlock_Started>0&&0>=a._Time_Remaining_Get()?(aI==g&&(aI=0),k.colorset({r:25,g:201,b:0,a:255}),k.transparencyset(Math.abs(.6*Math.sin(4*k.loops*k._degreestoradians))),k.rectdraw(c+b,d+b,e-f-2*b,e-f-7-2*b),k.transparencyset(0),aZ&&fG==bG&&jc(c,d+5,e-b,h-10)&&a._Open(!1)):null!=aK&&aI==g||aZ&&fG==bG&&jc(c,d+5,e-b,h-10)&&(em=g,iy(),g0(bU)),hC(c,d+5,e-b,h-10)&&(null!=aK&&aI==g?k.cursorset(66,"wait"):k.mousedownany&&k.mousemovedget(-1)||k.cursorset(69,"pointer")),aI==g&&(k.colorset({r:152,g:152,b:152,a:255}),k.rectdraw(c+b,d+b,e-f-2*b,e-f-7-2*b)),g==em&&bG==bU&&(k.colorset({r:186,g:198,b:107,a:255}),k.rectdraw(c+b,d+b,e-f-2*b,e-f-7-2*b)),a.X=c+(e-b)/2-k.imagesizexget(k.images[117])/2,aI==g&&ej>22&&(a.X+=1.5*Math.sin(22*ej*k._degreestoradians)),a.Y=d-11,5==a.Tier&&aI!=g&&gJ(c+(e-f)/2-10,d+25,fY,fV,fW,!1,!1,fU,fX),a.Time_Unlock_Started>0&&0>=a._Time_Remaining_Get()&&k.mod(k.loops/(60-9*a.Tier),1)>.5?(hX(a.X,a.Y+2,a.Tier,2,!1,!1),k.imagedrawgl(a0[k.mod(Math.floor(k.loops/5),3)+1],a.X+(k.imagesizexget(k.images[320])-k.imagesizexget(k.images[10]))/2,a.Y+13)):hX(a.X,a.Y+2,a.Tier,1,!1,a._Time_Remaining_Get()>0||0==a.Time_Unlock_Started),aI!=g)?(k.transparencyset(.5),5!=a.Tier&&iH("@"+a.Day,c+(e-f-0*b)/2,d+33,14,!0),k.transparencyset(0)):(l=Math.floor((o=a._Time_Remaining_Get())/60/60),m=Math.floor(k.mod(o/60,60)),k.mod(o,60),l>0&&(i=""+l+"h"),i+=""+m+"m",i=""+l+(":"+hI(m)),30>k.mod(k.loops,60)&&(i=""+l+(" "+hI(m))),null!=aK&&(i=ho(!1),k.cursorset(129,"wait")),iH(i,c+(e-f)/2,d+33,14,!0),hZ(c+(e-b)/2,d+1)):(k.transparencyset(.85),iH("Slot",c+(e-f)/2,d+13,14,!0),iH(""+g,c+(e-f)/2,d+30,14,!0),k.transparencyset(0)),c+=e;j=null,null!=aK&&""!=k.ajaxresponseget(0,aK)&&(j=k.split(k.ajaxresponseget(1,aK),","),aK=null,k.arraylengthget(j)>=2&&"good"==j[1]&&(h2(j[2]),ej=99)),null!=ge&&gd._PrizeChest_getting_draw()}}function h2(i){var c,d,j=null,f=0,g=null,a=null,e=0,b=null,h=null;if(k.debugset("Chests from server text "+i),aI=0,h=k.split(i," "),4!=k.arraylengthget(h)){alert(""+k.arraylengthget(h)+"Chests"+i);return}for(e=1;e<=4;e++){if((a=es[e]).Day=0,a.Tier=0,a.Time_Unlock_Started=0,a.Buildings={total:0,first:null,last:null},b=k.split(h[e],"@"),5>k.arraylengthget(b)){alert("Bad chest info");return}if(a.Day=1*b[1]||0,a.Tier=1*b[2]||0,a.Tier<1&&(a.Tier=1),a.Tier>5&&(a.Tier=1),a.Gold=1*b[3]||0,b[4].length>0)for(f=1,g=k.split(b[4],";");f<=k.arraylengthget(g);f++)(j=new jU).Tile_Kind=iW(k.stringpart(g[f],1,1)),j.Tier=1*k.stringpart(g[f],2,1)||0,k.listpush(34,a.Buildings,j);a.Time_Unlock_Started=1*b[5]||0,a._Time_Remaining_Get()>0&&(aI=e)}c=null,d="",aI>0&&(c=es[aI],d="prize",2==c.Tier&&(d="bronze"),3==c.Tier&&(d="silver"),4==c.Tier&&(d="gold"),k.debugset("notimake;"+(""+c._Time_Remaining_Get()+(";Chest unlock finished!;Open your "+(d+" chest now."))))),gq()}function h3(a){return eK[k.mod(a,k.arraylengthget(eK))+1]}function h4(b){var c=0,a="";return b=Math.abs(b),c=Math.PI*(b+1),a=""+c,a="."+k.stringpart(a,a.length-6,6),1*a||0}function h5(){var a="";a="repairbyad.php?",a+="&day="+a6,a+="&level="+(dE.Index+1),eN=gp(a,!1)}function h6(){var a="";a="repair.php?",a+="&day="+a6,a+="&level="+(dE.Index+1),eM=gp(a,!1)}function h7(){var b=0,a=0;if(k.debugset("reset game"),d7=!1,bC=!1,e$=!1,fR=null,bN=-1,dU=0,bw={total:0,first:null,last:null},L={total:0,first:null,last:null},G={total:0,first:null,last:null},I={total:0,first:null,last:null},D={total:0,first:null,last:null},dQ=6,dR=6,dE==dn&&(dQ=6,dR=6),dE==dx&&(dQ=6,dR=5),dE==dz&&(dQ=6,dR=6),dE==dl&&(dQ=6,dR=6),dE==dD&&(dQ=6,dR=6),dE==dC&&(dQ=6,dR=6),il(),am=k.arraymake(41,0,dQ),aw=k.arraymake(42,null,dQ),ap=dE.Health_max_start,dE!=dx&&(ap+=az),ar=ap,dE==dx)for(ap=1,dE.Health_max_start=12,ar=dE.Health_max_start,dA>0&&(dE.Health_max_start=24),dA>1&&(dE.Health_max_start=36),a=1;a<=dE.Health_max_start-1;a++)(b=a)>k.arraylengthget(am)&&(b=k.randomint(1,k.arraylengthget(am))),am[b]+=1;hD(),a6=1,ax=0,ay=0,Q=0,a9=0,bN=cQ,h9()}function h8(){bC=!1,bN=-1,L={total:0,first:null,last:null},aw=k.arraymake(3,null,dQ),G={total:0,first:null,last:null},I={total:0,first:null,last:null},D={total:0,first:null,last:null},aF=null,il(),ar=ap=dE.Health_max_start,bN=cQ,k.soundstop(d3),k.soundstop(d2),d4=d5,dc=!1,ac=!1}function h9(){var e=null,b=null,d=0,c=0;dE==dy&&0==hm("leveltutorialdid1")&&k.rngsetup(1);for(var f=0;;){if(f++ >999999)throw{line:4,message:"Infinite While Loop"};for(c=1,L={total:0,first:null,last:null};c<=dR;c++)for(d=1;d<=dQ;d++){if(b=new a,dP[d][c]=b,b.Grid_x=d,b.Grid_y=c,b.Water_depth=0,dE==dx&&c<=2)for(var g=0;b.Kind==fv;){if(g++ >999999)throw{line:15,message:"Infinite While Loop"};b._Kind_set_randomly()}dE==dD&&(d+c>10||7-d+c>10)&&(b.Kind=ft,b.Water_depth=9999),dE==dB&&c>3&&(d<2||d>5)&&(b.Kind=ft,b.Water_depth=9999),dE==dz&&c>4&&d<4&&(b.Kind=ft,b.Water_depth=9999),null==dE&&c>5&&(d<2||d>5)&&(b.Kind=ft,b.Water_depth=2),dE==dC&&c>3&&(b.Kind=ft,b.Water_depth=1,c>4&&(b.Water_depth=9999))}if(dE==dx){if((b=dP[3][1]).Kind=fv,iZ(),bG==ch){fQ=b;break}g0(ch)}else if(dE==dC){if((b=dP[2][3]).Kind=fq,iZ(),bG==ch){fQ=b;break}g0(ch)}else if(dE==dz||dE==dl){if(e=fr,dE==dl&&(e=fx),dP[2][3].Kind=fq,dP[4][1].Kind=fq,dP[4][6].Kind=fq,dP[4][3].Kind=fq,dE==dl&&(dP[4][1].Kind=e,dP[4][1].Tier_Index=1,dP[4][2].Tier_Index=1,dP[3][3].Tier_Index=1,dP[4][4].Tier_Index=1,dP[4][5].Tier_Index=1),dP[4][2].Kind=e,dP[3][3].Kind=e,dP[4][4].Kind=e,dP[4][5].Kind=e,iZ(),bG==ch){fQ=dP[3][3];break}g0(ch)}else if(dE==dy&&0==hm("leveltutorialdid1")){if(dP[4][5].Kind=fv,dP[3][4].Kind=fv,dP[4][3].Kind=fv,dP[3][5].Kind=fq,dP[5][5].Kind=fq,dP[3][3].Kind=fy,dP[5][3].Kind=fr,dP[5][4].Kind=fs,dP[4][2].Kind=fr,dP[4][1].Kind=fv,dP[2][4].Kind=fr,dP[4][4].Kind=fs,dP[4][6].Kind=fs,dP[3][1].Kind=fs,iZ(),bG==ch){fQ=dP[3][4];break}g0(ch)}else if(dE==dD){if((b=dP[dQ][1]).Kind=fx,b.Tier_Index=1,(b=dP[1][1]).Kind=fx,b.Tier_Index=1,iZ(),bG==ch){fQ=b;break}g0(ch)}else if(dE==dn){for(c=1,(b=dP[dQ-1][dR]).Kind=fm,b.Tier_Index=1;c<=dR;c++)dP[1][c].Kind=fn,dP[dQ][c].Kind=fn;if(iZ(),bG==ch){fQ=b;break}g0(ch)}else break}du>0&&(gv(dp),a6=dq,ap=ds,dt>0&&(ar=dt),ap>ar&&(ar=ap),d1=dv,a9=dr,!g7()&&gx()!=hm("test2")&&hm("test2")>0&&(hr("boardhack",""+gx()+(" is not "+hm("test2"))+(" board="+gy())),ib("","board"),ib("","test2"),jg(),g0(cp),bD=!1),Q=1,k.debugset("board from level continue seed="+dw),k.rngsetup(dw)),i2()}function ia(a,b){k.localstorageset("m_"+b,""+a)}function ib(a,b){k.localstorageset("m_"+b,a),k.debugset(a+(" as m_"+b))}function ic(){var b=null,f=0,g=0,d=0,c=0,e="",a="";if(g=a6+1e3*dA,e=eQ,d9||(e=hn("screenname")),null!=dE.Scores){for(c=1;c<=k.arraylengthget(dE.Scores);c++)if((b=dE.Scores[c]).Is_my_new_one=!1,b.name==e&&g<=b.score)return;for(c=1;c<=k.arraylengthget(dE.Scores);c++){if(d+=1,b=dE.Scores[c],f<=0&&b.score<=g&&(a=a+(e+"@"+(""+g+("@"+(f=d))))+",",d+=1),b.name==e){d-=1;continue}a=a+(b.name+"@"+(""+b.score+("@"+d)))+","}}f<=0&&(a=a+(e+"@"+(""+g+("@"+(f=d+1))))+","),a=k.stringpart(a,1,a.length-1),dE._Scores_from_text(a),null!=dE.Scores&&((b=dE.Scores[f]).Is_my_new_one=!0),ib(a,"scoreslevel"+dE.Index)}function id(){var a=null;null!=eR&&""!=k.ajaxresponseget(0,eR)&&(a=k.split(k.ajaxresponseget(1,eR),","),k.arraylengthget(a)>=7&&"good"==a[1]?(a6=1*a[5]||0)<=0?g0(cq):(gv(a[3]),i2(),d1=0,d0=0,k.rngsetup(1*a[6]||0),an=1*a[7]||0):g0(cq),eR=null)}function ie(){var a="";a="scoreboardget.php?",bG==bH?(a+="&level=1",a+="&ever=1"):a+="&level="+dE.Index,a+="&screenname="+T,eR=gp(a,!1)}function ig(){var a=0;for(a=1;a<=k.arraylengthget(dJ);a++)dJ[a].Scores=null}function ih(e){var a=null,c=0,b=null,d=null;if(e.length>1)for(c=1,d=k.split(e," "),dE.Scores=k.arraymake(2,null,k.arraylengthget(d));c<=k.arraylengthget(d);c++)a=new jR,b=k.split(d[c],"@"),k.arraylengthget(b)>=3&&(a.name=b[1],a.score=1*b[2]||0,a.Avatar=gt(1*b[3]||0),k.arraylengthget(b)>=4&&(a.Is_other_war_clan="1"==b[4])),a.Rank=c,dE.Scores[c]=a}function ii(){var b=null,f=0,a=null,c=0,d=null,e=null;if(null!=eT&&""!=k.ajaxresponseget(0,eT)){if(a=k.split(k.ajaxresponseget(1,eT),","),k.arraylengthget(a)>=11&&"good"==a[1]){if(eh=!1,(1*a[2]||0)==dE.Index){if(""!=a[3])for(e=k.split(a[3]," "),dE.Scores=k.arraymake(7,null,k.arraylengthget(e)),dE==dy&&(f$=0),c=1;c<=k.arraylengthget(e);c++){if(d=k.split(e[c],"@"),3>k.arraylengthget(d)){(b=new jR).name="Error",b.Avatar=gt(0),dE.Scores=k.arraymake(17,null,1),dE.Scores[1]=b;break}(b=new jR).name=d[1],b.score=1*d[2]||0,b.Rank=c,dE==dy&&b.name==hn("screenname")&&(f$=c),b.Avatar=gt(1*d[3]||0),null==b.Avatar&&alert("db score no avatar"),k.arraylengthget(d)>=4&&(b.Is_other_war_clan="1"==d[4]),dE.Scores[c]=b}else dE.Scores=null;aB=0,aC=null,(f=1*a[6]||0)>0&&(f<=k.arraylengthget(dJ)?(aC=dJ[f],aB=1e3*(1*a[7]||0)):N=!0),hH(a[4]),hE(a[5]),M<(1*a[9]||0)&&(N=!0),c$=1*a[10]||0,ht(a,11)}}else k.arraylengthget(a)>=2&&"wrong token"==a[2]&&(jg(),g0(cp),bD=!1);eT=null}}function ij(){var a="";(dE!=dy||""!=fZ)&&(a="scoresget.php?",a+="&level="+dE.Index,dE!=dy&&(a+="&war=1"),eT=gp(a,!1),eS=new Date().getTime())}function ik(a){k.colorset({r:0,g:0,b:0,a:255}),k.transparencyset(a),k.rectdraw(0,0,eW,eU),k.transparencyset(0)}function il(){var c=0,a=0,e=0,d=0,b=0;fA=48,d=320,e=k.screensizex/k.screensizey,b=454,b=432,a=1.5*fA,c=4*fA,e>d/b?(bE=k.screensizey/b,S=Math.floor(a+k.mod(bE,.5)*(c-a))):(bE=k.screensizex/d,S=a+(k.screensizey/bE-b)/2),S=k.clamp(S,a,c),bE>1&&(bE=Math.floor(2*bE)/2),k.scaleset(bE,bE),e>d/b||(S=a+(k.screensizey/bE-b)/2,S=k.clamp(S,a,c)),k.debugset(""+bE),eW=k.screensizex/bE,eU=k.screensizey/bE,V=fA*dQ,R=Math.floor((eW-V)/2),c0=5+hV()}function im(a){ia(d6=a=k.clamp(a,0,1),"musicvolume"),k.soundvolumeset(d2,d6),k.soundvolumeset(d3,d6),k.soundvolumeset(d5,d6),d6<=0&&(k.soundstop(d2),k.soundstop(d3),k.soundstop(d5))}function io(c){var a=null,b=0;for(ia(e2=c=k.clamp(c,0,1),"soundvolume"),b=1;b<=k.sounds.length;b++)(a=k.sounds[b-1])!=d2&&a!=d5&&a!=d3&&k.soundvolumeset(a,e2);k.soundvolumeset(k.sounds[33],.5*e2)}function ip(){di["0".charCodeAt(0)||0]=k.images[42],di["1".charCodeAt(0)||0]=k.images[43],di["2".charCodeAt(0)||0]=k.images[44],di["3".charCodeAt(0)||0]=k.images[45],di["4".charCodeAt(0)||0]=k.images[46],di["5".charCodeAt(0)||0]=k.images[47],di["6".charCodeAt(0)||0]=k.images[48],di["7".charCodeAt(0)||0]=k.images[49],di["8".charCodeAt(0)||0]=k.images[50],di["9".charCodeAt(0)||0]=k.images[51],di["A".charCodeAt(0)||0]=k.images[16],di["B".charCodeAt(0)||0]=k.images[17],di["C".charCodeAt(0)||0]=k.images[18],di["D".charCodeAt(0)||0]=k.images[19],di["E".charCodeAt(0)||0]=k.images[20],di["F".charCodeAt(0)||0]=k.images[21],di["G".charCodeAt(0)||0]=k.images[22],di["H".charCodeAt(0)||0]=k.images[23],di["I".charCodeAt(0)||0]=k.images[24],di["J".charCodeAt(0)||0]=k.images[25],di["K".charCodeAt(0)||0]=k.images[26],di["L".charCodeAt(0)||0]=k.images[27],di["M".charCodeAt(0)||0]=k.images[28],di["N".charCodeAt(0)||0]=k.images[29],di["O".charCodeAt(0)||0]=k.images[30],di["P".charCodeAt(0)||0]=k.images[31],di["Q".charCodeAt(0)||0]=k.images[32],di["R".charCodeAt(0)||0]=k.images[33],di["S".charCodeAt(0)||0]=k.images[34],di["T".charCodeAt(0)||0]=k.images[35],di["U".charCodeAt(0)||0]=k.images[36],di["V".charCodeAt(0)||0]=k.images[37],di["W".charCodeAt(0)||0]=k.images[38],di["X".charCodeAt(0)||0]=k.images[39],di["Y".charCodeAt(0)||0]=k.images[40],di["Z".charCodeAt(0)||0]=k.images[41],di["!".charCodeAt(0)||0]=k.images[52],di["?".charCodeAt(0)||0]=k.images[53],di[".".charCodeAt(0)||0]=k.images[54],di["+".charCodeAt(0)||0]=k.images[55],di[":".charCodeAt(0)||0]=k.images[54],di["/".charCodeAt(0)||0]=k.images[108],di["$".charCodeAt(0)||0]=k.images[195],di["<".charCodeAt(0)||0]=k.images[75],di[">".charCodeAt(0)||0]=k.images[75],di["]".charCodeAt(0)||0]=k.images[410],di["}".charCodeAt(0)||0]=k.images[365],di["-".charCodeAt(0)||0]=k.images[196],di["'".charCodeAt(0)||0]=k.images[198]}function iq(){di["0".charCodeAt(0)||0]=k.images[145],di["1".charCodeAt(0)||0]=k.images[146],di["2".charCodeAt(0)||0]=k.images[147],di["3".charCodeAt(0)||0]=k.images[148],di["4".charCodeAt(0)||0]=k.images[149],di["5".charCodeAt(0)||0]=k.images[150],di["6".charCodeAt(0)||0]=k.images[151],di["7".charCodeAt(0)||0]=k.images[152],di["8".charCodeAt(0)||0]=k.images[153],di["9".charCodeAt(0)||0]=k.images[154],di["a".charCodeAt(0)||0]=k.images[119],di["b".charCodeAt(0)||0]=k.images[120],di["c".charCodeAt(0)||0]=k.images[121],di["d".charCodeAt(0)||0]=k.images[122],di["e".charCodeAt(0)||0]=k.images[123],di["f".charCodeAt(0)||0]=k.images[124],di["g".charCodeAt(0)||0]=k.images[125],di["h".charCodeAt(0)||0]=k.images[126],di["i".charCodeAt(0)||0]=k.images[127],di["j".charCodeAt(0)||0]=k.images[128],di["k".charCodeAt(0)||0]=k.images[129],di["l".charCodeAt(0)||0]=k.images[130],di["m".charCodeAt(0)||0]=k.images[131],di["n".charCodeAt(0)||0]=k.images[132],di["o".charCodeAt(0)||0]=k.images[133],di["p".charCodeAt(0)||0]=k.images[134],di["q".charCodeAt(0)||0]=k.images[135],di["r".charCodeAt(0)||0]=k.images[136],di["s".charCodeAt(0)||0]=k.images[137],di["t".charCodeAt(0)||0]=k.images[138],di["u".charCodeAt(0)||0]=k.images[139],di["v".charCodeAt(0)||0]=k.images[140],di["w".charCodeAt(0)||0]=k.images[141],di["x".charCodeAt(0)||0]=k.images[142],di["y".charCodeAt(0)||0]=k.images[143],di["z".charCodeAt(0)||0]=k.images[144],di["A".charCodeAt(0)||0]=k.images[158],di["B".charCodeAt(0)||0]=k.images[159],di["C".charCodeAt(0)||0]=k.images[160],di["D".charCodeAt(0)||0]=k.images[161],di["E".charCodeAt(0)||0]=k.images[162],di["F".charCodeAt(0)||0]=k.images[163],di["G".charCodeAt(0)||0]=k.images[164],di["H".charCodeAt(0)||0]=k.images[165],di["I".charCodeAt(0)||0]=k.images[166],di["J".charCodeAt(0)||0]=k.images[167],di["K".charCodeAt(0)||0]=k.images[168],di["L".charCodeAt(0)||0]=k.images[169],di["M".charCodeAt(0)||0]=k.images[170],di["N".charCodeAt(0)||0]=k.images[171],di["O".charCodeAt(0)||0]=k.images[172],di["P".charCodeAt(0)||0]=k.images[173],di["Q".charCodeAt(0)||0]=k.images[174],di["R".charCodeAt(0)||0]=k.images[175],di["S".charCodeAt(0)||0]=k.images[176],di["T".charCodeAt(0)||0]=k.images[177],di["U".charCodeAt(0)||0]=k.images[178],di["V".charCodeAt(0)||0]=k.images[179],di["W".charCodeAt(0)||0]=k.images[180],di["X".charCodeAt(0)||0]=k.images[181],di["Y".charCodeAt(0)||0]=k.images[182],di["Z".charCodeAt(0)||0]=k.images[183],di["!".charCodeAt(0)||0]=k.images[157],di["?".charCodeAt(0)||0]=k.images[213],di[".".charCodeAt(0)||0]=k.images[155],di[",".charCodeAt(0)||0]=k.images[306],di["+".charCodeAt(0)||0]=k.images[55],di[":".charCodeAt(0)||0]=k.images[155],di["/".charCodeAt(0)||0]=k.images[156],di["-".charCodeAt(0)||0]=k.images[197],di["~".charCodeAt(0)||0]=k.images[10],di["@".charCodeAt(0)||0]=k.images[102],di["^".charCodeAt(0)||0]=k.images[203],di["*".charCodeAt(0)||0]=k.images[100],di["]".charCodeAt(0)||0]=k.images[410],di[39]=k.images[190]}function ir(){var a=0,b=null;K={total:0,first:null,last:null},(ft=new g).Name="Water",ft.id="o",ft.Image=k.images[106],ft.Unmovable=!0,(fl=new g).Name="Anvil",fl.id="a",fl.Image=k.images[116],fl.X_offset=10,fl.Y_Offset=-5,(fn=new g).Name="Cannon slot",fn.id="C",fn.Image=k.images[375],fn.X_offset=-1,fn.Y_Offset=-3,fn.Unmovable=!0,(fw=new g).Name="TNT",fw.id="T",fw.Image=k.images[367],fw.X_offset=10,fw.Y_Offset=-4,(fu=new g).Name="Mirror",fu.id="m",fu.Image=k.images[357],fu.Y_Offset=25,(fy=new g).Name="Wood",fy.id="l",fy.Image=k.images[347],(fo=new g).Name="Ballista",fo.id="b",fo.Image=k.images[419],fo.X_offset=-1,fo.Level_Images=k.arraymake(58,null,4),fo.Projectile_Images=k.arraymake(59,null,4),fo.Projectile_Images[1]=k.images[2],fo.Projectile_Images[2]=k.images[58],fo.Projectile_Images[3]=k.images[59],fo.Projectile_Images[4]=k.images[273],fo.Level_Images[1]=k.images[419],fo.Level_Images[2]=k.images[422],fo.Level_Images[3]=k.images[424],fo.Level_Images[4]=k.images[426],fo.Projectile_Image=k.images[2],fo.Projectile_size=1,fo.Damage=6,fo.Reload_delay=196,fo.Upgraded_version=fo,fo.Shoot_Sound=k.sounds[4],fy.Upgraded_version=fo,(fv=new g).Name="Stone",fv.id="s",fv.Image=k.images[311],(fx=new g).Name="Arrow tower",fx.id="t",fx.Image=k.images[191],fx.Projectile_Images=k.arraymake(89,null,4),fx.Level_Images=k.arraymake(90,null,4),fx.Level_Images[1]=k.images[191],fx.Projectile_Images[1]=k.images[0],fx.Level_Images[2]=k.images[322],fx.Projectile_Images[2]=k.images[110],fx.Level_Images[3]=k.images[69],fx.Projectile_Images[3]=k.images[56],fx.Level_Images[4]=k.images[3],fx.Projectile_Images[4]=k.images[111],(fP=k.arraymake(101,null,4,4))[2][1]=k.images[265],fP[2][2]=k.images[266],fP[2][3]=k.images[267],fP[2][4]=k.images[268],fP[3][1]=k.images[269],fP[3][2]=k.images[270],fP[3][3]=k.images[271],fP[3][4]=k.images[272],fx.Projectile_Image=k.images[0],fx.Projectile_size=.4,fx.Damage=3,fx.Reload_delay=55,fx.X_offset=2,fx.Y_Offset=25,fx.Upgraded_version=fx,fx.Shoot_Sound=k.sounds[1],fv.Upgraded_version=fx,(fs=new g).Name="Iron",fs.id="i",fs.Image=k.images[331],(fm=new g).Name="Cannon",fm.id="c",aj=6,al=3,ak=3,fm.Level_Images=k.arraymake(137,null,4),fm.Projectile_Images=k.arraymake(138,null,4),fm.Level_Images[1]=k.images[207],fm.Projectile_Images[1]=k.images[64],fm.Level_Images[2]=k.images[210],fm.Projectile_Images[2]=k.images[115],fm.Level_Images[3]=k.images[211],fm.Projectile_Images[3]=k.images[113],fm.Level_Images[4]=k.images[212],fm.Projectile_Images[4]=k.images[112],fm.Image=k.images[207],fm.Projectile_Image=k.images[64],fm.Projectile_size=.15,fm.Damage=6,fm.Reload_delay=98,fm.Y_Offset=-3,fm.Shoot_Sound=k.sounds[0],fm.Upgraded_version=fm,fs.Upgraded_version=fm,(fr=new g).Name="Treasure",fr.id="g",fr.Image=k.images[256],fr.Image=k.images[332],(fp=new g).Name="Chest",fp.id="h",fp.Image=k.images[320],fp.Upgraded_version=fp,fr.Upgraded_version=fp,fp.X_offset=0,fp.Y_Offset=-5,fp.Level_Images=k.arraymake(176,null,4),fp.Level_Frames=k.arraymake(177,null,4,2),fp.Level_Images[1]=k.images[320],fp.Level_Frames[1][1]=k.images[320],fp.Level_Frames[1][2]=k.images[321],fp.Level_Images[2]=k.images[313],fp.Level_Frames[2][1]=k.images[313],fp.Level_Frames[2][2]=k.images[312],fp.Level_Images[3]=k.images[396],fp.Level_Frames[3][1]=k.images[396],fp.Level_Frames[3][2]=k.images[397],fp.Level_Images[4]=k.images[117],fp.Level_Frames[4][1]=k.images[117],fp.Level_Frames[4][2]=k.images[118],(fq=new g).Name="Ice cube",fq.id="d",fq.Image=k.images[336],(fz=new g).Name="Ice Wall",fz.id="w",fz.Image=k.images[335],fz.X_offset=-1,fz.Y_Offset=8,fz.Level_Images=k.arraymake(206,null,4),fz.Level_Images[1]=k.images[335],fz.Level_Images[2]=k.images[259],fz.Level_Images[3]=k.images[260],fz.Level_Images[4]=k.images[261],(a3=k.arraymake(212,null,4))[1]=k.images[258],a3[2]=k.images[263],a3[3]=k.images[264],a3[4]=k.images[262],fz.Upgraded_version=fz,fq.Upgraded_version=fz;for(var c=K.first;c;){if(null!=(b=c.val).Projectile_Images)for(a=1;a<=k.arraylengthget(b.Projectile_Images);a++)k.imageoffsetset(b.Projectile_Images[a],k.imagesizexget(b.Projectile_Images[a])/2,k.imagesizeyget(b.Projectile_Images[a])/2);c=c.next}}function is(){return!bD&&null==ge}function it(b){var i,a=null,g=0,d="",h=null,e=0,c=0;k.offsetset(R,0),c=43,iH("For sale today:",V/2,b-44,14,!0),g=1;for(var f=C.first;f;)a=f.val,k.imagedrawgl(k.images[214],c-k.imagesizexget(k.images[214])/2,b-a.Bump_Y),h=a.Kind,e=0,cH>0&&ad==a&&(e=0-gZ(e6,0,55,0,100),null==dG&&k.transparencyset(gZ(e6,44,55,0,1))),a.Bought&&0==e||h._Draw6(a.Level,c-fA/2,b-a.Bump_Y-17+e,0),k.transparencyset(0),k.imagedrawgl(k.images[215],c-k.imagesizexget(k.images[215])/2+0,b-a.Bump_Y+k.imagesizeyget(k.images[214])),a!=k.listfirstget(21,C)&&(k.imagedrawgl(k.images[216],c-k.imagesizexget(k.images[215])/2+0-2*k.imagesizexget(k.images[216]),b+6),k.imagedrawgl(k.images[216],c-k.imagesizexget(k.images[215])/2+ -1-0*k.imagesizexget(k.images[216]),b+6,0-k.imagesizexget(k.images[216]),k.imagesizeyget(k.images[216]))),d="] bought",a.Cost>=0?(a.Bought||(d="~"+a.Cost),null!=dG&&ad==a&&(d=ho(!1),k.cursorset(32,"wait")),gB(d,c,b+33,!1,!0,!1,c$<a.Cost||null!=dG||ad==a&&e6<60||a.Bought||null!=eY,!0,!1)):(a.Bought||(d="Watch }"),s&&(d="Failed"),null!=dG&&ad==a&&(d=ho(!1),k.cursorset(44,"wait")),gB(d,c,b+33,!1,!0,!1,"loading"==w||null!=dG||ad==a&&e6<60||a.Bought||null!=eY||s,!0,!1)),cH<=0&&af&&(c$>=a.Cost?bG==bQ?(c6=null,ad=a,a.Cost<0?gm():(hi(),gw(),g0(bR))):(ad=a,a.Cost<0?gm():(hi(),iz(),ix(k.sounds[22]))):g0(bS)),c+=k.imagesizexget(k.images[97])+g,f=f.next;gB("   ~80",V/2,b+=75,!1,!0,!1,null!=eY||c$<80||null!=dG,!0,!1),k.imageoffsetset(k.images[411],8,8),k.imagerotationset(k.images[411],0),null!=eY&&k.imagerotationset(k.images[411],45*Math.floor(k.loops/22)),k.imagedrawgl(k.images[411],V/2-15-16+6,b+15-6+ae+8),af&&iv(),null!=eY&&iu(),null!=ad&&ad.Cost>=0&&e6>55&&(ad=null,iz(),cH=0)}function iu(){var a=null;null!=eY&&""!=k.ajaxresponseget(0,eY)&&(a=k.split(k.ajaxresponseget(1,eY),","),k.arraylengthget(a)>=3&&"good"==a[1]&&(c$=1*a[2]||0,ix(k.sounds[10]),gA(a[3])),eY=null)}function iv(){eY=gp("shoprefresh.php?",!1)}function iw(){ia(0,"leveltutorialdid1"),cZ=!0,hd(dy),hc(!1)}function ix(a){hm("soundvolume")>0&&k.soundplay(a)}function iy(){ix(k.sounds[31])}function iz(){cH+=1,e7=k.loops,e6=0,k.debugset("State state increase to "+cH+(" on game state="+bG))}function iA(){var d=!1,b=null,a=0,c=0;if(11==e4&&(fB.dynamite_total-=1),0==k.mod(e4,66)){if((c=Math.floor(e4/66))>dR){fB.dynamite_total<=0&&(fB.Removed=!0),fB=null,g0(bO);return}if(c>0){for(a=1;a<=dQ;a++)(b=dP[a][c]).Kind._Resource_is()&&(b.Removed=!0,b.TNT_hit_loops=k.loops,d=!0);d?(ix(k.sounds[0]),jH(111)):e5-=55}}}function iB(g,h,d,e){var a=null,f=null;if(e>0)for(var b=bw.first;b;)(a=b.val).Chain>0&&k.listremove(3,bw,a),b=b.next;(a=new i).X=g,a.Y=h,a.Amount=d,a.Chain=e,a.Life=60,d<9?a.Life+=10*d:a.Life+=20,a.Chain>0&&(a.Life+=100),a.Life_start=a.Life;for(var c=bw.first;c;)(f=c.val)!=a&&5>Math.abs(f.Y-a.Y)&&(a.Y+=20),c=c.next}function iC(){for(var a=bw.first;a;)(0,a.val)._Update4(),a=a.next;k.offsetset(R,S);for(var b=bw.first;b;)(0,b.val)._Draw4(),b=b.next;k.offsetset(0,0)}function iD(d,e,c,f){var b=0,a=null;for(d1+=c,b=1;b<=c;b++)(a=new j).x=d,a.y=e,a.Chest_y=f,c>1&&(a.x+=k.randomint(-10,10),a.y+=k.randomint(-10,10),a.Time_created-=2*b)}function iE(){var b,a=null;k.mouseclickedany&&(bG==cQ&&(fG==bG||fG==cM)||bG==ca&&(fG==bG||fG==cQ)&&0>=hm("leveldaysent")?(k.debugset("chest open yes state="+bG),null!=(a=iS(fJ,fL))&&a.Kind==fp&&a._Chest_Open()):0>=hm("leveldaysent")&&(bG==b6||bG==bO)&&(fG==b6||fG==bO)&&null!=(a=iS(fJ,fL))&&a.Kind==fp&&(bG==cM||a!=fp.First_Matched_tile)&&(a.Tapped_to_open_chest=!0))}function iF(){var a=null;k.mouseclickedany&&(bG==cQ||bG==b6||bG==bO||bG==cT||bG==ca)&&null!=(a=iS(fJ,fL))&&a.Kind==fm&&a.Flip_loops<=0&&(iU(a.Grid_x,a.Grid_y)||(a.Flip_loops=1,a.Flipped_preferred=!a.Flipped_preferred))}function iG(){var a=null;k.mouseclickedany&&bG==cQ&&fG==bG&&null!=(a=iS(fJ,fL))&&(a.Kind==fw&&a._TNT_use(),a.Kind==fl&&(fQ=a,g0(cJ)))}function iH(f,b,e,h,j){var a=0,c="",d=null,g=0,i=!1;if("  DELETE"==(f=f.toUpperCase()))for(a=1;a<=k.arraylengthget(di);a++)null!=(d=di[a])&&k.imagergbset(d,k.colormake(233,55,44,255));for(j&&(b-=iN(f,h)/2),b=Math.floor(b),g=1;g<=f.length;g++){if(((c=k.stringpart(f,g,1)).charCodeAt(0)||0)!=(c.charCodeAt(0)||0)&&alert(c+" Is it"),null!=(d=di[k.clamp(c.charCodeAt(0)||0,1,255)]))14!=h?k.imagedrawgl(d,b,e,iN(c,h),h):("<"==c?(k.imagerotationset(d,0),k.imagedrawgl(d,b+8,e+7)):">"==c?(k.imagerotationset(d,180),k.imagedrawgl(d,b+8,e+7)):"}"==c?k.imagedrawgl(d,b-1,e-3):"]"==c?k.imagedrawgl(d,b,e-1):k.imagedrawgl(d,b,e),":"==c&&k.imagedrawgl(d,b,e-8));else if("~"==c){if(k.imagedrawgl(k.images[10],b,e-1),!fj){a=g+1;for(var l=0;;){if(l++ >999999)throw{line:54,message:"Infinite While Loop"};if(a>f.length||" "==k.stringpart(f,a,1))break;a+=1}if(a>g+1&&c$<(1*k.stringpart(f,g+1,a-g-1)||0))for(a=0,i=!0;a<=9;a++)k.imagergbset(di[(""+a).charCodeAt(0)||0],k.colormake(222,11,0,255))}}else"@"==c?k.imagedrawgl(k.images[102],b,e-2):"*"==c?k.imagedrawgl(k.images[100],b,e-1):"&"==c?k.imagedrawgl(k.images[346],b+2,e-1):"^"==c&&gs(eu,b-3,e+1,!1);b+=iN(c,h)}if(i)for(a=0;a<=9;a++)k.imagergbset(di[(""+a).charCodeAt(0)||0],k.colormake(255,255,255,255));if("  DELETE"==f)for(a=1;a<=k.arraylengthget(di);a++)null!=(d=di[a])&&k.imagergbset(d,k.colormake(255,255,255,255));fj=!1}function iI(d,a,b,f,e){var c=0;fh=0,fi=!1,c=iN(d,14),!k.mousemovedget(-1)&&jd(a-1-jM(e,0)*(c/2),b-1,c+2,18)&&(k.mousedownany&&(fh=1),aZ&&(fi=!0)),bE==Math.floor(bE)&&fh<=0&&iH(d,a,b+fh,f,e),iH(d,a,b+fh-1,f,e),hC(a,b,c+2,18)&&(k.mousedownany&&k.mousemovedget(-1)||k.cursorset(21,"pointer"))}function iJ(h,a,c,j,l,e){var f=0,i="",b="",d=null,g=0;for(l&&(a-=iO(h)/2),a=Math.floor(a),g=1;g<=h.length;g++){if(((b=k.stringpart(h,g,1)).charCodeAt(0)||0)!=(b.charCodeAt(0)||0)&&alert(b+" Is it"),null!=(d=dj[k.clamp(b.charCodeAt(0)||0,1,255)]))d==k.images[138]&&(a-=1),d==k.images[190]&&(a-=1),14!=j?k.imagedrawgl(d,a,c,iO(b),j):(b!=b.toLowerCase()?k.imagedrawgl(d,a,c-7):"~"==b?e||k.imagedrawgl(d,a,c-2):"^"==b?(e||gs(eu,a,c-1,!1),O>0&&!e&&(1==O&&k.imagedrawgl(k.images[204],a+eu.Head_X+2,c+eu.Head_Y-12),2==O&&k.imagedrawgl(k.images[392],a+eu.Head_X+2,c+eu.Head_Y-11),3==O&&k.imagedrawgl(k.images[393],a+eu.Head_X+2,c+eu.Head_Y-10))):"*"==b?e||k.imagedrawgl(d,a,c+0):"@"==b?e||k.imagedrawgl(d,a,c-2):"]"==b?e||k.imagedrawgl(d,a,c-4):k.imagedrawgl(d,a,c-10),":"==b&&k.imagedrawgl(d,a,c-18));else if("["==b)for(f=1,i=ho(!0);f<=i.length;f++)null!=(d=dj[k.stringpart(i,f,1).charCodeAt(0)||0])&&k.imagedrawgl(d,a+(f-1)*7,c-10);a+=iO(b)+0}}function iK(f,c,d,g,e){var a=0,b=0;a=0,fi=!1,b=iO(f),!k.mousemovedget(-1)&&jd(c-1-jM(e,0)*(b/2),d-1,b+2,18)&&(k.mousedownany&&(a=1),aZ&&(fi=!0)),a<=0&&iJ(f,c,d+a,g,e,!0),iJ(f,c,d+a-1,g,e,!1),hC(c-1-jM(e,b/2),d,b+2,18)&&(k.mousedownany&&k.mousemovedget(-1)||k.cursorset(19,"pointer"))}function iL(b,c,e){var a=0,d=0;for(a=1;a<=b.length;a++)d=1*k.stringpart(b,a,1)||0,k.imagedrawglpart(k.images[371],c,e,15*d,0,14,k.imagesizeyget(k.images[371])),c+=14}function iM(c,e,f){var d="",a="",b=0;for(b=1,a="";b<=c.length;b++)(d=k.stringpart(c,b,1))==e?a+=f:a+=d;return a}function iN(c,f){var e=0,a="",d=0,b=0;if(""==c)return 0;if((e=(c=c.toUpperCase()).length)!=e)return k.debugset("NAN!!!!!!!!!!!!!!!"+c),0;for(d=1;d<=e;d++)a=k.stringpart(c,d,1),b+=9,((1*a||0)>0||"0"==a)&&(b+=1),("V"==a||"Y"==a||"U"==a||"A"==a||"W"==a||"M"==a||"H"==a||"N"==a)&&(b+=1,"M"==a&&(b+=1),"W"==a&&(b+=1)),"'"==a&&(b-=6),"&"==a&&(b+=12),"~"==a&&(b+=7),"@"==a&&(b+=7),"*"==a&&(b+=7),"]"==a&&(b+=2),"}"==a&&(b+=10),"<"==a&&(b+=9),">"==a&&(b+=5),"!"==a&&(b-=5);return b*(f/14)}function iO(c){var e=0,f="",b=null,d=0,a=0;if(""==c)return 0;if((e=c.length)!=e)return k.debugset("NAN!!!!!!!!!!!!!!!"+c),0;for(d=1;d<=e;d++)" "==(f=k.stringpart(c,d,1))&&(a+=7),f.charCodeAt(0),null!=(b=dj[k.clamp(f.charCodeAt(0)||0,1,255)])&&(a+=k.imagesizexget(b)+1,b==k.images[124]&&(a-=5),b==k.images[138]&&(a-=1),b==k.images[121]&&(a-=1),b==k.images[158]&&(a-=2),b==k.images[160]&&(a-=1),b==k.images[171]&&(a-=2),b==k.images[162]&&(a-=1),b==k.images[163]&&(a-=1),b==k.images[173]&&(a-=2),b==k.images[177]&&(a-=4),b==k.images[203]&&(a+=11));return a}function iP(a,b,c){return a?b:c}function iQ(a){return 2==a?"Bronze":3==a?"Silver":4==a?"Gold":""}function iR(d){var a=0,b=0,c=0;for(c=1;c<=dR;c++)for(b=1;b<=dQ;b++)dP[b][c].Match_join_tile==d&&(a+=1);a>=5?k.soundplaying(k.sounds[19])||ix(k.sounds[19]):a>=4?k.soundplaying(k.sounds[17])||ix(k.sounds[17]):a>=3?k.soundplaying(k.sounds[9])||ix(k.sounds[9]):k.debugset("error less than 3 matches")}function iS(c,d){var a=0,b=0,e=null;return a=Math.floor((c-R)/fA)+1,b=Math.floor((d-S)/fA)+1,iT(a,b)}function iT(b,c){var a=null;return g3(b,c)?(null!=(a=dP[b][c])&&a.Kind==ft&&(a=null),a):null}function iU(a,b){return dE==dn&&(a<=1||a>=dQ)}function iV(a,b){var c=null;if(g3(a,b)){if(null!=(c=dP[a][b])&&c.Kind!=ft)return!0}else if(b<=dR&&a>=1&&a<=dQ)return!0;return!1}function iW(c){for(var b=null,a=K.first;a;){if((b=a.val).id==c)return b;a=a.next}return null}function iX(){return null!=ff&&null!=fg&&fg.Kind==fl&&0==ff.Tier_Index&&ff._Upgrade_Can()}function iY(){var a=0;hw(270,250,.4,0,!0),iJ("Anvil",dW/2,25,14,!0,!1),iJ("Upgrade any resource",dW/2,50,14,!0,!1),a=k.mod(e4,66)-48,fl._Draw6(0,dW/2+30,90,0),fv._Draw6(0,dW/2+a,90,0),k.imagerotationset(k.images[75],180),k.imagedrawgl(k.images[75],dW/2+a+40+2*Math.sin(22*e4*k._degreestoradians),112),k.imagerotationset(k.images[75],270),k.imagedrawgl(k.images[75],dW/2+45,150),fx._Draw6(1,dW/2+22,180,0),hv(dW,dV)&&hA(),k.offsetset(0,0)}function iZ(){var c=null,a=0,b=0;for(b=1;b<=dR;b++)for(a=1;a<=dQ;a++)if((c=dP[a][b]).Match_join_index=0,i$(c),-1==bG)return;if(bG!=ch&&bG!=cq){if(bG==bO)for(b=1;b<=dR;b++)for(a=1;a<=dQ;a++)(c=dP[a][b]).Match_join_tile==c&&(iR(c),dU+=1);bG==cQ?(ji(),0==Q&&(a7=60)):fR=null}}function i$(c){var a=null,d={total:0,first:null,last:null},l=0,m=0,b=null,n=null,e=0;if(!(!c._Upgrade_Can()||iU(c.Grid_x,c.Grid_y)))for(e=1;e<=2;e++){l=c.Grid_x,m=c.Grid_y,a=c,d={total:0,first:null,last:null};for(var o=0;;){if(o++ >999999)throw{line:12,message:"Infinite While Loop"};if(k.listpush(12,d,a),1==e?l+=1:m+=1,null==(a=iT(l,m))||a.Kind.Unmovable||iU(a.Grid_x,a.Grid_y)||a.Kind!=c.Kind||a.Tier_Index!=c.Tier_Index)break}if(d.total>=3){if(bG==ch||bG==cq){bG=-1;return}bG=bO,b=c;for(var f=d.first;f;)(a=f.val).Moved_time>b.Moved_time&&(b=a),f=f.next;for(var g=d.first;g;)((a=g.val)==fd||a==fe)&&(b=a),g=g.next;for(var h=d.first;h;){if(null!=(a=h.val).Match_join_tile){b=a.Match_join_tile;break}h=h.next}(b.Kind==fu||b.Kind==fl)&&k.debugquit(57);for(var i=d.first;i;){if(null!=(a=i.val).Match_join_tile&&a.Match_join_tile!=b){k.debugset("H Match");for(var j=L.first;j;)(n=j.val)!=a&&n.Match_join_tile==a.Match_join_tile&&(n.Match_join_tile=b),j=j.next}a.Match_join_tile=b,a.Removed||(a.Removed=!0),i=i.next}}}}function i_(a){var c=0,b={total:0,first:null,last:null},d=null,e=0,f=0;for(f=1;f<=dR;f++)for(e=1;e<=dQ;e++)(d=dP[e][f]).Match_join_tile==a&&k.listpush(4,b,d);if(b.total<3&&(k.debugset(""+b.total),alert("Less than 3 matches"+(""+a.Grid_x+(""+a.Grid_y))+gy())),dE==dz&&b.total>=4&&(dT+=1,dS=k.loops),a.Tier_Index>0?c+=(b.total-3)*Math.pow(3,a.Tier_Index):c+=b.total-3,bG==bI)for(var g=b.first;g;)(d=g.val).Achievement_causing=!0,d.Blink=0,g=g.next;if(c>0&&(iB(a.Pixel_x+fA/2,a.Pixel_y+fA/1.5,c,0),iD(a.Pixel_x+fA/2,a.Pixel_y+fA/2,c,0)),null==a.Kind.Upgraded_version)for(var h=b.first;h;)(d=h.val).Match_join_tile=null,h=h.next}function i0(){var c=null,a=0,b=0;for(b=1;b<=dR;b++)for(a=1;a<=dQ;a++)(c=dP[a][dR+1-b]).Match_join_tile==c&&i_(c)}function i1(e,f,g){var a=0,b=0,c=null,d=0;for(b=-1;b<=1;b++)for(a=-1;a<=1;a++)Math.abs(a)+Math.abs(b)==1&&null!=(c=iT(e+a,f+b))&&c.Kind==g&&(d+=1);return d}function i2(){var c=null,a=0,b=0;for(b=1;b<=dR;b++)for(a=1;a<=dQ;a++)(c=dP[a][b])._Pixel_Position_Reset();for(a=1;a<=dQ;a++)null!=(c=aw[a])&&c._Pixel_Position_Reset()}function i3(){var f=!1,g={total:0,first:null,last:null},b=null,d=0,c=0,e=0;for(c=1;c<=dR;c++)for(d=1;d<=dQ;d++)(b=dP[d][c]).Removed&&(null!=b.Turning_into_kind?(b._Kind_Set2(b.Turning_into_kind),b.Removed=!1,b.Tapped_to_open_chest=!1,b.Blink=0,b.Frame=0,b.Tier_Index=0,b.Turning_into_kind=null):(b.Match_join_tile!=b&&b._Remove_From_Grid(),null==b.Match_join_tile&&b._Delete2(),g0(b6)));for(d=1;d<=dQ;d++)for(c=1,f=!1;c<=dR+1;c++)if(c<dR+1&&(b=dP[d][c]),null==b&&c<=dR)f=!0;else if(f){for(e=1;e<=c-1;e++)(b=new a).Grid_x=d,b.Grid_y=e,b.Pixel_x=b._Pixel_Target_X_Get(),b.Pixel_y=(e-c)*fA,dP[d][e]=b,k.listpush(45,g,b);break}}function i4(){var a=0,b=0;dP[fg.Grid_x][fg.Grid_y]=ff,dP[ff.Grid_x][ff.Grid_y]=fg,a=ff.Grid_x,b=ff.Grid_y,ff.Grid_x=fg.Grid_x,ff.Grid_y=fg.Grid_y,fg.Grid_x=a,fg.Grid_y=b,ff.Moved_time=k.loops+1,fg.Moved_time=k.loops,i2(),ff._Cannonslot_attach(),fg._Cannonslot_attach()}function i5(){var a=0;a=20,ff.Pixel_x=gZ(e4,0,a,ff._Pixel_Target_X_Get(),fg._Pixel_Target_X_Get()),ff.Pixel_y=gZ(e4,0,a,ff._Pixel_Target_Y_Get(),fg._Pixel_Target_Y_Get()),fg.Pixel_x=gZ(e4,0,a,fg._Pixel_Target_X_Get(),ff._Pixel_Target_X_Get()),fg.Pixel_y=gZ(e4,0,a,fg._Pixel_Target_Y_Get(),ff._Pixel_Target_Y_Get()),e4>a&&(d1+=1,d0=d1,i4(),ff=null,fg=null,fR=null,fS=null,gw(),g0(cQ),a7=0)}function i6(){d1-=1,d0=d1,Q+=1,a7=0,function(){var d=null,e=null,c=0,a=0,b=null;if(dE==dB&&dA<3){for(a=1,c=1;a<=dR;a++)if((b=dP[c][a]).Kind==fo&&b.Tier_Index>=dE._Goal_Number_Next_Get()){d=b;break}if(null!=d){for(a=1,c=dQ;a<=dR;a++)if((b=dP[c][a]).Kind==fo&&b.Tier_Index>=dE._Goal_Number_Next_Get()){e=b;break}null!=e&&(d.Achievement_causing=!0,e.Achievement_causing=!0,gi(dE.Index))}}}(),function(){var c=0,a=0,b=null;if(dE==dD&&dA<3){for(a=0;a<=1;a++)null!=(b=aw[a*(dQ-1)+1])&&b.Tier_Index>=dE._Goal_Number_Next_Get()&&(c+=1);if(c>=2){for(a=0;a<=1;a++)(b=aw[a*(dQ-1)+1]).Achievement_causing=!0;gi(dE.Index)}}}(),bG!=bI&&(bG!=b6&&(iZ(),null!=fd&&null!=fe&&(bG==cQ||bG==ca)&&(fR=fd,fS=fe)),ji(),gw())}function i7(a,q,o,p,r,s){var e="",l="",m=0,c=0,f="",d="",g="",b="",h=0,i="",j="",n=0;return(a<0&&(a=0),a=Math.floor(a/1e3),c=Math.floor(a/60/60),h=Math.floor(k.mod(a/60,60)),n=Math.floor(k.mod(a,60)),f=":",g=":",i="",o?(f="h ",g="m ",i="s",d=""+c,b=""+h,j=""+n):(d=hI(c),b=hI(h),j=hI(n)),q)?s?b+(g+(j+i)):d+(f+(b+(g+(j+i)))):o?(r&&(e=" ago"),c>24)?1==(m=Math.floor(c/24))?""+m+(" day"+e):""+m+(" days"+e):""!=p&&c<1&&h<1?p:"0"==d?b+("m"+e):d+("h "+(b+("m"+e))):(l=" ",30>k.mod(k.loops,60)&&(l=f),d+(l+b))}function i8(){var a=null,b="";null!=fC&&""!=k.ajaxresponseget(1,fC)&&(""!=(b=k.ajaxresponseget(2,fC))&&(a=k.split(b,","),k.arraylengthget(a)>=14&&"good"==a[1]?(hs(a),k.offsetset(0,0)):"bad"==a[1]&&(k.arraylengthget(a)>1&&("no user"==a[1]||"no token"==a[1]||"bad token"==a[1])&&(ia(0,"userid"),ib("","token"),ib("","screenname")),k.arraylengthget(a)>1&&"wrong token"==a[2]&&(ib("","token"),g0(cp),k.offsetset(0,0)))),fC=null)}function i9(){if(eg=!1,null!=ff&&(0!=e8||0!=e9)){if(Math.abs(bf)<fA/2||bG==cO&&(dE==dx||dE==dC)&&null!=fg||bG==cO&&dE==dy&&fg!=dP[ff.Grid_x+1][ff.Grid_y]||bG==cO&&(dE==dz||dE==dl)&&fg!=dP[ff.Grid_x+1][ff.Grid_y]||bG==cO&&dE==dn&&fg!=dP[ff.Grid_x+1][ff.Grid_y]||bG==cO&&dE==dD&&null!=fg||null!=fg&&fg.Kind==fl&&!iX()){ff._Pixel_Position_Reset(),null!=fg&&fg._Pixel_Position_Reset(),ff=null,fg=null;return}!function(){if(k.debugset("Tiles Swap"),fg!=ff&&null!=fg){if(fg.Kind==ff.Kind&&ff.Tier_Index==fg.Tier_Index){ff._Pixel_Position_Reset(),fg._Pixel_Position_Reset();return}if(fR=null,iX())null==ff.Kind&&k.debugquit(12),ff._Remove_From_Grid(),ff._Removed_so_replace(!1),ff.Grid_x=fg.Grid_x,ff.Grid_y=fg.Grid_y,ff.Moved_time=k.loops,dP[fg.Grid_x][fg.Grid_y]=ff,fg._Delete2(),ff._Pixel_Position_Reset(),ff._Upgrade(),ix(k.sounds[28]);else if(fg.Kind==fu)null==ff.Kind&&k.debugquit(27),fg._Kind_Set2(ff.Kind),fg.Tier_Index=ff.Tier_Index,fg.Time_Created=k.loops,ff._Pixel_Position_Reset(),ix(k.sounds[22]);else if(iU(fg.Grid_x,fg.Grid_y)&&!(ff.Kind==fm&&fg.Kind==fm)){if(ff.Kind!=fm){ff._Pixel_Position_Reset();return}fg.Kind==fn&&iU(ff.Grid_x,ff.Grid_y)?i4():(ff._Remove_From_Grid(),ff._Removed_so_replace(!1),ff.Grid_x=fg.Grid_x,ff.Grid_y=fg.Grid_y,ff.Moved_time=k.loops,dP[fg.Grid_x][fg.Grid_y]=ff,fg._Delete2(),ff._Pixel_Position_Reset(),ff._Cannonslot_attach())}else i4();fd=ff,fe=fg,i6(),fd=null,fg=null}else{if(fR=null,null==fg){if(ff.Kind==fv&&1==ff.Grid_y&&e9<0&&ap<as){!function(){var a=0;if((ap+=1)>ar&&(ar=ap),at=k.loops,ix(k.sounds[13]),au=ff.Grid_x,am[ff.Grid_x]>0)am[ff.Grid_x]-=1;else for(a=1;a<=k.arraylengthget(am);a++)if(am[a]>0){am[a]-=1,au=a;break}ff._Remove_delete_and_replace(!0),aq=k.loops,ff=null,i6(),dE==dx&&ap>=dE.Health_max_start&&gi(dE.Index)}();return}if(e9<0&&ff._Arm_Castle_Tower_Can()){ff._Arm_Castle_Tower();return}}if(null==fg&&0==ff.Tier_Index&&e9>=0){ff._Remove_From_Grid(),ff._Removed_so_replace(!1),ff.Removed=!0,ff.Dragged_off_edge_time=k.loops,ff=null,dE.Is_water_level&&ix(k.sounds[26]),i6();return}k.debugset("Tiles Swap fail"),fg==ff&&k.debugset("they =========="),ff._Pixel_Position_Reset(),null!=fg&&fg._Pixel_Position_Reset()}}()}fc=0}function ja(){fO=fN,fN=fM,fK=fJ,fM=fL,fJ=k.touchx/bE,fL=k.touchy/bE,fE=fL-fM}function jb(){ja(),fG=bG,fH=fJ,fI=fL,fM=fL,fN=fL,fO=fL,e8=0,e9=0,(bG==cQ||bG==cO)&&(null!=ff&&(ff._Pixel_Position_Reset(),null!=fg&&fg._Pixel_Position_Reset()),null!=(ff=iS(fJ,fL))&&ff.Kind.Unmovable&&(ff=null),fg=null,bG==cO&&ff!=fQ&&(ff=null))}function jc(a,b,c,d){return!!k.rectshit(a+window.gtboffsetx,b+window.gtboffsety,c,d,fJ,fL,1,1)}function jd(a,b,c,d){return!!k.rectshit(a+window.gtboffsetx,b+window.gtboffsety,c,d,fH,fI,1,1)}function je(){var a=null;(a=new b)._Kind_Set(bt),a.Pixel_x=3.5*fA,a.Spawn_time=k.loops,a._Grid_X_Set(),a.Grid_x_2=a.Grid_x,a._Grid_Y_Set(),d1=1,e$=!0}function jf(){bG==ca&&(d4=d2,dc=!1)}function jg(){var a=0;for(k.debugset("User clear!!!"),c5={total:0,first:null,last:null},C={total:0,first:null,last:null},H={total:0,first:null,last:null},ib("","token"),ib("","userid"),ib("","userisoffline"),ib("","screenname"),fZ="",d9=!0,c$=0,a=1;a<=k.arraylengthget(es);a++)es[1].Day=0;ea=0,de=!1,dd=!1,fT=gt(0),fV=0,fW=0,fY=0,gd._Clear(),dy._Scores_from_text(hn("scoreslevel"+dy.Index))}function jh(){var b="",a=0;hw(320,360,.4,0,!0),iJ("Delete Your Account?",dW/2,a=28,14,!0,!1),iJ("Your account information",dW/2,a+=44,14,!0,!1),iJ("scores, email, gold, etc.",dW/2,a+=25,14,!0,!1),iJ("will be deleted forever.",dW/2,a+=25,14,!0,!1),iJ("Enter your password",dW/2,a+=40,14,!0,!1),iJ("if you're sure.",dW/2,a+=25,14,!0,!1),a+=25,k.fontsizeset(24),k.textboxdraw(5,(dW-200)/2,a,200,!0,"padding:"+3*bE+"px"),b=k.textboxtextget(19,5),k.keyboardopen()||""!=b||(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],dW/2,a+51+1.5*Math.sin(10*k.loops*k._degreestoradians))),null!=f1&&(hp(dW/2-9,a+47),k.cursorset(26,"wait")),a+=70,cH>0&&""==b&&iJ("Wrong password.",dW/2,a-22,14,!0,!1),null!=f1&&(iJ(ho(!1),dW/2,a-22,14,!0,!1),k.cursorset(34,"wait")),gB("  Delete",dW/2,a,!0,!0,!1,b.length<6||null!=f1,!1,!1),k.imagedrawgl(k.images[203],dW/2-35,a+ae+22),(af||c3)&&(f1=gp("userdelete.php?password="+b,!1)),hv(0,0)&&(f1=null,hA()),null!=f1&&jn(),k.offsetset(0,0)}function ji(){var a=null;if(null!=(a=function(){var c=null,a=0,b=0;for(b=1;b<=dR;b++)for(a=1;a<=dQ;a++)if(null!=(c=dP[a][b])&&c.Tapped_to_open_chest)return c;return null}())){a._Chest_Open();return}if(!function(){var c,b=null;if(bG!=bO)for(var a=K.first;a;){if(null!=(b=a.val).First_Matched_tile){g0(cM),fQ=b.First_Matched_tile;return}a=a.next}}(),bG==cQ){if(""!=d8){g0(cs);return}if(dE==dD&&d7&&(d7=!1,g0(cg)),bG==cQ){if(e5=0,!ac&&C.total>0&&1==a6){ac=!0,g0(bQ);return}hu(),d1<=0&&(bG=ca,e5=k.loops,d4=d3,dc=!0)}}}function jj(){var c=!1,b="",a=0;hw(310,255,.4,111+hV(),!0),iJ("Report This User",dW/2,a+=28,14,!0,!1),iJ(eI,dW/2,a+=33,14,!0,!1),a+=44,cH<=0&&(k.fontsizeset(12),k.textboxdraw(4,(dW-260)/2,a,260,!1,"padding:"+2*bE+"px"),b=k.textboxtextget(11,4),k.keyboardopen()||""!=b||(k.imagerotationset(k.images[75],90),k.imagedrawgl(k.images[75],dW/2,a+43+1.5*Math.sin(10*k.loops*k._degreestoradians)))),null!=ga&&(hp(dW/2-9,a+47),k.cursorset(19,"wait")),a+=61,cH<=0?(gB("Send",dW/2,a,!0,!0,!1,c=b.length<6||null!=ga,!1,!1),(af||c3)&&!c&&(ga=gp("userreport.php?screenname="+eI+("&reason=other&text="+(b=k.stringpart(b,1,999))),!1))):iJ("Thanks!",dW/2,a,14,!0,!1),hv(0,0)&&(ga=null,hA()),null!=ga&&(jC(),null==ga&&iz()),k.offsetset(0,0)}function jk(){var a=0;(hw(320,320,.4,0,!0),iJ("Report This User",dW/2,a=28,14,!0,!1),iJ(eI,dW/2,a+=33,14,!0,!1),a+=44,1==cH)?iJ("Error",dW/2,a,14,!0,!1):2==cH?iJ("Thanks. We're on it.",dW/2,a,14,!0,!1):(iJ("Reason:",dW/2,a,14,!0,!1),gB("Name",dW/2,a+=25,!1,!0,!1,null!=ga,!1,!1),af&&(ga=gp("userreport.php?screenname="+eI+"&reason=name",!1)),gB("Cheating",dW/2,a+=44,!1,!0,!1,null!=ga,!1,!1),af&&(ga=gp("userreport.php?screenname="+eI+"&reason=hack",!1)),gB("Inactive",dW/2,a+=44,!1,!0,!1,null!=ga,!1,!1),af&&(ga=gp("userreport.php?screenname="+eI+"&reason=inactive",!1)),gB("Other",dW/2,a+=44,!1,!0,!1,null!=ga,!1,!1),af&&g0(cS)),null!=ga&&(hp(dW/2,a+44),k.cursorset(51,"wait")),hv(0,0)&&(ga=null,hA()),null!=ga&&jC()}function jl(){var a=null;null!=f0&&""!=k.ajaxresponseget(1,f0)&&(k.ajaxresponseget(2,f0),a=k.split(k.ajaxresponseget(3,f0),","),k.arraylengthget(a)>=5&&"good"==a[1]?(fZ=a[4],h2(a[5])):f7=!0,f0=null)}function jm(b){var a="";f_=b,a="userageset.php?",a+="&under13="+jM(b,0),f0=gp(a,!1)}function jn(){var a=null;null!=f1&&""!=k.ajaxresponseget(0,f1)&&(a=k.split(k.ajaxresponseget(1,f1),","),k.arraylengthget(a)>=2&&"good"==a[1]?(jg(),g0(cq)):(ix(k.sounds[29]),iz(),k.textboxtextset(8,5,"")),f1=null)}function jo(){var a=null;null!=f2&&""!=k.ajaxresponseget(0,f2)&&(a=k.split(k.ajaxresponseget(1,f2),","),k.arraylengthget(a)>=2&&"good"==a[1]?bg=a[2]:(ix(k.sounds[29]),k.arraylengthget(a)>=2&&(bg="",bn="Error.","taken"==a[2]&&(bn="Taken by another account."),"bad email"==a[2]&&(bn="Invalid email address."),"already confirmed"==a[2]&&k.arraylengthget(a)>=3&&(bg=a[3],bm=!0))),f2=null)}function jp(){var a="";a="useremailset.php?",a+="&email="+k.textboxtextget(1,3),a+="&emailallow="+jM(bo,0),bp=bo,f2=gp(a,!1)}function jq(){var a=null;null!=f3&&""!=k.ajaxresponseget(0,f3)&&(a=k.split(k.ajaxresponseget(1,f3),","),k.arraylengthget(a)>=2&&"good"==a[1]||ix(k.sounds[29]),f3=null)}function jr(){var a="";a="useremailsettingsset.php?",a+="&allowbattle="+jM(bh,0),a+="&allowkicked="+jM(bi,0),a+="&allownewsletter="+jM(bj,0),a+="&allowrankchange="+jM(bk,0),f3=gp(a,!1)}function js(){var a=null;null!=f4&&""!=k.ajaxresponseget(0,f4)&&(a=k.split(k.ajaxresponseget(1,f4),","),k.arraylengthget(a)>=17&&"good"==a[1]?(eB=1*a[3]||0,eC=a[4],eG=1*a[5]||0,ev=1*a[6]||0,eD=1*a[7]||0,eF=1*a[8]||0,eJ=1*a[9]||0,eH=1*a[10]||0,et=1*a[11]||0,eE="1"==a[12],ew=1*a[13]||0,ex=1*a[14]||0,eA=1*a[15]||0,ey=1*a[16]||0,ez=m,(1*a[17]||0)>0&&(ez=k.listitemget(19,bv,1*a[17]||0)),eC==fZ&&(fV=ew,fW=ex,fY=eA,fU=ey,fX=ez,k.arraylengthget(a)>=22&&(bg=a[18],bm="1"==a[19],bi="1"==a[20],bk="1"==a[21],bj="1"==a[22],bh="1"==a[23],bl="1"==a[24],bp=bi||bk||bj||bh))):hA(),f4=null)}function jt(){var a="";a="userinfoget.php?",a+="&screenname="+eI,f4=gp(a,!1)}function ju(){var a=null;null!=f5&&""!=k.ajaxresponseget(0,f5)&&(a=k.split(k.ajaxresponseget(1,f5),","),k.arraylengthget(a)>=2&&"good"==a[1]||ix(k.sounds[29]),f5=null)}function jv(b){var a="";a="userkick.php?",a+="&screenname="+b,f5=gp(a,!1)}function jw(){var a=null;""!=k.ajaxresponseget(0,f6)&&(a=k.split(k.ajaxresponseget(1,f6),","),k.arraylengthget(a)>1&&(k.arraylengthget(a)>=14&&"good"==a[1]?(ib("","board"),hs(a)):("bad password"==a[2]||"wrong password"==a[2])&&(k.keyboardhide(),e_="Wrong password!",cH=0,e5=0)),f6=null)}function jx(b){var a="";a="userlogin.php?",a+="&id="+dO,a+="&token="+hn("token"),a+="&password="+b,f6=gp(a,!0)}function jy(){var a=null;null!=f9&&""!=k.ajaxresponseget(0,f9)&&(a=k.split(k.ajaxresponseget(1,f9),","),iz(),k.arraylengthget(a)>=2&&"good"==a[1]?bA="Email Sent!":(ix(k.sounds[29]),k.arraylengthget(a)>=2&&(bA="Error","wrong name"==a[2]&&(bA="User not found."),"bad name"==a[2]&&(bA="User not found!"),"no email"==a[2]&&(bA="Sorry, that user never/set their email address."),"no confirmed email"==a[2]&&(bA="Sorry, that user has no/confirmed email address."))),f9=null)}function jz(){var a="";a="userpasswordrequest.php?",a+="&screenname="+hn("screenname"),f9=gp(a,!1)}function jA(){var a=null;null!=f9&&""!=k.ajaxresponseget(0,f9)&&(a=k.split(k.ajaxresponseget(1,f9),","),k.arraylengthget(a)>=2&&"good"==a[1]?iz():(ix(k.sounds[29]),hA()),f9=null)}function jB(){f9=gp("userpasswordrequest.php?",!1)}function jC(){var a=null;null!=ga&&""!=k.ajaxresponseget(0,ga)&&(a=k.split(k.ajaxresponseget(1,ga),","),k.arraylengthget(a)>=2&&"good"==a[1]?(iz(),iz()):(ix(k.sounds[29]),iz()),ga=null)}function jD(){var a=null;a=k.split(k.ajaxresponseget(0,gb),","),k.arraylengthget(a)>2&&"good"==a[1]&&("available"==a[3]?dX<=0&&(g0(cF),gb=null):(cH=0,e_="taken"==a[3]?"That name is taken!":"That name is not allowed!",e0=k.loops,eV="",k.keyboardhide(),k.textboxtextset(18,1,""),gb=null))}function jE(b){var a="";a="userscreennamecheck.php?",a+="&screenname="+b,gb=gp(a,!1)}function jF(b){var a="";a="userscreennamelogin.php?",a+="&screenname="+b,gc=gp(a,!1)}function jG(){var a=null;""!=k.ajaxresponseget(0,gc)&&(a=k.split(k.ajaxresponseget(1,gc),","),k.arraylengthget(a)>2&&("good"==a[1]?(dO=1*a[2]||0,ib(a[4],"screenname"),g0(co)):k.arraylengthget(a)>2&&"no real user"==a[2]&&a[3]==hn("userid")?g0(cF):(e_="That name does not exist!",e0=k.loops,k.keyboardhide(),cH=0)),gc=null)}function jH(a){0>=hm("vibrateoff")?k.debugset("vibrate;"+a):k.debugset("not vibrating "+a)}function jI(){ge=gp("warchestget.php?",!1)}function jJ(){var a=null,b=0,c=0;if(bG!=cb&&gR()){g0(cb),d_=g$();return}if(bG!=cr&&(dE==dy||dE==dF)&&a6==dE._Goal_Number_Next_Get()){g0(cr),d_=g$();return}if((dE==dy||dE==dF)&&dA<5&&a6==dE._Goal_Number_Next_Get()+1){gi(dE.Index);return}if(dE==dy&&e$&&2==a6&&bG!=cg){g0(cg);return}for(g0(cQ),c=1;c<=dR;c++)for(b=1;b<=dQ;b++)(a=dP[b][c]).Reload_Delay=0,a.Kind==fo&&(a.Flipped=!1),a.Kind==fm&&(a.Flipped=a.Flipped_preferred,a.Tilted=!1,a.Flip_loops=0),a.Destroyed&&(bG=b0),a.Turning_into_kind==fr&&(a._Kind_Set2(fr),a.Turning_into_kind=null,ix(k.sounds[22]));for(b=1;b<=dQ;b++)null!=aw[b]&&(aw[b].Reload_Delay=0);e5=k.loops,hD(),I={total:0,first:null,last:null},G={total:0,first:null,last:null},a7=60,ix(k.sounds[5]),k.soundstop(d4),d4=d2,dc=!1,gw(),ia(0,"leveldaysent"),iZ()}function jK(){var a=0,c=null,d=0,e=0;for(an=0,gw(),ix(k.sounds[7]),fR=null,e=fA*(a6/14+1),a=Math.ceil(2.6*a6)+2,(dE==dy||dE==dF)&&a6>dE.Goal_number_5&&(a=Math.ceil(.4*a)-10,e=Math.ceil(.8*e),a+=(a6-dE.Goal_number_5)*13),dE==dx&&(a-=2),dE==dn&&(a=.7*a-1),dE==dy&&(d9&&e$?a-=3:a-=1,a6<=1&&G.total>0&&(a=0)),d=1;d<=a;d++){if(c=new b,(dE==dy||dE==dF)&&1==d&&a6==dE._Goal_Number_Next_Get()){c._Kind_Set(bs),c.Spawn_time=k.loops,ix(k.sounds[12]),c.Pixel_y+=44;break}if(gR()){c._Kind_Set(br);break}dE==dn||(dE==dy||dE==dF)&&a6>dE.Goal_number_5?c._Kind_Set(bq):c._Kind_Set(bt),c.Pixel_y+=d/a*e,c._Grid_Y_Set()}g0(cT),0>=hm("leveldaysent")&&hj(),d9||gq()}function jL(){var a={total:0,first:null,last:null};return(k.listpush(0,a,"Towers shoot at dragons/in all directions."),k.listpush(1,a,"Drag things off the side/If you don't want them!"),k.listpush(2,a,"It's a puzzle game!"),k.listpush(3,a,"Dragons come every night!"),k.listpush(4,a,"Defend the castle!"),k.listpush(5,a,"Dragons are fascinated that/your mouth can make water!"),k.listpush(6,a,"Don't let the dragons/burninate the countryside!"),k.listpush(7,a,"Always remember that you can/repair the castle with stone!"),k.listpush(8,a,"Don't tickle a sleeping dragon!"),k.listpush(9,a,"Rome wasn't built in a day."),k.listpush(10,a,"When you match-4,/You get an extra swap."),k.listpush(11,a,"Match 3 wooden chests/to get a silver chest!"),k.listpush(12,a,"You can quickly open a chest/to stop night from falling."),k.listpush(13,a,"Drag dirt into shallow water/to increase your land space."),1>hm("plays"))?k.listfirstget(15,a):k.listitemget(17,a,k.randomint(1,a.total))}function jM(b,a){return b?0==a?1:a:0}function jN(){return this.Cost=0,this.Grid_X=0,this.Grid_Y=0,this.Head_Size_X=0,this.Head_X=0,this.Head_Y=0,this.Id=0,this.Name="",k.listpush(0,bu,this),null}function jO(){return this.Bought=!1,this.Bump_Y=0,this.Cost=0,this.Kind=null,this.Level=0,k.listpush(0,C,this),null}function jP(){return this.Id=0,k.listpush(0,bv,this),null}function h(){return this.Delay=0,this.From_gold_dragon=!1,this.Start_x=0,this.Start_x_add=0,this.Start_y=0,this.Start_y_add=0,this.Time_created=0,this.Value=0,this.x=0,this.y=0,k.listpush(0,D,this),this.Time_created=k.loops,a1=this,this.Value=1,null}function jQ(){return this.Color_1=0,this.Color_2=0,this.Color_3=0,this.Color_style=null,this.Emblem=0,this.ID=0,this.Name="",this.Total_Users=0,k.listpush(0,E,this),null}function jR(){return this.Avatar=null,this.Is_my_new_one=!1,this.Is_other_war_clan=!1,this.name="",this.Rank=0,this.score=0,null}function jS(){return this.active_minutes_ago=0,this.Avatar=null,this.castle_upgrades=0,this.gold=0,this.leader_is_1=0,this.rank=0,this.score_best=0,this.screenname="",k.listpush(0,F,this),null}function b(){return this.Arrows_coming=0,this.Baby_spawn_angle=0,this.Baby_spawn_loops=0,this.Current_frame_index=0,this.Dead_Time=0,this.Direction=0,this.Got_Colded=0,this.Got_to_castle=!1,this.Got_Zapped=0,this.Grid_x=0,this.Grid_x_2=0,this.Grid_Y=0,this.Health=0,this.Health_max=0,this.Is_Dead=!1,this.kind=null,this.Pixel_x=0,this.Pixel_y=0,this.Shoot_Time=0,this.Size=0,this.Spawn_time=0,this.Speed=0,this.Tile_that_its_shooting=null,this.Took_Damage_Time=0,this.Pixel_y=9*fA,this._Grid_Y_Set(),k.listpush(2,G,this),this.Current_frame_index=2*k.random()+1,this.Direction=3,null}function jT(){return this.Images=null,this.images_hp_low=null,this.Lightness=0,null}function jU(){return this.Opened_Loops=0,this.Tier=0,this.Tile_Kind=null,this.Total=0,null}function e(){return this.Goal_gold=0,this.Goal_Number_1=0,this.Goal_Number_2=0,this.Goal_Number_3=0,this.Goal_number_4=0,this.Goal_number_5=0,this.Goal_Text_1="",this.Goal_Text_2="",this.Goal_Text_3="",this.Goal_text_4="",this.Goal_text_5="",this.Goal_Text_Did_2="",this.Goal_Text_Did_3="",this.Goal_text_did_4="",this.Goal_text_did_5="",this.Goal_text_did_SE_2="",this.Goal_text_for_menu="",this.Health_max_start=0,this.Index=0,this.Is_water_level=!1,this.Name="",this.Road=null,this.Scores=null,this.User_rank=0,this.X=0,this.Y=0,null}function jV(){return this.amount=0,this.collecting=!1,this.done_time=0,this.From_user_avatar=null,this.From_user_name="",this.id=0,this.kind="",this.level_index=0,this.reason=0,this.score=0,this.Y=0,k.listpush(0,H,this),null}function c(){return this.Buildings={total:0,first:null,last:null},this.Day=0,this.Gold=0,this.Tier=0,this.Time_Unlock_Started=0,this.X=0,this.Y=0,null}function d(){return this.Damage=0,this.Direction_Angle=0,this.Exploded_time=0,this.Image=null,this.Level=0,this.Pixel_X=0,this.Pixel_Y=0,this.Shot_up=!1,this.Speed=0,this.Start_x=0,this.Target_Enemy=null,this.Target_X=0,this.Target_Y=0,this.Tower=null,this.Speed=3.84,k.listpush(1,I,this),null}function i(){return this.Amount=0,this.Chain=0,this.Life=0,this.Life_start=0,this.Loops_Made=0,this.X=0,this.Y=0,k.listpush(0,bw,this),this.Loops_Made=k.loops,null}function j(){return this.Chest_y=0,this.Old_x=0,this.Old_y=0,this.Time_created=0,this.x=0,this.y=0,this.Time_created=k.loops,k.listpush(1,J,this),null}function a(){return this.Achievement_causing=!1,this.Appear_loops=0,this.Blink=0,this.Checked=!1,this.Chest_opened_swap=0,this.Destroyed=!1,this.Dragged_into_lake=!1,this.Dragged_off_edge_time=0,this.dynamite_total=0,this.Flip_loops=0,this.Flipped=!1,this.Flipped_preferred=!1,this.Frame=0,this.Grid_x=0,this.Grid_y=0,this.Health=0,this.Kind=null,this.Match_join_index=0,this.Match_join_tile=null,this.Moved_time=0,this.Pixel_x=0,this.Pixel_y=0,this.Reload_Delay=0,this.Removed=!1,this.Shift_X=0,this.Shift_Y=0,this.Tapped_to_open_chest=!1,this.Tier_Index=0,this.Tilted=!1,this.Time_Created=0,this.TNT_hit_loops=0,this.Turning_into_kind=null,this.Upgraded=!1,this.Water_depth=0,this.Water_Depth_Reduced_Time=0,k.listpush(0,L,this),this._Kind_set_randomly(),this.Frame=1,this.Moved_time=k.loops,null}function g(){return this.Damage=0,this.Did_tutorial=!1,this.First_Matched_tile=null,this.Frame_Images=null,this.id="",this.Image=null,this.Level_Frames=null,this.Level_Images=null,this.Name="",this.Projectile_Image=null,this.Projectile_Images=null,this.Projectile_size=0,this.Reload_delay=0,this.Shoot_Sound=null,this.Unmovable=!1,this.Upgraded_version=null,this.X_offset=0,this.Y_Offset=0,k.listpush(0,K,this),null}function f(){return this.chest_got=!1,this.clan_color_1=0,this.clan_color_2=0,this.Clan_color_3=0,this.clan_emblem=0,this.clan_name="",this.Color_style=null,this.end_time=0,this.level=null,this.User_is_in=!1,this.You_won=0,k.listpush(0,bx,this),null}h.prototype._Draw=function(){var b=0,a=0;this.Delay>0||(b=1,(a=k.loops-this.Time_created)<20?k.transparencyset(k.clamp(1-a/15,0,1)):a<50&&(b=k.mod(Math.floor(a/4),k.arraylengthget(a0))+1),k.imagedrawgl(a0[b],this.x-8,this.y-8),k.transparencyset(0))},h.prototype._Update=function(){var c=0,e=0,d=0,f=0,a=0,b=0;if(this.Delay>0){this.Delay-=1;return}if(f=eW-(iN("  "+c$,14)-7)-R,a=c0-S,c2=k.loops,b=k.loops-this.Time_created,b<20&&!this.From_gold_dragon)this.y-=.3;else if(b<=50)this.From_gold_dragon&&(this.x+=.1*this.Start_x_add,b<=42&&(this.y+=-1*Math.sin(b/39*360*k._degreestoradians)));else{if(this.From_gold_dragon&&G.total>0){this.Time_created+=1;return}c=k.angleto(this.x,this.y,f,a),e=Math.abs(this.y-a)/Math.abs(this.Start_y-a),d=4+(.5-Math.abs(e-.5))*16,this.x+=Math.cos(c*k._degreestoradians)*d,this.y+=Math.sin(c*k._degreestoradians)*d,this.y<a+8&&(k.listremove(36,D,this),c$+=this.Value,k.soundplaying(k.sounds[10])||ix(k.sounds[10]),a_=k.loops)}},b.prototype._Damage_The_Castle=function(){if(this.kind!=br&&(ix(k.sounds[3]),jH(50),an=this.Grid_x,am[this.Grid_x]+=1,ao=1,(ap-=1)<=0)){if(eO){var a;bG!=cw&&(ix(k.sounds[8]),g0(cw),k.soundstop(d4),d4=k.sounds[8])}else g0(cu);return}k.listremove(21,G,this)},b.prototype._Die=function(){0==this.Dead_Time&&(ix(k.sounds[2]),this.kind==bs&&function(d){var e=0,c=0,a=null;for(jH(90),e=.7*a6+3,c=1;c<=e;c++)(a=new b)._Kind_Set(bt),a.Spawn_time=k.loops,a.Pixel_x=d.Pixel_x,a.Pixel_y=d.Pixel_y,a.Baby_spawn_angle=360*k.random(),a.Baby_spawn_loops=k.randomint(5,20+.6*a6),a._Grid_X_Set(),a.Grid_x_2=a.Grid_x}(this)),this.Is_Dead=!0,this.Dead_Time=k.loops,this.Size=.6*this.Size,this.Tile_that_its_shooting=null},b.prototype._Draw2=function(){var c=null,d=0,b=0,a=null,e=!1,f=0;this.Is_Dead&&!this.Got_to_castle?k.loops-this.Dead_Time<21&&(this.Size=this.Size+.3,k.transparencyset((k.loops+2-this.Dead_Time)/23),k.imagerotationset(k.images[109],this.Pixel_x),k.imagedrawgl(k.images[109],this.Pixel_x,this.Pixel_y),k.transparencyset(0)):(null==this.Tile_that_its_shooting||(d=k.mod(Math.floor(k.loops/2),3),c=k.images[103],1==d&&(c=k.images[104]),2==d&&(c=k.images[105]),k.imagedrawgl(c,this.Pixel_x-k.imagesizexget(k.images[103])/2,this.Pixel_y-fA-(k.imagesizeyget(k.images[103])-2)),k.soundplaying(k.sounds[11])||ix(k.sounds[11])),a=this.kind.Images[Math.floor(this.Current_frame_index)],null!=this.kind.images_hp_low&&this.Health<=6&&(a=this.kind.images_hp_low[Math.floor(this.Current_frame_index)]),this.Got_Colded>0&&(b=170-11*Math.sin(18*k.loops*k._degreestoradians),k.imagergbset(a,k.colormake(b,b,255,255)),e=!0),k.loops-this.Took_Damage_Time<10&&(b=255-111*Math.sin((k.loops-this.Took_Damage_Time)*18*k._degreestoradians),k.imagergbset(a,k.colormake(255,b,b,255)),e=!0),this.kind==bs&&(f-=Math.floor(this.Current_frame_index)),this.Got_to_castle&&(f-=2*Math.sin(33*k.loops*k._degreestoradians)),k.imagedrawgl(a,this.Pixel_x-k.imagesizexget(a)/2,this.Pixel_y-k.imagesizeyget(a)/2+f),e&&k.imagergbset(a,k.colormake(255,255,255,255)),this.Got_Zapped>0&&k.imagedrawgl(k.images[57],this.Pixel_x-8,this.Pixel_y-8))},b.prototype._Grid_X_Set=function(){this.Grid_x=Math.floor(this.Pixel_x/fA)+1,this.Grid_x=k.clamp(this.Grid_x,1,dQ),this.Grid_x_2=this.Grid_x},b.prototype._Grid_Y_Set=function(){this.Grid_Y=Math.floor(this.Pixel_y/fA)+1},b.prototype._Kind_Set=function(a){this.kind=a,a==bt?(this.Health=6,this.Size=38,this.Speed=.7*(1+.013*a6),dE==dy||dE==dF||(this.Speed=.6*(1+.027*a6)),this.Grid_x=g$(),this.Grid_x_2=this.Grid_x,this.Pixel_x=(this.Grid_x-.5)*fA,this.Pixel_x+=(k.random()-.5)*(.1*fA)):a==br?(this.Health=99,this.Size=38,this.Speed=1.5*(1+.01*a6),this.Grid_x=d_,this.Grid_x_2=this.Grid_x,this.Pixel_x=(this.Grid_x-.5)*fA,this.Pixel_x+=(k.random()-.5)*(.05*fA)):a==bq?(this.Health=12,this.Size=38,this.Speed=.7*(1+.01*a6),this.Grid_x=g$(),this.Grid_x_2=this.Grid_x,this.Pixel_x=(this.Grid_x-.5)*fA,this.Pixel_x+=(k.random()-.5)*(.05*fA)):(this.Health=-13+11*a6,this.Speed=.6*(1+.01*a6),a6>40&&(this.Health+=99,this.Speed+=.3*this.Speed),this.Size=.7*k.imagesizexget(k.images[61]),this.Grid_x=d_,this.Grid_x_2=this.Grid_x,this.Pixel_x=(this.Grid_x-.5)*fA),this.Health_max=this.Health},b.prototype._Road_follow=function(){var a=0,b=0;null!=dE.Road&&this.Grid_Y<=k.arrayheightget(dE.Road)&&this.Grid_Y>=1&&dE.Road[this.Grid_x][this.Grid_Y]&&(3==this.Direction&&(b=Math.floor(this.Pixel_y/fA-.5)+1)>0&& !dE.Road[this.Grid_x][b]&&(dE.Road[this.Grid_x-1][this.Grid_Y]&&(this.Direction=2),dE.Road[this.Grid_x+1][this.Grid_Y]&&(this.Direction=4)),4==this.Direction&&(a=Math.floor(this.Pixel_x/fA+.5)+1)<=k.arraylengthget(dE.Road)&& !dE.Road[a][this.Grid_Y]&&(dE.Road[this.Grid_x][this.Grid_Y-1]?this.Direction=3:dE.Road[a][this.Grid_Y+1]&&(this.Direction=1)))},b.prototype._Speed_Now_Get=function(){var b=0,a=null;return this.Is_Dead||this.Got_Zapped>0||null!=this.Tile_that_its_shooting?0:(b=this.Speed,a=iT(this.Grid_x,this.Grid_Y),this.Got_Colded=0,null!=a&&a.Kind==fz&&k.mod(this.Pixel_y/fA,1)>.1&&.6>k.mod(this.Pixel_y/fA,1)&&(b*=1-(.42+.12*a.Tier_Index),this.Got_Colded=1,a.Reload_Delay=2),k.loops-this.Spawn_time<50&&(b*=(k.loops-this.Spawn_time)/50),b)},b.prototype._Take_Damage=function(a){this.Is_Dead||((this.kind==br?this.Health-=1:this.Health-=a.Damage,this.Health<=0)?this._Die():(a.Tower.Kind==fx&&(this.Arrows_coming-=1),this.kind==bq&&this.Health<=6&&!(this.Health+a.Damage<=6)&&ix(k.sounds[29]),this.Took_Damage_Time=k.loops,this.Pixel_x+=Math.cos(a.Direction_Angle*k._degreestoradians)*this.kind.Lightness,null==this.Tile_that_its_shooting&&(this.Pixel_y+=Math.sin(a.Direction_Angle*k._degreestoradians)*(this.kind.Lightness/2))),this.kind==br&&(gQ(1,this.Pixel_x,this.Pixel_y,!0),ix(k.sounds[10])))},b.prototype._Update2=function(){var a=null;if(this.Current_frame_index+=.18,Math.floor(this.Current_frame_index)>k.arraylengthget(this.kind.Images)&&(this.Current_frame_index=1),this.Is_Dead){if(this.Got_to_castle){if(k.loops-this.Dead_Time>15){this._Damage_The_Castle();return}}else this.Pixel_y+=.3*this.Speed;k.loops-this.Dead_Time>20&&k.listremove(16,G,this);return}if(null==this.kind&&(null==this.Tile_that_its_shooting?null==(a=iT(this.Grid_x,this.Grid_Y-1))||a.Destroyed||a.Kind!=a.Kind.Upgraded_version||(this.Tile_that_its_shooting=a,this.Shoot_Time=k.loops):(this.Tile_that_its_shooting.Health-=1,this.Tile_that_its_shooting.Health<=0&&(this.Tile_that_its_shooting.Destroyed=!0,this.Tile_that_its_shooting=null,this.Shoot_Time=0,ix(k.sounds[7])))),this.Got_Zapped>0&&(this.Shoot_Time=0,this.Got_Zapped+=1,this.Pixel_x+=.9*Math.sin(72*this.Got_Zapped*k._degreestoradians),this._Grid_X_Set(),this.Grid_x_2=this.Grid_x,this.Got_Zapped>7*this.kind.Lightness&&(this.Got_Zapped=0)),this.Baby_spawn_loops>0&&(this.Baby_spawn_loops-=1,this.Pixel_x+=Math.cos(this.Baby_spawn_angle*k._degreestoradians),this.Pixel_y+=Math.sin(this.Baby_spawn_angle*k._degreestoradians),this._Grid_X_Set()),3==this.Direction&&(this.Pixel_y-=this._Speed_Now_Get()),4==this.Direction&&(this.Pixel_x+=this._Speed_Now_Get(),this._Grid_X_Set()),2==this.Direction&&(this.Pixel_x-=this._Speed_Now_Get(),this._Grid_X_Set()),this.Pixel_x<0&&(this.Pixel_x+=.5),this.Pixel_x>dQ*fA&&(this.Pixel_x-=.5),this._Grid_Y_Set(),this.Pixel_y<0-fA){this.Got_to_castle=!0,this.Is_Dead=!0,this.Dead_Time=k.loops;return}this.kind==bs&& !this.Is_Dead&&this.Pixel_y<0&&this._Die(),this.kind,this._Road_follow()},e.prototype._Get_User_Lordy_Rank=function(){var a=0;if(this==null||this==dC)return 0;if(null!=this.Scores)for(a=1;a<=k.arraylengthget(this.Scores);a++){if(this.Scores[a].name==hn("screenname"))return a;if(a>=k.arraylengthget(eL))break}return 0},e.prototype._Goal_Number_Next_Get=function(){return 0==dA?this.Goal_Number_1:1==dA?this.Goal_Number_2:this.Goal_number_4>0&&3==dA?this.Goal_number_4:this.Goal_number_5>0&&4==dA?this.Goal_number_5:5==dA?0:this.Goal_Number_3},e.prototype._Goal_Text_Next_Get=function(){return this==dy&&d9?"Swap these stones to match 3/in a row!":0==dA?iM(this.Goal_Text_1,"=",""+this._Goal_Number_Next_Get()):1==dA?iM(this.Goal_Text_2,"=",""+this._Goal_Number_Next_Get()):this.Goal_number_4>0&&3==dA?iM(this.Goal_text_4,"=",""+this._Goal_Number_Next_Get()):this.Goal_number_5>0&&4==dA?iM(this.Goal_text_5,"=",""+this._Goal_Number_Next_Get()):iM(this.Goal_Text_3,"=",""+this._Goal_Number_Next_Get())},e.prototype._Scores_from_text=function(e){var a=null,b=0,c=null,d=null;if(""!=e)for(b=1,d=k.split(e,","),this.Scores=k.arraymake(4,null,k.arraylengthget(d));b<=k.arraylengthget(this.Scores);b++)a=new jR,c=k.split(d[b],"@"),2>k.arraylengthget(c)?(a.name="Error",a.score=0):(a.name=c[1],a.score=1*c[2]||0),a.Rank=b,a.Avatar=k.listitemget(16,bu,b+1),("Curtastic"==a.name||"CurtBot"==a.name)&&(a.Avatar=gt(30)),("JoeCreates"==a.name||"JoeBot"==a.name)&&(a.Avatar=gt(18)),("HomerGlumplich"==a.name||"HomerBot"==a.name)&&(a.Avatar=gt(31)),("Lemonzest"==a.name||"LemonBot"==a.name)&&(a.Avatar=gt(8)),("Zuiggurat"==a.name||"ZigBot"==a.name)&&(a.Avatar=gt(26)),("SirWelBot"==a.name||"SirWelchito"==a.name)&&(a.Avatar=gt(23)),("GreyBot"==a.name||"GreyHam"==a.name)&&(a.Avatar=gt(25)),a.name==eQ&&(a.Avatar=k.listfirstget(39,bu)),this.Scores[b]=a},c.prototype._Hours_Total_Get=function(){return hY(this.Tier)},c.prototype._Open=function(c){var a=0,b="";for(a=1;a<=4;a++)if(this==es[a]){eo=a,ep=this.Tier,en=this.Buildings,g0(bV),c_=this.Gold,ix(k.sounds[7]);break}b="chestopen.php?",b+="&index="+eo,c&&(b+="&pay=1"),aJ=gp(b,!1),c&&(k.debugset("notisclear"),ix(k.sounds[10]),c$-=this._Unlock_cost_get())},c.prototype._Time_Remaining_Get=function(){var a=0,b=0;return this.Time_Unlock_Started>0&&(a=Math.floor(new Date().getTime()/1e3)-this.Time_Unlock_Started,(b=3600*this._Hours_Total_Get()-a)>0)?b:0},c.prototype._Unlock_cost_get=function(){return Math.ceil(this._Time_Remaining_Get()/(3600*this._Hours_Total_Get())*this.Gold/2)},c.prototype._Unlock_Start=function(){var a=0,b="";if(aI>0){alert("Already unlocking");return}for(a=1;a<=4;a++)this==es[a]&&(aI=a);b="chestunlockstart.php?",b+="&index="+aI,aK=gp(b,!1),ix(k.sounds[20])},d.prototype._Delete=function(){this.Tower=null,this.Target_Enemy=null,k.listremove(2,I,this)},d.prototype._Draw3=function(){var c=0,a=0,b=null;null!=this.Tower&&(this.Exploded_time>0?((a=3*this.Exploded_time)>15&&(a=15),k.transparencyset(.2),this.Exploded_time>10&&k.transparencyset((this.Exploded_time-10)/6),k.imagedrawgl(k.images[63],this.Pixel_X-a/2,this.Pixel_Y-a/2,a,a),k.transparencyset(0)):this.Tower.Kind==fm?(k.imagerotationset(this.Image,this.Direction_Angle),k.imagerotationset(k.images[66],this.Direction_Angle),k.imagedrawgl(k.images[66],this.Pixel_X,this.Pixel_Y),c=Math.sin(Math.abs(this.Start_x-this.Pixel_X)/Math.abs(this.Start_x-this.Target_X)*180*k._degreestoradians)*(10+Math.abs(this.Start_x-this.Target_X)/9),k.imagedrawgl(this.Image,this.Pixel_X,this.Pixel_Y-c),k.fps>58&&(b=k.images[403],1>k.mod(k.loops,2)&&(b=k.images[404]),k.imagerotationset(b,this.Direction_Angle),k.imagedrawgl(b,this.Pixel_X-0,this.Pixel_Y-c))):(this.Tower.Kind==fo&&(90>Math.abs(this.Direction_Angle-90)?this.Direction_Angle=0:this.Direction_Angle=180),this.Tower.Kind==fx?k.imagerotationset(this.Image,this.Direction_Angle-90):k.imagerotationset(this.Image,this.Direction_Angle),k.imagedrawgl(this.Image,this.Pixel_X,this.Pixel_Y)))},d.prototype._Hit_Enemy=function(a){var b=0;return b=2,this.Exploded_time>0&&(b=15),!!k.rectshit(this.Pixel_X-b/2,this.Pixel_Y-b/2,b,b,a.Pixel_x-a.Size/3,a.Pixel_y-a.Size/2,.66*a.Size,a.Size)},d.prototype._Retarget=function(){var a=null;if(this.Tower.Kind==fo)for(var b=G.first;b;){if(!(a=b.val).Is_Dead&&a.Grid_x==this.Tower.Grid_x&&a.Pixel_y<this.Pixel_Y==this.Shot_up){this.Target_Enemy=a;return}b=b.next}if(this.Tower.Kind==fx)for(var c=G.first;c;){if(!(a=c.val).Is_Dead&&9>Math.abs(this.Pixel_X-a.Pixel_x)&&9>Math.abs(this.Pixel_Y-a.Pixel_y)){this.Target_Enemy=a;return}c=c.next}this.Tower.Kind==fm?this.Exploded_time=1:this._Delete()},d.prototype._Update3=function(){var d=0,a=null;if(this.Exploded_time>0){if(this.Exploded_time+=1,5==this.Exploded_time)for(var b=G.first;b;)a=b.val,this._Hit_Enemy(a)&&(d=k.angleto(this.Pixel_X,this.Pixel_Y,a.Pixel_x,a.Pixel_y),a.Pixel_x+=Math.cos(d*k._degreestoradians)*a.kind.Lightness*.3,null==a.Tile_that_its_shooting&&(a.Pixel_y+=Math.sin(d*k._degreestoradians)*a.kind.Lightness*.3)),b=b.next;this.Exploded_time>15&&this._Delete();return}if(this.Tower.Kind!=fm&&null!=this.Target_Enemy){if(this.Target_Enemy.Is_Dead){this._Retarget();return}this.Direction_Angle=k.angleto(this.Pixel_X,this.Pixel_Y,this.Target_Enemy.Pixel_x+0,this.Target_Enemy.Pixel_y+0)}if(null==this.Target_Enemy&&(this.Direction_Angle=k.angleto(this.Pixel_X,this.Pixel_Y,this.Target_X+0,this.Target_Y+0)),this.Pixel_X+=Math.cos(this.Direction_Angle*k._degreestoradians)*this.Speed,this.Pixel_Y+=Math.sin(this.Direction_Angle*k._degreestoradians)*this.Speed,null!=this.Target_Enemy){if(this._Hit_Enemy(this.Target_Enemy)){this.Target_Enemy._Take_Damage(this),this.Tower.Kind==fm?this.Exploded_time=1:this._Delete();return}}else if(k.rectshit(this.Pixel_X,this.Pixel_Y,5,5,this.Target_X,this.Target_Y,5,5)){for(var c=G.first;c;){if(a=c.val,this._Hit_Enemy(a)){a._Take_Damage(this);break}c=c.next}this.Exploded_time=1}},i.prototype._Draw4=function(){var c=0,b=0,a="";if(this.Life<10&&k.transparencyset(1-this.Life/10),this.Life>this.Life_start-20&&k.transparencyset(gZ(this.Life,this.Life_start,this.Life_start-20,1,0)),a="+1 Swap!",this.Amount>1&&(a="+"+(""+this.Amount+" Swaps!")),b=3,this.Chain>=b){for(a="",this.Chain==b+0?.5>h3(this.Loops_Made)?a+="great":a+="good":this.Chain==b+1?.5>h3(this.Loops_Made)?a+="awesome":a+="excellent":this.Chain==b+2?.5>h3(this.Loops_Made)?a+="amazing":a+="stunning":.5>h3(this.Loops_Made)?a+="towering":a+="glorious",a+=" combo!",this.Chain<=b?a+="/Have a swap ":a+="/Take my swaps! ",c=1;c<=this.Chain-b+1;c++)a+="&";g8(a,"",k.images[74],this.Life_start-this.Life)}else iH(a,this.X,this.Y+c,14,!0);k.transparencyset(0)},i.prototype._Update4=function(){this.Life-=1,this.Life<1&&k.listremove(2,bw,this),this.Chain<=0&&(this.Y-=.11)},j.prototype._Update5=function(){var a=0;(fb=k.loops,a=k.loops-this.Time_created,a<30)?(this.y-=20/(a+5),this.Chest_y>0&&(this.y,k.imagesizeyget(k.images[346]),this.Chest_y),k.imagedrawglpart(k.images[346],this.x-8,this.y-8,0,0,k.imagesizexget(k.images[346]),k.clamp(this.Chest_y-(this.y-8),0,k.imagesizeyget(k.images[346])))):(.4>k.random()&&(this.Old_x=this.x,this.Old_y=this.y),this.x+=(55-this.x)/15,this.y+=(-8-S-this.y)/15,this.y<15+hV()-S&&(k.listremove(20,J,this),k.soundplaying(k.sounds[18])||ix(k.sounds[18]),fa=k.loops,d0+=1),k.imagedrawgl(k.images[1],this.Old_x-4,this.Old_y-4,8,8),k.imagedrawgl(k.images[346],this.x-8,this.y-8)),k.transparencyset(0)},a.prototype._Arm_Castle_Tower=function(){bG==cO&&(d7=!0),this._Remove_delete_and_replace(!1),ff=null,aw[this.Grid_x]=this,this.Grid_y=0,this.Dragged_off_edge_time=k.loops,this._Pixel_Position_Reset(),ix(k.sounds[23]),i6()},a.prototype._Arm_Castle_Tower_Can=function(){var a=null;return this.Kind==fx&&1==this.Grid_y&&(1==this.Grid_x||this.Grid_x==dQ)&&(null==(a=aw[this.Grid_x])||a.Tier_Index<this.Tier_Index)},a.prototype._Ballista_Top_Draw=function(){var b=0,a=0,c=0,d=0;this._Blink_draw(),c=this.Kind.X_offset,d=this.Kind.Y_Offset,b=this.Pixel_x+c+this.Shift_X,a=this.Pixel_y+d+this.Shift_Y,this.Tier_Index<=2&&(a+=1),this.Tier_Index<=1&&(a+=1),this.Flipped?(this.Tier_Index<=1&&(a+=1),k.imagedrawgl(k.images[436],b,a)):k.imagedrawgl(k.images[420],b,a),k.transparencyset(0)},a.prototype._Blink_draw=function(){var a=0;this.Blink>0&&(this.Kind==fp&&null==this.Match_join_tile&&bG==bO&&null==this.Turning_into_kind?this.Frame=2:dU<999?k.transparencyset(Math.abs(Math.sin(350*this.Blink*k._degreestoradians))):k.transparencyset(Math.abs(Math.sin(700*this.Blink*k._degreestoradians)))),this.Appear_loops>0&&k.transparencyset(Math.abs(Math.sin(this.Appear_loops*(25+1/this.Appear_loops*88)*k._degreestoradians))),(a=k.loops-this.Time_Created)<30&&a>=0&&k.transparencyset(1-a/31)},a.prototype._Cannonslot_attach=function(){iU(this.Grid_x,this.Grid_y)&&(this.Flipped_preferred=this.Grid_x>1,this.Flipped=this.Flipped_preferred,ix(k.sounds[27]))},a.prototype._Chest_Open=function(){var a=0,b=0,e=0,c=0,d=0;this.Tier_Index>0&&(e=0,1==this.Tier_Index&&(e=2),2==this.Tier_Index&&(e=12),3==this.Tier_Index&&(e=70),4==this.Tier_Index&&(e=400),iB(this.Pixel_x+fA/2,this.Pixel_y+fA/1.5+3,e,0),iD(this.Pixel_x+fA/2,this.Pixel_y+fA/2+21,e,this.Pixel_y+fA/2+9)),this.Removed=!0,this.Tapped_to_open_chest=!1,jf(),g0(bO),Q+=1,ix(k.sounds[14]),a=1,this.Tier_Index<=3&&(a/=2.9),this.Tier_Index<=2&&(a/=2.9),this.Tier_Index<=1&&(a/=2.9),a8&&(c=k.mod(fJ-R,fA)/fA,d=k.mod(fL-S,fA)/fA,k.debugset(""+c),k.debugset(""+d),(c<.25||c>.75)&&(d<.25||d>.75)&&(a=999)),k.random()<a&&(a=.55,a*=Math.pow(.9,a9),b=k.random()<a?1:k.randomint(2,4),a8&&(c<.25&&d<.25&&(b=1),c>.75&&d<.25&&(b=2),c<.25&&d>.75&&(b=3),c>.75&&d>.75&&(b=4)),1==b?(jH(333),ix(k.sounds[25]),g0(b1),aF=this,aH=function(){for(var a=null,b=0;;){if(b++ >999999)throw{line:1,message:"Infinite While Loop"};if((a=k.listitemget(1,K,k.randomint(1,K.total)))==a.Upgraded_version&&!a.Unmovable)return a}return null}(),bc=1,(a9>0||ba>0)&&(bc=2),aG=0,ap>1&&(k.random()>.5||eh)&&(aG=k.randomint(2,5),aG+=k.clamp(a9,0,4),aG=k.clamp(aG,0,ap-1))):2==b?(jH(222),ix(k.sounds[25]),aF=this,g0(cK),this.Turning_into_kind=fw,this.dynamite_total=k.randomint(1,3)):3==b?(jH(222),ix(k.sounds[25]),aF=this,g0(cK),this.Turning_into_kind=fl):4==b&&(jH(222),ix(k.sounds[25]),aF=this,g0(b9)))},a.prototype._Delete2=function(){this.Match_join_tile=null,k.listremove(1,L,this)},a.prototype._Draw5=function(p){var l=0,i=0,h=0,b=0,c=0,d=0,a=null,n=!1,o=null,f=null,e=0,g=0,m=0,j=0;if(this.Destroyed){bG==b0?k.loops-e5<60&&(k.transparencyset((k.loops-e5)/60),k.imagedrawgl(k.images[107],this.Pixel_x,this.Pixel_y),k.transparencyset(0)):k.imagedrawgl(k.images[107],this.Pixel_x,this.Pixel_y);return}if(0==this.Grid_y&&(this==aw[1]||this==aw[dQ])){this._Draw_castle_tile();return}if(this==ff&&iX()&&(k.transparencyset(1-Math.abs(.4*Math.sin(8*k.loops*k._degreestoradians))),(0,this.Kind.Upgraded_version)._Draw6(this.Tier_Index+1,fg.Pixel_x,fg.Pixel_y,0),k.transparencyset(0)),this._Blink_draw(),this==aF&&(this.Frame=2),this.Dragged_off_edge_time>0&&((g=k.loops-this.Dragged_off_edge_time)>30?k.transparencyset(1):k.transparencyset(g/31)),m=this.Kind.X_offset,j=this.Kind.Y_Offset,this.Kind==fx&&(j=k.imagesizeyget(this.Kind.Level_Images[this.Tier_Index])-50),this.Shift_X=k.moveto(this.Shift_X,0,.005*fA),this.Shift_Y=k.moveto(this.Shift_Y,0,.005*fA),b=this.Pixel_x+m+this.Shift_X,c=this.Pixel_y-j+this.Shift_Y,(this.TNT_hit_loops>0||this==fB)&&(b+=2*Math.sin(33*k.loops*k._degreestoradians),this.TNT_hit_loops>0)){if(k.loops-this.TNT_hit_loops>55){k.transparencyset(0);return}k.loops-this.TNT_hit_loops>50&&k.transparencyset(k.clamp((k.loops-this.TNT_hit_loops-50)/7,0,1))}if(p?(b=this._Pixel_Target_X_Get()+m+this.Shift_X,c=this._Pixel_Target_Y_Get()-j+this.Shift_Y,k.transparencyset(.5)):this==ff&&null!=fg&&fg.Kind==fu&&this._Draw5(!0),this.Kind==fu&&this==fg&&k.transparencyset(Math.abs(.6*Math.sin(6*k.loops*k._degreestoradians))),this.Kind==fn&&this.Grid_x>1&&(b+=7),this.Tapped_to_open_chest&&(b+=Math.sin(44*k.loops*k._degreestoradians)),null==this.Kind.Level_Images){if(a=this.Kind.Image,this==fB&&(a=k.images[402]),this.Frame>1){if(null==this.Kind.Frame_Images){alert("Error!");return}a=this.Kind.Frame_Images[Math.floor(this.Frame)]}if(this.Kind==ft&&this.Water_depth<=1&&(a=k.images[229],c+=44,this.Grid_x>=dQ&&(a=k.images[231],c-=16),this.Grid_x<=1&&(a=k.images[231],n=!0,b-=16,c-=16)),this==ff&&null==fg&&(e9>=0||this.Kind==fv&&e9<0&&ap<as)||this.Dragged_off_edge_time>0?(i=d=this.Dragged_off_edge_time>0&&!this.Dragged_into_lake?fA+g:Math.abs(bf),e8<0&&(i=0-i),d=k.clamp(d,0,2*fA),k.transparencyset(d/(2*fA)),k.imageoffsetset(a,k.imagesizexget(a)/2,k.imagesizeyget(a)/2),k.imagerotationset(a,i),k.imagedrawgl(a,b+k.imagesizexget(a)/2,c+k.imagesizeyget(a)/2),k.imagerotationset(a,0),k.imageoffsetset(a,0,0),k.transparencyset(0)):n?g2(a,b,c):k.imagedrawgl(a,b,c),this.Kind==ft&&this.Water_depth<=111)for(c-=22,(this.Grid_x<=1||this.Grid_x>=dQ)&&(c+=16),e=1;e<=2;e++){if(f=k.images[228],.3>h4(5*this.Grid_x+(this.Grid_y+e))&&(f=k.images[226]),h4(5*this.Grid_x+this.Grid_y+e)>.7&&(f=k.images[227]),null!=(o=e<2?iT(this.Grid_x-1,this.Grid_y):iT(this.Grid_x+1,this.Grid_y))&&o.Kind!=this.Kind){b+=fA/2;continue}l=fA/2-k.imagesizexget(f),.5>h4(3*this.Grid_x+this.Grid_y+e)?k.imagedrawgl(f,b+h4(this.Grid_x+this.Grid_y+e)*l,c+33+13*h4(2*this.Grid_x+this.Grid_y+e)):g2(f,b+h4(this.Grid_x+this.Grid_y+e)*l,c+33+13*h4(2*this.Grid_x+this.Grid_y+e)),b+=fA/2}}else h=fA,a=null==this.Kind.Level_Frames?this.Kind.Level_Images[this.Tier_Index]:this.Kind.Level_Frames[this.Tier_Index][Math.floor(this.Frame)],this.Kind==fo&&(this.Reload_Delay>=10&&(a=k.images[421],2==this.Tier_Index&&(a=k.images[423]),3==this.Tier_Index&&(a=k.images[425]),4==this.Tier_Index&&(a=k.images[427])),this.Flipped&&(this.Reload_Delay>=10?(a=k.images[437],2==this.Tier_Index&&(a=k.images[438]),3==this.Tier_Index&&(a=k.images[439]),4==this.Tier_Index&&(a=k.images[440])):(a=k.images[432],2==this.Tier_Index&&(a=k.images[433]),3==this.Tier_Index&&(a=k.images[434]),4==this.Tier_Index&&(a=k.images[435])))),this.Kind==fm&&iU(this.Grid_x,this.Grid_y)&&(a=k.images[377],2==this.Tier_Index&&(a=k.images[378]),3==this.Tier_Index&&(a=k.images[379]),4==this.Tier_Index&&(a=k.images[380]),c-=6),this==ff&&null==fg&&e9<0&&ff._Arm_Castle_Tower_Can()?(d=Math.abs(bf),d=k.clamp(d,0,1.5*fA),k.transparencyset(d/(1.5*fA)),k.imagedrawgl(a,b,c),k.transparencyset(0),this._Draw_castle_tile()):this.Kind==fm&&this.Flipped?(b-=(h=0-(h=k.imagesizexget(a)))-4,k.imagedrawgl(a,b,c,h,k.imagesizeyget(a))):(this.Kind==fo&&this.Flipped,k.imagedrawgl(a,b,c));if(this.Kind==fx&&(2==this.Tier_Index||3==this.Tier_Index)&&k.imagedrawgl(fP[this.Tier_Index][1+k.mod(Math.floor(k.loops/10),4)],b,c-2+7*jM(3==this.Tier_Index,0)),this.Kind==fm&&(this.Flipped&&(b+=h-40),this.Reload_Delay<10&&k.transparencyset(.5-k.clamp(this.Reload_Delay,0,9)/20),0==k.mod(Math.floor(k.loops/22),4)&&k.imagedrawgl(k.images[274],b+36,c-4),1==k.mod(Math.floor(k.loops/22),4)&&k.imagedrawgl(k.images[275],b+36,c-4),2==k.mod(Math.floor(k.loops/22),4)&&k.imagedrawgl(k.images[276],b+36,c-4),3==k.mod(Math.floor(k.loops/22),4)&&k.imagedrawgl(k.images[277],b+36,c-4),k.transparencyset(0)),this.Kind==fo&&this.Reload_Delay<10&&(k.imagerotationset(this.Kind.Projectile_Images[this.Tier_Index],0),this.Flipped?k.imagedrawgl(this.Kind.Projectile_Images[this.Tier_Index],b+25,c+fA/2-2+jM(this.Tier_Index<=2,2),k.imagesizexget(this.Kind.Projectile_Images[this.Tier_Index]),0-k.imagesizeyget(this.Kind.Projectile_Images[this.Tier_Index])):k.imagedrawgl(this.Kind.Projectile_Images[this.Tier_Index],b+k.imagesizexget(k.images[419])/2,c+fA/2-2+3)),this.Kind==fw)for(d=1;d<=this.dynamite_total;d++)k.imagedrawgl(k.images[368],b-2-1*d,c+4+(-5*this.dynamite_total+7*d));k.transparencyset(0),this.TNT_hit_loops>0&&(k.transparencyset(.5),k.imagedrawgl(k.images[109],b+22-6*Math.sin(16*k.loops*k._degreestoradians),c+22+5*Math.cos(16*k.loops*k._degreestoradians)),k.imagedrawgl(k.images[109],b+22-5*Math.sin((16*k.loops+180)*k._degreestoradians),c+22+6*Math.cos((16*k.loops+170)*k._degreestoradians)),k.transparencyset(0)),this.Kind==fu&&(k.transparencyset(Math.abs(.4*Math.sin(1.6*k.loops*k._degreestoradians))),k.imagedrawgl(k.images[359],b-3,c+25),k.transparencyset(0)),iU(this.Grid_x,this.Grid_y)&&k.imagedrawgl(k.images[376],this._Pixel_Target_X_Get()+fn.X_offset+this.Shift_X+7*jM(this.Grid_x>1,0),this._Pixel_Target_Y_Get()+16+3*jM(this.Kind==fn,0)),this.Dragged_off_edge_time>0&&dE.Is_water_level&&(d=Math.floor(g/30*11),d=k.clamp(d,0,10),g>20&&k.transparencyset(k.clamp((g-20)/10,0,1)),c=this._Pixel_Target_Y_Get()+15,b=this._Pixel_Target_X_Get(),b+=66*e8,b+=8,c+=74*e9,d=k.clamp(94*d-15,0,k.imagesizexget(k.images[366])),k.imagedrawglpart(k.images[366],b,c,d,0,44,k.imagesizeyget(k.images[366])),k.transparencyset(0))},a.prototype._Draw_castle_tile=function(){var c=0,d=0,a=null,b=0,e=0;k.loops-this.Dragged_off_edge_time<55&&6>k.mod(k.loops,12)||(b=this.Tier_Index,ff==this&&null==fg&&e9<0&&ff._Arm_Castle_Tower_Can()&&ff.Grid_x==this.Grid_x&&k.transparencyset(.5*Math.abs(Math.cos(9*k.loops*k._degreestoradians))+.4),a=1==b?k.images[309]:2==b?k.images[315]:3==b?k.images[316]:k.images[317],e=0-k.imagesizeyget(k.images[308])+ -12,d=e+20+142,this.Grid_x>1?(c=0+V/2+av-k.imagesizexget(k.images[308])/2+281,k.imagedrawgl(a,c+k.imagesizexget(a),d,0-k.imagesizexget(a),k.imagesizeyget(a)),c-=2):(c=0+V/2+av-k.imagesizexget(k.images[308])/2+(17+k.imagesizexget(a)),k.imagedrawgl(a,c,d,k.imagesizexget(a),k.imagesizeyget(a))),this.Reload_Delay<10&&(k.imagerotationset(fx.Projectile_Images[b],0),k.imagedrawglpart(fx.Projectile_Images[b],c+13,d+27,0,12,k.imagesizexget(fx.Projectile_Images[b]),11)),k.transparencyset(0))},a.prototype._Kind_can_go_here=function(a){return!iU(this.Grid_x,this.Grid_y)||a==fm},a.prototype._Kind_Set2=function(a){this.Kind=a,this.Frame=1},a.prototype._Kind_set_randomly=function(){for(var a=0;;){if(a++ >999999)throw{line:1,message:"Infinite While Loop"};if(this.Kind=k.listitemget(1,K,k.randomint(1,K.total)),this.Kind!=this.Kind.Upgraded_version&&null!=this.Kind.Upgraded_version&&!this.Kind.Unmovable)break}},a.prototype._Make_coin=function(){var a=null;(a=new h).x=this.Pixel_x+fA/2,a.y=this.Pixel_y+fA/2,a.Start_x=a.x,a.Start_y=a.y},a.prototype._Pixel_Position_Reset=function(){this.Pixel_x=this._Pixel_Target_X_Get(),this.Pixel_y=this._Pixel_Target_Y_Get()},a.prototype._Pixel_Target_X_Get=function(){return(this.Grid_x-1)*fA},a.prototype._Pixel_Target_Y_Get=function(){return(this.Grid_y-1)*fA},a.prototype._Remove_From_Grid=function(){var c=0,a=0,b=null;a=this.Grid_y,c=this.Grid_x;for(var d=0;a>1;){if(d++ >999999)throw{line:3,message:"Infinite While Loop"};b=dP[c][a-1],dP[c][a]=b,null!=b&&(b.Grid_y=a,b.Moved_time=k.loops),a-=1}dP[c][1]=null},a.prototype._Remove_delete_and_replace=function(a){this._Remove_From_Grid(),this._Delete2(),this._Removed_so_replace(a)},a.prototype._Removed_so_replace=function(c){var b=null;if(b=new a,c)for(var d=0;b.Kind==this.Kind;){if(d++ >999999)throw{line:3,message:"Infinite While Loop"};b._Kind_set_randomly()}b.Grid_x=this.Grid_x,b.Grid_y=1,b.Pixel_x=b._Pixel_Target_X_Get(),b.Pixel_y=0-fA,dP[this.Grid_x][1]=b,bG=b6},a.prototype._Shoot_Enemy=function(b){var e=0,a=null,c=0;for(this.Reload_Delay=this.Kind.Reload_delay/Math.pow(2.4,this.Tier_Index-1),e=1,this.Kind==fm&&(iU(this.Grid_x,this.Grid_y)&&(this.Reload_Delay=.7*this.Reload_Delay),b.Grid_x!=this.Grid_x&&(this.Flipped=b.Grid_x<this.Grid_x),this.Tilted=b.Grid_x==this.Grid_x),c=1;c<=e;c++)(a=new d).Tower=this,a.Level=this.Tier_Index,a.Damage=this.Kind.Damage,a.Image=this.Kind.Projectile_Image,null!=this.Kind.Projectile_Images&&(a.Image=this.Kind.Projectile_Images[this.Tier_Index]),a.Pixel_X=this.Pixel_x+fA/2,a.Pixel_Y=this.Pixel_y+fA/2,this.Grid_y<=0&&(a.Pixel_Y-=3),a.Target_Enemy=b,this.Kind==fx&&(b.Arrows_coming+=1),this.Kind==fo&&(a.Shot_up=b.Pixel_y<this.Pixel_y),this.Kind==fm&&(a.Target_X=b.Pixel_x,a.Target_Y=b.Pixel_y,a.Target_Y-=Math.abs(a.Pixel_X-a.Target_X)/a.Speed*Math.abs(a.Target_Enemy._Speed_Now_Get()),a.Target_Enemy=null,this.Flipped?(a.Direction_Angle+=180,a.Pixel_X+=-12):a.Pixel_X+=12,a.Pixel_Y-=1,a.Start_x=a.Pixel_X);this.Kind==fm&&(this.Shift_X=.05*fA,b.Pixel_x>a.Pixel_X&&(this.Shift_X=0-this.Shift_X)),this.Kind==fo&&(b.Grid_Y!=this.Grid_y&&(this.Flipped=b.Grid_Y<this.Grid_y),this.Shift_Y=-0.05*fA),null!=this.Kind.Shoot_Sound&&ix(this.Kind.Shoot_Sound)},a.prototype._Shoot_Enemy_Can=function(a){if(a.Is_Dead||a.Grid_Y>=10)return!1;if(this.Kind==fo&&this.Grid_x>=a.Grid_x&&this.Grid_x<=a.Grid_x_2)return!0;if(this.Kind==fm)return!(this.Flip_loops>0)&&this.Grid_y==a.Grid_Y;if(this.Kind==fx){if(this==aw[1]||this==aw[dQ]){if(this.Grid_x-2<=a.Grid_x_2&&this.Grid_x+2>=a.Grid_x&&2>=Math.abs(this.Grid_y-a.Grid_Y))return!0}else if(this.Grid_x-1<=a.Grid_x_2&&this.Grid_x+1>=a.Grid_x&&1>=Math.abs(this.Grid_y-a.Grid_Y))return!0}return!1},a.prototype._Shoot_Enemy_Value_Get=function(a){var e=0,b=0,c=0,d=0;return(a.Got_Zapped>0&&(d=2*fA),this.Kind==fo)?fA/(Math.abs(this.Pixel_y-a.Pixel_y)+fA+d):(b=this.Pixel_x+fA/2,this.Pixel_y,this.Kind==fx)?(c=6*fA-(Math.abs(this.Pixel_x+fA/2-a.Pixel_x)+Math.abs(this.Pixel_y+fA/2-a.Pixel_y)),a.Arrows_coming*this.Kind.Damage>=a.Health&&(c*=.1),0==a.Arrows_coming&&a.Health<a.Health_max&&(c*=2),c):this.Kind==fm?(this.Flipped_preferred?b-=.55*fA:b+=.55*fA,(a.Grid_x<this.Grid_x==this.Flipped_preferred||this.Grid_x==a.Grid_x)&&(e=66*fA),(fA+e)/(Math.abs(b-a.Pixel_x)+fA+d)):1},a.prototype._TNT_use=function(){fB=this,g0(cL)},a.prototype._Update6=function(){var e=0,a=null,b=null,c=0;if(this.Appear_loops>0&&(this.Appear_loops-=1),this.Flip_loops>0&&(this.Flip_loops+=1,2==this.Flip_loops&&(this.Tilted=!0),3==this.Flip_loops&&(this.Flipped=!this.Flipped),4==this.Flip_loops&&(this.Tilted=!1,this.Flip_loops=0)),bG==cT){if(this.Reload_Delay<=0&&null!=this.Kind.Projectile_Image){if(!this.Destroyed)for(var d=G.first;d;)b=d.val,this._Shoot_Enemy_Can(b)&&(c=this._Shoot_Enemy_Value_Get(b),null==a?(a=b,e=c):c>e&&(e=c,a=b)),d=d.next;null!=a?this._Shoot_Enemy(a):this.Tilted=!1}this.Reload_Delay-=1,this.Tilted&&this.Tier_Index<=1&&0==this.Flip_loops&&this.Reload_Delay<.5*this.Kind.Reload_delay&&(this.Tilted=!1)}},a.prototype._Upgrade=function(){if(null==this.Kind.Upgraded_version){k.debugquit(1);return}this.Upgraded=!0,this.Tier_Index+=1,this.Health=100+20*this.Tier_Index,this.Kind==fz&&(this.Health+=40*this.Tier_Index),this.Blink=0,this.Frame=1,this.Removed=!1,this.Time_Created=k.loops,this.Kind==fs&&(this.Flipped=!1),this._Kind_Set2(this.Kind.Upgraded_version),this.Match_join_tile=null,1!=hm("tilekindtutorialdid"+this.Kind.id)&&d9&&(this.Kind.First_Matched_tile=this),this.Kind==fm&&this.Grid_x>=dQ-1&&(this.Flipped=!0,this.Flipped_preferred=!0),this.Moved_time=k.loops},a.prototype._Upgrade_Can=function(){return null!=this.Kind&&null!=this.Kind&&this.Kind!=fl&&null!=this.Kind.Upgraded_version&&this.Tier_Index<4},g.prototype._Draw6=function(c,b,a,d){a-=this.Y_Offset,b+=this.X_offset,null==this.Level_Images?k.imagedrawgl(this.Image,b,a):d<1?k.imagedrawgl(this.Level_Images[c],b,a):k.imagedrawgl(this.Level_Frames[c][d],b,a),this==fo&&(k.imagedrawgl(this.Projectile_Images[c],b+k.imagesizexget(k.images[419])/2,a+fA/2+1),c<=1&&(a+=1),c<=2&&(a+=1),k.imagedrawgl(k.images[420],b,a-0))},g.prototype._Name_Get=function(c,d){var a="",b="";return(d>1&&(b="s",a=""+d+" "),0==c&&null!=this.Upgraded_version)?a+(this.Name+b):(d<=1&&(a="a ",this==null&&alert("Error!"),"A"==k.stringpart(this.Name,1,1)&&(a="an ")),c>1)?a+(iQ(c)+" "+(this.Name+b)):a+(this.Name+b)},g.prototype._Resource_is=function(){return null!=this.Upgraded_version&&this.Upgraded_version!=this},f.prototype._Clear=function(){this.clan_name="",this.end_time=0,this.level=null},f.prototype._PrizeChest_get_draw=function(b){var a=0,c=0;if(c=88,this.User_is_in){if(this.chest_got)iJ("]",dW/2,b+11,14,!0,!1);else{if(gB("Get Chest",dW-180,b+6,!1,!1,!1,null!=ge,!1,!1),af){for(a=1,ek=0;a<=4;a++)if(es[a].Day<=0){ek=a,es[a].X=c+window.gtboffsetx,es[a].Y=b+window.gtboffsety,jI(),iz(),ix(k.sounds[22]);break}ek<=0&&(er=22,ix(k.sounds[29]))}null==ge&&hX(c,b,5,0,!1,!0)}}else iJ("You were not in this war.",dW/2,b+11,14,!0,!1)},f.prototype._PrizeChest_getting_draw=function(){var a,f=0,g=0,d=0,e=0,b=0,c=null;if(null!=ge){if(null==(c=es[ek])){k.debugquit(3);return}d=c.X,e=c.Y,b=e6/60,b>1&&(b=1,a=null,null!=ge&&""!=k.ajaxresponseget(0,ge)&&(a=k.split(k.ajaxresponseget(1,ge),","),k.arraylengthget(a)>=2&&"good"==a[1]?(gd.chest_got=!0,h2(a[2])):(k.arraylengthget(a)>=2&&("already got"==a[2]&&(gd.chest_got=!0,k.arraylengthget(a)>=3&&h2(a[3])),"war is going now"==a[2]&&(gd.end_time=1*a[3]||0)),ix(k.sounds[29])),ek=0,ge=null),null!=ge&&(hp(c.X-40,c.Y-11),e6>333&&(k.cursorset(15,"wait"),gB("Cancel",c.X-48,c.Y+6,!1,!1,!1,!1,!1,!1),af&&(hr("loadingcancel","warchestget.php"),ge=null,ek=0)))),f=h0(ek),f+=k.imagesizexget(k.images[117])/2,g=eU-eq-11,d+=(f-d)*b,e+=(g-e)*b,ek>2?d+=33*Math.sin(180*b*k._degreestoradians):d-=33*Math.sin(180*b*k._degreestoradians),hX(d,e,5,0,!1,!0)}},f.prototype._Score_total_get=function(d){var b=null,a=0,c=0;if(null==gd.level)return 0;if(null!=gd.level.Scores)for(a=1;a<=k.arraylengthget(gd.level.Scores);a++)(b=gd.level.Scores[a]).Is_other_war_clan!=d&&(c+=b.score);return c}}()